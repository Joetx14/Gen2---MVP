const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-BRRJ753s.js","assets/react-D8qwWWc-.js"])))=>i.map(i=>d[i]);
import{_ as H}from"./vendor-BRRJ753s.js";import{a as I,u as Y,r as n,R as e,E as G,h as J,i as Q,j as U}from"./react-D8qwWWc-.js";import{S as V}from"./StandardLayout-CODG-ZJt.js";import{F as K}from"./FormBox-DKl1xVdV.js";/* empty css                  */import{u as W}from"./usePlanningData-KxF1tlZ7.js";import"./PageWrapper-qXWqd5_q.js";import"./Footer-DbTn4dsc.js";import"./index-C_jNqslI.js";import"./amplify-CUteMs5F.js";const X=({donationAmount:b,firstName:p,lastName:x,setPaymentError:d,setIsSubmitting:i,navigate:o,clientSecret:P,isRecurring:E})=>{const l=J(),a=Q(),[c,f]=n.useState(!1);n.useEffect(()=>{console.log("DonationFormContent mounted"),console.log("Stripe initialized:",!!l),console.log("Elements initialized:",!!a)},[l,a]);const F=async S=>{if(S.preventDefault(),f(!0),i(!0),!l||!a){d("Stripe is not loaded yet. Please try again in a moment."),f(!1),i(!1);return}d(null);try{const h=await l.confirmPayment({elements:a,confirmParams:{return_url:`${window.location.origin}/dashboard?payment_success=true`,payment_method_data:{billing_details:{name:`${p} ${x}`.trim(),email:p?`${p.toLowerCase()}@example.com`:void 0}}},redirect:"if_required"});h.error?(console.error("[Stripe error]",h.error),d(h.error.message||"An unexpected error occurred during payment."),f(!1),i(!1)):o("/dashboard?payment_success=true")}catch(h){console.error("Payment confirmation error:",h),d("An unexpected error occurred. Please try again."),f(!1),i(!1)}};return e.createElement("form",{onSubmit:F,className:"payment-form"},e.createElement("div",{style:{marginBottom:"20px"}},e.createElement(U,{options:{layout:"tabs"}})),e.createElement("button",{type:"submit",className:"pay-button",disabled:!l||!a||c,style:{width:"100%",padding:"12px",backgroundColor:"#c05f68",color:"white",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"600",cursor:"pointer"}},c?e.createElement("span",null,"Processing..."):e.createElement("span",null,"Pay $",b.toFixed(2))))},me=()=>{const b=I(),p=Y(),{routeToLastStep:x}=W(),d=p.state?.returnToPlanning,i=p.state?.lastStep,[o,P]=n.useState(!0),E=[3,9],l=[10,25],[a,c]=n.useState(E[0]),[f,F]=n.useState(""),[S,h]=n.useState(""),[T,g]=n.useState(null),[Z,N]=n.useState(!1),[m,v]=n.useState(!1),[w,C]=n.useState(""),[y,_]=n.useState(""),[A,q]=n.useState(null),[R,O]=n.useState(null);n.useEffect(()=>{let t=!0;return H(async()=>{const{loadStripe:s}=await import("./vendor-BRRJ753s.js").then(r=>r.z);return{loadStripe:s}},__vite__mapDeps([0,1])).then(({loadStripe:s})=>{t&&O(s("pk_test_51RXnXYG0OYrUVFvzGJONOsFdtY0ib6iFfSkvdpOEV9YTk1TQ4FjGvf2xp5G4a6wHZlMpfuKP8SrCi5kQ8R9uSKyB00ZTz09Pol"))}),()=>{t=!1}},[]),n.useEffect(()=>{(async()=>{if(a<=0){_(""),g("Donation amount must be greater than zero.");return}g(null);try{console.log("Fetching client secret for amount:",a);const s=Math.round(a*100),r=await fetch("https://us-central1-farewell-app.cloudfunctions.net/createPaymentIntent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:s,isRecurring:o})});if(!r.ok){const k=await r.json().catch(()=>null);throw new Error(k&&k.error?k.error:`HTTP error! Status: ${r.status}`)}const u=await r.json();console.log("Client secret received:",u.clientSecret?"✓":"✗"),_(u.clientSecret)}catch(s){console.error("Error fetching client secret:",s),g(`Failed to initialize payment: ${s.message}`)}})()},[a,o]),n.useEffect(()=>{m&&parseFloat(w)>0?c(parseFloat(w)):(c(o?E[0]:l[0]),v(!1)),C("")},[o]);const $=t=>{P(t)},z=t=>{c(t),v(!1)},D=()=>{v(!0),m||C(a.toString())},j=t=>{const r=t.target.value.replace(/[^\d.]/g,"").split(".");if(r.length>2)return;r[1]&&r[1].length>2&&(r[1]=r[1].substring(0,2));const u=r.join(".");C(u),c(parseFloat(u)||0)},M=()=>{b(d&&i?i:"/confirm-wishes")},L=n.useMemo(()=>y?{clientSecret:y,appearance:{theme:"stripe",variables:{colorPrimary:"#c05f68",colorBackground:"#ffffff",colorText:"#30313d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',borderRadius:"4px"}},loader:"auto"}:null,[y]),B=async()=>{try{N(!0);const t=Math.round(a*100),s=await fetch("https://us-central1-farewell-app.cloudfunctions.net/createCheckoutSession",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:t,isRecurring:o,successUrl:`${window.location.origin}/dashboard?success=true`,cancelUrl:`${window.location.origin}/donation?canceled=true`})});if(!s.ok){const u=await s.json().catch(()=>null);throw new Error(u?.error||`HTTP error ${s.status}`)}const{url:r}=await s.json();console.log("Redirecting to checkout:",r),window.location.href=r}catch(t){console.error("Error redirecting to checkout:",t),g(`Failed to redirect to checkout: ${t.message}`),N(!1)}};return e.createElement(V,{title:e.createElement(e.Fragment,null,e.createElement("span",{className:"h1b"},"Support")," ",e.createElement("span",{className:"h1"},"Our Cause")),subtitle:e.createElement("span",{className:"h1sub"},"And secure access to Farewell for life!"),hideFooter:!0,showFooter:!1},e.createElement("div",{className:"donation-container"},e.createElement(K,{className:"donation-form-box"},e.createElement("button",{type:"button",className:"exit-button",onClick:M,"aria-label":"Close donation form"},e.createElement("img",{src:"/Picture/exit-x.svg",alt:"Close"})),e.createElement("div",{className:"impact-message"},"Your contribution helps families navigate end-of-life planning with dignity and care."),e.createElement("div",{className:"contribution-tabs",role:"tablist"},e.createElement("button",{type:"button",className:`tab ${o?"active":""}`,onClick:()=>$(!0),role:"tab","aria-selected":o,"aria-controls":"monthly-donation-panel",id:"monthly-tab"},e.createElement("span",{className:"tab-label"},"Monthly"),e.createElement("span",{className:"tab-benefit"},"Help us grow")),e.createElement("button",{type:"button",className:`tab ${o?"":"active"}`,onClick:()=>$(!1),role:"tab","aria-selected":!o,"aria-controls":"one-time-donation-panel",id:"one-time-tab"},e.createElement("span",{className:"tab-label"},"One-time"),e.createElement("span",{className:"tab-benefit"},"Quick support"))),e.createElement("div",{className:"amount-selection",role:"tabpanel",id:o?"monthly-donation-panel":"one-time-donation-panel","aria-labelledby":o?"monthly-tab":"one-time-tab"},e.createElement("label",{className:"form-label",id:"select-amount-label"},"Select an amount"),e.createElement("div",{className:"amount-options",role:"radiogroup","aria-labelledby":"select-amount-label"},(o?E:l).map(t=>e.createElement("button",{key:t,type:"button",className:`amount-option ${a===t&&!m?"selected":""}`,onClick:()=>z(t),role:"radio","aria-checked":a===t&&!m},"$",t)),e.createElement("button",{type:"button",className:`amount-option ${m?"selected":""}`,onClick:D,role:"radio","aria-checked":m},"Custom")),m&&e.createElement("div",{className:"custom-amount"},e.createElement("div",{className:"input-with-prefix"},e.createElement("span",{className:"currency-prefix","aria-hidden":"true"},"$"),e.createElement("input",{className:"custom-amount-input",type:"text",value:w,onChange:j,placeholder:"0.00","aria-label":"Custom donation amount",inputMode:"decimal",autoFocus:!0}))),e.createElement("div",{className:"amount-summary","aria-live":"polite"},e.createElement("span",{className:"amount-label"},o?"Monthly donation:":"One-time donation:"),e.createElement("span",{className:"amount-value"},"$",a.toFixed(2)))),y&&a>0?e.createElement(G,{stripe:R,options:L},e.createElement(X,{donationAmount:a,firstName:f,lastName:S,setPaymentError:g,setIsSubmitting:N,navigate:b,clientSecret:y,isRecurring:o})):e.createElement("div",{className:"loading-payment-section"},T?e.createElement("p",{className:"error-message"},T):e.createElement("p",null,"Loading payment options...")),A&&e.createElement("div",{className:"error-message full-width"},A),e.createElement("div",{className:"privacy-note"},e.createElement("p",{className:"donation-privacy-text"},"Your payment information is secure. By proceeding, you agree to our ",e.createElement("a",{href:"/terms",target:"_blank",rel:"noopener noreferrer"},"Terms of Service")," and ",e.createElement("a",{href:"/privacy",target:"_blank",rel:"noopener noreferrer"},"Privacy Policy"),".")),e.createElement("p",{className:"unlock-message"},"By completing this support, you'll immediately unlock access to all future features of Farewell at no additional cost."),!1,e.createElement("button",{type:"button",onClick:B,className:"pay-button",style:{width:"100%",padding:"12px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"600",cursor:"pointer",marginTop:"10px"}},"Try Stripe Checkout Instead"))))};export{me as default};
