import{a as j,u as z,f as J,r,R as e}from"./react-D8qwWWc-.js";import{b as A}from"./index-C_jNqslI.js";import{u as K}from"./usePlanningData-KxF1tlZ7.js";import{S as M}from"./StandardLayout-CODG-ZJt.js";import{T as E}from"./TextInput-CfcbAWFU.js";import{F as Q}from"./FormBox-DKl1xVdV.js";import{P as X}from"./PrimaryButton-D-OJOajV.js";import{S as Z}from"./ShareMoreModal-C2A5BRkQ.js";import{g as ee}from"./amplify-CUteMs5F.js";import"./vendor-BRRJ753s.js";import"./PageWrapper-qXWqd5_q.js";import"./Footer-DbTn4dsc.js";/* empty css                  */const ae=[{value:"family",label:"Family Member"},{value:"friend",label:"Friend"},{value:"coworker",label:"Colleague/Co-worker"},{value:"caregiver",label:"Caregiver"},{value:"other",label:"Other"}],ge=()=>{const m=j(),N=z(),O=J(),{isLoading:k,user:o}=A?A():{isLoading:!1,user:null},{formData:c,currentPlanId:B}=K(),L=ee(),[i,u]=r.useState(""),[s,d]=r.useState(""),[S,f]=r.useState(""),[T,h]=r.useState(""),[I,p]=r.useState(null),[R,v]=r.useState(!1),[n,y]=r.useState(!1),[$,te]=r.useState(null),[D,C]=r.useState(!1),[q,W]=r.useState({name:""}),[x,b]=r.useState({fullName:!1,email:!1}),g=a=>{b(t=>({...t,[a]:!0}))},_=a=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a),P=O.inviteId||null;r.useEffect(()=>{y(!!P),u(""),d(""),f(""),h("")},[P]);const w=async a=>{if(a&&a.preventDefault(),!i.trim()&&!s.trim()){p("Please enter a name and email address."),b({fullName:!0,email:!0});return}if(!s.trim()||!_(s)){p("Please enter a valid email address."),b(t=>({...t,email:!0}));return}v(!0),p(null);try{if(!o?.userId)throw new Error("User not authenticated");let t=B;if(!t)throw new Error("No farewell plan found. Please create your farewell plan first.");let l=o.attributes?.name||o.attributes?.given_name||c?.basicInformation?.firstName||o.attributes?.email?.split("@")[0]||"Plan Owner";c?.basicInformation?.lastName?l=`${c.basicInformation.firstName||l} ${c.basicInformation.lastName}`:o.attributes?.family_name&&(l=`${o.attributes.given_name||l} ${o.attributes.family_name}`);const F={name:i.trim()||null,email:s.trim(),planOwnerId:o.userId,planOwnerName:l,farewellPlanCollaboratorsId:t,invitedAt:new Date().toISOString(),status:"pending",role:S||"viewer"};console.log("Creating collaborator with input:",F);const V=(await L.graphql({query:createCollaborator,variables:{input:F}})).data.createCollaborator;console.log("Collaborator created successfully:",V),W({name:i||s}),C(!0),v(!1),u(""),d(""),f(""),h(""),b({fullName:!1,email:!1})}catch(t){console.error("Error creating collaborator:",t);let l="Unable to share your wishes. Please try again.";t.message?.includes("not authenticated")?l="Please sign in to share your wishes.":t.message?.includes("No farewell plan")?l="Please complete your farewell plan before sharing.":t.errors&&t.errors.length>0&&(l=t.errors[0].message||l),p(l),v(!1)}},Y=()=>{C(!1),u(""),d(""),f(""),h("")},G=()=>{N.key!=="default"&&N.pathname!=="/"?m(-1):m(n?"/":"/confirm-wishes")},U=()=>{m("/donation")},H=()=>"Add people who can access your farewell wishes.";return k?e.createElement(M,{title:e.createElement(e.Fragment,null,e.createElement("span",{className:"h1b"},"Loading")," ",e.createElement("span",{className:"h1"},"Information")),subtitle:e.createElement("span",{className:"h1sub"},"Please wait")},e.createElement("div",{className:"form-box-container"},e.createElement("div",{className:"form-box",style:{textAlign:"center",padding:"20px"}},"Loading your information..."))):e.createElement(M,{title:e.createElement(e.Fragment,null,e.createElement("span",{className:"h1b"},"Share")," ",e.createElement("span",{className:"h1"},"Your Wishes")),subtitle:e.createElement("span",{className:"h1sub"},H()),onGoBack:G,onSaveContinue:w,continueButtonText:n?"Accept Invitation":"Share Wishes",showSkipButton:!1,hideFooter:!0,showFooter:!1,mobileResponsive:!0},e.createElement("div",{className:"add-collaborators-container"},e.createElement(Q,{className:"collaborator-form-box"},e.createElement("button",{className:"form-exit-button",onClick:U,"aria-label":"Exit to donation screen"},e.createElement("img",{src:"/Picture/exit-x.svg",alt:"Exit"})),e.createElement("form",{className:"collaborator-form",onSubmit:w},e.createElement("div",{className:"form-field"},e.createElement(E,{label:"Full Name",id:"collaboratorFullName",value:i,onChange:a=>{u(a.target.value),g("fullName")},onBlur:()=>g("fullName"),placeholder:"First & Last Name",required:!!i.trim()||!!s.trim()})),e.createElement("div",{className:"form-field"},e.createElement(E,{label:"Email Address",id:"collaboratorEmail",type:"email",value:s,onChange:a=>{d(a.target.value),g("email")},onBlur:()=>g("email"),placeholder:n?"Your Email Address":"Enter their email address",required:!!i.trim()||!!s.trim(),disabled:n&&$?.invitedEmail})),e.createElement("div",{className:"form-field"},e.createElement(E,{type:"dropdown",label:`Relationship ${n?"to the Plan Owner":"to You"} (Optional)`,options:ae,value:S,onChange:a=>f(a.target.value),placeholder:"Choose from dropdown"})),e.createElement("div",{className:"form-field"},e.createElement(E,{label:`Personal Message ${n?"to the Plan Owner":"to Them"} (Optional)`,id:"personalMessage",multiline:!0,value:T,onChange:a=>h(a.target.value),placeholder:n?"Add a note for the plan owner...":"Write a short note to let them know why you're sharing...",textareaClassName:"tributes-textarea farewell-scrollbar",style:{minHeight:"7rem"}})),I&&(x.fullName||x.email)&&e.createElement("div",{className:"error-helper"},I),e.createElement("div",{className:"button-container-centered"},e.createElement(X,{onClick:w,disabled:R,className:"centered-button"},n?"Accept Invitation":"Share Wishes"))),D&&e.createElement(Z,{collaboratorName:q.name,onClose:()=>m("/donation"),onShareMore:Y}))))};export{ge as default};
