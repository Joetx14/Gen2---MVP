import{f as Zu,O as me,a as os,S as Kn,m as Ys,b as jn,c as el,d as Za,t as ec,e as tl,g as Dn,p as nl,o as sl,h as il,i as rl,j as ol,L as tc,s as al,T as cl}from"./vendor-BRRJ753s.js";const ul="Logging",ll="x-amz-user-agent",dl="NoHubcallbackProvidedException";var ge;(function(e){e.DEBUG="DEBUG",e.ERROR="ERROR",e.INFO="INFO",e.WARN="WARN",e.VERBOSE="VERBOSE",e.NONE="NONE"})(ge||(ge={}));const Hr={VERBOSE:1,DEBUG:2,INFO:3,WARN:4,ERROR:5,NONE:6};class j{constructor(t,n=ge.WARN){this.name=t,this.level=n,this._pluggables=[]}_padding(t){return t<10?"0"+t:""+t}_ts(){const t=new Date;return[this._padding(t.getMinutes()),this._padding(t.getSeconds())].join(":")+"."+t.getMilliseconds()}configure(t){return t?(this._config=t,this._config):this._config}_log(t,...n){let s=this.level;j.LOG_LEVEL&&(s=j.LOG_LEVEL),typeof window<"u"&&window.LOG_LEVEL&&(s=window.LOG_LEVEL);const i=Hr[s];if(!(Hr[t]>=i))return;let o=console.log.bind(console);t===ge.ERROR&&console.error&&(o=console.error.bind(console)),t===ge.WARN&&console.warn&&(o=console.warn.bind(console)),j.BIND_ALL_LOG_LEVELS&&(t===ge.INFO&&console.info&&(o=console.info.bind(console)),t===ge.DEBUG&&console.debug&&(o=console.debug.bind(console)));const a=`[${t}] ${this._ts()} ${this.name}`;let c="";if(n.length===1&&typeof n[0]=="string")c=`${a} - ${n[0]}`,o(c);else if(n.length===1)c=`${a} ${n[0]}`,o(a,n[0]);else if(typeof n[0]=="string"){let u=n.slice(1);u.length===1&&(u=u[0]),c=`${a} - ${n[0]} ${u}`,o(`${a} - ${n[0]}`,u)}else c=`${a} ${n}`,o(a,n);for(const u of this._pluggables){const l={message:c,timestamp:Date.now()};u.pushLogs([l])}}log(...t){this._log(ge.INFO,...t)}info(...t){this._log(ge.INFO,...t)}warn(...t){this._log(ge.WARN,...t)}error(...t){this._log(ge.ERROR,...t)}debug(...t){this._log(ge.DEBUG,...t)}verbose(...t){this._log(ge.VERBOSE,...t)}addPluggable(t){t&&t.getCategoryName()===ul&&(this._pluggables.push(t),t.configure(this._config))}listPluggables(){return this._pluggables}}j.LOG_LEVEL=null;j.BIND_ALL_LOG_LEVELS=!1;class ue extends Error{constructor({message:t,name:n,recoverySuggestion:s,underlyingError:i,metadata:r}){if(super(t),this.name=n,this.underlyingError=i,this.recoverySuggestion=s,r){const{extendedRequestId:o,httpStatusCode:a,requestId:c}=r;this.metadata={extendedRequestId:o,httpStatusCode:a,requestId:c}}this.constructor=ue,Object.setPrototypeOf(this,ue.prototype)}}var yt;(function(e){e.NoEndpointId="NoEndpointId",e.PlatformNotSupported="PlatformNotSupported",e.Unknown="Unknown",e.NetworkError="NetworkError"})(yt||(yt={}));const Js=(e,t=ue)=>(n,s,i)=>{const{message:r,recoverySuggestion:o}=e[s];if(!n)throw new t({name:s,message:i?`${r} ${i}`:r,recoverySuggestion:o})},gt=typeof Symbol<"u"?Symbol("amplify_default"):"@@amplify_default",Tn=new j("Hub");class nc{constructor(t){this.listeners=new Map,this.protectedChannels=["core","auth","api","analytics","interactions","pubsub","storage","ui","xr"],this.name=t}_remove(t,n){const s=this.listeners.get(t);if(!s){Tn.warn(`No listeners for ${t}`);return}this.listeners.set(t,[...s.filter(({callback:i})=>i!==n)])}dispatch(t,n,s,i){typeof t=="string"&&this.protectedChannels.indexOf(t)>-1&&(i===gt||Tn.warn(`WARNING: ${t} is protected and dispatching on it can have unintended consequences`));const r={channel:t,payload:{...n},source:s,patternInfo:[]};try{this._toListeners(r)}catch(o){Tn.error(o)}}listen(t,n,s="noname"){let i;if(typeof n!="function")throw new ue({name:dl,message:"No callback supplied to Hub"});i=n;let r=this.listeners.get(t);return r||(r=[],this.listeners.set(t,r)),r.push({name:s,callback:i}),()=>{this._remove(t,i)}}_toListeners(t){const{channel:n,payload:s}=t,i=this.listeners.get(n);i&&i.forEach(r=>{Tn.debug(`Dispatching to ${n} with `,s);try{r.callback(t)}catch(o){Tn.error(o)}})}}const ye=new nc("__default__"),ks=new nc("internal-hub"),hl=()=>{if(typeof window=="object"&&typeof window.crypto=="object")return window.crypto;if(typeof crypto=="object")return crypto;throw new ue({name:"MissingPolyfill",message:"Cannot resolve the `crypto` function from the environment."})},pl=()=>{if(typeof window<"u"&&typeof window.btoa=="function")return window.btoa;if(typeof btoa=="function")return btoa;throw new ue({name:"Base64EncoderError",message:"Cannot resolve the `btoa` function from the environment."})},fl=()=>{if(typeof window<"u"&&typeof window.atob=="function")return window.atob;if(typeof atob=="function")return atob;throw new ue({name:"Base64EncoderError",message:"Cannot resolve the `atob` function from the environment."})},ir={convert(e,t){let n=e;return t?.urlSafe&&(n=n.replace(/-/g,"+").replace(/_/g,"/")),fl()(n)}};var Be;(function(e){e.AuthTokenConfigException="AuthTokenConfigException",e.AuthUserPoolAndIdentityPoolException="AuthUserPoolAndIdentityPoolException",e.AuthUserPoolException="AuthUserPoolException",e.InvalidIdentityPoolIdException="InvalidIdentityPoolIdException",e.OAuthNotConfigureException="OAuthNotConfigureException"})(Be||(Be={}));const ml={[Be.AuthTokenConfigException]:{message:"Auth Token Provider not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app."},[Be.AuthUserPoolAndIdentityPoolException]:{message:"Auth UserPool or IdentityPool not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app with UserPoolId and IdentityPoolId."},[Be.AuthUserPoolException]:{message:"Auth UserPool not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app with userPoolId and userPoolClientId."},[Be.InvalidIdentityPoolIdException]:{message:"Invalid identity pool id provided.",recoverySuggestion:"Make sure a valid identityPoolId is given in the config."},[Be.OAuthNotConfigureException]:{message:"oauth param not configured.",recoverySuggestion:"Make sure to call Amplify.configure with oauth parameter in your app."}},rr=Js(ml);function B(e){let t=!0;e?t=!!e.userPoolId&&!!e.userPoolClientId:t=!1,rr(t,Be.AuthUserPoolException)}function sc(e){const t=!!e?.loginWith?.oauth?.domain&&!!e?.loginWith?.oauth?.redirectSignOut&&!!e?.loginWith?.oauth?.redirectSignIn&&!!e?.loginWith?.oauth?.responseType;rr(t,Be.OAuthNotConfigureException)}function ws(e){const t=!!e?.identityPoolId;rr(t,Be.InvalidIdentityPoolIdException)}function Et(e){const t=e.split(".");if(t.length!==3)throw new Error("Invalid token");try{const s=t[1].replace(/-/g,"+").replace(/_/g,"/"),i=decodeURIComponent(ir.convert(s).split("").map(o=>`%${`00${o.charCodeAt(0).toString(16)}`.slice(-2)}`).join("")),r=JSON.parse(i);return{toString:()=>e,payload:r}}catch{throw new Error("Invalid token payload")}}const ic=e=>e&&e["nonRetryable"],as=new j("retryUtil");async function rc(e,t,n,s){if(typeof e!="function")throw Error("functionToRetry must be a function");return new Promise(async(i,r)=>{let o=0,a=!1,c,u=()=>{},l;for(s&&s.then(()=>{a=!0,clearTimeout(c),u()});!a;){o++,as.debug(`${e.name} attempt #${o} with this vars: ${JSON.stringify(t)}`);try{i(await e(...t));return}catch(d){if(l=d,as.debug(`error on ${e.name}`,d),ic(d)){as.debug(`${e.name} non retryable error`,d),r(d);return}const h=n(o,t,d);if(as.debug(`${e.name} retrying in ${h} ms`),h===!1||a){r(d);return}else await new Promise(p=>{u=p,c=setTimeout(u,h)})}}r(l)})}const oc=e=>{const t=Reflect.ownKeys(e);for(const n of t){const s=e[n];(s&&typeof s=="object"||typeof s=="function")&&oc(s)}return Object.freeze(e)},yl=new j("parseAWSExports"),gl={API_KEY:"apiKey",AWS_IAM:"iam",AMAZON_COGNITO_USER_POOLS:"userPool",OPENID_CONNECT:"oidc",NONE:"none",AWS_LAMBDA:"lambda",LAMBDA:"lambda"},El=(e={})=>{if(!Object.prototype.hasOwnProperty.call(e,"aws_project_region"))throw new ue({name:"InvalidParameterException",message:"Invalid config parameter.",recoverySuggestion:"Ensure passing the config object imported from  `amplifyconfiguration.json`."});const{aws_appsync_apiKey:t,aws_appsync_authenticationType:n,aws_appsync_graphqlEndpoint:s,aws_appsync_region:i,aws_bots_config:r,aws_cognito_identity_pool_id:o,aws_cognito_sign_up_verification_method:a,aws_cognito_mfa_configuration:c,aws_cognito_mfa_types:u,aws_cognito_password_protection_settings:l,aws_cognito_verification_mechanisms:d,aws_cognito_signup_attributes:h,aws_cognito_social_providers:p,aws_cognito_username_attributes:f,aws_mandatory_sign_in:m,aws_mobile_analytics_app_id:y,aws_mobile_analytics_app_region:g,aws_user_files_s3_bucket:E,aws_user_files_s3_bucket_region:v,aws_user_files_s3_dangerously_connect_to_http_endpoint_for_testing:S,aws_user_pools_id:I,aws_user_pools_web_client_id:T,geo:O,oauth:b,predictions:x,aws_cloud_logic_custom:U,Notifications:M,modelIntrospection:P}=e,A={};y&&(A.Analytics={Pinpoint:{appId:y,region:g}});const{InAppMessaging:F,Push:k}=M??{};if(F?.AWSPinpoint||k?.AWSPinpoint){if(F?.AWSPinpoint){const{appId:Q,region:Tt}=F.AWSPinpoint;A.Notifications={InAppMessaging:{Pinpoint:{appId:Q,region:Tt}}}}if(k?.AWSPinpoint){const{appId:Q,region:Tt}=k.AWSPinpoint;A.Notifications={...A.Notifications,PushNotification:{Pinpoint:{appId:Q,region:Tt}}}}}if(Array.isArray(r)&&(A.Interactions={LexV1:Object.fromEntries(r.map(Q=>[Q.name,Q]))}),s){const Q=gl[n];Q||yl.debug(`Invalid authentication type ${n}. Falling back to IAM.`),A.API={GraphQL:{endpoint:s,apiKey:t,region:i,defaultAuthMode:Q??"iam"}},P&&(A.API.GraphQL.modelIntrospection=P)}const V=c?{status:c&&c.toLowerCase(),totpEnabled:u?.includes("TOTP")??!1,smsEnabled:u?.includes("SMS")??!1}:void 0,Z=l?{minLength:l.passwordPolicyMinLength,requireLowercase:l.passwordPolicyCharacters?.includes("REQUIRES_LOWERCASE")??!1,requireUppercase:l.passwordPolicyCharacters?.includes("REQUIRES_UPPERCASE")??!1,requireNumbers:l.passwordPolicyCharacters?.includes("REQUIRES_NUMBERS")??!1,requireSpecialCharacters:l.passwordPolicyCharacters?.includes("REQUIRES_SYMBOLS")??!1}:void 0,$t=Array.from(new Set([...d??[],...h??[]])).reduce((Q,Tt)=>({...Q,[Tt.toLowerCase()]:{required:!0}}),{}),Kt=f?.includes("EMAIL")??!1,vn=f?.includes("PHONE_NUMBER")??!1;(o||I)&&(A.Auth={Cognito:{identityPoolId:o,allowGuestAccess:m!=="enable",signUpVerificationMethod:a,userAttributes:$t,userPoolClientId:T,userPoolId:I,mfa:V,passwordFormat:Z,loginWith:{username:!(Kt||vn),email:Kt,phone:vn}}});const Qu=b?Object.keys(b).length>0:!1,Yu=p?p.length>0:!1;if(A.Auth&&Qu&&(A.Auth.Cognito.loginWith={...A.Auth.Cognito.loginWith,oauth:{...Sl(b),...Yu&&{providers:wl(p)}}}),E&&(A.Storage={S3:{bucket:E,region:v,dangerouslyConnectToHttpEndpointForTesting:S}}),O){const{amazon_location_service:Q}=O;A.Geo={LocationService:{maps:Q.maps,geofenceCollections:Q.geofenceCollections,searchIndices:Q.search_indices,region:Q.region}}}if(U&&(A.API={...A.API,REST:U.reduce((Q,Tt)=>{const{name:Ju,endpoint:Xu,region:Wr,service:zr}=Tt;return{...Q,[Ju]:{endpoint:Xu,...zr?{service:zr}:void 0,...Wr?{region:Wr}:void 0}}},{})}),x){const{VoiceId:Q}=x?.convert?.speechGenerator?.defaults??{};A.Predictions=Q?{...x,convert:{...x.convert,speechGenerator:{...x.convert.speechGenerator,defaults:{voiceId:Q}}}}:x}return A},Gr=e=>e?.split(",")??[],Sl=({domain:e,scope:t,redirectSignIn:n,redirectSignOut:s,responseType:i})=>({domain:e,scopes:t,redirectSignIn:Gr(n),redirectSignOut:Gr(s),responseType:i}),wl=e=>e.map(t=>{const n=t.toLowerCase();return n.charAt(0).toUpperCase()+n.slice(1)}),Il=Symbol("oauth-listener");let cs;const vl=new Uint8Array(16);function Tl(){if(!cs&&(cs=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!cs))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return cs(vl)}const se=[];for(let e=0;e<256;++e)se.push((e+256).toString(16).slice(1));function bl(e,t=0){return se[e[t+0]]+se[e[t+1]]+se[e[t+2]]+se[e[t+3]]+"-"+se[e[t+4]]+se[e[t+5]]+"-"+se[e[t+6]]+se[e[t+7]]+"-"+se[e[t+8]]+se[e[t+9]]+"-"+se[e[t+10]]+se[e[t+11]]+se[e[t+12]]+se[e[t+13]]+se[e[t+14]]+se[e[t+15]]}const Al=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Qr={randomUUID:Al};function Nl(e,t,n){if(Qr.randomUUID&&!t&&!e)return Qr.randomUUID();e=e||{};const s=e.random||(e.rng||Tl)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,t){n=n||0;for(let i=0;i<16;++i)t[n+i]=s[i];return t}return bl(s)}function Cl(e){const{version:t}=e;return t?t.startsWith("1"):!1}function Pl(e){if(!e)return;const{bucket_name:t,aws_region:n,buckets:s}=e;return{S3:{bucket:t,region:n,buckets:s&&$l(s)}}}function Ol(e){if(!e)return;const{user_pool_id:t,user_pool_client_id:n,identity_pool_id:s,password_policy:i,mfa_configuration:r,mfa_methods:o,unauthenticated_identities_enabled:a,oauth:c,username_attributes:u,standard_required_attributes:l,groups:d}=e,h={Cognito:{userPoolId:t,userPoolClientId:n,groups:d}};return s&&(h.Cognito={...h.Cognito,identityPoolId:s}),i&&(h.Cognito.passwordFormat={requireLowercase:i.require_lowercase,requireNumbers:i.require_numbers,requireUppercase:i.require_uppercase,requireSpecialCharacters:i.require_symbols,minLength:i.min_length??6}),r&&(h.Cognito.mfa={status:Ll(r),smsEnabled:o?.includes("SMS"),totpEnabled:o?.includes("TOTP")}),a&&(h.Cognito.allowGuestAccess=a),c&&(h.Cognito.loginWith={oauth:{domain:c.domain,redirectSignIn:c.redirect_sign_in_uri,redirectSignOut:c.redirect_sign_out_uri,responseType:c.response_type==="token"?"token":"code",scopes:c.scopes,providers:Ul(c.identity_providers)}}),u&&(h.Cognito.loginWith={...h.Cognito.loginWith,email:u.includes("email"),phone:u.includes("phone_number"),username:u.includes("username")}),l&&(h.Cognito.userAttributes=l.reduce((p,f)=>({...p,[f]:{required:!0}}),{})),h}function xl(e){if(!e?.amazon_pinpoint)return;const{amazon_pinpoint:t}=e;return{Pinpoint:{appId:t.app_id,region:t.aws_region}}}function _l(e){if(!e)return;const{aws_region:t,geofence_collections:n,maps:s,search_indices:i}=e;return{LocationService:{region:t,searchIndices:i,geofenceCollections:n,maps:s}}}function Rl(e){if(!e)return;const{aws_region:t,default_authorization_type:n,url:s,api_key:i,model_introspection:r}=e;return{GraphQL:{endpoint:s,defaultAuthMode:ac(n),region:t,apiKey:i,modelIntrospection:r}}}function kl(e){if(!e?.events)return;const{url:t,aws_region:n,api_key:s,default_authorization_type:i}=e.events;return{Events:{endpoint:t,defaultAuthMode:ac(i),region:n,apiKey:s}}}function Ml(e){if(!e)return;const{aws_region:t,channels:n,amazon_pinpoint_app_id:s}=e,i=n.includes("IN_APP_MESSAGING"),r=n.includes("APNS")||n.includes("FCM");if(!(i||r))return;const o={};return i&&(o.InAppMessaging={Pinpoint:{appId:s,region:t}}),r&&(o.PushNotification={Pinpoint:{appId:s,region:t}}),o}function Dl(e){const t={};if(e.storage&&(t.Storage=Pl(e.storage)),e.auth&&(t.Auth=Ol(e.auth)),e.analytics&&(t.Analytics=xl(e.analytics)),e.geo&&(t.Geo=_l(e.geo)),e.data&&(t.API=Rl(e.data)),e.custom){const n=kl(e.custom);n&&"Events"in n&&(t.API={...t.API,...n})}return e.notifications&&(t.Notifications=Ml(e.notifications)),t}const Fl={AMAZON_COGNITO_USER_POOLS:"userPool",API_KEY:"apiKey",AWS_IAM:"iam",AWS_LAMBDA:"lambda",OPENID_CONNECT:"oidc"};function ac(e){return Fl[e]}const Yr={GOOGLE:"Google",LOGIN_WITH_AMAZON:"Amazon",FACEBOOK:"Facebook",SIGN_IN_WITH_APPLE:"Apple"};function Ul(e=[]){return e.reduce((t,n)=>(Yr[n]!==void 0&&t.push(Yr[n]),t),[])}function Ll(e){return e==="OPTIONAL"?"optional":e==="REQUIRED"?"on":"off"}function $l(e){const t={};return e.forEach(({name:n,bucket_name:s,aws_region:i,paths:r})=>{if(n in t)throw new Error(`Duplicate friendly name found: ${n}. Name must be unique.`);const o=r?Object.entries(r).reduce((a,[c,u])=>(u!==void 0&&(a[c]=u),a),{}):void 0;t[n]={bucketName:s,region:i,paths:o}}),t}const cc=e=>Object.keys(e).some(t=>t.startsWith("aws_"))?El(e):Cl(e)?Dl(e):e,uc={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();t.length===1&&(t=`0${t}`),uc[e]=t}function Kl(e){let t="";for(let n=0;n<e.byteLength;n++)t+=uc[e[n]];return t}var J;(function(e){e.WebUnknown="0",e.React="1",e.NextJs="2",e.Angular="3",e.VueJs="4",e.Nuxt="5",e.Svelte="6",e.ServerSideUnknown="100",e.ReactSSR="101",e.NextJsSSR="102",e.AngularSSR="103",e.VueJsSSR="104",e.NuxtSSR="105",e.SvelteSSR="106",e.ReactNative="201",e.Expo="202"})(J||(J={}));var St;(function(e){e.AI="ai",e.API="api",e.Auth="auth",e.Analytics="analytics",e.DataStore="datastore",e.Geo="geo",e.InAppMessaging="inappmessaging",e.Interactions="interactions",e.Predictions="predictions",e.PubSub="pubsub",e.PushNotification="pushnotification",e.Storage="storage"})(St||(St={}));var Jr;(function(e){e.CreateConversation="1",e.GetConversation="2",e.ListConversations="3",e.DeleteConversation="4",e.SendMessage="5",e.ListMessages="6",e.OnMessage="7",e.Generation="8",e.UpdateConversation="9"})(Jr||(Jr={}));var Xr;(function(e){e.Record="1",e.IdentifyUser="2"})(Xr||(Xr={}));var Ms;(function(e){e.GraphQl="1",e.Get="2",e.Post="3",e.Put="4",e.Patch="5",e.Del="6",e.Head="7"})(Ms||(Ms={}));var Se;(function(e){e.SignUp="1",e.ConfirmSignUp="2",e.ResendSignUpCode="3",e.SignIn="4",e.FetchMFAPreference="6",e.UpdateMFAPreference="7",e.SetUpTOTP="10",e.VerifyTOTPSetup="11",e.ConfirmSignIn="12",e.DeleteUserAttributes="15",e.DeleteUser="16",e.UpdateUserAttributes="17",e.FetchUserAttributes="18",e.ConfirmUserAttribute="22",e.SignOut="26",e.UpdatePassword="27",e.ResetPassword="28",e.ConfirmResetPassword="29",e.FederatedSignIn="30",e.RememberDevice="32",e.ForgetDevice="33",e.FetchDevices="34",e.SendUserAttributeVerificationCode="35",e.SignInWithRedirect="36",e.StartWebAuthnRegistration="37",e.CompleteWebAuthnRegistration="38",e.ListWebAuthnCredentials="39",e.DeleteWebAuthnCredential="40"})(Se||(Se={}));var Bn;(function(e){e.Subscribe="1",e.GraphQl="2"})(Bn||(Bn={}));var Zr;(function(e){e.SearchByText="0",e.SearchByCoordinates="1",e.SearchForSuggestions="2",e.SearchByPlaceId="3",e.SaveGeofences="4",e.GetGeofence="5",e.ListGeofences="6",e.DeleteGeofences="7"})(Zr||(Zr={}));var eo;(function(e){e.SyncMessages="1",e.IdentifyUser="2",e.NotifyMessageInteraction="3"})(eo||(eo={}));var to;(function(e){e.None="0"})(to||(to={}));var no;(function(e){e.Convert="1",e.Identify="2",e.Interpret="3"})(no||(no={}));var so;(function(e){e.Subscribe="1"})(so||(so={}));var io;(function(e){e.InitializePushNotifications="1",e.IdentifyUser="2"})(io||(io={}));var ro;(function(e){e.UploadData="1",e.DownloadData="2",e.List="3",e.Copy="4",e.Remove="5",e.GetProperties="6",e.GetUrl="7",e.GetDataAccess="8",e.ListCallerAccessGrants="9"})(ro||(ro={}));const jl="6.15.1",Xs=()=>typeof global<"u",cn=()=>typeof window<"u",lc=()=>typeof document<"u",or=()=>typeof process<"u",qn=(e,t)=>!!Object.keys(e).find(n=>n.startsWith(t));var oo={};function Bl(){const e=s=>s.startsWith("_react")||s.startsWith("__react"),t=s=>Object.keys(s).find(e),n=()=>Array.from(document.querySelectorAll("[id]"));return lc()&&n().some(t)}function ql(){return or()&&typeof oo<"u"&&!!Object.keys(oo).find(e=>e.includes("react"))}function Vl(){return cn()&&qn(window,"__VUE")}function Wl(){return Xs()&&qn(global,"__VUE")}var ao={};function zl(){return cn()&&qn(window,"__SVELTE")}function Hl(){return or()&&typeof ao<"u"&&!!Object.keys(ao).find(e=>e.includes("svelte"))}function Gl(){return cn()&&window.next&&typeof window.next=="object"}function Ql(){return Xs()&&(qn(global,"__next")||qn(global,"__NEXT"))}function Yl(){return cn()&&(window.__NUXT__!==void 0||window.$nuxt!==void 0)}function Jl(){return Xs()&&typeof global.__NUXT_PATHS__<"u"}var co={};function Xl(){const e=!!(lc()&&document.querySelector("[ng-version]")),t=!!(cn()&&typeof window.ng<"u");return e||t}function Zl(){return or()&&typeof co=="object"&&co.npm_lifecycle_script?.startsWith("ng ")||!1}function ed(){return typeof navigator<"u"&&typeof navigator.product<"u"&&navigator.product==="ReactNative"}function td(){return Xs()&&typeof global.expo<"u"}function nd(){return cn()}const sd=[{platform:J.Expo,detectionMethod:td},{platform:J.ReactNative,detectionMethod:ed},{platform:J.NextJs,detectionMethod:Gl},{platform:J.Nuxt,detectionMethod:Yl},{platform:J.Angular,detectionMethod:Xl},{platform:J.React,detectionMethod:Bl},{platform:J.VueJs,detectionMethod:Vl},{platform:J.Svelte,detectionMethod:zl},{platform:J.WebUnknown,detectionMethod:nd},{platform:J.NextJsSSR,detectionMethod:Ql},{platform:J.NuxtSSR,detectionMethod:Jl},{platform:J.ReactSSR,detectionMethod:ql},{platform:J.VueJsSSR,detectionMethod:Wl},{platform:J.AngularSSR,detectionMethod:Zl},{platform:J.SvelteSSR,detectionMethod:Hl}];function id(){return sd.find(e=>e.detectionMethod())?.platform||J.ServerSideUnknown}let Fn;const gi=[];let Ri=!1;const rd=10,od=10,ad=1e3,dc=()=>{if(!Fn){if(Fn=id(),Ri)for(;gi.length;)gi.pop()?.();else gi.forEach(e=>{e()});uo(J.ServerSideUnknown,rd),uo(J.WebUnknown,od)}return Fn};function cd(){Fn=void 0}function uo(e,t){Fn===e&&!Ri&&setTimeout(()=>{cd(),Ri=!0,setTimeout(dc,ad)},t)}const ud={},ld=(e,t)=>ud[e]?.[t]?.additionalDetails,dd="aws-amplify",hd=e=>e.replace(/\+.*/,""),pd=({category:e,action:t}={})=>{const n=[[dd,hd(jl)]];if(e&&n.push([e,t]),n.push(["framework",dc()]),e&&t){const s=ld(e,t);s&&s.forEach(i=>{n.push(i)})}return n},un=e=>pd(e).map(([s,i])=>s&&i?`${s}/${i}`:s).join(" ");var Ge;(function(e){e.Open="Open",e.Closing="Closing",e.Closed="Closed"})(Ge||(Ge={}));const hc=()=>{if(typeof self>"u")return!1;const e=self;return typeof e.WorkerGlobalScope<"u"&&self instanceof e.WorkerGlobalScope};class _t{networkMonitor(t){const n=hc()?self:typeof window<"u"&&window;return n?new me(s=>{s.next({online:n.navigator.onLine});const i=()=>{s.next({online:!0})},r=()=>{s.next({online:!1})};return n.addEventListener("online",i),n.addEventListener("offline",r),_t._observers.push(s),()=>{n.removeEventListener("online",i),n.removeEventListener("offline",r),_t._observers=_t._observers.filter(o=>o!==s)}}):Zu([{online:!0}])}static _observerOverride(t){for(const n of this._observers){if(n.closed){this._observers=this._observers.filter(s=>s!==n);continue}n?.next&&n.next(t)}}}_t._observers=[];const ar=()=>typeof window<"u"&&typeof window.document<"u",lo=new j("Auth");class fd{configure(t,n){this.authConfig=t,this.authOptions=n,t&&t.Cognito?.userPoolEndpoint&&lo.warn(ho("Amazon Cognito User Pool")),t&&t.Cognito?.identityPoolEndpoint&&lo.warn(ho("Amazon Cognito Identity Pool"))}async fetchAuthSession(t={}){let n,s;const i=await this.getTokens(t);return i?(s=i.accessToken?.payload?.sub,n=await this.authOptions?.credentialsProvider?.getCredentialsAndIdentityId({authConfig:this.authConfig,tokens:i,authenticated:!0,forceRefresh:t.forceRefresh})):n=await this.authOptions?.credentialsProvider?.getCredentialsAndIdentityId({authConfig:this.authConfig,authenticated:!1,forceRefresh:t.forceRefresh}),{tokens:i,credentials:n?.credentials,identityId:n?.identityId,userSub:s}}async clearCredentials(){await this.authOptions?.credentialsProvider?.clearCredentialsAndIdentityId()}async getTokens(t){return await this.authOptions?.tokenProvider?.getTokens(t)??void 0}}const ho=e=>`You are using a custom Amazon ${e} endpoint, ensure the endpoint is correct.`;class md{constructor(){this.oAuthListener=void 0,this.resourcesConfig={},this.libraryOptions={},this.Auth=new fd}configure(t,n){const s=cc(t);this.resourcesConfig=s,n&&(this.libraryOptions=n),this.resourcesConfig=oc(this.resourcesConfig),this.Auth.configure(this.resourcesConfig.Auth,this.libraryOptions.Auth),ye.dispatch("core",{event:"configure",data:this.resourcesConfig},"Configure",gt),this.notifyOAuthListener()}getConfig(){return this.resourcesConfig}[Il](t){this.resourcesConfig.Auth?.Cognito.loginWith?.oauth?t(this.resourcesConfig.Auth?.Cognito):this.oAuthListener=t}notifyOAuthListener(){!this.resourcesConfig.Auth?.Cognito.loginWith?.oauth||!this.oAuthListener||(this.oAuthListener(this.resourcesConfig.Auth?.Cognito),this.oAuthListener=void 0)}}const W=new md,yd=(e,t)=>e.Auth.fetchAuthSession(t),Zt=e=>yd(W,e);function pc(){return W.Auth.clearCredentials()}const Zs=e=>{const{headers:t,statusCode:n}=e;return{...gd(e)?e.$metadata:{},httpStatusCode:n,requestId:t["x-amzn-requestid"]??t["x-amzn-request-id"]??t["x-amz-request-id"],extendedRequestId:t["x-amz-id-2"],cfId:t["x-amz-cf-id"]}},gd=e=>typeof e?.$metadata=="object",Lt=async e=>{if(!e||e.statusCode<300)return;const t=await Yn(e),s=(o=>{const[a]=o.toString().split(/[,:]+/);return a.includes("#")?a.split("#")[1]:a})(e.headers["x-amzn-errortype"]??t.code??t.__type??"UnknownError"),i=t.message??t.Message??"Unknown error",r=new Error(i);return Object.assign(r,{name:s,$metadata:Zs(e)})},Yn=async e=>{if(!e.body)throw new Error("Missing response payload");const t=await e.body.json();return Object.assign(t,{$metadata:Zs(e)})},Fe=(e,t,n,s)=>async(i,r)=>{const o={...s,...i},a=await o.endpointResolver(o,r),c=await t(r,a),u=await e(c,{...o});return n(u)},fc=5*60*1e3;function cr(e=fc){return s=>{const i=2**s*100+100*Math.random();return i>e?!1:i}}const mc=3,po="amz-sdk-invocation-id",Ed="amz-sdk-request",fo=5*60*1e3,ur=e=>{const n=cr(fo)(e);return n===!1?fo:n},Sd=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch","BadRequestException"],wd=e=>!!e&&Sd.includes(e),lr=e=>async(t,n)=>{const s=n??await e(t)??void 0,i=s?.code||s?.name,r=t?.statusCode;return{retryable:bd(n)||Td(r,i)||wd(i)||Ad(r,i)}},Id=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException"],vd=["TimeoutError","RequestTimeout","RequestTimeoutException"],Td=(e,t)=>e===429||!!t&&Id.includes(t),bd=e=>[yt.NetworkError,"ERR_NETWORK"].includes(e?.name),Ad=(e,t)=>!!e&&[500,502,503,504].includes(e)||!!t&&vd.includes(t),yc="cognito-identity",gc={service:yc,retryDecider:lr(Lt),computeDelay:ur,cache:"no-store"},dr=({maxAttempts:e=mc,retryDecider:t,computeDelay:n,abortSignal:s})=>{if(e<1)throw new Error("maxAttempts must be greater than 0");return(i,r)=>async function(a){let c,u=r.attemptsCount??0,l;const d=()=>{if(l)return mo(l,u),l;throw mo(c,u),c};for(;!s?.aborted&&u<e;){try{l=await i(a),c=void 0}catch(f){c=f,l=void 0}u=(r.attemptsCount??0)>u?r.attemptsCount??0:u+1,r.attemptsCount=u;const{isCredentialsExpiredError:h,retryable:p}=await t(l,c,r);if(p){if(r.isCredentialsExpired=!!h,!s?.aborted&&u<e){const f=n(u);await Nd(f,s)}continue}else return d()}if(s?.aborted)throw new Error("Request aborted.");return d()}},Nd=(e,t)=>{if(t?.aborted)return Promise.resolve();let n,s;const i=new Promise(r=>{s=r,n=setTimeout(r,e)});return t?.addEventListener("abort",function r(o){clearTimeout(n),t?.removeEventListener("abort",r),s()}),i},mo=(e,t)=>{Object.prototype.toString.call(e)==="[object Object]"&&(e.$metadata={...e.$metadata??{},attempts:t})},Mt=Nl,Cd=()=>e=>async function(n){return n.headers[po]||(n.headers[po]=Mt()),e(n)},Pd=({maxAttempts:e=mc})=>(t,n)=>async function(i){const r=n.attemptsCount??0;return i.headers[Ed]=`attempt=${r+1}; max=${e}`,t(i)},hr=({userAgentHeader:e="x-amz-user-agent",userAgentValue:t=""})=>n=>async function(i){if(t.trim().length===0)return await n(i);{const r=e.toLowerCase();return i.headers[r]=i.headers[r]?`${i.headers[r]} ${t}`:t,await n(i)}},Jn=(e,t)=>(n,s)=>{const i={};let r=o=>e(o,s);for(let o=t.length-1;o>=0;o--){const a=t[o];r=a(s)(r,i)}return r(n)},Ei=e=>{let t;return()=>(t||(t=e()),t)},Od=e=>!["HEAD","GET","DELETE"].includes(e.toUpperCase()),pr=async({url:e,method:t,headers:n,body:s},{abortSignal:i,cache:r,withCrossDomainCredentials:o})=>{let a;try{a=await fetch(e,{method:t,headers:n,body:Od(t)?s:void 0,signal:i,cache:r,credentials:o?"include":"same-origin"})}catch(d){throw d instanceof TypeError?new ue({name:yt.NetworkError,message:"A network error has occurred.",underlyingError:d}):d}const c={};a.headers?.forEach((d,h)=>{c[h.toLowerCase()]=d});const u={statusCode:a.status,headers:c,body:null},l=Object.assign(a.body??{},{text:Ei(()=>a.text()),blob:Ei(()=>a.blob()),json:Ei(()=>a.json())});return{...u,body:l}},Ec=Jn(pr,[hr,Cd,dr,Pd]),xd=()=>e=>async function(n){return n.headers["cache-control"]="no-store",e(n)},Sc=Jn(Ec,[xd]),wc=e=>(t,n)=>{const s=_d(e),i=JSON.stringify(t);return Rd(n,s,i)},_d=e=>({"content-type":"application/x-amz-json-1.1","x-amz-target":`AWSCognitoIdentityService.${e}`}),Rd=({url:e},t,n)=>({headers:t,url:e,body:n,method:"POST"}),yo=e=>Fe(Sc,wc("GetCredentialsForIdentity"),kd,{...gc,...e,userAgentValue:un()}),kd=async e=>{if(e.statusCode>=300)throw await Lt(e);const t=await Yn(e);return{IdentityId:t.IdentityId,Credentials:Md(t.Credentials),$metadata:Zs(e)}},Md=({Expiration:e,...t}={})=>({...t,Expiration:e&&new Date(e*1e3)}),Dd=e=>Fe(Sc,wc("GetId"),Fd,{...gc,...e,userAgentValue:un()}),Fd=async e=>{if(e.statusCode>=300)throw await Lt(e);return{IdentityId:(await Yn(e)).IdentityId,$metadata:Zs(e)}},Ic={id:"aws",outputs:{dnsSuffix:"amazonaws.com"},regionRegex:"^(us|eu|ap|sa|ca|me|af)\\-\\w+\\-\\d+$",regions:["aws-global"]},Ud={partitions:[Ic,{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn"},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:["aws-cn-global"]}]},vc=e=>{const{partitions:t}=Ud;for(const{regions:n,outputs:s,regionRegex:i}of t){const r=new RegExp(i);if(n.includes(e)||r.test(e))return s.dnsSuffix}return Ic.outputs.dnsSuffix},ke=URL,Tc=URLSearchParams,Ld=({region:e})=>({url:new ke(`https://${yc}.${e}.${vc(e)}`)});class On extends ue{constructor(){super({name:yt.PlatformNotSupported,message:"Function not supported on current platform"})}}class fr{constructor(t){this.storage=t}async setItem(t,n){if(!this.storage)throw new On;this.storage.setItem(t,n)}async getItem(t){if(!this.storage)throw new On;return this.storage.getItem(t)}async removeItem(t){if(!this.storage)throw new On;this.storage.removeItem(t)}async clear(){if(!this.storage)throw new On;this.storage.clear()}}class bc{constructor(){this.storage=new Map}get length(){return this.storage.size}key(t){return t>this.length-1?null:Array.from(this.storage.keys())[t]}setItem(t,n){this.storage.set(t,n)}getItem(t){return this.storage.get(t)??null}removeItem(t){this.storage.delete(t)}clear(){this.storage.clear()}}const Ac=new j("CoreStorageUtils"),Nc=()=>{try{if(typeof window<"u"&&window.localStorage)return window.localStorage}catch{Ac.info("localStorage not found. InMemoryStorage is used as a fallback.")}return new bc},Cc=()=>{try{if(typeof window<"u"&&window.sessionStorage)return window.sessionStorage.getItem("test"),window.sessionStorage;throw new Error("sessionStorage is not defined")}catch{return Ac.info("sessionStorage not found. InMemoryStorage is used as a fallback."),new bc}};class $d extends fr{constructor(){super(Nc())}}class Kd extends fr{constructor(){super(Cc())}}class jd{constructor(t){this._storage=t}get storage(){if(!this._storage)throw new On;return this._storage}setItem(t,n){this.storage.setItem(t,n)}getItem(t){return this.storage.getItem(t)}removeItem(t){this.storage.removeItem(t)}clear(){this.storage.clear()}}class Bd extends jd{constructor(){super(Cc())}}class qd{constructor(t={}){const{path:n,domain:s,expires:i,sameSite:r,secure:o}=t;if(this.domain=s,this.path=n||"/",this.expires=Object.prototype.hasOwnProperty.call(t,"expires")?i:365,this.secure=Object.prototype.hasOwnProperty.call(t,"secure")?o:!0,Object.prototype.hasOwnProperty.call(t,"sameSite")){if(!r||!["strict","lax","none"].includes(r))throw new Error('The sameSite value of cookieStorage must be "lax", "strict" or "none".');if(r==="none"&&!this.secure)throw new Error("sameSite = None requires the Secure attribute in latest browser versions.");this.sameSite=r}}async setItem(t,n){os.set(t,n,this.getData())}async getItem(t){return os.get(t)??null}async removeItem(t){os.remove(t,this.getData())}async clear(){const t=os.get(),n=Object.keys(t).map(s=>this.removeItem(s));await Promise.all(n)}getData(){return{path:this.path,expires:this.expires,domain:this.domain,secure:this.secure,...this.sameSite&&{sameSite:this.sameSite}}}}const Xn=new $d;new Kd;const Xe=new Bd,qt={keyPrefix:"aws-amplify-cache",capacityInBytes:1048576,itemMaxSize:21e4,defaultTTL:2592e5,defaultPriority:5,warningThreshold:.8},Nt="CurSize";function go(e){let t=0;t=e.length;for(let n=e.length;n>=0;n-=1){const s=e.charCodeAt(n);s>127&&s<=2047?t+=1:s>2047&&s<=65535&&(t+=2),s>=56320&&s<=57343&&(n-=1)}return t}function Vt(){return new Date().getTime()}const xn=e=>`${e}${Nt}`;var Rt;(function(e){e.NoCacheItem="NoCacheItem",e.NullNextNode="NullNextNode",e.NullPreviousNode="NullPreviousNode"})(Rt||(Rt={}));const Vd={[Rt.NoCacheItem]:{message:"Item not found in the cache storage."},[Rt.NullNextNode]:{message:"Next node is null."},[Rt.NullPreviousNode]:{message:"Previous node is null."}},Eo=Js(Vd),H=new j("StorageCache");class Wd{constructor({config:t,keyValueStorage:n}){this.config={...qt,...t},this.keyValueStorage=n,this.sanitizeConfig()}getModuleName(){return"Cache"}configure(t){return t&&(t.keyPrefix&&H.warn("keyPrefix can not be re-configured on an existing Cache instance."),this.config={...this.config,...t}),this.sanitizeConfig(),this.config}async getCurrentCacheSize(){let t=await this.getStorage().getItem(xn(this.config.keyPrefix));return t||(await this.getStorage().setItem(xn(this.config.keyPrefix),"0"),t="0"),Number(t)}async setItem(t,n,s){if(H.debug(`Set item: key is ${t}, value is ${n} with options: ${s}`),!t||t===Nt){H.warn(`Invalid key: should not be empty or reserved key: '${Nt}'`);return}if(typeof n>"u"){H.warn("The value of item should not be undefined!");return}const i={priority:s?.priority!==void 0?s.priority:this.config.defaultPriority,expires:s?.expires!==void 0?s.expires:this.config.defaultTTL+Vt()};if(i.priority<1||i.priority>5){H.warn("Invalid parameter: priority due to out or range. It should be within 1 and 5.");return}const r=`${this.config.keyPrefix}${t}`,o=this.fillCacheItem(r,n,i);if(o.byteSize>this.config.itemMaxSize){H.warn(`Item with key: ${t} you are trying to put into is too big!`);return}try{const a=await this.getStorage().getItem(r);if(a&&await this.removeCacheItem(r,JSON.parse(a).byteSize),await this.isCacheFull(o.byteSize)){const c=await this.clearInvalidAndGetRemainingKeys();if(await this.isCacheFull(o.byteSize)){const u=await this.sizeToPop(o.byteSize);await this.popOutItems(c,u)}}return this.setCacheItem(r,o)}catch(a){H.warn(`setItem failed! ${a}`)}}async getItem(t,n){H.debug(`Get item: key is ${t} with options ${n}`);let s;if(!t||t===Nt)return H.warn(`Invalid key: should not be empty or reserved key: '${Nt}'`),null;const i=`${this.config.keyPrefix}${t}`;try{if(s=await this.getStorage().getItem(i),s!=null)if(await this.isExpired(i))await this.removeCacheItem(i,JSON.parse(s).byteSize);else return(await this.updateVisitedTime(JSON.parse(s),i)).data;if(n?.callback){const r=n.callback();return r!==null&&await this.setItem(t,r,n),r}return null}catch(r){return H.warn(`getItem failed! ${r}`),null}}async removeItem(t){if(H.debug(`Remove item: key is ${t}`),!t||t===Nt){H.warn(`Invalid key: should not be empty or reserved key: '${Nt}'`);return}const n=`${this.config.keyPrefix}${t}`;try{const s=await this.getStorage().getItem(n);s&&await this.removeCacheItem(n,JSON.parse(s).byteSize)}catch(s){H.warn(`removeItem failed! ${s}`)}}async getAllKeys(){try{return await this.getAllCacheKeys()}catch(t){return H.warn(`getAllkeys failed! ${t}`),[]}}getStorage(){return this.keyValueStorage}async isExpired(t){const n=await this.getStorage().getItem(t);Eo(n!==null,Rt.NoCacheItem,`Key: ${t}`);const s=JSON.parse(n);return Vt()>=s.expires}async removeCacheItem(t,n){const s=await this.getStorage().getItem(t);Eo(s!==null,Rt.NoCacheItem,`Key: ${t}`);const i=n??JSON.parse(s).byteSize;await this.decreaseCurrentSizeInBytes(i);try{await this.getStorage().removeItem(t)}catch(r){await this.increaseCurrentSizeInBytes(i),H.error(`Failed to remove item: ${r}`)}}fillCacheItem(t,n,s){const i={key:t,data:n,timestamp:Vt(),visitedTime:Vt(),priority:s.priority??0,expires:s.expires??0,type:typeof n,byteSize:0};return i.byteSize=go(JSON.stringify(i)),i.byteSize=go(JSON.stringify(i)),i}sanitizeConfig(){this.config.itemMaxSize>this.config.capacityInBytes&&(H.error("Invalid parameter: itemMaxSize. It should be smaller than capacityInBytes. Setting back to default."),this.config.itemMaxSize=qt.itemMaxSize),(this.config.defaultPriority>5||this.config.defaultPriority<1)&&(H.error("Invalid parameter: defaultPriority. It should be between 1 and 5. Setting back to default."),this.config.defaultPriority=qt.defaultPriority),(Number(this.config.warningThreshold)>1||Number(this.config.warningThreshold)<0)&&(H.error("Invalid parameter: warningThreshold. It should be between 0 and 1. Setting back to default."),this.config.warningThreshold=qt.warningThreshold);const t=5*1024*1024;this.config.capacityInBytes>t&&(H.error("Cache Capacity should be less than 5MB. Setting back to default. Setting back to default."),this.config.capacityInBytes=qt.capacityInBytes)}async increaseCurrentSizeInBytes(t){const n=await this.getCurrentCacheSize();await this.getStorage().setItem(xn(this.config.keyPrefix),(n+t).toString())}async decreaseCurrentSizeInBytes(t){const n=await this.getCurrentCacheSize();await this.getStorage().setItem(xn(this.config.keyPrefix),(n-t).toString())}async updateVisitedTime(t,n){return t.visitedTime=Vt(),await this.getStorage().setItem(n,JSON.stringify(t)),t}async setCacheItem(t,n){await this.increaseCurrentSizeInBytes(n.byteSize);try{await this.getStorage().setItem(t,JSON.stringify(n))}catch(s){await this.decreaseCurrentSizeInBytes(n.byteSize),H.error(`Failed to set item ${s}`)}}async sizeToPop(t){const s=await this.getCurrentCacheSize()+t-this.config.capacityInBytes,i=(1-this.config.warningThreshold)*this.config.capacityInBytes;return s>i?s:i}async isCacheFull(t){const n=await this.getCurrentCacheSize();return t+n>this.config.capacityInBytes}async popOutItems(t,n){const s=[];let i=n;for(const r of t){const o=await this.getStorage().getItem(r);if(o!=null){const a=JSON.parse(o);s.push(a)}}s.sort((r,o)=>r.priority>o.priority?-1:r.priority<o.priority?1:r.visitedTime<o.visitedTime?-1:1);for(const r of s)if(await this.removeCacheItem(r.key,r.byteSize),i-=r.byteSize,i<=0)return}async clearInvalidAndGetRemainingKeys(){const t=[],n=await this.getAllCacheKeys({omitSizeKey:!0});for(const s of n)await this.isExpired(s)?await this.removeCacheItem(s):t.push(s);return t}async clear(){H.debug("Clear Cache");try{const t=await this.getAllKeys();for(const n of t){const s=`${this.config.keyPrefix}${n}`;await this.getStorage().removeItem(s)}}catch(t){H.warn(`clear failed! ${t}`)}}}const zd=new j("StorageCache");class mr extends Wd{constructor(t){const n=Nc();super({config:t,keyValueStorage:new fr(n)}),this.storage=n,this.getItem=this.getItem.bind(this),this.setItem=this.setItem.bind(this),this.removeItem=this.removeItem.bind(this)}async getAllCacheKeys(t){const{omitSizeKey:n}=t??{},s=[];for(let i=0;i<this.storage.length;i++){const r=this.storage.key(i);n&&r===xn(this.config.keyPrefix)||r?.startsWith(this.config.keyPrefix)&&s.push(r.substring(this.config.keyPrefix.length))}return s}createInstance(t){return(!t.keyPrefix||t.keyPrefix===qt.keyPrefix)&&(zd.error("invalid keyPrefix, setting keyPrefix with timeStamp"),t.keyPrefix=Vt.toString()),new mr(t)}}const Pc=new mr,Oc=e=>Object.keys(e).map(t=>t.toLowerCase()).sort().join(";"),Hd="X-Amz-Date",Gd="X-Amz-Security-Token",Qd="authorization",Yd="host",Jd=Hd.toLowerCase(),Xd=Gd.toLowerCase(),xc="aws4_request",_c="AWS4-HMAC-SHA256",Zd="AWS4",eh="e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",th="UNSIGNED-PAYLOAD",nh=(e,t,n)=>`${e}/${t}/${n}/${xc}`,sh=e=>{const t=e.toISOString().replace(/[:-]|\.\d{3}/g,"");return{longDate:t,shortDate:t.slice(0,8)}},ih=({credentials:e,signingDate:t=new Date,signingRegion:n,signingService:s,uriEscapePath:i=!0})=>{const{accessKeyId:r,secretAccessKey:o,sessionToken:a}=e,{longDate:c,shortDate:u}=sh(t),l=nh(u,n,s);return{accessKeyId:r,credentialScope:l,longDate:c,secretAccessKey:o,sessionToken:a,shortDate:u,signingRegion:n,signingService:s,uriEscapePath:i}},_n=(e,t)=>{const n=new Kn(e??void 0);return n.update(t),n.digestSync()},ki=(e,t)=>{const n=_n(e,t);return Kl(n)},rh=e=>Object.entries(e).map(([t,n])=>({key:t.toLowerCase(),value:n?.trim().replace(/\s+/g," ")??""})).sort((t,n)=>t.key<n.key?-1:1).map(t=>`${t.key}:${t.value}
`).join(""),oh=e=>Array.from(e).sort(([t,n],[s,i])=>t===s?n<i?-1:1:t<s?-1:1).map(([t,n])=>`${So(t)}=${So(n)}`).join("&"),So=e=>encodeURIComponent(e).replace(/[!'()*]/g,ah),ah=e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`,ch=(e,t=!0)=>e?t?encodeURIComponent(e).replace(/%2F/g,"/"):e:"/",uh=e=>e==null?eh:lh(e)?ki(null,e):th,lh=e=>typeof e=="string"||ArrayBuffer.isView(e)||dh(e),dh=e=>typeof ArrayBuffer=="function"&&e instanceof ArrayBuffer||Object.prototype.toString.call(e)==="[object ArrayBuffer]",hh=({body:e,headers:t,method:n,url:s},i=!0)=>[n,ch(s.pathname,i),oh(s.searchParams),rh(t),Oc(t),uh(e)].join(`
`),ph=(e,t,n,s)=>{const i=`${Zd}${e}`,r=_n(i,t),o=_n(r,n),a=_n(o,s);return _n(a,xc)},fh=(e,t,n)=>[_c,e,t,n].join(`
`),mh=(e,{credentialScope:t,longDate:n,secretAccessKey:s,shortDate:i,signingRegion:r,signingService:o,uriEscapePath:a})=>{const c=hh(e,a),u=ki(null,c),l=fh(n,t,u);return ki(ph(s,i,r,o),l)},Rc=(e,t)=>{const n=ih(t),{accessKeyId:s,credentialScope:i,longDate:r,sessionToken:o}=n,a={...e.headers};a[Yd]=e.url.host,a[Jd]=r,o&&(a[Xd]=o);const c={...e,headers:a},u=mh(c,n),l=`Credential=${s}/${i}`,d=`SignedHeaders=${Oc(a)}`,h=`Signature=${u}`;return a[Qd]=`${_c} ${l}, ${d}, ${h}`,c},kc=e=>new Date(Date.now()+e),yh=5*60*1e3,gh=(e,t)=>Math.abs(kc(t).getTime()-e)>=yh,Eh=(e,t)=>gh(e,t)?e-Date.now():t,Sh=({credentials:e,region:t,service:n,uriEscapePath:s=!0})=>{let i;return(r,o)=>async function(c){i=i??0;const u={credentials:typeof e=="function"?await e({forceRefresh:!!o?.isCredentialsExpired}):e,signingDate:kc(i),signingRegion:t,signingService:n,uriEscapePath:s},l=await Rc(c,u),d=await r(l),h=wh(d);return h&&(i=Eh(Date.parse(h),i)),d}},wh=({headers:e}={})=>e?.date??e?.Date??e?.["x-amz-date"];class Ct extends Error{constructor(){super(...arguments),this.nonRetryable=!0}}const Mc=(e,t,n=fc,s)=>rc(e,t,cr(n),s),Ih=e=>{let t;return async(...n)=>t||(t=new Promise((s,i)=>{e(...n).then(r=>{s(r)}).catch(r=>{i(r)}).finally(()=>{t=void 0})}),t)};function wo({expiresAt:e,clockDrift:t,tolerance:n=5e3}){return Date.now()+t+n>e}const vh=async()=>{const{userAgentData:e}=navigator;if(!e)return navigator.userAgent;const{platform:t="",platformVersion:n="",model:s="",architecture:i="",fullVersionList:r=[]}=await e.getHighEntropyValues(["platform","platformVersion","architecture","model","fullVersionList"]),o=r.map(c=>`${c.brand}/${c.version}`).join(";");return[t,n,i,s,t,o].filter(c=>c).join(" ")||navigator.userAgent};class Ds extends ue{get response(){return this._response?Th(this._response):void 0}constructor(t){super(t),this.constructor=Ds,Object.setPrototypeOf(this,Ds.prototype),t.response&&(this._response=t.response)}}const Th=e=>({...e,headers:{...e.headers}});class bh extends Error{constructor(t){super(`BackgroundManagerNotOpenError: ${t}`)}}class tt{constructor(){this._state=Ge.Open,this.jobs=new Set}add(t,n){let s,i;typeof t=="string"?(s=void 0,i=t):(s=t,i=n);const r=this.closedFailure(i);if(r)return r;if(s===void 0)return this.addHook(i);if(typeof s=="function")return this.addFunction(s,i);if(s instanceof tt)this.addManager(s,i);else throw new Error("If `job` is provided, it must be an Observable, Function, or BackgroundProcessManager.")}addCleaner(t,n){const{resolve:s,onTerminate:i}=this.addHook(n),r=async()=>{await t(),s()};return i.then(r),r}addFunction(t,n){let s;const i=new Promise(o=>{s=o}),r=t(i);return typeof r?.then=="function"&&this.registerPromise(r,s,n),r}addManager(t,n){this.addCleaner(async()=>t.close(),n)}addHook(t){let n,s;const i=new Promise((a,c)=>{n=a,s=c});let r;const o=new Promise(a=>{r=a});return this.registerPromise(i,r,t),{resolve:n,reject:s,onTerminate:o}}registerPromise(t,n,s){const i={promise:t,terminate:n,description:s};this.jobs.add(i),t.then(()=>{this.jobs.delete(i)}).catch(()=>{this.jobs.delete(i)})}get length(){return this.jobs.size}get state(){return this._state}get pending(){return Array.from(this.jobs).map(t=>t.description)}get isOpen(){return this._state===Ge.Open}get isClosing(){return this._state===Ge.Closing}get isClosed(){return this._state===Ge.Closed}closedFailure(t){if(!this.isOpen)return Promise.reject(new bh([`The manager is ${this.state}.`,`You tried to add "${t}".`,`Pending jobs: [
${this.pending.map(n=>"    "+n).join(`,
`)}
]`].join(`
`)))}async close(){if(this.isOpen){this._state=Ge.Closing;for(const t of Array.from(this.jobs))try{t.terminate()}catch(n){console.warn(`Failed to send termination signal to job. Error: ${n.message}`,t)}this._closingPromise=Promise.allSettled(Array.from(this.jobs).map(t=>t.promise)),await this._closingPromise,this._state=Ge.Closed}return this._closingPromise}async open(){this.isClosing&&await this.close(),this._state=Ge.Open}}/*!
 * The MIT License (MIT)
 *
 * Copyright (c) 2016 Christian Speckner <cnspeckn@googlemail.com>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */class Ah{constructor(){this._queue=[],this._pending=!1}isLocked(){return this._pending}acquire(){const t=new Promise(n=>this._queue.push(n));return this._pending||this._dispatchNext(),t}runExclusive(t){return this.acquire().then(n=>{let s;try{s=t()}catch(i){throw n(),i}return Promise.resolve(s).then(i=>(n(),i),i=>{throw n(),i})})}_dispatchNext(){this._queue.length>0?(this._pending=!0,this._queue.shift()(this._dispatchNext.bind(this))):this._pending=!1}}function Nh(e){return Array.from(e,t=>String.fromCodePoint(t)).join("")}const en={convert(e,t={urlSafe:!1,skipPadding:!1}){const n=typeof e=="string"?e:Nh(e);let s=pl()(n);return t.urlSafe&&(s=s.replace(/\+/g,"-").replace(/\//g,"_")),t.skipPadding&&(s=s.replace(/=/g,"")),s}};function Ch(){return hl().getRandomValues(new Uint32Array(1))[0]}function Ph(e){const{words:t}=e,{sigBytes:n}=e,s=[];for(let i=0;i<n;i++){const r=t[i>>>2]>>>24-i%4*8&255;s.push((r>>>4).toString(16)),s.push((r&15).toString(16))}return s.join("")}class ei{constructor(t,n){this.words=[];let s=t;s=this.words=s||[],n!==void 0?this.sigBytes=n:this.sigBytes=s.length*4}random(t){const n=[];for(let s=0;s<t;s+=4)n.push(Ch());return new ei(n,t)}toString(){return Ph(this)}}var D;(function(e){e.EmptySignInUsername="EmptySignInUsername",e.EmptySignInPassword="EmptySignInPassword",e.CustomAuthSignInPassword="CustomAuthSignInPassword",e.EmptySignUpUsername="EmptySignUpUsername",e.EmptySignUpPassword="EmptySignUpPassword",e.EmptyConfirmSignUpUsername="EmptyConfirmSignUpUsername",e.EmptyConfirmSignUpCode="EmptyConfirmSignUpCode",e.EmptyResendSignUpCodeUsername="EmptyresendSignUpCodeUsername",e.EmptyChallengeResponse="EmptyChallengeResponse",e.EmptyConfirmResetPasswordUsername="EmptyConfirmResetPasswordUsername",e.EmptyConfirmResetPasswordNewPassword="EmptyConfirmResetPasswordNewPassword",e.EmptyConfirmResetPasswordConfirmationCode="EmptyConfirmResetPasswordConfirmationCode",e.EmptyResetPasswordUsername="EmptyResetPasswordUsername",e.EmptyVerifyTOTPSetupCode="EmptyVerifyTOTPSetupCode",e.EmptyConfirmUserAttributeCode="EmptyConfirmUserAttributeCode",e.IncorrectMFAMethod="IncorrectMFAMethod",e.EmptyUpdatePassword="EmptyUpdatePassword"})(D||(D={}));const Dc={[D.EmptyChallengeResponse]:{message:"challengeResponse is required to confirmSignIn"},[D.EmptyConfirmResetPasswordUsername]:{message:"username is required to confirmResetPassword"},[D.EmptyConfirmSignUpCode]:{message:"code is required to confirmSignUp"},[D.EmptyConfirmSignUpUsername]:{message:"username is required to confirmSignUp"},[D.EmptyConfirmResetPasswordConfirmationCode]:{message:"confirmationCode is required to confirmResetPassword"},[D.EmptyConfirmResetPasswordNewPassword]:{message:"newPassword is required to confirmResetPassword"},[D.EmptyResendSignUpCodeUsername]:{message:"username is required to confirmSignUp"},[D.EmptyResetPasswordUsername]:{message:"username is required to resetPassword"},[D.EmptySignInPassword]:{message:"password is required to signIn"},[D.EmptySignInUsername]:{message:"username is required to signIn"},[D.EmptySignUpPassword]:{message:"password is required to signUp"},[D.EmptySignUpUsername]:{message:"username is required to signUp"},[D.CustomAuthSignInPassword]:{message:"A password is not needed when signing in with CUSTOM_WITHOUT_SRP",recoverySuggestion:"Do not include a password in your signIn call."},[D.IncorrectMFAMethod]:{message:"Incorrect MFA method was chosen. It should be either SMS, TOTP, or EMAIL",recoverySuggestion:"Try to pass SMS, TOTP, or EMAIL as the challengeResponse"},[D.EmptyVerifyTOTPSetupCode]:{message:"code is required to verifyTotpSetup"},[D.EmptyUpdatePassword]:{message:"oldPassword and newPassword are required to changePassword"},[D.EmptyConfirmUserAttributeCode]:{message:"confirmation code is required to confirmUserAttribute"}};var Io;(function(e){e.DEFAULT_MSG="Authentication Error",e.EMPTY_EMAIL="Email cannot be empty",e.EMPTY_PHONE="Phone number cannot be empty",e.EMPTY_USERNAME="Username cannot be empty",e.INVALID_USERNAME="The username should either be a string or one of the sign in types",e.EMPTY_PASSWORD="Password cannot be empty",e.EMPTY_CODE="Confirmation code cannot be empty",e.SIGN_UP_ERROR="Error creating account",e.NO_MFA="No valid MFA method provided",e.INVALID_MFA="Invalid MFA type",e.EMPTY_CHALLENGE="Challenge response cannot be empty",e.NO_USER_SESSION="Failed to get the session because the user is empty",e.NETWORK_ERROR="Network Error",e.DEVICE_CONFIG="Device tracking has not been configured in this User Pool",e.AUTOSIGNIN_ERROR="Please use your credentials to sign in",e.OAUTH_ERROR="Couldn't finish OAuth flow, check your User Pool HostedUI settings"})(Io||(Io={}));var tn;(function(e){e.SignInException="SignInException",e.OAuthSignInError="OAuthSignInException"})(tn||(tn={}));class R extends ue{constructor(t){super(t),this.constructor=R,Object.setPrototypeOf(this,R.prototype)}}function ne(e,t){const{message:n,recoverySuggestion:s}=Dc[t];if(!e)throw new R({name:t,message:n,recoverySuggestion:s})}function re(e){const t=e?.split("_")[0];if(!e||e.indexOf("_")<0||!t||typeof t!="string")throw new R({name:"InvalidUserPoolId",message:"Invalid user pool id provided."});return t}function Mi(e){if(!e||!e.includes(":"))throw new R({name:"InvalidIdentityPoolIdException",message:"Invalid identity pool id provided.",recoverySuggestion:"Make sure a valid identityPoolId is given in the config."});return e.split(":")[0]}function vo(e){return Object.entries(e).map(([t,n])=>({Name:t,Value:n}))}var To;(function(e){e.ConcurrentModificationException="ConcurrentModificationException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.SoftwareTokenMFANotFoundException="SoftwareTokenMFANotFoundException"})(To||(To={}));var bo;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(bo||(bo={}));var Ao;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UsernameExistsException="UsernameExistsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Ao||(Ao={}));var No;(function(e){e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyFailedAttemptsException="TooManyFailedAttemptsException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(No||(No={}));var Co;(function(e){e.AliasExistsException="AliasExistsException",e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyFailedAttemptsException="TooManyFailedAttemptsException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotFoundException="UserNotFoundException"})(Co||(Co={}));var Po;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Po||(Po={}));var Oo;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Oo||(Oo={}));var xo;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(xo||(xo={}));var _o;(function(e){e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotFoundException="UserNotFoundException"})(_o||(_o={}));var Ro;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Ro||(Ro={}));var ko;(function(e){e.ExternalServiceException="ExternalServiceException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceConflictException="ResourceConflictException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException"})(ko||(ko={}));var Mo;(function(e){e.ExternalServiceException="ExternalServiceException",e.InternalErrorException="InternalErrorException",e.InvalidIdentityPoolConfigurationException="InvalidIdentityPoolConfigurationException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceConflictException="ResourceConflictException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException"})(Mo||(Mo={}));var Do;(function(e){e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Do||(Do={}));var Fo;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException"})(Fo||(Fo={}));var Fs;(function(e){e.PasswordResetRequiredException="PasswordResetRequiredException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Fs||(Fs={}));var Uo;(function(e){e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotFoundException="UserNotFoundException"})(Uo||(Uo={}));var Lo;(function(e){e.AliasExistsException="AliasExistsException",e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.MFAMethodNotFoundException="MFAMethodNotFoundException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.SoftwareTokenMFANotFoundException="SoftwareTokenMFANotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Lo||(Lo={}));var $o;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})($o||($o={}));var Di;(function(e){e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UsernameExistsException="UsernameExistsException"})(Di||(Di={}));var Ko;(function(e){e.AliasExistsException="AliasExistsException",e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Ko||(Ko={}));var jo;(function(e){e.CodeMismatchException="CodeMismatchException",e.EnableSoftwareTokenMFAException="EnableSoftwareTokenMFAException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.SoftwareTokenMFANotFoundException="SoftwareTokenMFANotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(jo||(jo={}));var Bo;(function(e){e.AliasExistsException="AliasExistsException",e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Bo||(Bo={}));var qo;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(qo||(qo={}));var Vo;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Vo||(Vo={}));const ti="UserUnAuthenticatedException",Oh="UserAlreadyAuthenticatedException",xh="DeviceMetadataNotFoundException",_h="InvalidRedirectException",Rh="InvalidAppSchemeException",kh="InvalidPreferredRedirectUrlException",Mh=new R({name:_h,message:"signInRedirect or signOutRedirect had an invalid format or was not found.",recoverySuggestion:"Please make sure the signIn/Out redirect in your oauth config is valid."});new R({name:Rh,message:"A valid non-http app scheme was not found in the config.",recoverySuggestion:"Please make sure a valid custom app scheme is present in the config."});new R({name:kh,message:"The given preferredRedirectUrl does not match any items in the redirectSignOutUrls array from the config.",recoverySuggestion:"Please make sure a matching preferredRedirectUrl is provided."});const Dh="InvalidOriginException",Fh=new R({name:Dh,message:"redirect is coming from a different origin. The oauth flow needs to be initiated from the same origin",recoverySuggestion:"Please call signInWithRedirect from the same origin."}),Uh="OAuthSignOutException",Lh="TokenRefreshException",$h="UnexpectedSignInInterruptionException";function Kh(e){if(!e||!e.accessToken)throw new R({name:ti,message:"User needs to be authenticated to call this API.",recoverySuggestion:"Sign in before calling this API again."})}function jh(e){if(!e||!e.idToken)throw new R({name:ti,message:"User needs to be authenticated to call this API.",recoverySuggestion:"Sign in before calling this API again."})}const Bh=new R({name:Lh,message:`Token refresh is not supported when authenticated with the 'implicit grant' (token) oauth flow. 
	Please change your oauth configuration to use 'code grant' flow.`,recoverySuggestion:`Please logout and change your Amplify configuration to use "code grant" flow. 
	E.g { responseType: 'code' }`}),qh=new R({name:ti,message:"User needs to be authenticated to call this API.",recoverySuggestion:"Sign in before calling this API again."});function Fc(e){if(zh(e))throw Bh;if(!Wh(e))throw qh}function Uc(e){if(!e||!e.deviceKey||!e.deviceGroupKey||!e.randomPassword)throw new R({name:xh,message:"Either deviceKey, deviceGroupKey or secretPassword were not found during the sign-in process.",recoverySuggestion:"Make sure to not clear storage after calling the signIn API."})}const Vh={inflightOAuth:"inflightOAuth",oauthSignIn:"oauthSignIn",oauthPKCE:"oauthPKCE",oauthState:"oauthState"};function Lc(e){return e?.accessToken||e?.idToken}function Wh(e){return Lc(e)&&e?.refreshToken}function zh(e){return Lc(e)&&!e?.refreshToken}const Hh=async e=>{const t=e.getConfig().Auth?.Cognito;B(t);const n=await e.Auth.getTokens({forceRefresh:!1});Kh(n);const{"cognito:username":s,sub:i}=n.idToken?.payload??{},r={username:s,userId:i},o=Gh(n);return o&&(r.signInDetails=o),r};function Gh(e){return e?.signInDetails}const yr=async()=>Hh(W),Ue=(e,t)=>un({category:St.Auth,action:e,...t}),ot=e=>(t,n)=>{const s=Qh(e),i=JSON.stringify(t);return Yh(n,s,i)},Qh=e=>({"content-type":"application/x-amz-json-1.1","x-amz-target":`AWSCognitoIdentityProviderService.${e}`}),Yh=({url:e},t,n)=>({headers:t,url:e,body:n,method:"POST"});function Me(e){if(!e||e.name==="Error"||e instanceof TypeError)throw new R({name:yt.Unknown,message:"An unknown error has occurred.",underlyingError:e})}const vt=()=>async e=>{if(e.statusCode>=300){const t=await Lt(e);throw Me(t),new R({name:t.name,message:t.message,metadata:t.$metadata})}return Yn(e)},Jh=()=>(e,t)=>async function(s){return s.headers["cache-control"]="no-store",e(s)},at=Jn(Ec,[Jh]),$c="cognito-idp",ct={service:$c,retryDecider:lr(Lt),computeDelay:ur,userAgentValue:un(),cache:"no-store"},ln=e=>Fe(at,ot("InitiateAuth"),vt(),{...ct,...e}),ni=e=>Fe(at,ot("RespondToAuthChallenge"),vt(),{...ct,...e}),Xh=e=>Fe(at,ot("AssociateSoftwareToken"),vt(),{...ct,...e}),Zh=({region:e})=>({url:new ke(`https://${$c}.${e}.${vc(e)}`)}),oe=({endpointOverride:e})=>t=>e?{url:new ke(e)}:Zh(t);function Ce({username:e,userPoolId:t,userPoolClientId:n}){if(typeof window>"u")return;const s=window.AmazonCognitoAdvancedSecurityData;if(typeof s>"u")return;const i=s.getData(e,t,n);return i?{EncodedData:i}:{}}const ep=async({tokens:e,authConfig:t,username:n})=>{B(t?.Cognito);const{userPoolId:s,userPoolClientId:i,userPoolEndpoint:r}=t.Cognito,o=re(s);Fc(e);const a=e.refreshToken,c={REFRESH_TOKEN:a};e.deviceMetadata?.deviceKey&&(c.DEVICE_KEY=e.deviceMetadata.deviceKey);const u=Ce({username:n,userPoolId:s,userPoolClientId:i}),l=ln({endpointResolver:oe({endpointOverride:r})}),{AuthenticationResult:d}=await l({region:o},{ClientId:i,AuthFlow:"REFRESH_TOKEN_AUTH",AuthParameters:c,UserContextData:u}),h=Et(d?.AccessToken??""),p=d?.IdToken?Et(d.IdToken):void 0,{iat:f}=h.payload;if(!f)throw new R({name:"iatNotFoundException",message:"iat not found in access token"});const m=f*1e3-new Date().getTime();return{accessToken:h,idToken:p,clockDrift:m,refreshToken:a,username:n}},tp=Ih(ep),np={accessToken:"accessToken",idToken:"idToken",oidcProvider:"oidcProvider",clockDrift:"clockDrift",refreshToken:"refreshToken",deviceKey:"deviceKey",randomPasswordKey:"randomPasswordKey",deviceGroupKey:"deviceGroupKey",signInDetails:"signInDetails",oauthMetadata:"oauthMetadata"};var Us;(function(e){e.InvalidAuthTokens="InvalidAuthTokens"})(Us||(Us={}));const sp={[Us.InvalidAuthTokens]:{message:"Invalid tokens.",recoverySuggestion:"Make sure the tokens are valid."}},ip=Js(sp),Wo="CognitoIdentityServiceProvider";class rp{getKeyValueStorage(){if(!this.keyValueStorage)throw new R({name:"KeyValueStorageNotFoundException",message:"KeyValueStorage was not found in TokenStore"});return this.keyValueStorage}setKeyValueStorage(t){this.keyValueStorage=t}setAuthConfig(t){this.authConfig=t}async loadTokens(){try{const t=await this.getAuthKeys(),n=await this.getKeyValueStorage().getItem(t.accessToken);if(!n)throw new R({name:"NoSessionFoundException",message:"Auth session was not found. Make sure to call signIn."});const s=Et(n),i=await this.getKeyValueStorage().getItem(t.idToken),r=i?Et(i):void 0,o=await this.getKeyValueStorage().getItem(t.refreshToken)??void 0,a=await this.getKeyValueStorage().getItem(t.clockDrift)??"0",c=Number.parseInt(a),u=await this.getKeyValueStorage().getItem(t.signInDetails),l={accessToken:s,idToken:r,refreshToken:o,deviceMetadata:await this.getDeviceMetadata()??void 0,clockDrift:c,username:await this.getLastAuthUser()};return u&&(l.signInDetails=JSON.parse(u)),l}catch{return null}}async storeTokens(t){ip(t!==void 0,Us.InvalidAuthTokens);const n=t.username;await this.getKeyValueStorage().setItem(this.getLastAuthUserKey(),n);const s=await this.getAuthKeys();await this.getKeyValueStorage().setItem(s.accessToken,t.accessToken.toString()),t.idToken?await this.getKeyValueStorage().setItem(s.idToken,t.idToken.toString()):await this.getKeyValueStorage().removeItem(s.idToken),t.refreshToken?await this.getKeyValueStorage().setItem(s.refreshToken,t.refreshToken):await this.getKeyValueStorage().removeItem(s.refreshToken),t.deviceMetadata&&(t.deviceMetadata.deviceKey&&await this.getKeyValueStorage().setItem(s.deviceKey,t.deviceMetadata.deviceKey),t.deviceMetadata.deviceGroupKey&&await this.getKeyValueStorage().setItem(s.deviceGroupKey,t.deviceMetadata.deviceGroupKey),await this.getKeyValueStorage().setItem(s.randomPasswordKey,t.deviceMetadata.randomPassword)),t.signInDetails?await this.getKeyValueStorage().setItem(s.signInDetails,JSON.stringify(t.signInDetails)):await this.getKeyValueStorage().removeItem(s.signInDetails),await this.getKeyValueStorage().setItem(s.clockDrift,`${t.clockDrift}`)}async clearTokens(){const t=await this.getAuthKeys();await Promise.all([this.getKeyValueStorage().removeItem(t.accessToken),this.getKeyValueStorage().removeItem(t.idToken),this.getKeyValueStorage().removeItem(t.clockDrift),this.getKeyValueStorage().removeItem(t.refreshToken),this.getKeyValueStorage().removeItem(t.signInDetails),this.getKeyValueStorage().removeItem(this.getLastAuthUserKey()),this.getKeyValueStorage().removeItem(t.oauthMetadata)])}async getDeviceMetadata(t){const n=await this.getAuthKeys(t),s=await this.getKeyValueStorage().getItem(n.deviceKey),i=await this.getKeyValueStorage().getItem(n.deviceGroupKey),r=await this.getKeyValueStorage().getItem(n.randomPasswordKey);return r&&i&&s?{deviceKey:s,deviceGroupKey:i,randomPassword:r}:null}async clearDeviceMetadata(t){const n=await this.getAuthKeys(t);await Promise.all([this.getKeyValueStorage().removeItem(n.deviceKey),this.getKeyValueStorage().removeItem(n.deviceGroupKey),this.getKeyValueStorage().removeItem(n.randomPasswordKey)])}async getAuthKeys(t){B(this.authConfig?.Cognito);const n=t??await this.getLastAuthUser();return op(Wo,`${this.authConfig.Cognito.userPoolClientId}.${n}`)}getLastAuthUserKey(){B(this.authConfig?.Cognito);const t=this.authConfig.Cognito.userPoolClientId;return`${Wo}.${t}.LastAuthUser`}async getLastAuthUser(){return await this.getKeyValueStorage().getItem(this.getLastAuthUserKey())??"username"}async setOAuthMetadata(t){const{oauthMetadata:n}=await this.getAuthKeys();await this.getKeyValueStorage().setItem(n,JSON.stringify(t))}async getOAuthMetadata(){const{oauthMetadata:t}=await this.getAuthKeys(),n=await this.getKeyValueStorage().getItem(t);return n&&JSON.parse(n)}}const op=(e,t)=>gr(np)(`${e}`,t);function gr(e){const t=Object.values({...e});return(n,s)=>t.reduce((i,r)=>({...i,[r]:`${n}.${s}.${r}`}),{})}const zo="amplify-signin-with-hostedUI",Le="CognitoIdentityServiceProvider";class Kc{constructor(t){this.keyValueStorage=t}async clearOAuthInflightData(){B(this.cognitoConfig);const t=$e(Le,this.cognitoConfig.userPoolClientId);await Promise.all([this.keyValueStorage.removeItem(t.inflightOAuth),this.keyValueStorage.removeItem(t.oauthPKCE),this.keyValueStorage.removeItem(t.oauthState)])}async clearOAuthData(){B(this.cognitoConfig);const t=$e(Le,this.cognitoConfig.userPoolClientId);return await this.clearOAuthInflightData(),await this.keyValueStorage.removeItem(zo),this.keyValueStorage.removeItem(t.oauthSignIn)}loadOAuthState(){B(this.cognitoConfig);const t=$e(Le,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.getItem(t.oauthState)}storeOAuthState(t){B(this.cognitoConfig);const n=$e(Le,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.setItem(n.oauthState,t)}loadPKCE(){B(this.cognitoConfig);const t=$e(Le,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.getItem(t.oauthPKCE)}storePKCE(t){B(this.cognitoConfig);const n=$e(Le,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.setItem(n.oauthPKCE,t)}setAuthConfig(t){this.cognitoConfig=t}async loadOAuthInFlight(){B(this.cognitoConfig);const t=$e(Le,this.cognitoConfig.userPoolClientId);return await this.keyValueStorage.getItem(t.inflightOAuth)==="true"}async storeOAuthInFlight(t){B(this.cognitoConfig);const n=$e(Le,this.cognitoConfig.userPoolClientId);await this.keyValueStorage.setItem(n.inflightOAuth,`${t}`)}async loadOAuthSignIn(){B(this.cognitoConfig);const t=$e(Le,this.cognitoConfig.userPoolClientId),n=await this.keyValueStorage.getItem(zo),[s,i]=(await this.keyValueStorage.getItem(t.oauthSignIn))?.split(",")??[];return{isOAuthSignIn:s==="true"||n==="true",preferPrivateSession:i==="true"}}async storeOAuthSignIn(t,n=!1){B(this.cognitoConfig);const s=$e(Le,this.cognitoConfig.userPoolClientId);await this.keyValueStorage.setItem(s.oauthSignIn,`${t},${n}`)}}const $e=(e,t)=>gr(Vh)(e,t),Ho=new Kc(Xn);class ap{constructor(){this.waitForInflightOAuth=ar()?async()=>{if(await Ho.loadOAuthInFlight())return this.inflightPromise?this.inflightPromise:(this.inflightPromise=new Promise((t,n)=>{}),this.inflightPromise)}:async()=>{}}setAuthConfig(t){Ho.setAuthConfig(t.Cognito),this.authConfig=t}setTokenRefresher(t){this.tokenRefresher=t}setAuthTokenStore(t){this.tokenStore=t}getTokenStore(){if(!this.tokenStore)throw new R({name:"EmptyTokenStoreException",message:"TokenStore not set"});return this.tokenStore}getTokenRefresher(){if(!this.tokenRefresher)throw new R({name:"EmptyTokenRefresherException",message:"TokenRefresher not set"});return this.tokenRefresher}async getTokens(t){let n;try{B(this.authConfig?.Cognito)}catch{return null}await this.waitForInflightOAuth(),this.inflightPromise=void 0,n=await this.getTokenStore().loadTokens();const s=await this.getTokenStore().getLastAuthUser();if(n===null)return null;const i=!!n?.idToken&&wo({expiresAt:(n.idToken?.payload?.exp??0)*1e3,clockDrift:n.clockDrift??0}),r=wo({expiresAt:(n.accessToken?.payload?.exp??0)*1e3,clockDrift:n.clockDrift??0});return(t?.forceRefresh||i||r)&&(n=await this.refreshTokens({tokens:n,username:s}),n===null)?null:{accessToken:n?.accessToken,idToken:n?.idToken,signInDetails:n?.signInDetails}}async refreshTokens({tokens:t,username:n}){try{const{signInDetails:s}=t,i=await this.getTokenRefresher()({tokens:t,authConfig:this.authConfig,username:n});return i.signInDetails=s,await this.setTokens({tokens:i}),ye.dispatch("auth",{event:"tokenRefresh"},"Auth",gt),i}catch(s){return this.handleErrors(s)}}handleErrors(t){if(Me(t),t.name!==yt.NetworkError&&this.clearTokens(),ye.dispatch("auth",{event:"tokenRefresh_failure",data:{error:t}},"Auth",gt),t.name.startsWith("NotAuthorizedException"))return null;throw t}async setTokens({tokens:t}){return this.getTokenStore().storeTokens(t)}async clearTokens(){return this.getTokenStore().clearTokens()}getDeviceMetadata(t){return this.getTokenStore().getDeviceMetadata(t)}clearDeviceMetadata(t){return this.getTokenStore().clearDeviceMetadata(t)}setOAuthMetadata(t){return this.getTokenStore().setOAuthMetadata(t)}getOAuthMetadata(){return this.getTokenStore().getOAuthMetadata()}}class cp{constructor(){this.authTokenStore=new rp,this.authTokenStore.setKeyValueStorage(Xn),this.tokenOrchestrator=new ap,this.tokenOrchestrator.setAuthTokenStore(this.authTokenStore),this.tokenOrchestrator.setTokenRefresher(tp)}getTokens({forceRefresh:t}={forceRefresh:!1}){return this.tokenOrchestrator.getTokens({forceRefresh:t})}setKeyValueStorage(t){this.authTokenStore.setKeyValueStorage(t)}setAuthConfig(t){this.authTokenStore.setAuthConfig(t),this.tokenOrchestrator.setAuthConfig(t)}}const Rn=new cp,{tokenOrchestrator:Ne}=Rn;async function dn(e){if(e.AccessToken){const t=Et(e.AccessToken),n=(t.payload.iat||0)*1e3,s=new Date().getTime(),i=n>0?n-s:0;let r,o,a;e.RefreshToken&&(o=e.RefreshToken),e.IdToken&&(r=Et(e.IdToken)),e?.NewDeviceMetadata&&(a=e.NewDeviceMetadata);const c={accessToken:t,idToken:r,refreshToken:o,clockDrift:i,deviceMetadata:a,username:e.username};e?.signInDetails&&(c.signInDetails=e.signInDetails),await Ne.setTokens({tokens:c})}else throw new ue({message:"Invalid tokens",name:"InvalidTokens",recoverySuggestion:"Check Cognito UserPool settings"})}const up="Unable to get user session following successful sign-in.",hn=async()=>{try{ye.dispatch("auth",{event:"signedIn",data:await yr()},"Auth",gt)}catch(e){throw e.name===ti?new R({name:$h,message:up,recoverySuggestion:"This most likely is due to auth tokens not being persisted. If you are using cookie store, please ensure cookies can be correctly set from your server."}):e}};function jc(){return{active:!1}}const lp=(e,t)=>{switch(t.type){case"SET_USERNAME":return{...e,username:t.value};case"SET_SESSION":return{...e,session:t.value};case"START":return{...e,active:!0};case"RESET":return jc();default:return e}},dp=e=>{let t=e(jc(),{type:"RESET"});return{getState:()=>t,dispatch:n=>{t=e(t,n)}}},lt=dp(lp),hp=3*60*1e3,us="CognitoSignInState",Ze={username:`${us}.username`,challengeName:`${us}.challengeName`,signInSession:`${us}.signInSession`,expiry:`${us}.expiry`},pp=(e,t)=>{switch(t.type){case"SET_SIGN_IN_SESSION":return ls({signInSession:t.value}),{...e,signInSession:t.value};case"SET_SIGN_IN_STATE":return ls(t.value),{...t.value};case"SET_CHALLENGE_NAME":return ls({challengeName:t.value}),{...e,challengeName:t.value};case"SET_USERNAME":return ls({username:t.value}),{...e,username:t.value};case"SET_INITIAL_STATE":return mp();case"RESET_STATE":return Bc(),Er();default:return e}},fp=e=>{const t=Number(e),n=Date.now();return t<=n},ze=()=>{wt.dispatch({type:"RESET_STATE"})},Bc=()=>{for(const e of Object.values(Ze))Xe.removeItem(e)},Er=()=>({username:void 0,challengeName:void 0,signInSession:void 0}),mp=()=>{const e=Xe.getItem(Ze.expiry);if(!e||fp(e))return Bc(),Er();const t=Xe.getItem(Ze.username)??void 0,n=Xe.getItem(Ze.challengeName)??void 0,s=Xe.getItem(Ze.signInSession)??void 0;return{username:t,challengeName:n,signInSession:s}},yp=e=>{let t=e(Er(),{type:"SET_INITIAL_STATE"});return{getState:()=>t,dispatch:n=>{t=e(t,n)}}},wt=yp(pp);function pn(e){wt.dispatch({type:"SET_SIGN_IN_STATE",value:e})}const ls=({challengeName:e,signInSession:t,username:n})=>{n&&Xe.setItem(Ze.username,n),e&&Xe.setItem(Ze.challengeName,e),t&&(Xe.setItem(Ze.signInSession,t),Xe.setItem(Ze.expiry,String(Date.now()+hp)))};class et extends ue{constructor(t){super(t),this.constructor=et,Object.setPrototypeOf(this,et.prototype)}}var Y;(function(e){e.PasskeyNotSupported="PasskeyNotSupported",e.PasskeyAlreadyExists="PasskeyAlreadyExists",e.InvalidPasskeyRegistrationOptions="InvalidPasskeyRegistrationOptions",e.InvalidPasskeyAuthenticationOptions="InvalidPasskeyAuthenticationOptions",e.RelyingPartyMismatch="RelyingPartyMismatch",e.PasskeyRegistrationFailed="PasskeyRegistrationFailed",e.PasskeyRetrievalFailed="PasskeyRetrievalFailed",e.PasskeyRegistrationCanceled="PasskeyRegistrationCanceled",e.PasskeyAuthenticationCanceled="PasskeyAuthenticationCanceled",e.PasskeyOperationAborted="PasskeyOperationAborted"})(Y||(Y={}));const Go="Passkeys may not be supported on this device. Ensure your application is running in a secure context (HTTPS) and Web Authentication API is supported.",Si="User may have canceled the ceremony or another interruption has occurred. Check underlying error for details.",Qo="Ensure your user pool is configured to support the WEB_AUTHN as an authentication factor.",Ls={[Y.PasskeyNotSupported]:{message:"Passkeys may not be supported on this device.",recoverySuggestion:Go},[Y.InvalidPasskeyRegistrationOptions]:{message:"Invalid passkey registration options.",recoverySuggestion:Qo},[Y.InvalidPasskeyAuthenticationOptions]:{message:"Invalid passkey authentication options.",recoverySuggestion:Qo},[Y.PasskeyRegistrationFailed]:{message:"Device failed to create passkey.",recoverySuggestion:Go},[Y.PasskeyRetrievalFailed]:{message:"Device failed to retrieve passkey.",recoverySuggestion:"Passkeys may not be available on this device. Try an alternative authentication factor like PASSWORD, EMAIL_OTP, or SMS_OTP."},[Y.PasskeyAlreadyExists]:{message:"Passkey already exists in authenticator.",recoverySuggestion:"Proceed with existing passkey or try again after deleting the credential."},[Y.PasskeyRegistrationCanceled]:{message:"Passkey registration ceremony has been canceled.",recoverySuggestion:Si},[Y.PasskeyAuthenticationCanceled]:{message:"Passkey authentication ceremony has been canceled.",recoverySuggestion:Si},[Y.PasskeyOperationAborted]:{message:"Passkey operation has been aborted.",recoverySuggestion:Si},[Y.RelyingPartyMismatch]:{message:"Relying party does not match current domain.",recoverySuggestion:"Ensure relying party identifier matches current domain."}},Sr=Js(Ls,et),gp=e=>{if(e instanceof et)return e;if(e instanceof Error&&e.name==="NotAllowedError"){const{message:t,recoverySuggestion:n}=Ls[Y.PasskeyAuthenticationCanceled];return new et({name:Y.PasskeyAuthenticationCanceled,message:t,recoverySuggestion:n,underlyingError:e})}return Ep(e)},Ep=e=>{if(e instanceof Error){if(e.name==="AbortError"){const{message:t,recoverySuggestion:n}=Ls[Y.PasskeyOperationAborted];return new et({name:Y.PasskeyOperationAborted,message:t,recoverySuggestion:n,underlyingError:e})}if(e.name==="SecurityError"){const{message:t,recoverySuggestion:n}=Ls[Y.RelyingPartyMismatch];return new et({name:Y.RelyingPartyMismatch,message:t,recoverySuggestion:n,underlyingError:e})}}return new et({name:yt.Unknown,message:"An unknown error has occurred.",underlyingError:e})},Sp=()=>ar()&&window.isSecureContext&&"credentials"in navigator&&typeof window.PublicKeyCredential=="function",bn=e=>en.convert(new Uint8Array(e),{urlSafe:!0,skipPadding:!0}),Yo=e=>Uint8Array.from(ir.convert(e,{urlSafe:!0}),t=>t.charCodeAt(0)).buffer,wp=e=>{const t=Yo(e.challenge),n=(e.allowCredentials||[]).map(s=>({...s,id:Yo(s.id)}));return{...e,challenge:t,allowCredentials:n}},Ip=e=>{const t={clientDataJSON:bn(e.response.clientDataJSON),authenticatorData:bn(e.response.authenticatorData),signature:bn(e.response.signature)};e.response.userHandle&&(t.userHandle=bn(e.response.userHandle));const n={id:e.id,rawId:bn(e.rawId),type:e.type,clientExtensionResults:e.getClientExtensionResults(),response:t};return e.authenticatorAttachment&&(n.authenticatorAttachment=e.authenticatorAttachment),n};function vp(e){Sr(e&&e instanceof PublicKeyCredential&&e.response instanceof AuthenticatorAssertionResponse,Y.PasskeyRetrievalFailed)}const Tp=async e=>{try{const t=Sp();Sr(t,Y.PasskeyNotSupported);const n=wp(e),s=await navigator.credentials.get({publicKey:n});return vp(s),Ip(s)}catch(t){throw gp(t)}},bp=e=>Fe(at,ot("ConfirmDevice"),vt(),{...ct,...e}),Is={convert(e){return new TextEncoder().encode(e)}};function N(e,t){e!=null&&this.fromString(e,t)}function de(){return new N(null,null)}let ft;const Ap=0xdeadbeefcafe,Jo=(Ap&16777215)===15715070;function Np(e,t,n,s,i,r){for(;--r>=0;){const o=t*this[e++]+n[s]+i;i=Math.floor(o/67108864),n[s++]=o&67108863}return i}function Cp(e,t,n,s,i,r){const o=t&32767,a=t>>15;for(;--r>=0;){let c=this[e]&32767;const u=this[e++]>>15,l=a*c+u*o;c=o*c+((l&32767)<<15)+n[s]+(i&1073741823),i=(c>>>30)+(l>>>15)+a*u+(i>>>30),n[s++]=c&1073741823}return i}function Pp(e,t,n,s,i,r){const o=t&16383,a=t>>14;for(;--r>=0;){let c=this[e]&16383;const u=this[e++]>>14,l=a*c+u*o;c=o*c+((l&16383)<<14)+n[s]+i,i=(c>>28)+(l>>14)+a*u,n[s++]=c&268435455}return i}const Xo=typeof navigator<"u";Xo&&Jo&&navigator.appName==="Microsoft Internet Explorer"?(N.prototype.am=Cp,ft=30):Xo&&Jo&&navigator.appName!=="Netscape"?(N.prototype.am=Np,ft=26):(N.prototype.am=Pp,ft=28);N.prototype.DB=ft;N.prototype.DM=(1<<ft)-1;N.prototype.DV=1<<ft;const wr=52;N.prototype.FV=Math.pow(2,wr);N.prototype.F1=wr-ft;N.prototype.F2=2*ft-wr;const Op="0123456789abcdefghijklmnopqrstuvwxyz",si=[];let fn,Ae;fn=48;for(Ae=0;Ae<=9;++Ae)si[fn++]=Ae;fn=97;for(Ae=10;Ae<36;++Ae)si[fn++]=Ae;fn=65;for(Ae=10;Ae<36;++Ae)si[fn++]=Ae;function Zo(e){return Op.charAt(e)}function xp(e,t){const n=si[e.charCodeAt(t)];return n??-1}function _p(e){for(let t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function Rp(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0}function Ir(e){const t=de();return t.fromInt(e),t}function kp(e,t){let n;if(t===16)n=4;else if(t===8)n=3;else if(t===2)n=1;else if(t===32)n=5;else if(t===4)n=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");this.t=0,this.s=0;let s=e.length,i=!1,r=0;for(;--s>=0;){const o=xp(e,s);if(o<0){e.charAt(s)==="-"&&(i=!0);continue}i=!1,r===0?this[this.t++]=o:r+n>this.DB?(this[this.t-1]|=(o&(1<<this.DB-r)-1)<<r,this[this.t++]=o>>this.DB-r):this[this.t-1]|=o<<r,r+=n,r>=this.DB&&(r-=this.DB)}this.clamp(),i&&N.ZERO.subTo(this,this)}function Mp(){const e=this.s&this.DM;for(;this.t>0&&this[this.t-1]==e;)--this.t}function Dp(e){if(this.s<0)return"-"+this.negate().toString(e);let t;if(e==16)t=4;else if(e===8)t=3;else if(e===2)t=1;else if(e===32)t=5;else if(e===4)t=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");const n=(1<<t)-1;let s,i=!1,r="",o=this.t,a=this.DB-o*this.DB%t;if(o-- >0)for(a<this.DB&&(s=this[o]>>a)>0&&(i=!0,r=Zo(s));o>=0;)a<t?(s=(this[o]&(1<<a)-1)<<t-a,s|=this[--o]>>(a+=this.DB-t)):(s=this[o]>>(a-=t)&n,a<=0&&(a+=this.DB,--o)),s>0&&(i=!0),i&&(r+=Zo(s));return i?r:"0"}function Fp(){const e=de();return N.ZERO.subTo(this,e),e}function Up(){return this.s<0?this.negate():this}function Lp(e){let t=this.s-e.s;if(t!=0)return t;let n=this.t;if(t=n-e.t,t!=0)return this.s<0?-t:t;for(;--n>=0;)if((t=this[n]-e[n])!=0)return t;return 0}function vr(e){let t=1,n;return(n=e>>>16)!==0&&(e=n,t+=16),(n=e>>8)!==0&&(e=n,t+=8),(n=e>>4)!==0&&(e=n,t+=4),(n=e>>2)!==0&&(e=n,t+=2),(n=e>>1)!==0&&(e=n,t+=1),t}function $p(){return this.t<=0?0:this.DB*(this.t-1)+vr(this[this.t-1]^this.s&this.DM)}function Kp(e,t){let n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s}function jp(e,t){for(let n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s}function Bp(e,t){const n=e%this.DB,s=this.DB-n,i=(1<<s)-1,r=Math.floor(e/this.DB);let o=this.s<<n&this.DM,a;for(a=this.t-1;a>=0;--a)t[a+r+1]=this[a]>>s|o,o=(this[a]&i)<<n;for(a=r-1;a>=0;--a)t[a]=0;t[r]=o,t.t=this.t+r+1,t.s=this.s,t.clamp()}function qp(e,t){t.s=this.s;const n=Math.floor(e/this.DB);if(n>=this.t){t.t=0;return}const s=e%this.DB,i=this.DB-s,r=(1<<s)-1;t[0]=this[n]>>s;for(let o=n+1;o<this.t;++o)t[o-n-1]|=(this[o]&r)<<i,t[o-n]=this[o]>>s;s>0&&(t[this.t-n-1]|=(this.s&r)<<i),t.t=this.t-n,t.clamp()}function Vp(e,t){let n=0,s=0;const i=Math.min(e.t,this.t);for(;n<i;)s+=this[n]-e[n],t[n++]=s&this.DM,s>>=this.DB;if(e.t<this.t){for(s-=e.s;n<this.t;)s+=this[n],t[n++]=s&this.DM,s>>=this.DB;s+=this.s}else{for(s+=this.s;n<e.t;)s-=e[n],t[n++]=s&this.DM,s>>=this.DB;s-=e.s}t.s=s<0?-1:0,s<-1?t[n++]=this.DV+s:s>0&&(t[n++]=s),t.t=n,t.clamp()}function Wp(e,t){const n=this.abs(),s=e.abs();let i=n.t;for(t.t=i+s.t;--i>=0;)t[i]=0;for(i=0;i<s.t;++i)t[i+n.t]=n.am(0,s[i],t,i,0,n.t);t.s=0,t.clamp(),this.s!==e.s&&N.ZERO.subTo(t,t)}function zp(e){const t=this.abs();let n=e.t=2*t.t;for(;--n>=0;)e[n]=0;for(n=0;n<t.t-1;++n){const s=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,s,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()}function Hp(e,t,n){const s=e.abs();if(s.t<=0)return;const i=this.abs();if(i.t<s.t){t?.fromInt(0),n!=null&&this.copyTo(n);return}n===null&&(n=de());const r=de(),o=this.s,a=e.s,c=this.DB-vr(s[s.t-1]);c>0?(s.lShiftTo(c,r),i.lShiftTo(c,n)):(s.copyTo(r),i.copyTo(n));const u=r.t,l=r[u-1];if(l===0)return;const d=l*(1<<this.F1)+(u>1?r[u-2]>>this.F2:0),h=this.FV/d,p=(1<<this.F1)/d,f=1<<this.F2;let m=n.t,y=m-u;const g=t===null?de():t;for(r.dlShiftTo(y,g),n.compareTo(g)>=0&&(n[n.t++]=1,n.subTo(g,n)),N.ONE.dlShiftTo(u,g),g.subTo(r,r);r.t<u;)r[r.t++]=0;for(;--y>=0;){let E=n[--m]===l?this.DM:Math.floor(n[m]*h+(n[m-1]+f)*p);if((n[m]+=r.am(0,E,n,y,0,u))<E)for(r.dlShiftTo(y,g),n.subTo(g,n);n[m]<--E;)n.subTo(g,n)}t!==null&&(n.drShiftTo(u,t),o!==a&&N.ZERO.subTo(t,t)),n.t=u,n.clamp(),c>0&&n.rShiftTo(c,n),o<0&&N.ZERO.subTo(n,n)}function Gp(e){const t=de();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(N.ZERO)>0&&e.subTo(t,t),t}function Qp(){if(this.t<1)return 0;const e=this[0];if((e&1)===0)return 0;let t=e&3;return t=t*(2-(e&15)*t)&15,t=t*(2-(e&255)*t)&255,t=t*(2-((e&65535)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function Yp(e){return this.compareTo(e)===0}function Jp(e,t){let n=0,s=0;const i=Math.min(e.t,this.t);for(;n<i;)s+=this[n]+e[n],t[n++]=s&this.DM,s>>=this.DB;if(e.t<this.t){for(s+=e.s;n<this.t;)s+=this[n],t[n++]=s&this.DM,s>>=this.DB;s+=this.s}else{for(s+=this.s;n<e.t;)s+=e[n],t[n++]=s&this.DM,s>>=this.DB;s+=e.s}t.s=s<0?-1:0,s>0?t[n++]=s:s<-1&&(t[n++]=this.DV+s),t.t=n,t.clamp()}function Xp(e){const t=de();return this.addTo(e,t),t}function Zp(e){const t=de();return this.subTo(e,t),t}function ef(e){const t=de();return this.multiplyTo(e,t),t}function tf(e){const t=de();return this.divRemTo(e,t,null),t}function mn(e){this.m=e,this.mp=e.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function nf(e){const t=de();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(N.ZERO)>0&&this.m.subTo(t,t),t}function sf(e){const t=de();return e.copyTo(t),this.reduce(t),t}function rf(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(let t=0;t<this.m.t;++t){let n=e[t]&32767;const s=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(n=t+this.m.t,e[n]+=this.m.am(0,s,e,t,0,this.m.t);e[n]>=e.DV;)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function of(e,t){e.squareTo(t),this.reduce(t)}function af(e,t,n){e.multiplyTo(t,n),this.reduce(n)}mn.prototype.convert=nf;mn.prototype.revert=sf;mn.prototype.reduce=rf;mn.prototype.mulTo=af;mn.prototype.sqrTo=of;function cf(e,t,n){let s=e.bitLength(),i,r=Ir(1);const o=new mn(t);if(s<=0)return r;s<18?i=1:s<48?i=3:s<144?i=4:s<768?i=5:i=6;const a=[];let c=3;const u=i-1,l=(1<<i)-1;if(a[1]=o.convert(this),i>1){const g=de();for(o.sqrTo(a[1],g);c<=l;)a[c]=de(),o.mulTo(g,a[c-2],a[c]),c+=2}let d=e.t-1,h,p=!0,f=de(),m;for(s=vr(e[d])-1;d>=0;){for(s>=u?h=e[d]>>s-u&l:(h=(e[d]&(1<<s+1)-1)<<u-s,d>0&&(h|=e[d-1]>>this.DB+s-u)),c=i;(h&1)===0;)h>>=1,--c;if((s-=c)<0&&(s+=this.DB,--d),p)a[h].copyTo(r),p=!1;else{for(;c>1;)o.sqrTo(r,f),o.sqrTo(f,r),c-=2;c>0?o.sqrTo(r,f):(m=r,r=f,f=m),o.mulTo(f,a[h],r)}for(;d>=0&&(e[d]&1<<s)===0;)o.sqrTo(r,f),m=r,r=f,f=m,--s<0&&(s=this.DB-1,--d)}const y=o.revert(r);return n(null,y),y}N.prototype.copyTo=_p;N.prototype.fromInt=Rp;N.prototype.fromString=kp;N.prototype.clamp=Mp;N.prototype.dlShiftTo=Kp;N.prototype.drShiftTo=jp;N.prototype.lShiftTo=Bp;N.prototype.rShiftTo=qp;N.prototype.subTo=Vp;N.prototype.multiplyTo=Wp;N.prototype.squareTo=zp;N.prototype.divRemTo=Hp;N.prototype.invDigit=Qp;N.prototype.addTo=Jp;N.prototype.toString=Dp;N.prototype.negate=Fp;N.prototype.abs=Up;N.prototype.compareTo=Lp;N.prototype.bitLength=$p;N.prototype.mod=Gp;N.prototype.equals=Yp;N.prototype.add=Xp;N.prototype.subtract=Zp;N.prototype.multiply=ef;N.prototype.divide=tf;N.prototype.modPow=cf;N.ZERO=Ir(0);N.ONE=Ir(1);const uf=async({a:e,g:t,k:n,x:s,B:i,N:r,U:o})=>new Promise((a,c)=>{t.modPow(s,r,(u,l)=>{if(u){c(u);return}i.subtract(n.multiply(l)).modPow(e.add(o.multiply(s)),r,(d,h)=>{if(d){c(d);return}a(h.mod(r))})})}),lf="FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF",qc={},Fi={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();t.length===1&&(t=`0${t}`),qc[e]=t,Fi[t]=e}const nn=e=>{if(e.length%2!==0)throw new Error("Hex encoded strings must have an even number length");const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2){const s=e.slice(n,n+2).toLowerCase();if(s in Fi)t[n/2]=Fi[s];else throw new Error(`Cannot decode unrecognized sequence ${s} as hexadecimal`)}return t},Tr=e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=qc[e[n]];return t},Ui=e=>{const t=new Kn;t.update(e);const n=t.digestSync(),s=Tr(n);return new Array(64-s.length).join("0")+s},vs=e=>Ui(nn(e)),df=/^[89a-f]/i,Qe=e=>{if(!(e instanceof N))throw new Error("Not a BigInteger");const t=e.compareTo(N.ZERO)<0;let n=e.abs().toString(16);if(n=n.length%2!==0?`0${n}`:n,n=df.test(n)?`00${n}`:n,t){const s=n.split("").map(r=>{const o=~parseInt(r,16)&15;return"0123456789ABCDEF".charAt(o)}).join("");n=new N(s,16).add(N.ONE).toString(16),n.toUpperCase().startsWith("FF8")&&(n=n.substring(2))}return n},hf=({A:e,B:t})=>{const n=new N(vs(Qe(e)+Qe(t)),16);if(n.equals(N.ZERO))throw new Error("U cannot be zero.");return n},pf=(e,t,n)=>{const s=new Kn(t);s.update(e);const i=s.digestSync(),r=new Kn(i);return r.update(n),r.digestSync().slice(0,16)},br=e=>{const t=new ei().random(e).toString();return nn(t)},ff=()=>en.convert(br(40));class mf{constructor({userPoolName:t,a:n,g:s,A:i,N:r}){this.encoder=Is,this.userPoolName=t,this.a=n,this.g=s,this.A=i,this.N=r,this.k=new N(vs(`${Qe(r)}${Qe(s)}`),16)}getRandomPassword(){if(!this.randomPassword)throw new R({name:"EmptyBigIntegerRandomPassword",message:"random password is empty"});return this.randomPassword}getSaltToHashDevices(){if(!this.saltToHashDevices)throw new R({name:"EmptyBigIntegersaltToHashDevices",message:"saltToHashDevices is empty"});return this.saltToHashDevices}getVerifierDevices(){if(!this.verifierDevices)throw new R({name:"EmptyBigIntegerVerifierDevices",message:"verifyDevices is empty"});return this.verifierDevices}async generateHashDevice(t,n){this.randomPassword=ff();const s=`${t}${n}:${this.randomPassword}`,i=Ui(s),r=Tr(br(16));return this.saltToHashDevices=Qe(new N(r,16)),new Promise((o,a)=>{this.g.modPow(new N(vs(this.saltToHashDevices+i),16),this.N,(c,u)=>{if(c){a(c);return}this.verifierDevices=Qe(u),o()})})}async getPasswordAuthenticationKey({username:t,password:n,serverBValue:s,salt:i}){if(s.mod(this.N).equals(N.ZERO))throw new Error("B cannot be zero.");const r=hf({A:this.A,B:s}),o=`${this.userPoolName}${t}:${n}`,a=Ui(o),c=new N(vs(Qe(i)+a),16),u=await uf({a:this.a,g:this.g,k:this.k,x:c,B:s,N:this.N,U:r}),l=this.encoder.convert("Caldera Derived Key"),d=this.encoder.convert(""),h=new Uint8Array(l.byteLength+d.byteLength);return h.set(l,0),h.set(d,l.byteLength),pf(nn(Qe(u)),nn(Qe(r)),h)}}const yf=async({a:e,g:t,N:n})=>new Promise((s,i)=>{t.modPow(e,n,(r,o)=>{if(r){i(r);return}if(o.mod(n).equals(N.ZERO)){i(new Error("Illegal parameter. A mod N cannot be 0."));return}s(o)})}),ii=async e=>{const t=new N(lf,16),n=new N("2",16),s=gf(),i=await yf({a:s,g:n,N:t});return new mf({userPoolName:e,a:s,g:n,A:i,N:t})},gf=()=>{const e=Tr(br(128));return new N(e,16)};async function yn({userPoolId:e,userPoolEndpoint:t,newDeviceMetadata:n,accessToken:s}){if(!n)return;const i=e.split("_")[1]||"",r=await ii(i),o=n?.DeviceKey,a=n?.DeviceGroupKey;try{await r.generateHashDevice(a??"",o??"")}catch{return}const c={Salt:en.convert(nn(r.getSaltToHashDevices())),PasswordVerifier:en.convert(nn(r.getVerifierDevices()))},u=r.getRandomPassword();try{return await bp({endpointResolver:oe({endpointOverride:t})})({region:re(e)},{AccessToken:s,DeviceName:await vh(),DeviceKey:n?.DeviceKey,DeviceSecretVerifierConfig:c}),{deviceKey:o,deviceGroupKey:a,randomPassword:u}}catch{return}}async function Ef(e){const t=W.getConfig().Auth?.Cognito;B(t);const{username:n,signInSession:s,signInDetails:i,challengeName:r}=wt.getState();if(r!=="WEB_AUTHN"||!n)throw new R({name:tn.SignInException,message:"Unable to proceed due to invalid sign in state."});const{CREDENTIAL_REQUEST_OPTIONS:o}=e;Sr(!!o,Y.InvalidPasskeyAuthenticationOptions);const a=await Tp(JSON.parse(o)),c=ni({endpointResolver:oe({endpointOverride:t.userPoolEndpoint})}),{ChallengeName:u,ChallengeParameters:l,AuthenticationResult:d,Session:h}=await c({region:re(t.userPoolId),userAgentValue:Ue(Se.ConfirmSignIn)},{ChallengeName:"WEB_AUTHN",ChallengeResponses:{USERNAME:n,CREDENTIAL:JSON.stringify(a)},ClientId:t.userPoolClientId,Session:s});if(pn({signInSession:h,username:n,challengeName:u,signInDetails:i}),d)return await dn({...d,username:n,NewDeviceMetadata:await yn({userPoolId:t.userPoolId,userPoolEndpoint:t.userPoolEndpoint,newDeviceMetadata:d.NewDeviceMetadata,accessToken:d.AccessToken}),signInDetails:i}),wt.dispatch({type:"RESET_STATE"}),await hn(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}};if(u==="WEB_AUTHN")throw new R({name:tn.SignInException,message:"Sequential WEB_AUTHN challenges returned from underlying service cannot be handled."});return{challengeName:u,challengeParameters:l}}const Sf=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wf=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Vc=()=>{const e=new Date,t=wf[e.getUTCDay()],n=Sf[e.getUTCMonth()],s=e.getUTCDate();let i=e.getUTCHours();i<10&&(i=`0${i}`);let r=e.getUTCMinutes();r<10&&(r=`0${r}`);let o=e.getUTCSeconds();o<10&&(o=`0${o}`);const a=e.getUTCFullYear();return`${t} ${n} ${s} ${i}:${r}:${o} UTC ${a}`},Wc=({userPoolName:e,username:t,challengeParameters:n,dateNow:s,hkdf:i})=>{const r=Is.convert(e),o=Is.convert(t),a=If(n.SECRET_BLOCK),c=Is.convert(s),u=new Uint8Array(r.byteLength+o.byteLength+a.byteLength+c.byteLength);u.set(r,0),u.set(o,r.byteLength),u.set(a,r.byteLength+o.byteLength),u.set(c,r.byteLength+o.byteLength+a.byteLength);const l=new Kn(i);l.update(u);const d=l.digestSync();return en.convert(d)},If=e=>{const t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/-/g,"+").replace(/_/g,"/"),s=ir.convert(n),i=new Uint8Array(s.length);for(let r=0;r<s.length;++r)i[r]=s.charCodeAt(r);return i};async function Ar({username:e,config:t,clientMetadata:n,session:s,tokenOrchestrator:i}){const{userPoolId:r,userPoolEndpoint:o}=t,a=t.userPoolClientId,c=await i?.getDeviceMetadata(e);Uc(c);const u=await ii(c.deviceGroupKey),l={USERNAME:e,SRP_A:u.A.toString(16),DEVICE_KEY:c.deviceKey},d={ChallengeName:"DEVICE_SRP_AUTH",ClientId:a,ChallengeResponses:l,ClientMetadata:n,Session:s},h=ni({endpointResolver:oe({endpointOverride:o})}),{ChallengeParameters:p,Session:f}=await h({region:re(r)},d);return vf(e,p,n,f,u,t,i)}async function vf(e,t,n,s,i,{userPoolId:r,userPoolClientId:o,userPoolEndpoint:a},c){const u=await c?.getDeviceMetadata(e);Uc(u);const l=new N(t?.SRP_B,16),d=new N(t?.SALT,16),{deviceKey:h}=u,{deviceGroupKey:p}=u,f=await i.getPasswordAuthenticationKey({username:u.deviceKey,password:u.randomPassword,serverBValue:l,salt:d}),m=Vc(),y={USERNAME:t?.USERNAME??e,PASSWORD_CLAIM_SECRET_BLOCK:t?.SECRET_BLOCK,TIMESTAMP:m,PASSWORD_CLAIM_SIGNATURE:Wc({username:h,userPoolName:p,challengeParameters:t,dateNow:m,hkdf:f}),DEVICE_KEY:h},g=Ce({username:e,userPoolId:r,userPoolClientId:o}),E={ChallengeName:"DEVICE_PASSWORD_VERIFIER",ClientId:o,ChallengeResponses:y,Session:s,ClientMetadata:n,UserContextData:g};return ni({endpointResolver:oe({endpointOverride:a})})({region:re(r)},E)}async function zc(e,t,n,s,i,r,o){const{userPoolId:a,userPoolClientId:c,userPoolEndpoint:u}=r,l=a?.split("_")[1]||"",d=new N(t?.SRP_B,16),h=new N(t?.SALT,16),p=t?.USER_ID_FOR_SRP;if(!p)throw new R({name:"EmptyUserIdForSRPException",message:"USER_ID_FOR_SRP was not found in challengeParameters"});const f=await i.getPasswordAuthenticationKey({username:p,password:e,serverBValue:d,salt:h}),m=Vc(),y={USERNAME:p,PASSWORD_CLAIM_SECRET_BLOCK:t?.SECRET_BLOCK,TIMESTAMP:m,PASSWORD_CLAIM_SIGNATURE:Wc({username:p,userPoolName:l,challengeParameters:t,dateNow:m,hkdf:f})},g=await o.getDeviceMetadata(p);g&&g.deviceKey&&(y.DEVICE_KEY=g.deviceKey);const E=Ce({username:p,userPoolId:a,userPoolClientId:c}),v={ChallengeName:"PASSWORD_VERIFIER",ChallengeResponses:y,ClientMetadata:n,Session:s,ClientId:c,UserContextData:E},I=await ni({endpointResolver:oe({endpointOverride:u})})({region:re(a)},v);return I.ChallengeName==="DEVICE_SRP_AUTH"?Ar({username:p,config:r,clientMetadata:n,session:I.Session,tokenOrchestrator:o}):I}async function ri(e,t,n,s){try{return await e(...t)}catch(i){if(i instanceof R&&i.name==="ResourceNotFoundException"&&i.message.includes("Device does not exist."))return await s.clearDeviceMetadata(n),e(...t);throw i}}function Zn(e){const{dispatch:t}=wt;t({type:"SET_USERNAME",value:e})}async function Hc({username:e,password:t,clientMetadata:n,config:s,tokenOrchestrator:i,authFlow:r,preferredChallenge:o}){const{userPoolId:a,userPoolClientId:c,userPoolEndpoint:u}=s,l=a?.split("_")[1]||"",d=await ii(l),h={USERNAME:e,SRP_A:d.A.toString(16)};r==="USER_AUTH"&&o&&(h.PREFERRED_CHALLENGE=o);const p=Ce({username:e,userPoolId:a,userPoolClientId:c}),f={AuthFlow:r,AuthParameters:h,ClientMetadata:n,ClientId:c,UserContextData:p},y=await ln({endpointResolver:oe({endpointOverride:u})})({region:re(a),userAgentValue:Ue(Se.SignIn)},f),{ChallengeParameters:g,Session:E}=y,v=g?.USERNAME??e;return Zn(v),y.ChallengeName==="PASSWORD_VERIFIER"?ri(zc,[t,g,n,E,d,s,i],v,i):y}const ea="userAttributes.";function Tf(e){return"isSignedIn"in e&&"nextStep"in e}async function bf(e,t,n,s,i){const{userPoolClientId:r,userPoolId:o,userPoolEndpoint:a}=s,c={USERNAME:e,PASSWORD:t},u=await i.getDeviceMetadata(e);u&&u.deviceKey&&(c.DEVICE_KEY=u.deviceKey);const l=Ce({username:e,userPoolId:o,userPoolClientId:r}),d={AuthFlow:"USER_PASSWORD_AUTH",AuthParameters:c,ClientMetadata:n,ClientId:r,UserContextData:l},p=await ln({endpointResolver:oe({endpointOverride:a})})({region:re(o),userAgentValue:Ue(Se.SignIn)},d),f=p.ChallengeParameters?.USERNAME??p.ChallengeParameters?.USER_ID_FOR_SRP??e;return Zn(f),p.ChallengeName==="DEVICE_SRP_AUTH"?Ar({username:f,config:s,clientMetadata:n,session:p.Session,tokenOrchestrator:i}):p}async function Af(e,t,n,s,i){return Hc({username:e,password:t,clientMetadata:n,config:s,tokenOrchestrator:i,authFlow:"USER_SRP_AUTH"})}async function Nf(e,t,n,s){const{userPoolClientId:i,userPoolId:r,userPoolEndpoint:o}=n,a={USERNAME:e},c=await s.getDeviceMetadata(e);c&&c.deviceKey&&(a.DEVICE_KEY=c.deviceKey);const u=Ce({username:e,userPoolId:r,userPoolClientId:i}),l={AuthFlow:"CUSTOM_AUTH",AuthParameters:a,ClientMetadata:t,ClientId:i,UserContextData:u},h=await ln({endpointResolver:oe({endpointOverride:o})})({region:re(r),userAgentValue:Ue(Se.SignIn)},l),p=h.ChallengeParameters?.USERNAME??e;return Zn(p),h.ChallengeName==="DEVICE_SRP_AUTH"?Ar({username:p,config:n,clientMetadata:t,session:h.Session,tokenOrchestrator:s}):h}async function Cf(e,t,n,s,i){B(s);const{userPoolId:r,userPoolClientId:o,userPoolEndpoint:a}=s,c=r?.split("_")[1]||"",u=await ii(c),l={USERNAME:e,SRP_A:u.A.toString(16),CHALLENGE_NAME:"SRP_A"},d=Ce({username:e,userPoolId:r,userPoolClientId:o}),h={AuthFlow:"CUSTOM_AUTH",AuthParameters:l,ClientMetadata:n,ClientId:o,UserContextData:d},p=ln({endpointResolver:oe({endpointOverride:a})}),{ChallengeParameters:f,Session:m}=await p({region:re(r),userAgentValue:Ue(Se.SignIn)},h),y=f?.USERNAME??e;return Zn(y),ri(zc,[t,f,n,m,u,s,i],y,i)}async function gn(e){const{challengeName:t,challengeParameters:n,availableChallenges:s}=e,i=W.getConfig().Auth?.Cognito;switch(B(i),t){case"CUSTOM_CHALLENGE":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_CUSTOM_CHALLENGE",additionalInfo:n}};case"MFA_SETUP":{const{signInSession:r,username:o}=wt.getState(),a=ta(na(n.MFAS_CAN_SETUP))||[],c=_f(a),u=c.includes("TOTP"),l=c.includes("EMAIL");if(u&&l)return{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_MFA_SETUP_SELECTION",allowedMFATypes:c}};if(l)return{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_EMAIL_SETUP"}};if(u){const d=Xh({endpointResolver:oe({endpointOverride:i.userPoolEndpoint})}),{Session:h,SecretCode:p}=await d({region:re(i.userPoolId)},{Session:r});return wt.dispatch({type:"SET_SIGN_IN_SESSION",value:h}),{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_TOTP_SETUP",totpSetupDetails:Pf(p,o)}}}throw new R({name:tn.SignInException,message:`Cannot initiate MFA setup from available types: ${a}`})}case"NEW_PASSWORD_REQUIRED":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_NEW_PASSWORD_REQUIRED",missingAttributes:Of(n.requiredAttributes)}};case"SELECT_MFA_TYPE":return{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_MFA_SELECTION",allowedMFATypes:ta(na(n.MFAS_CAN_CHOOSE))}};case"SMS_OTP":case"SMS_MFA":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_SMS_CODE",codeDeliveryDetails:{deliveryMedium:n.CODE_DELIVERY_DELIVERY_MEDIUM,destination:n.CODE_DELIVERY_DESTINATION}}};case"SOFTWARE_TOKEN_MFA":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_TOTP_CODE"}};case"EMAIL_OTP":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_EMAIL_CODE",codeDeliveryDetails:{deliveryMedium:n.CODE_DELIVERY_DELIVERY_MEDIUM,destination:n.CODE_DELIVERY_DESTINATION}}};case"WEB_AUTHN":{const r=await Ef(n);return Tf(r)?r:gn(r)}case"PASSWORD":case"PASSWORD_SRP":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_PASSWORD"}};case"SELECT_CHALLENGE":return{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_FIRST_FACTOR_SELECTION",availableChallenges:s}}}throw new R({name:tn.SignInException,message:`An error occurred during the sign in process. ${t} challengeName returned by the underlying service was not addressed.`})}function Pf(e,t){return{sharedSecret:e,getSetupUri:(n,s)=>{const i=`otpauth://totp/${n}:${s??t}?secret=${e}&issuer=${n}`;return new ke(i)}}}function es(e){if(e===Fs.PasswordResetRequiredException)return{isSignedIn:!1,nextStep:{signInStep:"RESET_PASSWORD"}};if(e===Fs.UserNotConfirmedException)return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_UP"}}}function Of(e){return e?JSON.parse(e).map(n=>n.includes(ea)?n.replace(ea,""):n):[]}function xf(e){if(e==="SMS_MFA")return"SMS";if(e==="SOFTWARE_TOKEN_MFA")return"TOTP";if(e==="EMAIL_OTP")return"EMAIL"}function ta(e){if(e)return e.map(xf).filter(Boolean)}function na(e){return e?JSON.parse(e):[]}function _f(e){return e.filter(t=>t==="EMAIL"||t==="TOTP")}async function Rf(){let e;try{e=await yr()}catch{}if(e&&e.userId&&e.username)throw new R({name:Oh,message:"There is already a signed in user.",recoverySuggestion:"Call signOut before calling signIn again."})}function ts(e){return wt.getState().username??e}async function kf(e){const t=W.getConfig().Auth?.Cognito;B(t);const{username:n,password:s,options:i}=e,r={loginId:n,authFlowType:"CUSTOM_WITHOUT_SRP"},o=i?.clientMetadata;ne(!!n,D.EmptySignInUsername),ne(!s,D.CustomAuthSignInPassword);try{const{ChallengeName:a,ChallengeParameters:c,AuthenticationResult:u,Session:l}=await ri(Nf,[n,o,t,Ne],n,Ne),d=ts(n);return pn({signInSession:l,username:d,challengeName:a,signInDetails:r}),u?(await dn({username:d,...u,NewDeviceMetadata:await yn({userPoolId:t.userPoolId,userPoolEndpoint:t.userPoolEndpoint,newDeviceMetadata:u.NewDeviceMetadata,accessToken:u.AccessToken}),signInDetails:r}),ze(),await hn(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):gn({challengeName:a,challengeParameters:c})}catch(a){ze(),Me(a);const c=es(a.name);if(c)return c;throw a}}async function Mf(e){const{username:t,password:n,options:s}=e,i={loginId:t,authFlowType:"CUSTOM_WITH_SRP"},r=W.getConfig().Auth?.Cognito;B(r);const o=s?.clientMetadata;ne(!!t,D.EmptySignInUsername),ne(!!n,D.EmptySignInPassword);try{const{ChallengeName:a,ChallengeParameters:c,AuthenticationResult:u,Session:l}=await Cf(t,n,o,r,Ne),d=ts(t);return pn({signInSession:l,username:d,challengeName:a,signInDetails:i}),u?(await dn({username:d,...u,NewDeviceMetadata:await yn({userPoolId:r.userPoolId,userPoolEndpoint:r.userPoolEndpoint,newDeviceMetadata:u.NewDeviceMetadata,accessToken:u.AccessToken}),signInDetails:i}),ze(),await hn(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):gn({challengeName:a,challengeParameters:c})}catch(a){ze(),Me(a);const c=es(a.name);if(c)return c;throw a}}function nt(e=!0){lt.dispatch({type:"RESET"})}async function sa(e){const{username:t,password:n}=e,s=W.getConfig().Auth?.Cognito,i={loginId:t,authFlowType:"USER_SRP_AUTH"};B(s);const r=e.options?.clientMetadata;ne(!!t,D.EmptySignInUsername),ne(!!n,D.EmptySignInPassword);try{const{ChallengeName:o,ChallengeParameters:a,AuthenticationResult:c,Session:u}=await Af(t,n,r,s,Ne),l=ts(t);return pn({signInSession:u,username:l,challengeName:o,signInDetails:i}),c?(await dn({username:l,...c,NewDeviceMetadata:await yn({userPoolId:s.userPoolId,userPoolEndpoint:s.userPoolEndpoint,newDeviceMetadata:c.NewDeviceMetadata,accessToken:c.AccessToken}),signInDetails:i}),ze(),await hn(),nt(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):gn({challengeName:o,challengeParameters:a})}catch(o){ze(),nt(),Me(o);const a=es(o.name);if(a)return a;throw o}}async function Df(e){const{username:t,password:n,options:s}=e,i=W.getConfig().Auth?.Cognito,r={loginId:t,authFlowType:"USER_PASSWORD_AUTH"};B(i);const o=s?.clientMetadata;ne(!!t,D.EmptySignInUsername),ne(!!n,D.EmptySignInPassword);try{const{ChallengeName:a,ChallengeParameters:c,AuthenticationResult:u,Session:l}=await ri(bf,[t,n,o,i,Ne],t,Ne),d=ts(t);return pn({signInSession:l,username:d,challengeName:a,signInDetails:r}),u?(await dn({...u,username:d,NewDeviceMetadata:await yn({userPoolId:i.userPoolId,userPoolEndpoint:i.userPoolEndpoint,newDeviceMetadata:u.NewDeviceMetadata,accessToken:u.AccessToken}),signInDetails:r}),ze(),await hn(),nt(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):gn({challengeName:a,challengeParameters:c})}catch(a){ze(),nt(),Me(a);const c=es(a.name);if(c)return c;throw a}}async function Ff({username:e,clientMetadata:t,config:n,tokenOrchestrator:s,preferredChallenge:i,password:r,session:o}){const{userPoolId:a,userPoolClientId:c,userPoolEndpoint:u}=n,l=Ce({username:e,userPoolId:a,userPoolClientId:c}),d={USERNAME:e};if(i){if(i==="PASSWORD_SRP")return ne(!!r,D.EmptySignInPassword),Hc({username:e,password:r,clientMetadata:t,config:n,tokenOrchestrator:s,authFlow:"USER_AUTH",preferredChallenge:i});i==="PASSWORD"&&(ne(!!r,D.EmptySignInPassword),d.PASSWORD=r),d.PREFERRED_CHALLENGE=i}const h={AuthFlow:"USER_AUTH",AuthParameters:d,ClientMetadata:t,ClientId:c,UserContextData:l};o&&(h.Session=o);const f=await ln({endpointResolver:oe({endpointOverride:u})})({region:re(a),userAgentValue:Ue(Se.SignIn)},h);return Zn(e),f}async function Uf(e){const{username:t,password:n,options:s}=e,i=W.getConfig().Auth?.Cognito,r={loginId:t,authFlowType:"USER_AUTH"};B(i);const o=s?.clientMetadata,a=s?.preferredChallenge;ne(!!t,D.EmptySignInUsername);try{const c={username:t,config:i,tokenOrchestrator:Ne,clientMetadata:o,preferredChallenge:a,password:n},u=lt.getState();u.active&&u.username===t&&(c.session=u.session);const l=await Ff(c),d=ts(t);return pn({signInSession:l.Session,username:d,challengeName:l.ChallengeName,signInDetails:r}),l.AuthenticationResult?(await dn({username:d,...l.AuthenticationResult,NewDeviceMetadata:await yn({userPoolId:i.userPoolId,userPoolEndpoint:i.userPoolEndpoint,newDeviceMetadata:l.AuthenticationResult.NewDeviceMetadata,accessToken:l.AuthenticationResult.AccessToken}),signInDetails:r}),ze(),await hn(),nt(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):gn({challengeName:l.ChallengeName,challengeParameters:l.ChallengeParameters,availableChallenges:"AvailableChallenges"in l?l.AvailableChallenges:void 0})}catch(c){ze(),nt(),Me(c);const u=es(c.name);if(u)return u;throw c}}async function Lf(e){nt(!1);const t=e.options?.authFlowType;switch(await Rf(),t){case"USER_SRP_AUTH":return sa(e);case"USER_PASSWORD_AUTH":return Df(e);case"CUSTOM_WITHOUT_SRP":return kf(e);case"CUSTOM_WITH_SRP":return Mf(e);case"USER_AUTH":return Uf(e);default:return sa(e)}}const $f=3*60*1e3;function Kf(e){const t=ks.listen("auth-internal",async({payload:s})=>{switch(s.event){case"confirmSignUp":s.data?.isSignUpComplete&&(ks.dispatch("auth-internal",{event:"autoSignIn"}),t())}}),n=setTimeout(()=>{t(),clearTimeout(n),nt()},$f)}const jf=()=>async e=>{if(e.statusCode>=300){const t=await Lt(e);if(Me(t),t.name===Di.InvalidParameterException&&/'password'/.test(t.message)&&/Member must not be null/.test(t.message)){const n=D.EmptySignUpPassword,{message:s,recoverySuggestion:i}=Dc[n];throw new R({name:n,message:s,recoverySuggestion:i})}throw new R({name:t.name,message:t.message})}return Yn(e)},Bf=e=>Fe(at,ot("SignUp"),jf(),{...ct,...e});async function qf(e){const{username:t,password:n,options:s}=e,i=W.getConfig().Auth?.Cognito,r=i?.signUpVerificationMethod??"code",{clientMetadata:o,validationData:a,autoSignIn:c}=e.options??{};B(i),ne(!!t,D.EmptySignUpUsername);const u=typeof c!="boolean"?c:void 0;u?.authFlowType;const{userPoolId:l,userPoolClientId:d,userPoolEndpoint:h}=i,p=Bf({endpointResolver:oe({endpointOverride:h})}),f={Username:t,Password:void 0,UserAttributes:s?.userAttributes&&vo(s?.userAttributes),ClientMetadata:o,ValidationData:a&&vo(a),ClientId:d,UserContextData:Ce({username:t,userPoolId:l,userPoolClientId:d})};n&&(f.Password=n);const{UserSub:m,CodeDeliveryDetails:y,UserConfirmed:g,Session:E}=await p({region:re(l),userAgentValue:Ue(Se.SignUp)},f);(u||c===!0)&&(lt.dispatch({type:"START"}),lt.dispatch({type:"SET_USERNAME",value:t}),lt.dispatch({type:"SET_SESSION",value:E}));const v={destination:y?.Destination,deliveryMedium:y?.DeliveryMedium,attributeName:y?.AttributeName},S=!!g,I=lt.getState().active;if(S)return I?{isSignUpComplete:!0,nextStep:{signUpStep:"COMPLETE_AUTO_SIGN_IN"},userId:m}:{isSignUpComplete:!0,nextStep:{signUpStep:"DONE"},userId:m};if(I){if(r==="link")return{isSignUpComplete:!1,nextStep:{signUpStep:"COMPLETE_AUTO_SIGN_IN",codeDeliveryDetails:v},userId:m};Kf()}return{isSignUpComplete:!1,nextStep:{signUpStep:"CONFIRM_SIGN_UP",codeDeliveryDetails:v},userId:m}}const Vf=e=>Fe(at,ot("ForgotPassword"),vt(),{...ct,...e});async function Wf(e){const{username:t}=e;ne(!!t,D.EmptyResetPasswordUsername);const n=W.getConfig().Auth?.Cognito;B(n);const{userPoolClientId:s,userPoolId:i,userPoolEndpoint:r}=n,o=e.options?.clientMetadata,a=Ce({username:t,userPoolId:i,userPoolClientId:s}),l=(await Vf({endpointResolver:oe({endpointOverride:r})})({region:re(i),userAgentValue:Ue(Se.ResetPassword)},{Username:t,ClientMetadata:o,ClientId:s,UserContextData:a})).CodeDeliveryDetails;return{isPasswordReset:!1,nextStep:{resetPasswordStep:"CONFIRM_RESET_PASSWORD_WITH_CODE",codeDeliveryDetails:{deliveryMedium:l?.DeliveryMedium,destination:l?.Destination,attributeName:l?.AttributeName}}}}const zf=e=>Fe(at,ot("ConfirmForgotPassword"),vt(),{...ct,...e});async function Hf(e){const t=W.getConfig().Auth?.Cognito;B(t);const{userPoolClientId:n,userPoolId:s,userPoolEndpoint:i}=t,{username:r,newPassword:o}=e;ne(!!r,D.EmptyConfirmResetPasswordUsername),ne(!!o,D.EmptyConfirmResetPasswordNewPassword);const a=e.confirmationCode;ne(!!a,D.EmptyConfirmResetPasswordConfirmationCode);const c=e.options?.clientMetadata,u=Ce({username:r,userPoolId:s,userPoolClientId:n});await zf({endpointResolver:oe({endpointOverride:i})})({region:re(t.userPoolId),userAgentValue:Ue(Se.ConfirmResetPassword)},{Username:r,ConfirmationCode:a,Password:o,ClientMetadata:c,ClientId:t.userPoolClientId,UserContextData:u})}const Gf=e=>Fe(at,ot("ConfirmSignUp"),vt(),{...ct,...e});async function Qf(e){const{username:t,confirmationCode:n,options:s}=e,i=W.getConfig().Auth?.Cognito;B(i);const{userPoolId:r,userPoolClientId:o,userPoolEndpoint:a}=i,c=s?.clientMetadata;ne(!!t,D.EmptyConfirmSignUpUsername),ne(!!n,D.EmptyConfirmSignUpCode);const u=Ce({username:t,userPoolId:r,userPoolClientId:o}),l=Gf({endpointResolver:oe({endpointOverride:a})}),{Session:d}=await l({region:re(i.userPoolId),userAgentValue:Ue(Se.ConfirmSignUp)},{Username:t,ConfirmationCode:n,ClientMetadata:c,ForceAliasCreation:s?.forceAliasCreation,ClientId:i.userPoolClientId,UserContextData:u});return new Promise((h,p)=>{try{const f={isSignUpComplete:!0,nextStep:{signUpStep:"DONE"}},m=lt.getState();if(!m.active||m.username!==t){h(f),nt();return}lt.dispatch({type:"SET_SESSION",value:d});const y=ks.listen("auth-internal",({payload:g})=>{switch(g.event){case"autoSignIn":h({isSignUpComplete:!0,nextStep:{signUpStep:"COMPLETE_AUTO_SIGN_IN"}}),y()}});ks.dispatch("auth-internal",{event:"confirmSignUp",data:f})}catch(f){p(f)}})}function Yf(e,t){{const n=e?.find(Jf)??e?.find(Xf),s=e?.find(em)??e?.find(Zf);if(n)return n;throw s?Fh:Mh}}const Jf=e=>e.startsWith(String(window.location.origin+(window.location.pathname||"/"))),Xf=e=>e.includes(String(window.location.hostname)),Zf=e=>e.startsWith("http://"),em=e=>e.startsWith("https://"),tm=async e=>{window?.location&&(window.location.href=e.replace("http://","https://"))},nm=async e=>{await e.clearOAuthData(),Ne.clearTokens(),await pc(),ye.dispatch("auth",{event:"signedOut"},"Auth",gt)},sm=async(e,t=!1,n)=>{sc(e);const{loginWith:s,userPoolClientId:i}=e,{domain:r,redirectSignOut:o}=s.oauth,a=Yf(o),c=`https://${r}/logout?${Object.entries({client_id:i,logout_uri:encodeURIComponent(a)}).map(([u,l])=>`${u}=${l}`).join("&")}`;return tm(c)},im=async(e,t,n,s)=>{const{isOAuthSignIn:i}=await t.loadOAuthSignIn(),r=await n.getOAuthMetadata();if(await nm(t),i||r?.oauthSignIn)return sm(e,!1)},rm=e=>Fe(at,ot("RevokeToken"),vt(),{...ct,...e}),om=new j("Auth");async function am(e){const t=W.getConfig().Auth?.Cognito;B(t),await cm(t);let n;try{sc(t),n=!0}catch{n=!1}if(n){const s=new Kc(Xn);s.setAuthConfig(t);const{type:i}=await im(t,s,Ne)??{};if(i==="error")throw new R({name:Uh,message:"An error occurred when attempting to log out from OAuth provider."})}else Ne.clearTokens(),await pc(),ye.dispatch("auth",{event:"signedOut"},"Auth",gt)}async function cm(e){try{const{userPoolEndpoint:t,userPoolId:n,userPoolClientId:s}=e,i=await Ne.getTokenStore().loadTokens();Fc(i),um(i.accessToken)&&await rm({endpointResolver:oe({endpointOverride:t})})({region:re(n),userAgentValue:Ue(Se.SignOut)},{ClientId:s,Token:i.refreshToken})}catch{om.debug("Client signOut error caught but will proceed with token removal")}}const um=e=>!!e?.payload?.origin_jti,lm={identityId:"identityId"},dm=new j("DefaultIdentityIdStore");class Gc{setAuthConfig(t){ws(t.Cognito),this.authConfig=t,this._authKeys=hm("Cognito",t.Cognito.identityPoolId)}constructor(t){this._authKeys={},this._hasGuestIdentityId=!1,this.keyValueStorage=t}async loadIdentityId(){ws(this.authConfig?.Cognito);try{if(this._primaryIdentityId)return{id:this._primaryIdentityId,type:"primary"};{const t=await this.keyValueStorage.getItem(this._authKeys.identityId);return t?(this._hasGuestIdentityId=!0,{id:t,type:"guest"}):null}}catch(t){return dm.log("Error getting stored IdentityId.",t),null}}async storeIdentityId(t){ws(this.authConfig?.Cognito),t.type==="guest"?(this.keyValueStorage.setItem(this._authKeys.identityId,t.id),this._primaryIdentityId=void 0,this._hasGuestIdentityId=!0):(this._primaryIdentityId=t.id,this._hasGuestIdentityId&&(this.keyValueStorage.removeItem(this._authKeys.identityId),this._hasGuestIdentityId=!1))}async clearIdentityId(){this._primaryIdentityId=void 0,await this.keyValueStorage.removeItem(this._authKeys.identityId)}}const hm=(e,t)=>gr(lm)(`com.amplify.${e}`,t),Li=({endpointOverride:e})=>t=>e?{url:new ke(e)}:Ld(t);function Qc(e){const t=Et(e).payload.iss,n={};if(!t)throw new R({name:"InvalidIdTokenException",message:"Invalid Idtoken."});const s=t.replace(/(^\w+:|^)\/\//,"");return n[s]=e,n}async function pm({tokens:e,authConfig:t,identityIdStore:n}){n.setAuthConfig({Cognito:t});const s=await n.loadIdentityId();if(s)return s.id;const i=e?.idToken?Qc(e.idToken.toString()):{},r=await fm(i,t);return n.storeIdentityId({id:r,type:e?"primary":"guest"}),r}async function fm(e,t){const n=t?.identityPoolId,s=Mi(n),i=Dd({endpointResolver:Li({endpointOverride:t.identityPoolEndpoint})});let r;try{r=(await i({region:s},{IdentityPoolId:n,Logins:e})).IdentityId}catch(o){throw Me(o),new R(o)}if(!r)throw new R({name:"GetIdResponseException",message:"Received undefined response from getId operation",recoverySuggestion:"Make sure to pass a valid identityPoolId in the configuration."});return r}const ds=new j("CognitoCredentialsProvider"),ia=50*60*1e3;class Yc{constructor(t){this._nextCredentialsRefresh=0,this._identityIdStore=t}async clearCredentialsAndIdentityId(){ds.debug("Clearing out credentials and identityId"),this._credentialsAndIdentityId=void 0,await this._identityIdStore.clearIdentityId()}async clearCredentials(){ds.debug("Clearing out in-memory credentials"),this._credentialsAndIdentityId=void 0}async getCredentialsAndIdentityId(t){const n=t.authenticated,{tokens:s}=t,{authConfig:i}=t;try{ws(i?.Cognito)}catch{return}if(!n&&!i.Cognito.allowGuestAccess)return;const{forceRefresh:r}=t,o=this.hasTokenChanged(s),a=await pm({tokens:s,authConfig:i.Cognito,identityIdStore:this._identityIdStore});return(r||o)&&this.clearCredentials(),n?(jh(s),this.credsForOIDCTokens(i.Cognito,s,a)):this.getGuestCredentials(a,i.Cognito)}async getGuestCredentials(t,n){if(this._credentialsAndIdentityId&&!this.isPastTTL()&&this._credentialsAndIdentityId.isAuthenticatedCreds===!1)return ds.info("returning stored credentials as they neither past TTL nor expired."),this._credentialsAndIdentityId;this.clearCredentials();const s=Mi(n.identityPoolId),i=yo({endpointResolver:Li({endpointOverride:n.identityPoolEndpoint})});let r;try{r=await i({region:s},{IdentityId:t})}catch(o){throw Me(o),new R(o)}if(r?.Credentials?.AccessKeyId&&r?.Credentials?.SecretKey){this._nextCredentialsRefresh=new Date().getTime()+ia;const o={credentials:{accessKeyId:r.Credentials.AccessKeyId,secretAccessKey:r.Credentials.SecretKey,sessionToken:r.Credentials.SessionToken,expiration:r.Credentials.Expiration},identityId:t};return r.IdentityId&&(o.identityId=r.IdentityId,this._identityIdStore.storeIdentityId({id:r.IdentityId,type:"guest"})),this._credentialsAndIdentityId={...o,isAuthenticatedCreds:!1},o}else throw new R({name:"CredentialsNotFoundException",message:"Cognito did not respond with either Credentials, AccessKeyId or SecretKey."})}async credsForOIDCTokens(t,n,s){if(this._credentialsAndIdentityId&&!this.isPastTTL()&&this._credentialsAndIdentityId.isAuthenticatedCreds===!0)return ds.debug("returning stored credentials as they neither past TTL nor expired."),this._credentialsAndIdentityId;this.clearCredentials();const i=n.idToken?Qc(n.idToken.toString()):{},r=Mi(t.identityPoolId),o=yo({endpointResolver:Li({endpointOverride:t.identityPoolEndpoint})});let a;try{a=await o({region:r},{IdentityId:s,Logins:i})}catch(c){throw Me(c),new R(c)}if(a?.Credentials?.AccessKeyId&&a?.Credentials?.SecretKey){this._nextCredentialsRefresh=new Date().getTime()+ia;const c={credentials:{accessKeyId:a.Credentials.AccessKeyId,secretAccessKey:a.Credentials.SecretKey,sessionToken:a.Credentials.SessionToken,expiration:a.Credentials.Expiration},identityId:s};return a.IdentityId&&(c.identityId=a.IdentityId,this._identityIdStore.storeIdentityId({id:a.IdentityId,type:"primary"})),this._credentialsAndIdentityId={...c,isAuthenticatedCreds:!0,associatedIdToken:n.idToken?.toString()},c}else throw new R({name:"CredentialsException",message:"Cognito did not respond with either Credentials, AccessKeyId or SecretKey."})}isPastTTL(){return this._nextCredentialsRefresh===void 0?!0:this._nextCredentialsRefresh<=Date.now()}hasTokenChanged(t){return!!t&&!!this._credentialsAndIdentityId?.associatedIdToken&&t.idToken?.toString()!==this._credentialsAndIdentityId.associatedIdToken}}const mm=new Yc(new Gc(Xn)),ym={configure(e,t){const n=cc(e),s=new qd({sameSite:"lax"}),i=t?.ssr?s:Xn,r=t?.ssr?new Yc(new Gc(s)):mm;if(!n.Auth){W.configure(n,t);return}if(t?.Auth){W.configure(n,t);return}if(!W.libraryOptions.Auth){Rn.setAuthConfig(n.Auth),Rn.setKeyValueStorage(i),W.configure(n,{...t,Auth:{tokenProvider:Rn,credentialsProvider:r}});return}if(t){const o=W.libraryOptions.Auth;t.ssr!==void 0&&(Rn.setKeyValueStorage(i),o.credentialsProvider=r),W.configure(n,{Auth:o,...t});return}W.configure(n)},getConfig(){return W.getConfig()}},rw=Object.freeze(Object.defineProperty({__proto__:null,Amplify:ym},Symbol.toStringTag,{value:"Module"})),ow=Object.freeze(Object.defineProperty({__proto__:null,AuthError:R,confirmResetPassword:Hf,confirmSignUp:Qf,decodeJWT:Et,fetchAuthSession:Zt,getCurrentUser:yr,resetPassword:Wf,signIn:Lf,signOut:am,signUp:qf},Symbol.toStringTag,{value:"Module"}));function Ts(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ts=function(n){return typeof n}:Ts=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ts(e)}function gm(e){return Ts(e)=="object"&&e!==null}var Jc=typeof Symbol=="function"&&Symbol.toStringTag!=null?Symbol.toStringTag:"@@toStringTag";function $i(e,t){for(var n=/\r\n|[\n\r]/g,s=1,i=t+1,r;(r=n.exec(e.body))&&r.index<t;)s+=1,i=t+1-(r.index+r[0].length);return{line:s,column:i}}function Em(e){return Xc(e.source,$i(e.source,e.start))}function Xc(e,t){var n=e.locationOffset.column-1,s=bs(n)+e.body,i=t.line-1,r=e.locationOffset.line-1,o=t.line+r,a=t.line===1?n:0,c=t.column+a,u="".concat(e.name,":").concat(o,":").concat(c,`
`),l=s.split(/\r\n|[\n\r]/g),d=l[i];if(d.length>120){for(var h=Math.floor(c/80),p=c%80,f=[],m=0;m<d.length;m+=80)f.push(d.slice(m,m+80));return u+ra([["".concat(o),f[0]]].concat(f.slice(1,h+1).map(function(y){return["",y]}),[[" ",bs(p-1)+"^"],["",f[h+1]]]))}return u+ra([["".concat(o-1),l[i-1]],["".concat(o),d],["",bs(c-1)+"^"],["".concat(o+1),l[i+1]]])}function ra(e){var t=e.filter(function(s){s[0];var i=s[1];return i!==void 0}),n=Math.max.apply(Math,t.map(function(s){var i=s[0];return i.length}));return t.map(function(s){var i=s[0],r=s[1];return Sm(n,i)+(r?" | "+r:" |")}).join(`
`)}function bs(e){return Array(e+1).join(" ")}function Sm(e,t){return bs(e-t.length)+t}function As(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?As=function(n){return typeof n}:As=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},As(e)}function oa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function wm(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?oa(Object(n),!0).forEach(function(s){Im(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oa(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Im(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vm(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Tm(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function bm(e,t,n){return t&&Tm(e.prototype,t),e}function Am(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Vn(e,t)}function Nm(e){var t=eu();return function(){var s=Wn(e),i;if(t){var r=Wn(this).constructor;i=Reflect.construct(s,arguments,r)}else i=s.apply(this,arguments);return Zc(this,i)}}function Zc(e,t){return t&&(As(t)==="object"||typeof t=="function")?t:kn(e)}function kn(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ki(e){var t=typeof Map=="function"?new Map:void 0;return Ki=function(s){if(s===null||!Cm(s))return s;if(typeof s!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(s))return t.get(s);t.set(s,i)}function i(){return Ns(s,arguments,Wn(this).constructor)}return i.prototype=Object.create(s.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Vn(i,s)},Ki(e)}function Ns(e,t,n){return eu()?Ns=Reflect.construct:Ns=function(i,r,o){var a=[null];a.push.apply(a,r);var c=Function.bind.apply(i,a),u=new c;return o&&Vn(u,o.prototype),u},Ns.apply(null,arguments)}function eu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Cm(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function Vn(e,t){return Vn=Object.setPrototypeOf||function(s,i){return s.__proto__=i,s},Vn(e,t)}function Wn(e){return Wn=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},Wn(e)}var Un=function(e){Am(n,e);var t=Nm(n);function n(s,i,r,o,a,c,u){var l,d,h,p;vm(this,n),p=t.call(this,s),p.name="GraphQLError",p.originalError=c??void 0,p.nodes=aa(Array.isArray(i)?i:i?[i]:void 0);for(var f=[],m=0,y=(g=p.nodes)!==null&&g!==void 0?g:[];m<y.length;m++){var g,E=y[m],v=E.loc;v!=null&&f.push(v)}f=aa(f),p.source=r??((l=f)===null||l===void 0?void 0:l[0].source),p.positions=o??((d=f)===null||d===void 0?void 0:d.map(function(I){return I.start})),p.locations=o&&r?o.map(function(I){return $i(r,I)}):(h=f)===null||h===void 0?void 0:h.map(function(I){return $i(I.source,I.start)}),p.path=a??void 0;var S=c?.extensions;return u==null&&gm(S)?p.extensions=wm({},S):p.extensions=u??{},Object.defineProperties(kn(p),{message:{enumerable:!0},locations:{enumerable:p.locations!=null},path:{enumerable:p.path!=null},extensions:{enumerable:p.extensions!=null&&Object.keys(p.extensions).length>0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),c!=null&&c.stack?(Object.defineProperty(kn(p),"stack",{value:c.stack,writable:!0,configurable:!0}),Zc(p)):(Error.captureStackTrace?Error.captureStackTrace(kn(p),n):Object.defineProperty(kn(p),"stack",{value:Error().stack,writable:!0,configurable:!0}),p)}return bm(n,[{key:"toString",value:function(){return Pm(this)}},{key:Jc,get:function(){return"Object"}}]),n}(Ki(Error));function aa(e){return e===void 0||e.length===0?void 0:e}function Pm(e){var t=e.message;if(e.nodes)for(var n=0,s=e.nodes;n<s.length;n++){var i=s[n];i.loc&&(t+=`

`+Em(i.loc))}else if(e.source&&e.locations)for(var r=0,o=e.locations;r<o.length;r++){var a=o[r];t+=`

`+Xc(e.source,a)}return t}function Ee(e,t,n){return new Un("Syntax Error: ".concat(n),void 0,e,[t])}var _=Object.freeze({NAME:"Name",DOCUMENT:"Document",OPERATION_DEFINITION:"OperationDefinition",VARIABLE_DEFINITION:"VariableDefinition",SELECTION_SET:"SelectionSet",FIELD:"Field",ARGUMENT:"Argument",FRAGMENT_SPREAD:"FragmentSpread",INLINE_FRAGMENT:"InlineFragment",FRAGMENT_DEFINITION:"FragmentDefinition",VARIABLE:"Variable",INT:"IntValue",FLOAT:"FloatValue",STRING:"StringValue",BOOLEAN:"BooleanValue",NULL:"NullValue",ENUM:"EnumValue",LIST:"ListValue",OBJECT:"ObjectValue",OBJECT_FIELD:"ObjectField",DIRECTIVE:"Directive",NAMED_TYPE:"NamedType",LIST_TYPE:"ListType",NON_NULL_TYPE:"NonNullType",SCHEMA_DEFINITION:"SchemaDefinition",OPERATION_TYPE_DEFINITION:"OperationTypeDefinition",SCALAR_TYPE_DEFINITION:"ScalarTypeDefinition",OBJECT_TYPE_DEFINITION:"ObjectTypeDefinition",FIELD_DEFINITION:"FieldDefinition",INPUT_VALUE_DEFINITION:"InputValueDefinition",INTERFACE_TYPE_DEFINITION:"InterfaceTypeDefinition",UNION_TYPE_DEFINITION:"UnionTypeDefinition",ENUM_TYPE_DEFINITION:"EnumTypeDefinition",ENUM_VALUE_DEFINITION:"EnumValueDefinition",INPUT_OBJECT_TYPE_DEFINITION:"InputObjectTypeDefinition",DIRECTIVE_DEFINITION:"DirectiveDefinition",SCHEMA_EXTENSION:"SchemaExtension",SCALAR_TYPE_EXTENSION:"ScalarTypeExtension",OBJECT_TYPE_EXTENSION:"ObjectTypeExtension",INTERFACE_TYPE_EXTENSION:"InterfaceTypeExtension",UNION_TYPE_EXTENSION:"UnionTypeExtension",ENUM_TYPE_EXTENSION:"EnumTypeExtension",INPUT_OBJECT_TYPE_EXTENSION:"InputObjectTypeExtension"});function Om(e,t){var n=!!e;if(!n)throw new Error("Unexpected invariant triggered.")}var ji=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):void 0;function tu(e){var t=e.prototype.toJSON;typeof t=="function"||Om(0),e.prototype.inspect=t,ji&&(e.prototype[ji]=t)}var nu=function(){function e(n,s,i){this.start=n.start,this.end=s.end,this.startToken=n,this.endToken=s,this.source=i}var t=e.prototype;return t.toJSON=function(){return{start:this.start,end:this.end}},e}();tu(nu);var G=function(){function e(n,s,i,r,o,a,c){this.kind=n,this.start=s,this.end=i,this.line=r,this.column=o,this.value=c,this.prev=a,this.next=null}var t=e.prototype;return t.toJSON=function(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}},e}();tu(G);function ca(e){return e!=null&&typeof e.kind=="string"}var w=Object.freeze({SOF:"<SOF>",EOF:"<EOF>",BANG:"!",DOLLAR:"$",AMP:"&",PAREN_L:"(",PAREN_R:")",SPREAD:"...",COLON:":",EQUALS:"=",AT:"@",BRACKET_L:"[",BRACKET_R:"]",BRACE_L:"{",PIPE:"|",BRACE_R:"}",NAME:"Name",INT:"Int",FLOAT:"Float",STRING:"String",BLOCK_STRING:"BlockString",COMMENT:"Comment"});function Cs(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Cs=function(n){return typeof n}:Cs=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Cs(e)}var xm=10,su=2;function iu(e){return oi(e,[])}function oi(e,t){switch(Cs(e)){case"string":return JSON.stringify(e);case"function":return e.name?"[function ".concat(e.name,"]"):"[function]";case"object":return e===null?"null":_m(e,t);default:return String(e)}}function _m(e,t){if(t.indexOf(e)!==-1)return"[Circular]";var n=[].concat(t,[e]),s=Mm(e);if(s!==void 0){var i=s.call(e);if(i!==e)return typeof i=="string"?i:oi(i,n)}else if(Array.isArray(e))return km(e,n);return Rm(e,n)}function Rm(e,t){var n=Object.keys(e);if(n.length===0)return"{}";if(t.length>su)return"["+Dm(e)+"]";var s=n.map(function(i){var r=oi(e[i],t);return i+": "+r});return"{ "+s.join(", ")+" }"}function km(e,t){if(e.length===0)return"[]";if(t.length>su)return"[Array]";for(var n=Math.min(xm,e.length),s=e.length-n,i=[],r=0;r<n;++r)i.push(oi(e[r],t));return s===1?i.push("... 1 more item"):s>1&&i.push("... ".concat(s," more items")),"["+i.join(", ")+"]"}function Mm(e){var t=e[String(ji)];if(typeof t=="function")return t;if(typeof e.inspect=="function")return e.inspect}function Dm(e){var t=Object.prototype.toString.call(e).replace(/^\[object /,"").replace(/]$/,"");if(t==="Object"&&typeof e.constructor=="function"){var n=e.constructor.name;if(typeof n=="string"&&n!=="")return n}return t}function wi(e,t){var n=!!e;if(!n)throw new Error(t)}const Fm=function(t,n){return t instanceof n};function Um(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function Lm(e,t,n){return t&&Um(e.prototype,t),e}var ru=function(){function e(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"GraphQL request",s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{line:1,column:1};typeof t=="string"||wi(0,"Body must be a string. Received: ".concat(iu(t),".")),this.body=t,this.name=n,this.locationOffset=s,this.locationOffset.line>0||wi(0,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||wi(0,"column in locationOffset is 1-indexed and must be positive.")}return Lm(e,[{key:Jc,get:function(){return"Source"}}]),e}();function $m(e){return Fm(e,ru)}var Km=Object.freeze({QUERY:"QUERY",MUTATION:"MUTATION",SUBSCRIPTION:"SUBSCRIPTION",FIELD:"FIELD",FRAGMENT_DEFINITION:"FRAGMENT_DEFINITION",FRAGMENT_SPREAD:"FRAGMENT_SPREAD",INLINE_FRAGMENT:"INLINE_FRAGMENT",VARIABLE_DEFINITION:"VARIABLE_DEFINITION",SCHEMA:"SCHEMA",SCALAR:"SCALAR",OBJECT:"OBJECT",FIELD_DEFINITION:"FIELD_DEFINITION",ARGUMENT_DEFINITION:"ARGUMENT_DEFINITION",INTERFACE:"INTERFACE",UNION:"UNION",ENUM:"ENUM",ENUM_VALUE:"ENUM_VALUE",INPUT_OBJECT:"INPUT_OBJECT",INPUT_FIELD_DEFINITION:"INPUT_FIELD_DEFINITION"});function jm(e){var t=e.split(/\r\n|[\n\r]/g),n=Bm(e);if(n!==0)for(var s=1;s<t.length;s++)t[s]=t[s].slice(n);for(var i=0;i<t.length&&ua(t[i]);)++i;for(var r=t.length;r>i&&ua(t[r-1]);)--r;return t.slice(i,r).join(`
`)}function ua(e){for(var t=0;t<e.length;++t)if(e[t]!==" "&&e[t]!=="	")return!1;return!0}function Bm(e){for(var t,n=!0,s=!0,i=0,r=null,o=0;o<e.length;++o)switch(e.charCodeAt(o)){case 13:e.charCodeAt(o+1)===10&&++o;case 10:n=!1,s=!0,i=0;break;case 9:case 32:++i;break;default:s&&!n&&(r===null||i<r)&&(r=i),s=!1}return(t=r)!==null&&t!==void 0?t:0}function qm(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=e.indexOf(`
`)===-1,i=e[0]===" "||e[0]==="	",r=e[e.length-1]==='"',o=e[e.length-1]==="\\",a=!s||r||o||n,c="";return a&&!(s&&i)&&(c+=`
`+t),c+=t?e.replace(/\n/g,`
`+t):e,a&&(c+=`
`),'"""'+c.replace(/"""/g,'\\"""')+'"""'}var Vm=function(){function e(n){var s=new G(w.SOF,0,0,0,0,null);this.source=n,this.lastToken=s,this.token=s,this.line=1,this.lineStart=0}var t=e.prototype;return t.advance=function(){this.lastToken=this.token;var s=this.token=this.lookahead();return s},t.lookahead=function(){var s=this.token;if(s.kind!==w.EOF)do{var i;s=(i=s.next)!==null&&i!==void 0?i:s.next=zm(this,s)}while(s.kind===w.COMMENT);return s},e}();function Wm(e){return e===w.BANG||e===w.DOLLAR||e===w.AMP||e===w.PAREN_L||e===w.PAREN_R||e===w.SPREAD||e===w.COLON||e===w.EQUALS||e===w.AT||e===w.BRACKET_L||e===w.BRACKET_R||e===w.BRACE_L||e===w.PIPE||e===w.BRACE_R}function Dt(e){return isNaN(e)?w.EOF:e<127?JSON.stringify(String.fromCharCode(e)):'"\\u'.concat(("00"+e.toString(16).toUpperCase()).slice(-4),'"')}function zm(e,t){for(var n=e.source,s=n.body,i=s.length,r=t.end;r<i;){var o=s.charCodeAt(r),a=e.line,c=1+r-e.lineStart;switch(o){case 65279:case 9:case 32:case 44:++r;continue;case 10:++r,++e.line,e.lineStart=r;continue;case 13:s.charCodeAt(r+1)===10?r+=2:++r,++e.line,e.lineStart=r;continue;case 33:return new G(w.BANG,r,r+1,a,c,t);case 35:return Gm(n,r,a,c,t);case 36:return new G(w.DOLLAR,r,r+1,a,c,t);case 38:return new G(w.AMP,r,r+1,a,c,t);case 40:return new G(w.PAREN_L,r,r+1,a,c,t);case 41:return new G(w.PAREN_R,r,r+1,a,c,t);case 46:if(s.charCodeAt(r+1)===46&&s.charCodeAt(r+2)===46)return new G(w.SPREAD,r,r+3,a,c,t);break;case 58:return new G(w.COLON,r,r+1,a,c,t);case 61:return new G(w.EQUALS,r,r+1,a,c,t);case 64:return new G(w.AT,r,r+1,a,c,t);case 91:return new G(w.BRACKET_L,r,r+1,a,c,t);case 93:return new G(w.BRACKET_R,r,r+1,a,c,t);case 123:return new G(w.BRACE_L,r,r+1,a,c,t);case 124:return new G(w.PIPE,r,r+1,a,c,t);case 125:return new G(w.BRACE_R,r,r+1,a,c,t);case 34:return s.charCodeAt(r+1)===34&&s.charCodeAt(r+2)===34?Jm(n,r,a,c,t,e):Ym(n,r,a,c,t);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return Qm(n,r,o,a,c,t);case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 95:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:return Zm(n,r,a,c,t)}throw Ee(n,r,Hm(o))}var u=e.line,l=1+r-e.lineStart;return new G(w.EOF,i,i,u,l,t)}function Hm(e){return e<32&&e!==9&&e!==10&&e!==13?"Cannot contain the invalid character ".concat(Dt(e),"."):e===39?`Unexpected single quote character ('), did you mean to use a double quote (")?`:"Cannot parse the unexpected character ".concat(Dt(e),".")}function Gm(e,t,n,s,i){var r=e.body,o,a=t;do o=r.charCodeAt(++a);while(!isNaN(o)&&(o>31||o===9));return new G(w.COMMENT,t,a,n,s,i,r.slice(t+1,a))}function Qm(e,t,n,s,i,r){var o=e.body,a=n,c=t,u=!1;if(a===45&&(a=o.charCodeAt(++c)),a===48){if(a=o.charCodeAt(++c),a>=48&&a<=57)throw Ee(e,c,"Invalid number, unexpected digit after 0: ".concat(Dt(a),"."))}else c=Ii(e,c,a),a=o.charCodeAt(c);if(a===46&&(u=!0,a=o.charCodeAt(++c),c=Ii(e,c,a),a=o.charCodeAt(c)),(a===69||a===101)&&(u=!0,a=o.charCodeAt(++c),(a===43||a===45)&&(a=o.charCodeAt(++c)),c=Ii(e,c,a),a=o.charCodeAt(c)),a===46||ey(a))throw Ee(e,c,"Invalid number, expected digit but got: ".concat(Dt(a),"."));return new G(u?w.FLOAT:w.INT,t,c,s,i,r,o.slice(t,c))}function Ii(e,t,n){var s=e.body,i=t,r=n;if(r>=48&&r<=57){do r=s.charCodeAt(++i);while(r>=48&&r<=57);return i}throw Ee(e,i,"Invalid number, expected digit but got: ".concat(Dt(r),"."))}function Ym(e,t,n,s,i){for(var r=e.body,o=t+1,a=o,c=0,u="";o<r.length&&!isNaN(c=r.charCodeAt(o))&&c!==10&&c!==13;){if(c===34)return u+=r.slice(a,o),new G(w.STRING,t,o+1,n,s,i,u);if(c<32&&c!==9)throw Ee(e,o,"Invalid character within String: ".concat(Dt(c),"."));if(++o,c===92){switch(u+=r.slice(a,o-1),c=r.charCodeAt(o),c){case 34:u+='"';break;case 47:u+="/";break;case 92:u+="\\";break;case 98:u+="\b";break;case 102:u+="\f";break;case 110:u+=`
`;break;case 114:u+="\r";break;case 116:u+="	";break;case 117:{var l=Xm(r.charCodeAt(o+1),r.charCodeAt(o+2),r.charCodeAt(o+3),r.charCodeAt(o+4));if(l<0){var d=r.slice(o+1,o+5);throw Ee(e,o,"Invalid character escape sequence: \\u".concat(d,"."))}u+=String.fromCharCode(l),o+=4;break}default:throw Ee(e,o,"Invalid character escape sequence: \\".concat(String.fromCharCode(c),"."))}++o,a=o}}throw Ee(e,o,"Unterminated string.")}function Jm(e,t,n,s,i,r){for(var o=e.body,a=t+3,c=a,u=0,l="";a<o.length&&!isNaN(u=o.charCodeAt(a));){if(u===34&&o.charCodeAt(a+1)===34&&o.charCodeAt(a+2)===34)return l+=o.slice(c,a),new G(w.BLOCK_STRING,t,a+3,n,s,i,jm(l));if(u<32&&u!==9&&u!==10&&u!==13)throw Ee(e,a,"Invalid character within String: ".concat(Dt(u),"."));u===10?(++a,++r.line,r.lineStart=a):u===13?(o.charCodeAt(a+1)===10?a+=2:++a,++r.line,r.lineStart=a):u===92&&o.charCodeAt(a+1)===34&&o.charCodeAt(a+2)===34&&o.charCodeAt(a+3)===34?(l+=o.slice(c,a)+'"""',a+=4,c=a):++a}throw Ee(e,a,"Unterminated string.")}function Xm(e,t,n,s){return hs(e)<<12|hs(t)<<8|hs(n)<<4|hs(s)}function hs(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:-1}function Zm(e,t,n,s,i){for(var r=e.body,o=r.length,a=t+1,c=0;a!==o&&!isNaN(c=r.charCodeAt(a))&&(c===95||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122);)++a;return new G(w.NAME,t,a,n,s,i,r.slice(t,a))}function ey(e){return e===95||e>=65&&e<=90||e>=97&&e<=122}function vi(e,t){var n=new ty(e,t);return n.parseDocument()}var ty=function(){function e(n,s){var i=$m(n)?n:new ru(n);this._lexer=new Vm(i),this._options=s}var t=e.prototype;return t.parseName=function(){var s=this.expectToken(w.NAME);return{kind:_.NAME,value:s.value,loc:this.loc(s)}},t.parseDocument=function(){var s=this._lexer.token;return{kind:_.DOCUMENT,definitions:this.many(w.SOF,this.parseDefinition,w.EOF),loc:this.loc(s)}},t.parseDefinition=function(){if(this.peek(w.NAME))switch(this._lexer.token.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"schema":case"scalar":case"type":case"interface":case"union":case"enum":case"input":case"directive":return this.parseTypeSystemDefinition();case"extend":return this.parseTypeSystemExtension()}else{if(this.peek(w.BRACE_L))return this.parseOperationDefinition();if(this.peekDescription())return this.parseTypeSystemDefinition()}throw this.unexpected()},t.parseOperationDefinition=function(){var s=this._lexer.token;if(this.peek(w.BRACE_L))return{kind:_.OPERATION_DEFINITION,operation:"query",name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet(),loc:this.loc(s)};var i=this.parseOperationType(),r;return this.peek(w.NAME)&&(r=this.parseName()),{kind:_.OPERATION_DEFINITION,operation:i,name:r,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(s)}},t.parseOperationType=function(){var s=this.expectToken(w.NAME);switch(s.value){case"query":return"query";case"mutation":return"mutation";case"subscription":return"subscription"}throw this.unexpected(s)},t.parseVariableDefinitions=function(){return this.optionalMany(w.PAREN_L,this.parseVariableDefinition,w.PAREN_R)},t.parseVariableDefinition=function(){var s=this._lexer.token;return{kind:_.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(w.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(w.EQUALS)?this.parseValueLiteral(!0):void 0,directives:this.parseDirectives(!0),loc:this.loc(s)}},t.parseVariable=function(){var s=this._lexer.token;return this.expectToken(w.DOLLAR),{kind:_.VARIABLE,name:this.parseName(),loc:this.loc(s)}},t.parseSelectionSet=function(){var s=this._lexer.token;return{kind:_.SELECTION_SET,selections:this.many(w.BRACE_L,this.parseSelection,w.BRACE_R),loc:this.loc(s)}},t.parseSelection=function(){return this.peek(w.SPREAD)?this.parseFragment():this.parseField()},t.parseField=function(){var s=this._lexer.token,i=this.parseName(),r,o;return this.expectOptionalToken(w.COLON)?(r=i,o=this.parseName()):o=i,{kind:_.FIELD,alias:r,name:o,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(w.BRACE_L)?this.parseSelectionSet():void 0,loc:this.loc(s)}},t.parseArguments=function(s){var i=s?this.parseConstArgument:this.parseArgument;return this.optionalMany(w.PAREN_L,i,w.PAREN_R)},t.parseArgument=function(){var s=this._lexer.token,i=this.parseName();return this.expectToken(w.COLON),{kind:_.ARGUMENT,name:i,value:this.parseValueLiteral(!1),loc:this.loc(s)}},t.parseConstArgument=function(){var s=this._lexer.token;return{kind:_.ARGUMENT,name:this.parseName(),value:(this.expectToken(w.COLON),this.parseValueLiteral(!0)),loc:this.loc(s)}},t.parseFragment=function(){var s=this._lexer.token;this.expectToken(w.SPREAD);var i=this.expectOptionalKeyword("on");return!i&&this.peek(w.NAME)?{kind:_.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1),loc:this.loc(s)}:{kind:_.INLINE_FRAGMENT,typeCondition:i?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(s)}},t.parseFragmentDefinition=function(){var s,i=this._lexer.token;return this.expectKeyword("fragment"),((s=this._options)===null||s===void 0?void 0:s.experimentalFragmentVariables)===!0?{kind:_.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(i)}:{kind:_.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(i)}},t.parseFragmentName=function(){if(this._lexer.token.value==="on")throw this.unexpected();return this.parseName()},t.parseValueLiteral=function(s){var i=this._lexer.token;switch(i.kind){case w.BRACKET_L:return this.parseList(s);case w.BRACE_L:return this.parseObject(s);case w.INT:return this._lexer.advance(),{kind:_.INT,value:i.value,loc:this.loc(i)};case w.FLOAT:return this._lexer.advance(),{kind:_.FLOAT,value:i.value,loc:this.loc(i)};case w.STRING:case w.BLOCK_STRING:return this.parseStringLiteral();case w.NAME:switch(this._lexer.advance(),i.value){case"true":return{kind:_.BOOLEAN,value:!0,loc:this.loc(i)};case"false":return{kind:_.BOOLEAN,value:!1,loc:this.loc(i)};case"null":return{kind:_.NULL,loc:this.loc(i)};default:return{kind:_.ENUM,value:i.value,loc:this.loc(i)}}case w.DOLLAR:if(!s)return this.parseVariable();break}throw this.unexpected()},t.parseStringLiteral=function(){var s=this._lexer.token;return this._lexer.advance(),{kind:_.STRING,value:s.value,block:s.kind===w.BLOCK_STRING,loc:this.loc(s)}},t.parseList=function(s){var i=this,r=this._lexer.token,o=function(){return i.parseValueLiteral(s)};return{kind:_.LIST,values:this.any(w.BRACKET_L,o,w.BRACKET_R),loc:this.loc(r)}},t.parseObject=function(s){var i=this,r=this._lexer.token,o=function(){return i.parseObjectField(s)};return{kind:_.OBJECT,fields:this.any(w.BRACE_L,o,w.BRACE_R),loc:this.loc(r)}},t.parseObjectField=function(s){var i=this._lexer.token,r=this.parseName();return this.expectToken(w.COLON),{kind:_.OBJECT_FIELD,name:r,value:this.parseValueLiteral(s),loc:this.loc(i)}},t.parseDirectives=function(s){for(var i=[];this.peek(w.AT);)i.push(this.parseDirective(s));return i},t.parseDirective=function(s){var i=this._lexer.token;return this.expectToken(w.AT),{kind:_.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(s),loc:this.loc(i)}},t.parseTypeReference=function(){var s=this._lexer.token,i;return this.expectOptionalToken(w.BRACKET_L)?(i=this.parseTypeReference(),this.expectToken(w.BRACKET_R),i={kind:_.LIST_TYPE,type:i,loc:this.loc(s)}):i=this.parseNamedType(),this.expectOptionalToken(w.BANG)?{kind:_.NON_NULL_TYPE,type:i,loc:this.loc(s)}:i},t.parseNamedType=function(){var s=this._lexer.token;return{kind:_.NAMED_TYPE,name:this.parseName(),loc:this.loc(s)}},t.parseTypeSystemDefinition=function(){var s=this.peekDescription()?this._lexer.lookahead():this._lexer.token;if(s.kind===w.NAME)switch(s.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}throw this.unexpected(s)},t.peekDescription=function(){return this.peek(w.STRING)||this.peek(w.BLOCK_STRING)},t.parseDescription=function(){if(this.peekDescription())return this.parseStringLiteral()},t.parseSchemaDefinition=function(){var s=this._lexer.token,i=this.parseDescription();this.expectKeyword("schema");var r=this.parseDirectives(!0),o=this.many(w.BRACE_L,this.parseOperationTypeDefinition,w.BRACE_R);return{kind:_.SCHEMA_DEFINITION,description:i,directives:r,operationTypes:o,loc:this.loc(s)}},t.parseOperationTypeDefinition=function(){var s=this._lexer.token,i=this.parseOperationType();this.expectToken(w.COLON);var r=this.parseNamedType();return{kind:_.OPERATION_TYPE_DEFINITION,operation:i,type:r,loc:this.loc(s)}},t.parseScalarTypeDefinition=function(){var s=this._lexer.token,i=this.parseDescription();this.expectKeyword("scalar");var r=this.parseName(),o=this.parseDirectives(!0);return{kind:_.SCALAR_TYPE_DEFINITION,description:i,name:r,directives:o,loc:this.loc(s)}},t.parseObjectTypeDefinition=function(){var s=this._lexer.token,i=this.parseDescription();this.expectKeyword("type");var r=this.parseName(),o=this.parseImplementsInterfaces(),a=this.parseDirectives(!0),c=this.parseFieldsDefinition();return{kind:_.OBJECT_TYPE_DEFINITION,description:i,name:r,interfaces:o,directives:a,fields:c,loc:this.loc(s)}},t.parseImplementsInterfaces=function(){var s;if(!this.expectOptionalKeyword("implements"))return[];if(((s=this._options)===null||s===void 0?void 0:s.allowLegacySDLImplementsInterfaces)===!0){var i=[];this.expectOptionalToken(w.AMP);do i.push(this.parseNamedType());while(this.expectOptionalToken(w.AMP)||this.peek(w.NAME));return i}return this.delimitedMany(w.AMP,this.parseNamedType)},t.parseFieldsDefinition=function(){var s;return((s=this._options)===null||s===void 0?void 0:s.allowLegacySDLEmptyFields)===!0&&this.peek(w.BRACE_L)&&this._lexer.lookahead().kind===w.BRACE_R?(this._lexer.advance(),this._lexer.advance(),[]):this.optionalMany(w.BRACE_L,this.parseFieldDefinition,w.BRACE_R)},t.parseFieldDefinition=function(){var s=this._lexer.token,i=this.parseDescription(),r=this.parseName(),o=this.parseArgumentDefs();this.expectToken(w.COLON);var a=this.parseTypeReference(),c=this.parseDirectives(!0);return{kind:_.FIELD_DEFINITION,description:i,name:r,arguments:o,type:a,directives:c,loc:this.loc(s)}},t.parseArgumentDefs=function(){return this.optionalMany(w.PAREN_L,this.parseInputValueDef,w.PAREN_R)},t.parseInputValueDef=function(){var s=this._lexer.token,i=this.parseDescription(),r=this.parseName();this.expectToken(w.COLON);var o=this.parseTypeReference(),a;this.expectOptionalToken(w.EQUALS)&&(a=this.parseValueLiteral(!0));var c=this.parseDirectives(!0);return{kind:_.INPUT_VALUE_DEFINITION,description:i,name:r,type:o,defaultValue:a,directives:c,loc:this.loc(s)}},t.parseInterfaceTypeDefinition=function(){var s=this._lexer.token,i=this.parseDescription();this.expectKeyword("interface");var r=this.parseName(),o=this.parseImplementsInterfaces(),a=this.parseDirectives(!0),c=this.parseFieldsDefinition();return{kind:_.INTERFACE_TYPE_DEFINITION,description:i,name:r,interfaces:o,directives:a,fields:c,loc:this.loc(s)}},t.parseUnionTypeDefinition=function(){var s=this._lexer.token,i=this.parseDescription();this.expectKeyword("union");var r=this.parseName(),o=this.parseDirectives(!0),a=this.parseUnionMemberTypes();return{kind:_.UNION_TYPE_DEFINITION,description:i,name:r,directives:o,types:a,loc:this.loc(s)}},t.parseUnionMemberTypes=function(){return this.expectOptionalToken(w.EQUALS)?this.delimitedMany(w.PIPE,this.parseNamedType):[]},t.parseEnumTypeDefinition=function(){var s=this._lexer.token,i=this.parseDescription();this.expectKeyword("enum");var r=this.parseName(),o=this.parseDirectives(!0),a=this.parseEnumValuesDefinition();return{kind:_.ENUM_TYPE_DEFINITION,description:i,name:r,directives:o,values:a,loc:this.loc(s)}},t.parseEnumValuesDefinition=function(){return this.optionalMany(w.BRACE_L,this.parseEnumValueDefinition,w.BRACE_R)},t.parseEnumValueDefinition=function(){var s=this._lexer.token,i=this.parseDescription(),r=this.parseName(),o=this.parseDirectives(!0);return{kind:_.ENUM_VALUE_DEFINITION,description:i,name:r,directives:o,loc:this.loc(s)}},t.parseInputObjectTypeDefinition=function(){var s=this._lexer.token,i=this.parseDescription();this.expectKeyword("input");var r=this.parseName(),o=this.parseDirectives(!0),a=this.parseInputFieldsDefinition();return{kind:_.INPUT_OBJECT_TYPE_DEFINITION,description:i,name:r,directives:o,fields:a,loc:this.loc(s)}},t.parseInputFieldsDefinition=function(){return this.optionalMany(w.BRACE_L,this.parseInputValueDef,w.BRACE_R)},t.parseTypeSystemExtension=function(){var s=this._lexer.lookahead();if(s.kind===w.NAME)switch(s.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(s)},t.parseSchemaExtension=function(){var s=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");var i=this.parseDirectives(!0),r=this.optionalMany(w.BRACE_L,this.parseOperationTypeDefinition,w.BRACE_R);if(i.length===0&&r.length===0)throw this.unexpected();return{kind:_.SCHEMA_EXTENSION,directives:i,operationTypes:r,loc:this.loc(s)}},t.parseScalarTypeExtension=function(){var s=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");var i=this.parseName(),r=this.parseDirectives(!0);if(r.length===0)throw this.unexpected();return{kind:_.SCALAR_TYPE_EXTENSION,name:i,directives:r,loc:this.loc(s)}},t.parseObjectTypeExtension=function(){var s=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");var i=this.parseName(),r=this.parseImplementsInterfaces(),o=this.parseDirectives(!0),a=this.parseFieldsDefinition();if(r.length===0&&o.length===0&&a.length===0)throw this.unexpected();return{kind:_.OBJECT_TYPE_EXTENSION,name:i,interfaces:r,directives:o,fields:a,loc:this.loc(s)}},t.parseInterfaceTypeExtension=function(){var s=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");var i=this.parseName(),r=this.parseImplementsInterfaces(),o=this.parseDirectives(!0),a=this.parseFieldsDefinition();if(r.length===0&&o.length===0&&a.length===0)throw this.unexpected();return{kind:_.INTERFACE_TYPE_EXTENSION,name:i,interfaces:r,directives:o,fields:a,loc:this.loc(s)}},t.parseUnionTypeExtension=function(){var s=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");var i=this.parseName(),r=this.parseDirectives(!0),o=this.parseUnionMemberTypes();if(r.length===0&&o.length===0)throw this.unexpected();return{kind:_.UNION_TYPE_EXTENSION,name:i,directives:r,types:o,loc:this.loc(s)}},t.parseEnumTypeExtension=function(){var s=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");var i=this.parseName(),r=this.parseDirectives(!0),o=this.parseEnumValuesDefinition();if(r.length===0&&o.length===0)throw this.unexpected();return{kind:_.ENUM_TYPE_EXTENSION,name:i,directives:r,values:o,loc:this.loc(s)}},t.parseInputObjectTypeExtension=function(){var s=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");var i=this.parseName(),r=this.parseDirectives(!0),o=this.parseInputFieldsDefinition();if(r.length===0&&o.length===0)throw this.unexpected();return{kind:_.INPUT_OBJECT_TYPE_EXTENSION,name:i,directives:r,fields:o,loc:this.loc(s)}},t.parseDirectiveDefinition=function(){var s=this._lexer.token,i=this.parseDescription();this.expectKeyword("directive"),this.expectToken(w.AT);var r=this.parseName(),o=this.parseArgumentDefs(),a=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");var c=this.parseDirectiveLocations();return{kind:_.DIRECTIVE_DEFINITION,description:i,name:r,arguments:o,repeatable:a,locations:c,loc:this.loc(s)}},t.parseDirectiveLocations=function(){return this.delimitedMany(w.PIPE,this.parseDirectiveLocation)},t.parseDirectiveLocation=function(){var s=this._lexer.token,i=this.parseName();if(Km[i.value]!==void 0)return i;throw this.unexpected(s)},t.loc=function(s){var i;if(((i=this._options)===null||i===void 0?void 0:i.noLocation)!==!0)return new nu(s,this._lexer.lastToken,this._lexer.source)},t.peek=function(s){return this._lexer.token.kind===s},t.expectToken=function(s){var i=this._lexer.token;if(i.kind===s)return this._lexer.advance(),i;throw Ee(this._lexer.source,i.start,"Expected ".concat(ou(s),", found ").concat(Ti(i),"."))},t.expectOptionalToken=function(s){var i=this._lexer.token;if(i.kind===s)return this._lexer.advance(),i},t.expectKeyword=function(s){var i=this._lexer.token;if(i.kind===w.NAME&&i.value===s)this._lexer.advance();else throw Ee(this._lexer.source,i.start,'Expected "'.concat(s,'", found ').concat(Ti(i),"."))},t.expectOptionalKeyword=function(s){var i=this._lexer.token;return i.kind===w.NAME&&i.value===s?(this._lexer.advance(),!0):!1},t.unexpected=function(s){var i=s??this._lexer.token;return Ee(this._lexer.source,i.start,"Unexpected ".concat(Ti(i),"."))},t.any=function(s,i,r){this.expectToken(s);for(var o=[];!this.expectOptionalToken(r);)o.push(i.call(this));return o},t.optionalMany=function(s,i,r){if(this.expectOptionalToken(s)){var o=[];do o.push(i.call(this));while(!this.expectOptionalToken(r));return o}return[]},t.many=function(s,i,r){this.expectToken(s);var o=[];do o.push(i.call(this));while(!this.expectOptionalToken(r));return o},t.delimitedMany=function(s,i){this.expectOptionalToken(s);var r=[];do r.push(i.call(this));while(this.expectOptionalToken(s));return r},e}();function Ti(e){var t=e.value;return ou(e.kind)+(t!=null?' "'.concat(t,'"'):"")}function ou(e){return Wm(e)?'"'.concat(e,'"'):e}var ny={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},sy=Object.freeze({});function iy(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ny,s=void 0,i=Array.isArray(e),r=[e],o=-1,a=[],c=void 0,u=void 0,l=void 0,d=[],h=[],p=e;do{o++;var f=o===r.length,m=f&&a.length!==0;if(f){if(u=h.length===0?void 0:d[d.length-1],c=l,l=h.pop(),m){if(i)c=c.slice();else{for(var y={},g=0,E=Object.keys(c);g<E.length;g++){var v=E[g];y[v]=c[v]}c=y}for(var S=0,I=0;I<a.length;I++){var T=a[I][0],O=a[I][1];i&&(T-=S),i&&O===null?(c.splice(T,1),S++):c[T]=O}}o=s.index,r=s.keys,a=s.edits,i=s.inArray,s=s.prev}else{if(u=l?i?o:r[o]:void 0,c=l?l[u]:p,c==null)continue;l&&d.push(u)}var b=void 0;if(!Array.isArray(c)){if(!ca(c))throw new Error("Invalid AST Node: ".concat(iu(c),"."));var x=ry(t,c.kind,f);if(x){if(b=x.call(t,c,u,l,d,h),b===sy)break;if(b===!1){if(!f){d.pop();continue}}else if(b!==void 0&&(a.push([u,b]),!f))if(ca(b))c=b;else{d.pop();continue}}}if(b===void 0&&m&&a.push([u,c]),f)d.pop();else{var U;s={inArray:i,index:o,keys:r,edits:a,prev:s},i=Array.isArray(c),r=i?c:(U=n[c.kind])!==null&&U!==void 0?U:[],o=-1,a=[],l&&h.push(l),l=c}}while(s!==void 0);return a.length!==0&&(p=a[a.length-1][1]),p}function ry(e,t,n){var s=e[t];if(s){if(!n&&typeof s=="function")return s;var i=n?s.leave:s.enter;if(typeof i=="function")return i}else{var r=n?e.leave:e.enter;if(r){if(typeof r=="function")return r;var o=r[t];if(typeof o=="function")return o}}}function An(e){return iy(e,{leave:ay})}var oy=80,ay={Name:function(t){return t.value},Variable:function(t){return"$"+t.name},Document:function(t){return C(t.definitions,`

`)+`
`},OperationDefinition:function(t){var n=t.operation,s=t.name,i=z("(",C(t.variableDefinitions,", "),")"),r=C(t.directives," "),o=t.selectionSet;return!s&&!r&&!i&&n==="query"?o:C([n,C([s,i]),r,o]," ")},VariableDefinition:function(t){var n=t.variable,s=t.type,i=t.defaultValue,r=t.directives;return n+": "+s+z(" = ",i)+z(" ",C(r," "))},SelectionSet:function(t){var n=t.selections;return Oe(n)},Field:function(t){var n=t.alias,s=t.name,i=t.arguments,r=t.directives,o=t.selectionSet,a=z("",n,": ")+s,c=a+z("(",C(i,", "),")");return c.length>oy&&(c=a+z(`(
`,Ps(C(i,`
`)),`
)`)),C([c,C(r," "),o]," ")},Argument:function(t){var n=t.name,s=t.value;return n+": "+s},FragmentSpread:function(t){var n=t.name,s=t.directives;return"..."+n+z(" ",C(s," "))},InlineFragment:function(t){var n=t.typeCondition,s=t.directives,i=t.selectionSet;return C(["...",z("on ",n),C(s," "),i]," ")},FragmentDefinition:function(t){var n=t.name,s=t.typeCondition,i=t.variableDefinitions,r=t.directives,o=t.selectionSet;return"fragment ".concat(n).concat(z("(",C(i,", "),")")," ")+"on ".concat(s," ").concat(z("",C(r," ")," "))+o},IntValue:function(t){var n=t.value;return n},FloatValue:function(t){var n=t.value;return n},StringValue:function(t,n){var s=t.value,i=t.block;return i?qm(s,n==="description"?"":"  "):JSON.stringify(s)},BooleanValue:function(t){var n=t.value;return n?"true":"false"},NullValue:function(){return"null"},EnumValue:function(t){var n=t.value;return n},ListValue:function(t){var n=t.values;return"["+C(n,", ")+"]"},ObjectValue:function(t){var n=t.fields;return"{"+C(n,", ")+"}"},ObjectField:function(t){var n=t.name,s=t.value;return n+": "+s},Directive:function(t){var n=t.name,s=t.arguments;return"@"+n+z("(",C(s,", "),")")},NamedType:function(t){var n=t.name;return n},ListType:function(t){var n=t.type;return"["+n+"]"},NonNullType:function(t){var n=t.type;return n+"!"},SchemaDefinition:Pe(function(e){var t=e.directives,n=e.operationTypes;return C(["schema",C(t," "),Oe(n)]," ")}),OperationTypeDefinition:function(t){var n=t.operation,s=t.type;return n+": "+s},ScalarTypeDefinition:Pe(function(e){var t=e.name,n=e.directives;return C(["scalar",t,C(n," ")]," ")}),ObjectTypeDefinition:Pe(function(e){var t=e.name,n=e.interfaces,s=e.directives,i=e.fields;return C(["type",t,z("implements ",C(n," & ")),C(s," "),Oe(i)]," ")}),FieldDefinition:Pe(function(e){var t=e.name,n=e.arguments,s=e.type,i=e.directives;return t+(la(n)?z(`(
`,Ps(C(n,`
`)),`
)`):z("(",C(n,", "),")"))+": "+s+z(" ",C(i," "))}),InputValueDefinition:Pe(function(e){var t=e.name,n=e.type,s=e.defaultValue,i=e.directives;return C([t+": "+n,z("= ",s),C(i," ")]," ")}),InterfaceTypeDefinition:Pe(function(e){var t=e.name,n=e.interfaces,s=e.directives,i=e.fields;return C(["interface",t,z("implements ",C(n," & ")),C(s," "),Oe(i)]," ")}),UnionTypeDefinition:Pe(function(e){var t=e.name,n=e.directives,s=e.types;return C(["union",t,C(n," "),s&&s.length!==0?"= "+C(s," | "):""]," ")}),EnumTypeDefinition:Pe(function(e){var t=e.name,n=e.directives,s=e.values;return C(["enum",t,C(n," "),Oe(s)]," ")}),EnumValueDefinition:Pe(function(e){var t=e.name,n=e.directives;return C([t,C(n," ")]," ")}),InputObjectTypeDefinition:Pe(function(e){var t=e.name,n=e.directives,s=e.fields;return C(["input",t,C(n," "),Oe(s)]," ")}),DirectiveDefinition:Pe(function(e){var t=e.name,n=e.arguments,s=e.repeatable,i=e.locations;return"directive @"+t+(la(n)?z(`(
`,Ps(C(n,`
`)),`
)`):z("(",C(n,", "),")"))+(s?" repeatable":"")+" on "+C(i," | ")}),SchemaExtension:function(t){var n=t.directives,s=t.operationTypes;return C(["extend schema",C(n," "),Oe(s)]," ")},ScalarTypeExtension:function(t){var n=t.name,s=t.directives;return C(["extend scalar",n,C(s," ")]," ")},ObjectTypeExtension:function(t){var n=t.name,s=t.interfaces,i=t.directives,r=t.fields;return C(["extend type",n,z("implements ",C(s," & ")),C(i," "),Oe(r)]," ")},InterfaceTypeExtension:function(t){var n=t.name,s=t.interfaces,i=t.directives,r=t.fields;return C(["extend interface",n,z("implements ",C(s," & ")),C(i," "),Oe(r)]," ")},UnionTypeExtension:function(t){var n=t.name,s=t.directives,i=t.types;return C(["extend union",n,C(s," "),i&&i.length!==0?"= "+C(i," | "):""]," ")},EnumTypeExtension:function(t){var n=t.name,s=t.directives,i=t.values;return C(["extend enum",n,C(s," "),Oe(i)]," ")},InputObjectTypeExtension:function(t){var n=t.name,s=t.directives,i=t.fields;return C(["extend input",n,C(s," "),Oe(i)]," ")}};function Pe(e){return function(t){return C([t.description,e(t)],`
`)}}function C(e){var t,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return(t=e?.filter(function(s){return s}).join(n))!==null&&t!==void 0?t:""}function Oe(e){return z(`{
`,Ps(C(e,`
`)),`
}`)}function z(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";return t!=null&&t!==""?e+t+n:""}function Ps(e){return z("  ",e.replace(/\n/g,`
  `))}function cy(e){return e.indexOf(`
`)!==-1}function la(e){return e!=null&&e.some(cy)}class zn extends Ds{constructor(t){super(t),this.constructor=zn,Object.setPrototypeOf(this,zn.prototype)}}class Hn extends zn{constructor(t={}){super({name:"CanceledError",message:"Request is canceled by user",...t}),this.constructor=Hn,Object.setPrototypeOf(this,Hn.prototype)}}const uy=e=>!!e&&e instanceof Hn;var Bi;(function(e){e.InvalidApiName="InvalidApiName"})(Bi||(Bi={}));Bi.InvalidApiName+"";const au=async e=>{if(!e)return;const t=await Lt(ly(e));if(t){const n=await e.body?.text();return dy(t,{statusCode:e.statusCode,headers:e.headers,body:n})}},ly=e=>{let t;const n=new Proxy(e.body,{get(i,r,o){return r==="json"?async()=>{t||(t=i.text());try{return JSON.parse(await t)}catch{return{}}}:r==="text"?async()=>(t||(t=i.text()),t):Reflect.get(i,r,o)}});return new Proxy(e,{get(i,r,o){return r==="body"?n:Reflect.get(i,r,o)}})},dy=(e,t)=>{const n=new zn({name:e?.name,message:e.message,underlyingError:e,response:t});return Object.assign(n,{$metadata:e.$metadata})},qi=new j("RestApis");function hy(e,t){const n=c=>!!t,s=new AbortController,i=s.signal,r=t?.signal;let o;const a=async()=>{try{const c=await(n(e)?e():e(i));if(c.statusCode>=300)throw await au(c);return c}catch(c){const u=r??i,l=o??u.reason;if(c.name==="AbortError"||u?.aborted===!0){const d=new Hn({...l&&{message:l},underlyingError:c,recoverySuggestion:"The API request was explicitly canceled. If this is not intended, validate if you called the `cancel()` function on the API request erroneously."});throw qi.debug(c),d}throw qi.debug(c),c}};if(n())return a();{const c=u=>{i.aborted!==!0&&(s.abort(u),u&&i.reason!==u&&(o=u))};return{response:a(),cancel:c}}}const da="execute-api",py="us-east-1",fy=/^.+\.([a-z0-9-]+)\.([a-z0-9-]+)\.amazonaws\.com/,my=(e,t)=>{const{service:n=da,region:s=py}={},{hostname:i}=e,[,r,o]=fy.exec(i)??[];return r===da?{service:r,region:o??s}:r==="appsync-api"?{service:"appsync",region:o??s}:{service:n,region:s}},yy=({headers:e},t)=>!e.authorization&&!e["x-api-key"]&&!!t,gy=(e,t)=>{const n={};for(const s in e)n[s.toLowerCase()]=e[s];return t&&(n["content-type"]="application/json; charset=UTF-8",t instanceof FormData&&delete n["content-type"]),n},Ey=Jn(pr,[hr,dr,Sh]),Sy=Jn(pr,[hr,dr]),wy=async(e,t,n,s)=>{const{url:i,method:r,headers:o,body:a,withCredentials:c,abortSignal:u,retryStrategy:l}=t,d=a?a instanceof FormData?a:JSON.stringify(a??""):void 0,h=gy(o,a),p={url:i,headers:h,method:r,body:d},f={retryDecider:Iy(l??e?.libraryOptions?.API?.REST?.retryStrategy),computeDelay:ur,withCrossDomainCredentials:c,abortSignal:u},m=n(p,s);let y;const g=await vy(e);if(m&&g){const E=my(i),v=s?.service??E.service,S=s?.region??E.region;y=await Ey(p,{...f,credentials:g,region:S,service:v})}else y=await Sy(p,{...f});return{statusCode:y.statusCode,headers:y.headers,body:y.body}},Iy=e=>e?.strategy==="no-retry"?()=>Promise.resolve({retryable:!1}):lr(au),vy=async e=>{try{const{credentials:t}=await e.Auth.fetchAuthSession();if(t)return t}catch{qi.debug("No credentials available, the request will be unsigned.")}return null},Nr=new WeakMap,Ty=(e,{url:t,options:n,abortController:s})=>{const i=s??new AbortController,o=hy(async()=>wy(e,{url:t,method:"POST",...n,abortSignal:i.signal,retryStrategy:{strategy:"jittered-exponential-backoff"}},yy,n?.signingServiceInfo),i).finally(()=>{Nr.delete(o)});return o},by=(e,t)=>{const n=Nr.get(e);return n?(n.abort(t),t&&n.signal.reason!==t&&(n.signal.reason=t),!0):!1},Ay=(e,t)=>{Nr.set(e,t)},Ny=5e3,Cy=[400,401,403],Py=["BadRequestException","UnauthorizedException"],cu="ConnectionStateChange";var ve;(function(e){e.GQL_CONNECTION_INIT="connection_init",e.GQL_CONNECTION_ERROR="connection_error",e.GQL_CONNECTION_ACK="connection_ack",e.GQL_START="start",e.GQL_START_ACK="start_ack",e.DATA="data",e.GQL_CONNECTION_KEEP_ALIVE="ka",e.GQL_STOP="stop",e.GQL_COMPLETE="complete",e.GQL_ERROR="error",e.EVENT_SUBSCRIBE="subscribe",e.EVENT_PUBLISH="publish",e.EVENT_SUBSCRIBE_ACK="subscribe_success",e.EVENT_PUBLISH_ACK="publish_success",e.EVENT_STOP="unsubscribe",e.EVENT_COMPLETE="unsubscribe_success"})(ve||(ve={}));var Ye;(function(e){e[e.PENDING=0]="PENDING",e[e.CONNECTED=1]="CONNECTED",e[e.FAILED=2]="FAILED"})(Ye||(Ye={}));var le;(function(e){e[e.CLOSED=0]="CLOSED",e[e.READY=1]="READY",e[e.CONNECTING=2]="CONNECTING"})(le||(le={}));const Oy={accept:"application/json, text/javascript","content-encoding":"amz-1.0","content-type":"application/json; charset=UTF-8"},ha=15e3,xy=15e3,_y=5*60*1e3,Ry=5*1e3,ky=65*1e3,My=5*1e3,Dy=60*1e3;var ae;(function(e){e.CONNECTION_CLOSED="Connection closed",e.CONNECTION_FAILED="Connection failed",e.REALTIME_SUBSCRIPTION_INIT_ERROR="AppSync Realtime subscription init error",e.SUBSCRIPTION_ACK="Subscription ack",e.TIMEOUT_DISCONNECT="Timeout disconnect"})(ae||(ae={}));var X;(function(e){e.Connected="Connected",e.ConnectedPendingNetwork="ConnectedPendingNetwork",e.ConnectionDisrupted="ConnectionDisrupted",e.ConnectionDisruptedPendingNetwork="ConnectionDisruptedPendingNetwork",e.Connecting="Connecting",e.ConnectedPendingDisconnect="ConnectedPendingDisconnect",e.Disconnected="Disconnected",e.ConnectedPendingKeepAlive="ConnectedPendingKeepAlive"})(X||(X={}));const pa=()=>new _t().networkMonitor(),Ie={KEEP_ALIVE_MISSED:{keepAliveState:"unhealthy"},KEEP_ALIVE:{keepAliveState:"healthy"},CONNECTION_ESTABLISHED:{connectionState:"connected"},CONNECTION_FAILED:{intendedConnectionState:"disconnected",connectionState:"disconnected"},CLOSING_CONNECTION:{intendedConnectionState:"disconnected"},OPENING_CONNECTION:{intendedConnectionState:"connected",connectionState:"connecting"},CLOSED:{connectionState:"disconnected"},ONLINE:{networkState:"connected"},OFFLINE:{networkState:"disconnected"}};class Fy{constructor(){this._networkMonitoringSubscription=void 0,this._linkedConnectionState={networkState:"connected",connectionState:"disconnected",intendedConnectionState:"disconnected",keepAliveState:"healthy"},this._initialNetworkStateSubscription=pa().subscribe(({online:t})=>{this.record(t?Ie.ONLINE:Ie.OFFLINE),this._initialNetworkStateSubscription?.unsubscribe()}),this._linkedConnectionStateObservable=new me(t=>{t.next(this._linkedConnectionState),this._linkedConnectionStateObserver=t})}enableNetworkMonitoring(){this._initialNetworkStateSubscription?.unsubscribe(),this._networkMonitoringSubscription===void 0&&(this._networkMonitoringSubscription=pa().subscribe(({online:t})=>{this.record(t?Ie.ONLINE:Ie.OFFLINE)}))}disableNetworkMonitoring(){this._networkMonitoringSubscription?.unsubscribe(),this._networkMonitoringSubscription=void 0}get connectionStateObservable(){let t;return this._linkedConnectionStateObservable.pipe(Ys(n=>this.connectionStatesTranslator(n))).pipe(jn(n=>{const s=n!==t;return t=n,s}))}record(t){t.intendedConnectionState==="connected"?this.enableNetworkMonitoring():t.intendedConnectionState==="disconnected"&&this.disableNetworkMonitoring();const n={...this._linkedConnectionState,...t};this._linkedConnectionState={...n},this._linkedConnectionStateObserver?.next(this._linkedConnectionState)}connectionStatesTranslator({connectionState:t,networkState:n,intendedConnectionState:s,keepAliveState:i}){return t==="connected"&&n==="disconnected"?X.ConnectedPendingNetwork:t==="connected"&&s==="disconnected"?X.ConnectedPendingDisconnect:t==="disconnected"&&s==="connected"&&n==="disconnected"?X.ConnectionDisruptedPendingNetwork:t==="disconnected"&&s==="connected"?X.ConnectionDisrupted:t==="connected"&&i==="unhealthy"?X.ConnectedPendingKeepAlive:t==="connecting"?X.Connecting:t==="disconnected"?X.Disconnected:X.Connected}}var sn;(function(e){e.START_RECONNECT="START_RECONNECT",e.HALT_RECONNECT="HALT_RECONNECT"})(sn||(sn={}));class Uy{constructor(){this.reconnectObservers=[]}addObserver(t){this.reconnectObservers.push(t)}record(t){t===sn.START_RECONNECT&&this.reconnectSetTimeoutId===void 0&&this.reconnectIntervalId===void 0&&(this.reconnectSetTimeoutId=setTimeout(()=>{this._triggerReconnect(),this.reconnectIntervalId=setInterval(()=>{this._triggerReconnect()},Dy)},My)),t===sn.HALT_RECONNECT&&(this.reconnectIntervalId&&(clearInterval(this.reconnectIntervalId),this.reconnectIntervalId=void 0),this.reconnectSetTimeoutId&&(clearTimeout(this.reconnectSetTimeoutId),this.reconnectSetTimeoutId=void 0))}close(){this.reconnectObservers.forEach(t=>{t.complete?.()})}_triggerReconnect(){this.reconnectObservers.forEach(t=>{t.next?.()})}}const fa="wss://",Ly=/^https:\/\/\w{26}\.appsync-api\.\w{2}(?:(?:-\w{2,})+)-\d\.amazonaws.com(?:\.cn)?\/graphql$/i,$y=/^https:\/\/\w{26}\.\w+-api\.\w{2}(?:(?:-\w{2,})+)-\d\.amazonaws.com(?:\.cn)?\/event$/i,ma="/realtime",Ky=e=>e.match(Ly)===null,jy=e=>e.match($y)!==null,By=e=>{let t=e??"";return jy(t)?t=t.concat(ma).replace("ddpg-api","grt-gamma").replace("appsync-api","appsync-realtime-api"):Ky(t)?t=t.concat(ma):t=t.replace("appsync-api","appsync-realtime-api").replace("gogi-beta","grt-beta").replace("ddpg-api","grt-gamma"),t=t.replace("https://",fa).replace("http://",fa),new ke(t)},qy=e=>{if(!e)return{};if("Authorization"in e){const{Authorization:t,...n}=e;return n}return e},Vy=e=>{const t=qy(e),n=new Tc;return Object.entries(t).forEach(([s,i])=>{n.append(s,i)}),n},Wy=(e,t)=>{const n=By(e),s=new Tc(n.search);for(const[i,r]of t.entries())s.append(i,r);return n.search=s.toString(),n.toString()},bi=async e=>{const{appSyncGraphqlEndpoint:t,query:n,libraryConfigHeaders:s=()=>({}),additionalHeaders:i={},authToken:r}=e;let o={};const a=await s();return typeof i=="function"?o=await i({url:t||"",queryString:n||""}):o=i,r&&(o={...o,Authorization:r}),{additionalCustomHeaders:o,libraryConfigHeaders:a}},ya=new j("AWSAppSyncRealTimeProvider Auth"),ga=async({host:e})=>({Authorization:(await Zt())?.tokens?.accessToken?.toString(),host:e}),zy=async({apiKey:e,host:t})=>{const s=new Date().toISOString().replace(/[:-]|\.\d{3}/g,"");return{host:t,"x-amz-date":s,"x-api-key":e}},Hy=async({payload:e,canonicalUri:t,appSyncGraphqlEndpoint:n,region:s})=>{const i={region:s,service:"appsync"},r=(await Zt()).credentials,o={url:`${n}${t}`,data:e,method:"POST",headers:{...Oy}};return Rc({headers:o.headers,method:o.method,url:new ke(o.url),body:o.data},{credentials:r,signingRegion:i.region,signingService:i.service}).headers},Ea=async({host:e,additionalCustomHeaders:t})=>{if(!t?.Authorization)throw new Error("No auth token specified");return{Authorization:t.Authorization,host:e}},uu=async({apiKey:e,authenticationType:t,canonicalUri:n,appSyncGraphqlEndpoint:s,region:i,additionalCustomHeaders:r,payload:o})=>{const a={apiKey:zy,iam:Hy,oidc:ga,userPool:ga,lambda:Ea,none:Ea};if(!t||!a[t]){ya.debug(`Authentication type ${t} not supported`);return}else{const c=a[t],u=s?new ke(s).host:void 0,l=t==="apiKey"?e:void 0;return ya.debug(`Authenticating with ${JSON.stringify(t)}`),await c({payload:o,canonicalUri:n,appSyncGraphqlEndpoint:s,apiKey:l,region:i,host:u,additionalCustomHeaders:r})}},Sa=e=>{ye.dispatch("api",e,"PubSub",gt)};class Gy{constructor(t){this.subscriptionObserverMap=new Map,this.allowNoSubscriptions=!1,this.socketStatus=le.CLOSED,this.keepAliveTimestamp=Date.now(),this.promiseArray=[],this.connectionStateMonitor=new Fy,this.reconnectionMonitor=new Uy,this._establishConnection=async(n,s)=>{this.logger.debug(`Establishing WebSocket connection to ${n}`);try{await this._openConnection(n,s),await this._initiateHandshake()}catch(i){const{errorType:r,errorCode:o}=i;throw Cy.includes(o)||Py.includes(r)?new Ct(r):r?new Error(r):i}},this.logger=new j(t.providerName),this.wsProtocolName=t.wsProtocolName,this.wsConnectUri=t.connectUri,this.connectionStateMonitorSubscription=this._startConnectionStateMonitoring()}close(){return this.socketStatus=le.CLOSED,this.connectionStateMonitor.record(Ie.CONNECTION_FAILED),this.connectionStateMonitorSubscription.unsubscribe(),this.reconnectionMonitor.close(),new Promise((t,n)=>{this.awsRealTimeSocket?(this.awsRealTimeSocket.onclose=s=>{this._closeSocket(),this.subscriptionObserverMap=new Map,this.awsRealTimeSocket=void 0,t()},this.awsRealTimeSocket.onerror=s=>{n(s)},this.awsRealTimeSocket.close()):t()})}subscribe(t,n){return new me(s=>{if(!t?.appSyncGraphqlEndpoint){s.error({errors:[{...new Un("Subscribe only available for AWS AppSync endpoint")}]}),s.complete();return}let i=!1;const r=Mt(),o=()=>{i||(i=!0,this._startSubscriptionWithAWSAppSyncRealTime({options:t,observer:s,subscriptionId:r,customUserAgentDetails:n}).catch(c=>{this.logger.debug(`${ae.REALTIME_SUBSCRIPTION_INIT_ERROR}: ${c}`),this._closeSocket()}).finally(()=>{i=!1}))},a=new me(c=>{this.reconnectionMonitor.addObserver(c)}).subscribe(()=>{o()});return o(),async()=>{await this._cleanupSubscription(r,a)}})}async connect(t){this.socketStatus!==le.READY&&await this._connectWebSocket(t)}async publish(t,n){if(this.socketStatus!==le.READY)throw new Error("Subscription has not been initialized");return this._publishMessage(t,n)}async _connectWebSocket(t){const{apiKey:n,appSyncGraphqlEndpoint:s,authenticationType:i,region:r}=t,{additionalCustomHeaders:o}=await bi(t);this.connectionStateMonitor.record(Ie.OPENING_CONNECTION),await this._initializeWebSocketConnection({apiKey:n,appSyncGraphqlEndpoint:s,authenticationType:i,region:r,additionalCustomHeaders:o})}async _publishMessage(t,n){const s=Mt(),{additionalCustomHeaders:i,libraryConfigHeaders:r}=await bi(t),o=await this._prepareSubscriptionPayload({options:t,subscriptionId:s,customUserAgentDetails:n,additionalCustomHeaders:i,libraryConfigHeaders:r,publish:!0});return new Promise((a,c)=>{if(this.awsRealTimeSocket){const u=p=>{const f=JSON.parse(p.data);if(f.id===s&&f.type==="publish_success"&&(this.awsRealTimeSocket&&this.awsRealTimeSocket.removeEventListener("message",u),h(),a()),f.errors&&f.errors.length>0){const m=f.errors.map(y=>y.errorType);h(),c(new Error(`Publish errors: ${m.join(", ")}`))}},l=p=>{h(),c(new Error(`WebSocket error: ${p}`))},d=()=>{h(),c(new Error("WebSocket is closed"))},h=()=>{this.awsRealTimeSocket?.removeEventListener("message",u),this.awsRealTimeSocket?.removeEventListener("error",l),this.awsRealTimeSocket?.removeEventListener("close",d)};this.awsRealTimeSocket.addEventListener("message",u),this.awsRealTimeSocket.addEventListener("error",l),this.awsRealTimeSocket.addEventListener("close",d),this.awsRealTimeSocket.send(o)}else c(new Error("WebSocket is not connected"))})}async _cleanupSubscription(t,n){n?.unsubscribe();try{await this._waitForSubscriptionToBeConnected(t);const{subscriptionState:s}=this.subscriptionObserverMap.get(t)||{};if(!s)return;if(s===Ye.CONNECTED)this._sendUnsubscriptionMessage(t);else throw new Error("Subscription never connected")}catch(s){this.logger.debug(`Error while unsubscribing ${s}`)}finally{this._removeSubscriptionObserver(t)}}_startConnectionStateMonitoring(){return this.connectionStateMonitor.connectionStateObservable.subscribe(t=>{Sa({event:cu,data:{provider:this,connectionState:t},message:`Connection state is ${t}`}),this.connectionState=t,t===X.ConnectionDisrupted&&this.reconnectionMonitor.record(sn.START_RECONNECT),[X.Connected,X.ConnectedPendingDisconnect,X.ConnectedPendingKeepAlive,X.ConnectedPendingNetwork,X.ConnectionDisruptedPendingNetwork,X.Disconnected].includes(t)&&this.reconnectionMonitor.record(sn.HALT_RECONNECT)})}async _startSubscriptionWithAWSAppSyncRealTime({options:t,observer:n,subscriptionId:s,customUserAgentDetails:i}){const{query:r,variables:o}=t;this.subscriptionObserverMap.set(s,{observer:n,query:r??"",variables:o??{},subscriptionState:Ye.PENDING,startAckTimeoutId:void 0});const{additionalCustomHeaders:a,libraryConfigHeaders:c}=await bi(t),u=await this._prepareSubscriptionPayload({options:t,subscriptionId:s,customUserAgentDetails:i,additionalCustomHeaders:a,libraryConfigHeaders:c});try{await this._connectWebSocket(t)}catch(h){this._logStartSubscriptionError(s,n,h);return}const{subscriptionFailedCallback:l,subscriptionReadyCallback:d}=this.subscriptionObserverMap.get(s)??{};this.subscriptionObserverMap.set(s,{observer:n,subscriptionState:Ye.PENDING,query:r??"",variables:o??{},subscriptionReadyCallback:d,subscriptionFailedCallback:l,startAckTimeoutId:setTimeout(()=>{this._timeoutStartSubscriptionAck(s)},xy)}),this.awsRealTimeSocket&&this.awsRealTimeSocket.send(u)}_logStartSubscriptionError(t,n,s){this.logger.debug({err:s});const i=String(s.message??"");if(this._closeSocket(),this.connectionState!==X.ConnectionDisruptedPendingNetwork){ic(s)?n.error({errors:[{...new Un(`${ae.CONNECTION_FAILED}: ${i}`)}]}):this.logger.debug(`${ae.CONNECTION_FAILED}: ${i}`);const{subscriptionFailedCallback:r}=this.subscriptionObserverMap.get(t)||{};typeof r=="function"&&r()}}async _waitForSubscriptionToBeConnected(t){const n=this.subscriptionObserverMap.get(t);if(n){const{subscriptionState:s}=n;if(s===Ye.PENDING)return new Promise((i,r)=>{const{observer:o,subscriptionState:a,variables:c,query:u}=n;this.subscriptionObserverMap.set(t,{observer:o,subscriptionState:a,variables:c,query:u,subscriptionReadyCallback:i,subscriptionFailedCallback:r})})}}_sendUnsubscriptionMessage(t){try{if(this.awsRealTimeSocket&&this.awsRealTimeSocket.readyState===WebSocket.OPEN&&this.socketStatus===le.READY){const n=this._unsubscribeMessage(t),s=JSON.stringify(n);this.awsRealTimeSocket.send(s)}}catch(n){this.logger.debug({err:n})}}_removeSubscriptionObserver(t){this.subscriptionObserverMap.delete(t),this.allowNoSubscriptions||setTimeout(this._closeSocketIfRequired.bind(this),1e3)}_closeSocketIfRequired(){if(!(this.subscriptionObserverMap.size>0)){if(!this.awsRealTimeSocket){this.socketStatus=le.CLOSED;return}if(this.connectionStateMonitor.record(Ie.CLOSING_CONNECTION),this.awsRealTimeSocket.bufferedAmount>0)setTimeout(this._closeSocketIfRequired.bind(this),1e3);else{this.logger.debug("closing WebSocket...");const t=this.awsRealTimeSocket;t.onclose=null,t.onerror=null,t.close(1e3),this.awsRealTimeSocket=void 0,this.socketStatus=le.CLOSED,this._closeSocket()}}}maintainKeepAlive(){this.keepAliveTimestamp=Date.now()}keepAliveHeartbeat(t){const n=Date.now();n-this.keepAliveTimestamp>ky?this.connectionStateMonitor.record(Ie.KEEP_ALIVE_MISSED):this.connectionStateMonitor.record(Ie.KEEP_ALIVE),n-this.keepAliveTimestamp>t&&this._errorDisconnect(ae.TIMEOUT_DISCONNECT)}_handleIncomingSubscriptionMessage(t){if(typeof t.data!="string")return;const[n,s]=this._handleSubscriptionData(t);if(n){this.maintainKeepAlive();return}const{type:i,id:r,payload:o}=s,{observer:a=null,query:c="",variables:u={},startAckTimeoutId:l,subscriptionReadyCallback:d,subscriptionFailedCallback:h}=this.subscriptionObserverMap.get(r)||{};if(i===ve.GQL_START_ACK||i===ve.EVENT_SUBSCRIBE_ACK){this.logger.debug(`subscription ready for ${JSON.stringify({query:c,variables:u})}`),typeof d=="function"&&d(),l&&clearTimeout(l),Sa({event:ae.SUBSCRIPTION_ACK,data:{query:c,variables:u},message:"Connection established for subscription"});const p=Ye.CONNECTED;a&&this.subscriptionObserverMap.set(r,{observer:a,query:c,variables:u,startAckTimeoutId:void 0,subscriptionState:p,subscriptionReadyCallback:d,subscriptionFailedCallback:h}),this.connectionStateMonitor.record(Ie.CONNECTION_ESTABLISHED);return}if(i===ve.GQL_CONNECTION_KEEP_ALIVE){this.maintainKeepAlive();return}if(i===ve.GQL_ERROR){const p=Ye.FAILED;a&&(this.subscriptionObserverMap.set(r,{observer:a,query:c,variables:u,startAckTimeoutId:l,subscriptionReadyCallback:d,subscriptionFailedCallback:h,subscriptionState:p}),this.logger.debug(`${ae.CONNECTION_FAILED}: ${JSON.stringify(o??s)}`),a.error({errors:[{...new Un(`${ae.CONNECTION_FAILED}: ${JSON.stringify(o??s)}`)}]}),l&&clearTimeout(l),typeof h=="function"&&h())}}_errorDisconnect(t){this.logger.debug(`Disconnect error: ${t}`),this.awsRealTimeSocket&&(this._closeSocket(),this.awsRealTimeSocket.close()),this.socketStatus=le.CLOSED}_closeSocket(){this.keepAliveHeartbeatIntervalId&&(clearInterval(this.keepAliveHeartbeatIntervalId),this.keepAliveHeartbeatIntervalId=void 0),this.connectionStateMonitor.record(Ie.CLOSED)}_timeoutStartSubscriptionAck(t){const n=this.subscriptionObserverMap.get(t);if(n){const{observer:s,query:i,variables:r}=n;if(!s)return;this.subscriptionObserverMap.set(t,{observer:s,query:i,variables:r,subscriptionState:Ye.FAILED}),this._closeSocket(),this.logger.debug("timeoutStartSubscription",JSON.stringify({query:i,variables:r}))}}_initializeWebSocketConnection({appSyncGraphqlEndpoint:t,authenticationType:n,apiKey:s,region:i,additionalCustomHeaders:r}){if(this.socketStatus!==le.READY)return new Promise(async(o,a)=>{if(this.promiseArray.push({res:o,rej:a}),this.socketStatus===le.CLOSED)try{this.socketStatus=le.CONNECTING;const u=await uu({authenticationType:n,payload:"{}",canonicalUri:this.wsConnectUri,apiKey:s,appSyncGraphqlEndpoint:t,region:i,additionalCustomHeaders:r}),l=u?JSON.stringify(u):"",h=`header-${en.convert(l,{urlSafe:!0,skipPadding:!0})}`,p=Vy(r),f=Wy(t,p);await this._establishRetryableConnection(f,h),this.promiseArray.forEach(({res:m})=>{this.logger.debug("Notifying connection successful"),m()}),this.socketStatus=le.READY,this.promiseArray=[]}catch(c){this.logger.debug("Connection exited with",c),this.promiseArray.forEach(({rej:u})=>{u(c)}),this.promiseArray=[],this.awsRealTimeSocket&&this.awsRealTimeSocket.readyState===WebSocket.OPEN&&this.awsRealTimeSocket.close(3001),this.awsRealTimeSocket=void 0,this.socketStatus=le.CLOSED}})}async _establishRetryableConnection(t,n){this.logger.debug("Establishing retryable connection"),await Mc(this._establishConnection.bind(this),[t,n],Ny)}async _openConnection(t,n){return new Promise((s,i)=>{const r=this._getNewWebSocket(t,[this.wsProtocolName,n]);r.onerror=()=>{this.logger.debug("WebSocket connection error")},r.onclose=()=>{this._closeSocket(),i(new Error("Connection handshake error"))},r.onopen=()=>{this.awsRealTimeSocket=r,s()}})}_getNewWebSocket(t,n){return new WebSocket(t,n)}async _initiateHandshake(){return new Promise((t,n)=>{if(!this.awsRealTimeSocket){n(new Error("awsRealTimeSocket undefined"));return}let s=!1;this.awsRealTimeSocket.onerror=o=>{this.logger.debug(`WebSocket error ${JSON.stringify(o)}`)},this.awsRealTimeSocket.onclose=o=>{this.logger.debug(`WebSocket closed ${o.reason}`),this._closeSocket(),n(new Error(JSON.stringify(o)))},this.awsRealTimeSocket.onmessage=o=>{if(typeof o.data!="string")return;this.logger.debug(`subscription message from AWS AppSyncRealTime: ${o.data} `);const a=JSON.parse(o.data),{type:c}=a,u=this._extractConnectionTimeout(a);if(c===ve.GQL_CONNECTION_ACK){s=!0,this._registerWebsocketHandlers(u),t("Connected to AWS AppSyncRealTime");return}if(c===ve.GQL_CONNECTION_ERROR){const{errorType:l,errorCode:d}=this._extractErrorCodeAndType(a);n({errorType:l,errorCode:d})}};const i={type:ve.GQL_CONNECTION_INIT};this.awsRealTimeSocket.send(JSON.stringify(i));const r=o=>{o||(this.connectionStateMonitor.record(Ie.CONNECTION_FAILED),n(new Error(`Connection timeout: ack from AWSAppSyncRealTime was not received after ${ha} ms`)))};setTimeout(()=>{r(s)},ha)})}_registerWebsocketHandlers(t){this.awsRealTimeSocket&&(this.keepAliveHeartbeatIntervalId=setInterval(()=>{this.keepAliveHeartbeat(t)},Ry),this.awsRealTimeSocket.onmessage=this._handleIncomingSubscriptionMessage.bind(this),this.awsRealTimeSocket.onerror=n=>{this.logger.debug(n),this._errorDisconnect(ae.CONNECTION_CLOSED)},this.awsRealTimeSocket.onclose=n=>{this.logger.debug(`WebSocket closed ${n.reason}`),this._closeSocket(),this._errorDisconnect(ae.CONNECTION_CLOSED)})}}const wa="AWSAppSyncRealTimeProvider",Qy="graphql-ws",Yy="/connect";class Jy extends Gy{constructor(){super({providerName:wa,wsProtocolName:Qy,connectUri:Yy})}getProviderName(){return wa}subscribe(t,n){return super.subscribe(t,n)}async _prepareSubscriptionPayload({options:t,subscriptionId:n,customUserAgentDetails:s,additionalCustomHeaders:i,libraryConfigHeaders:r}){const{appSyncGraphqlEndpoint:o,authenticationType:a,query:c,variables:u,apiKey:l,region:d}=t,p=JSON.stringify({query:c,variables:u}),f={...await uu({apiKey:l,appSyncGraphqlEndpoint:o,authenticationType:a,payload:p,canonicalUri:"",region:d,additionalCustomHeaders:i}),...r,...i,[ll]:un(s)},m={id:n,payload:{data:p,extensions:{authorization:{...f}}},type:ve.GQL_START};return JSON.stringify(m)}_handleSubscriptionData(t){this.logger.debug(`subscription message from AWS AppSync RealTime: ${t.data}`);const{id:n="",payload:s,type:i}=JSON.parse(String(t.data)),{observer:r=null,query:o="",variables:a={}}=this.subscriptionObserverMap.get(n)||{};return this.logger.debug({id:n,observer:r,query:o,variables:a}),i===ve.DATA&&s&&s.data?(r?r.next(s):this.logger.debug(`observer not found for id: ${n}`),[!0,{id:n,type:i,payload:s}]):[!1,{id:n,type:i,payload:s}]}_unsubscribeMessage(t){return{id:t,type:ve.GQL_STOP}}_extractConnectionTimeout(t){const{payload:{connectionTimeoutMs:n=_y}={}}=t;return n}_extractErrorCodeAndType(t){const{payload:{errors:[{errorType:n="",errorCode:s=0}={}]=[]}={}}=t;return{errorCode:s,errorType:n}}}class qe extends ue{constructor(t){super(t),this.constructor=qe,Object.setPrototypeOf(this,qe.prototype)}}var Yt;(function(e){e.NoAuthSession="NoAuthSession",e.NoRegion="NoRegion",e.NoCustomEndpoint="NoCustomEndpoint"})(Yt||(Yt={}));const Xy={[Yt.NoAuthSession]:{message:"Auth session should not be empty."},[Yt.NoRegion]:{message:"Missing region."},[Yt.NoCustomEndpoint]:{message:"Custom endpoint region is present without custom endpoint."}};function Zy(e,t){const{message:n,recoverySuggestion:s}=Xy[t];if(!e)throw new qe({name:t,message:n,recoverySuggestion:s})}const eg=new j("GraphQLAPI resolveConfig"),Ia=e=>{const t=e.getConfig();t.API?.GraphQL||eg.warn("The API configuration is missing. This is likely due to Amplify.configure() not being called prior to generateClient().");const{apiKey:n,customEndpoint:s,customEndpointRegion:i,defaultAuthMode:r,endpoint:o,region:a}=t.API?.GraphQL??{};return Zy(!(!s&&i),Yt.NoCustomEndpoint),{apiKey:n,customEndpoint:s,customEndpointRegion:i,defaultAuthMode:r,endpoint:o,region:a}},va=e=>{const t=e.libraryOptions?.API?.GraphQL?.headers,n=e.libraryOptions?.API?.GraphQL?.withCredentials;return{headers:t,withCredentials:n}};function Ta(e){return e.errors&&Array.isArray(e.errors)&&e.errors.forEach(t=>{tg(t)&&(t.message="Unauthorized",t.recoverySuggestion=`If you're calling an Amplify-generated API, make sure to set the "authMode" in generateClient({ authMode: '...' }) to the backend authorization rule's auth provider ('apiKey', 'userPool', 'iam', 'oidc', 'lambda')`)}),e}function tg(e){return!!(e?.originalError?.name?.startsWith("UnauthorizedException")||e.message?.startsWith("Connection failed:")&&e.message?.includes("Permission denied"))}var It;(function(e){e.NO_API_KEY="No api-key configured",e.NO_CURRENT_USER="No current user",e.NO_CREDENTIALS="No credentials",e.NO_FEDERATED_JWT="No federated jwt",e.NO_AUTH_TOKEN="No auth token specified"})(It||(It={}));const lu=Symbol("amplify"),Os=Symbol("authMode"),du=Symbol("authToken"),Vi=Symbol("apiKey"),hu=Symbol("headers"),xs=Symbol("endpoint");function Cr(e){const t=e;return{amplify:t[lu],apiKey:t[Vi],authMode:t[Os],authToken:t[du],endpoint:t[xs],headers:t[hu]}}const ng={name:"NoApiKey",message:It.NO_API_KEY,recoverySuggestion:'The API request was made with `authMode: "apiKey"` but no API Key was passed into `Amplify.configure()`. Review if your API key is passed into the `Amplify.configure()` function.'},sg={name:"NoCredentials",message:It.NO_CREDENTIALS,recoverySuggestion:'The API request was made with `authMode: "iam"` but no authentication credentials are available.\n\nIf you intended to make a request using an authenticated role, review if your user is signed in before making the request.\n\nIf you intend to make a request using an unauthenticated role or also known as "guest access", verify if "Auth.Cognito.allowGuestAccess" is set to "true" in the `Amplify.configure()` function.'},ig={name:"NoValidAuthTokens",message:It.NO_FEDERATED_JWT,recoverySuggestion:"If you intended to make an authenticated API request, review if the current user is signed in."},rg={name:"NoSignedUser",message:It.NO_CURRENT_USER,recoverySuggestion:"Review the underlying exception field for more details. If you intended to make an authenticated API request, review if the current user is signed in."},og={name:"NoAuthorizationHeader",message:It.NO_AUTH_TOKEN,recoverySuggestion:'The API request was made with `authMode: "lambda"` but no `authToken` is set. Review if a valid authToken is passed into the request options or in the `Amplify.configure()` function.'},ag={name:"NoEndpoint",message:"No GraphQL endpoint configured in `Amplify.configure()`.",recoverySuggestion:"Review if the GraphQL API endpoint is set in the `Amplify.configure()` function."},ba=e=>({data:{},errors:[new Un(e.message,null,null,null,null,e)]});function cg(e){if(!e)return!1;const t=e;return Array.isArray(t.errors)&&t.errors.length>0}async function ug(e,t,n,s={}){let i={};switch(t){case"apiKey":if(!n)throw new qe(ng);i={"X-Api-Key":n};break;case"iam":{if((await e.Auth.fetchAuthSession()).credentials===void 0)throw new qe(sg);break}case"oidc":case"userPool":{let r;try{r=(await e.Auth.fetchAuthSession()).tokens?.accessToken.toString()}catch(o){throw new qe({...rg,underlyingError:o})}if(!r)throw new qe(ig);i={Authorization:r};break}case"lambda":if(typeof s=="object"&&!s.Authorization)throw new qe(og);i={Authorization:s.Authorization};break}return i}const lg="x-amz-user-agent",dg=e=>typeof e!="function";class pu{constructor(){this.appSyncRealTime=new Map,this._api={post:Ty,cancelREST:by,isCancelErrorREST:uy,updateRequestToBeCancellable:Ay}}getModuleName(){return"InternalGraphQLAPI"}getGraphqlOperationType(t){const s=vi(t).definitions,[{operation:i}]=s;return i}graphql(t,{query:n,variables:s={},authMode:i,authToken:r,endpoint:o,apiKey:a},c,u){const l=vi(typeof n=="string"?n:An(n)),[d={}]=l.definitions.filter(f=>f.kind==="OperationDefinition"),{operation:h}=d,p=c||{};switch(h){case"query":case"mutation":{const f=new AbortController;let m;return dg(t)?m=this._graphql(t,{query:l,variables:s,authMode:i,apiKey:a,endpoint:o},p,f,u,r):m=t(async g=>await this._graphql(g,{query:l,variables:s,authMode:i,apiKey:a,endpoint:o},p,f,u,r)),this._api.updateRequestToBeCancellable(m,f),m}case"subscription":return this._graphqlSubscribe(t,{query:l,variables:s,authMode:i,apiKey:a,endpoint:o},p,u,r);default:throw new Error(`invalid operation type: ${h}`)}}async _graphql(t,{query:n,variables:s,authMode:i,endpoint:r,apiKey:o},a={},c,u,l){const{apiKey:d,region:h,endpoint:p,customEndpoint:f,customEndpointRegion:m,defaultAuthMode:y}=Ia(t),g=i||y||"iam",E=g==="identityPool"?"iam":g,{headers:v,withCredentials:S}=va(t);let I;if(typeof a=="function"){const P={method:"POST",url:new ke(r||f||p||"").toString(),queryString:An(n)};I=await a(P)}else I=a;l&&(I={...I,Authorization:l});const T=await ug(t,E,o??d,I),O={...!f&&T,...f&&(m?T:{})||{},...v&&await v({query:An(n),variables:s}),...I,...!f&&{[lg]:un(u)}},b={query:An(n),variables:s||null};let x;f&&!m||E!=="oidc"&&E!=="userPool"&&E!=="iam"&&E!=="lambda"?x=void 0:x={service:m?"execute-api":"appsync",region:m||h};const U=r||f||p;if(!U)throw ba(new qe(ag));let M;try{const{body:P}=await this._api.post(t,{url:new ke(U),options:{headers:O,body:b,signingServiceInfo:x,withCredentials:S},abortController:c});M=await P.json()}catch(P){if(this.isCancelError(P))throw P;M=ba(P)}if(cg(M))throw Ta(M);return M}isCancelError(t){return this._api.isCancelErrorREST(t)}cancel(t,n){return this._api.cancelREST(t,n)}_graphqlSubscribe(t,{query:n,variables:s,authMode:i,apiKey:r,endpoint:o},a={},c,u){const l=Ia(t),d=i||l?.defaultAuthMode||"iam",h=d==="identityPool"?"iam":d,{headers:p}=va(t),f=o??l?.endpoint,m=f??"none",y=this.appSyncRealTime.get(m)??new Jy;return this.appSyncRealTime.set(m,y),y.subscribe({query:An(n),variables:s,appSyncGraphqlEndpoint:f,region:l?.region,authenticationType:h,apiKey:r??l?.apiKey,additionalHeaders:a,authToken:u,libraryConfigHeaders:p},c).pipe(el(g=>{throw g.errors?Ta(g):g}))}}function ai(e){const t=new Set;for(const n of e.attributes||[])if(hg(n))for(const s of n.properties.rules)s.allow==="owner"?t.add(s.ownerField||"owner"):s.allow==="groups"&&s.groupsField!==void 0&&t.add(s.groupsField);return Array.from(t)}function hg(e){return e?.type==="auth"&&typeof e?.properties=="object"&&Array.isArray(e?.properties?.rules)?(e?.properties?.rules).every(t=>!!t.allow):!1}function _s(e){return`${e[0].toUpperCase()}${e.slice(1)}`}function dt(e){let t,n;const s=new Promise((i,r)=>{t=i,n=r});return e(s).then(i=>{t(i)}).catch(i=>{n(i)}),s}const $s=new WeakMap;function ht(e,t){return $s.set(t,e),e.finally(()=>{$s.delete(t)})}function pg(e){const t=e.cancel.bind(e);e.cancel=function(n,s){const i=new Set;let r=n;for(;r&&$s.has(r);){if(i.has(r))throw new Error("A cycle was detected in the modeled graphql cancellation chain. This is a bug. Please report it!");i.add(r),r=$s.get(r)}return t(r,s)}}const zt={HAS_ONE:"HAS_ONE",HAS_MANY:"HAS_MANY",BELONGS_TO:"BELONGS_TO"},Aa={ID:"ID",String:"String",AWSDate:"String",AWSTime:"String",AWSDateTime:"String",AWSTimestamp:"Int",AWSEmail:"String",AWSPhone:"String",AWSURL:"String",AWSIPAddress:"String",AWSJSON:"String",Boolean:"Boolean",Int:"Int",Float:"Float"},Ks=e=>e.length===1?e[0]:e.reduce((t,n,s)=>s===0?n:t+_s(n),""),st=(e,t,n)=>{if(!n)return null;const s={};for(const[i,r]of Object.entries(n)){const o=t?e.models[t]?.fields[i]:void 0,a={fieldDef:o,value:r};fg(a)?s[i]=a.value.items.map(c=>st(e,a.fieldDef.type.model,c)):mg(o)?s[i]=st(e,o.type.model,r):s[i]=r}return s};function fg(e){return typeof e.fieldDef?.type=="object"&&"model"in e.fieldDef.type&&typeof e.fieldDef.type.model=="string"&&e.fieldDef.isArray&&Array.isArray(e.value?.items)}function mg(e){return typeof e?.type=="object"&&"model"in e.type&&typeof e.type.model=="string"}function it(e,t,n,s,i,r,o=!1){const a=s.models[t],c=a.fields,u=Object.entries(c).filter(([l,d])=>d?.type?.model!==void 0).map(([l])=>l);return n.map(l=>{if(l==null)return l;const d={};for(const h of u){const p=c[h],m=(p?.type).model,y=s.models[m],g=y.primaryKeyInfo.primaryKeyFieldName,E=y.primaryKeyInfo.sortKeyFieldNames,v=p.association?.connectionType;let S=[];p.association&&"associatedWith"in p.association&&(S=p.association.associatedWith);const I=[];switch(p.association&&"targetNames"in p.association&&I.push(...p.association.targetNames),v){case zt.BELONGS_TO:{const T=E.reduce((O,b)=>(l[b]&&(O[b]=l[b]),O),{});if(e.models[m]?.get===void 0)break;o?d[h]=(O,b)=>l[I[0]]?e.models[m].get(O,{[g]:l[I[0]],...T},{authMode:b?.authMode||i,authToken:b?.authToken||r}):{data:null}:d[h]=O=>l[I[0]]?e.models[m].get({[g]:l[I[0]],...T},{authMode:O?.authMode||i,authToken:O?.authToken||r}):{data:null};break}case zt.HAS_ONE:case zt.HAS_MANY:{const T=v===zt.HAS_ONE?P=>({data:P?.data.shift()||null,errors:P.errors,extensions:P.extensions}):P=>P,O=a.primaryKeyInfo.primaryKeyFieldName,b=a.primaryKeyInfo.sortKeyFieldNames,x=y.fields[S[0]];if(x.type.model){let P=[];x.association&&"targetNames"in x.association&&(P=x.association?.targetNames);const A=P.map((F,k)=>k===0?{[F]:{eq:l[O]}}:{[F]:{eq:l[b[k-1]]}});if(e.models[m]?.list===void 0)break;o?d[h]=(F,k)=>l[O]?dt(async V=>{const Z=e.models[m].list(F,{filter:{and:A},limit:k?.limit,nextToken:k?.nextToken,authMode:k?.authMode||i,authToken:k?.authToken||r}),he=ht(Z,V);return T(await he)}):[]:d[h]=F=>l[O]?dt(async k=>{const V=e.models[m].list({filter:{and:A},limit:F?.limit,nextToken:F?.nextToken,authMode:F?.authMode||i,authToken:F?.authToken||r}),Z=ht(V,k);return T(await Z)}):[];break}const M=S.map((P,A)=>A===0?{[P]:{eq:l[O]}}:{[P]:{eq:l[b[A-1]]}});if(e.models[m]?.list===void 0)break;o?d[h]=(P,A)=>l[O]?dt(async F=>{const k=e.models[m].list(P,{filter:{and:M},limit:A?.limit,nextToken:A?.nextToken,authMode:A?.authMode||i,authToken:A?.authToken||r}),V=ht(k,F);return T(await V)}):[]:d[h]=P=>l[O]?dt(async A=>{const F=e.models[m].list({filter:{and:M},limit:P?.limit,nextToken:P?.nextToken,authMode:P?.authMode||i,authToken:P?.authToken||r}),k=ht(F,A);return T(await k)}):[];break}}}return{...l,...d}})}const Wi={CREATE:{operationPrefix:"create",usePlural:!1},GET:{operationPrefix:"get",usePlural:!1},UPDATE:{operationPrefix:"update",usePlural:!1},DELETE:{operationPrefix:"delete",usePlural:!1},LIST:{operationPrefix:"list",usePlural:!0},INDEX_QUERY:{operationPrefix:"",usePlural:!1},ONCREATE:{operationPrefix:"onCreate",usePlural:!1},ONUPDATE:{operationPrefix:"onUpdate",usePlural:!1},ONDELETE:{operationPrefix:"onDelete",usePlural:!1},OBSERVEQUERY:{operationPrefix:"observeQuery",usePlural:!1}},zi="*",ci=(e,t)=>{const{fields:n}=e,s=Object.values(n).map(({type:i,name:r})=>{if(typeof i.enum=="string")return[r,rn];if(typeof i.nonModel=="string")return[r,ci(t.nonModels[i.nonModel],t)];if(typeof i=="string")return[r,rn]}).filter(i=>i!==void 0);return Object.fromEntries(s)},yg=(e,t)=>{const{fields:n}=e,s=Object.values(n).map(({type:r,name:o})=>{if(typeof r.enum=="string"||typeof r=="string")return[o,rn];if(typeof r.nonModel=="string")return[o,ci(t.nonModels[r.nonModel],t)]}).filter(r=>r!==void 0),i=ai(e).map(r=>[r,rn]);return Object.fromEntries(s.concat(i))};function gg(e){const{fields:t}=e,n=Object.values(t).map(({type:i,name:r})=>{if(typeof i=="string")return r;if(typeof i=="object"){if(typeof i?.enum=="string")return r;if(typeof i?.nonModel=="string")return`${r}.${zi}`}}).filter(Boolean),s=ai(e);return Array.from(new Set(n.concat(s)))}const rn="";function Eg(e,t,n){const s=(i,r)=>{const[o,...a]=i.split("."),c=a[0],u=e.models[r]??e.nonModels[r],l=u?.fields,d=l?.[o]?.type?.model,h=e.models[d],p=l?.[o]?.type?.nonModel,f=e.nonModels[p],m=h?"model":f?"nonModel":"field";if(m==="nonModel"){let y={};if(!c)throw Error(`${o} must declare a wildcard (*) or a field of custom type ${p}`);return c===zi?y={[o]:ci(f,e)}:y={[o]:s(a.join("."),p)},y}else if(m==="model"){let y={};if(!c)throw Error(`${o} must declare a wildcard (*) or a field of model ${d}`);if(c===zi){const g=e.models[d];y={[o]:yg(g,e)}}else y={[o]:s(a.join("."),d)};return l[o]?.isArray&&(y={[o]:{items:y[o]}}),y}else{const y=l?.[o],g=e.nonModels[r],E=g?.fields?.[o];if(g){if(!E)throw Error(`${o} is not a field of custom type ${r}`)}else{const v=ai(u).includes(o);if(!y&&!v)throw Error(`${o} is not a field of model ${r}`)}return{[o]:rn}}};return n.reduce((i,r)=>fu(s(r,t),i),{})}function js(e){const t=[];return Object.entries(e).forEach(([n,s])=>{s===rn?t.push(n):typeof s=="object"&&s!==null&&(s?.items?t.push(n,"{","items","{",js(s.items),"}","}"):t.push(n,"{",js(s),"}"))}),t.join(" ")}function fu(e,t){const n=s=>s&&typeof s=="object";for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(Object.prototype.hasOwnProperty.call(t,s)&&n(t[s])?fu(e[s],t[s]):t[s]=e[s]);return t}function mu(e,t,n){const s=e.models[t],i=Eg(e,t,n??gg(s));return js(i)}function ui(e,t,n,s,i){const{name:r,pluralName:o,fields:a,primaryKeyInfo:{isCustomPrimaryKey:c,primaryKeyFieldName:u,sortKeyFieldNames:l},attributes:d}=t,h=r.charAt(0).toUpperCase()+r.slice(1),p=o.charAt(0).toUpperCase()+o.slice(1),{operationPrefix:f,usePlural:m}=Wi[n],{selectionSet:y}=s||{};let g,E;if(f)g=`${f}${m?p:h}`;else if(i){const{queryField:M,pk:P,sk:A=[]}=i;g=M;let F={};if(A.length===1){const[k]=A,V=typeof a[k].type=="string"?a[k].type:"String",Z=Aa[V];F={[k]:`Model${Z}KeyConditionInput`}}else if(A.length>1){const k=Ks(A),V=d?.find(Z=>Z?.properties?.queryField===M)?.properties?.name;F={[k]:`Model${_s(r)}${_s(V)}CompositeKeyConditionInput`}}E={[P]:`${Object.prototype.hasOwnProperty.call(a[P].type,"enum")?a[P].type.enum:a[P].type}!`,...F}}else throw new Error("Error generating GraphQL Document - invalid operation name");let v,S,I;const T=mu(e,r,y),O={[u]:`${a[u].type}!`},b={},x=M=>{if(l.length===0)return{};if(M==="get")return l.reduce((P,A)=>{const F=a[A].type;return M==="get"&&(P[A]=`${F}!`),P},{});if(l.length===1){const[P]=l,A=typeof a[P].type=="string"?a[P].type:"String",F=Aa[A];return{[P]:`Model${F}KeyConditionInput`}}else return{[Ks(l)]:`Model${_s(r)}PrimaryCompositeKeyConditionInput`}};switch(c&&(Object.assign(O,x("get")),Object.assign(b,{[u]:`${a[u].type}`,sortDirection:"ModelSortDirection"},x("list"))),n){case"CREATE":case"UPDATE":case"DELETE":I??(I={input:`${f.charAt(0).toLocaleUpperCase()+f.slice(1)}${h}Input!`}),v??(v="mutation");case"GET":I??(I=O),S??(S=T);case"LIST":I??(I={...b,filter:`Model${h}FilterInput`,limit:"Int",nextToken:"String"}),v??(v="query"),S??(S=`items { ${T} } nextToken __typename`);case"INDEX_QUERY":I??(I={...E,filter:`Model${h}FilterInput`,sortDirection:"ModelSortDirection",limit:"Int",nextToken:"String"}),v??(v="query"),S??(S=`items { ${T} } nextToken __typename`);case"ONCREATE":case"ONUPDATE":case"ONDELETE":I??(I={filter:`ModelSubscription${h}FilterInput`}),v??(v="subscription"),S??(S=T);break;case"OBSERVEQUERY":default:throw new Error("Internal error: Attempted to generate graphql document for observeQuery. Please report this error.")}return`${v}${I?`(${Object.entries(I).map(([M,P])=>`$${M}: ${P}`)})`:""} { ${g}${I?`(${Object.keys(I).map(M=>`${M}: $${M}`)})`:""} { ${S} } }`}function li(e,t,n,s,i){const{fields:r,primaryKeyInfo:{isCustomPrimaryKey:o,primaryKeyFieldName:a,sortKeyFieldNames:c}}=e,u=c?.length&&Ks(c);let l={};switch(t){case"CREATE":l={input:n?Na(n,e,s):{}};break;case"UPDATE":l={input:n?Object.fromEntries(Object.entries(Na(n,e,s)).filter(([d])=>r[d]?!r[d].isReadOnly:!ai(e).includes(d))):{}};break;case"GET":case"DELETE":n&&(l=o?[a,...c].reduce((d,h)=>(d[h]=n[h],d),{}):{[a]:n[a]}),t==="DELETE"&&(l={input:l});break;case"LIST":n?.filter&&(l.filter=n.filter),n?.sortDirection&&(l.sortDirection=n.sortDirection),n&&n[a]&&(l[a]=n[a]),u&&n&&n[u]&&(l[u]=n[u]),n?.nextToken&&(l.nextToken=n.nextToken),n?.limit&&(l.limit=n.limit);break;case"INDEX_QUERY":{const{pk:d,sk:h=[]}=i,p=h?.length&&Ks(h);l[d]=n[d],p&&n&&n[p]&&(l[p]=n[p]),n?.filter&&(l.filter=n.filter),n?.sortDirection&&(l.sortDirection=n.sortDirection),n?.nextToken&&(l.nextToken=n.nextToken),n?.limit&&(l.limit=n.limit);break}case"ONCREATE":case"ONUPDATE":case"ONDELETE":n?.filter&&(l={filter:n.filter});break;case"OBSERVEQUERY":throw new Error("Internal error: Attempted to build variables for observeQuery. Please report this error.");default:{const d=t;throw new Error(`Unhandled operation case: ${d}`)}}return l}function Na(e,t,n){const{fields:s}=t,i={};return Object.entries(e).forEach(([r,o])=>{const c=s[r]?.type?.model;if(c){const u=s[r]?.association,d=n.models[c].primaryKeyInfo;if(u?.connectionType===zt.HAS_ONE){const h=u;h.targetNames.forEach((p,f)=>{const m=h.associatedWith[f];i[p]=o[m]})}u?.connectionType===zt.BELONGS_TO&&u.targetNames.forEach((p,f)=>{if(f===0){const m=d.primaryKeyFieldName;i[p]=o[m]}else{const m=d.sortKeyFieldNames[f-1];i[p]=o[m]}})}else i[r]=o}),i}function En(e,t,n={}){const s=t(e);return{authMode:n.authMode||s.authMode,authToken:n.authToken||s.authToken}}function Sn(e,t,n){let s=t(e).headers||{};return n&&(s=n),s}function Hi(e){if(e?.errors)return{...e,data:[]};throw e}function Bs(e){if(e.errors)return{...e,data:null};throw e}const Pr=Symbol("INTERNAL_USER_AGENT_OVERRIDE");var De;(function(e){e.CreateConversation="1",e.GetConversation="2",e.ListConversations="3",e.DeleteConversation="4",e.SendMessage="5",e.ListMessages="6",e.OnStreamEvent="7",e.Generation="8",e.UpdateConversation="9"})(De||(De={}));const ut=e=>({category:"ai",action:e});function di(e){return e?{[Pr]:e}:void 0}const Sg=e=>typeof e?.token?.value=="symbol";function hi(e,t,n,s,i,r,o){const a=s.arguments!==void 0;return(...u)=>{const l=u[u.length-1];let d,h;if(i)if(Sg(u[0]))d=u[0];else throw new Error(`Invalid first argument passed to ${s.name}. Expected contextSpec`);return a&&(i?h=u[1]:h=u[0]),n==="subscription"?bg(e,t,s,r,h,l,o):Tg(e,t,n,s,r,h,l,d,o)}}function Ht(e,t){return typeof e[t]=="string"}function wg(e){return e instanceof Object&&"enum"in e}function Ig(e){return e instanceof Object&&"input"in e}function vg({type:e,isRequired:t}){const n=t?"!":"";return wg(e)?`${e.enum}${n}`:Ig(e)?`${e.input}${n}`:`${e}${n}`}function yu(e){if(e.arguments===void 0)return"";const t=Object.entries(e.arguments).map(([n,s])=>{const i=vg(s),r=s.isArray?`[${i}]${s.isArrayNullable?"":"!"}`:i;return`$${n}: ${r}`}).join(", ");return t.length>0?`(${t})`:""}function gu(e){if(e.arguments===void 0)return"";const t=Object.keys(e.arguments).map(n=>`${n}: $${n}`).join(", ");return t.length>0?`(${t})`:""}function Eu(e,t){if(Ht(t,"type")||Ht(t.type,"enum"))return"";if(Ht(t.type,"nonModel")){const n=e.nonModels[t.type.nonModel];return`{${js(ci(n,e))}}`}else return Ht(t.type,"model")?`{${mu(e,t.type.model)}}`:""}function Su(e,t={}){const n={};if(e.arguments===void 0)return n;for(const s of Object.values(e.arguments))if(typeof t[s.name]<"u")n[s.name]=t[s.name];else if(s.isRequired)throw new Error(`${e.name} requires arguments '${s.name}'`);return n}function Tg(e,t,n,s,i,r,o,a,c){return dt(async u=>{const{name:l}=s,d=En(e,i,o),h=Sn(e,i,o?.headers),p=yu(s),f=gu(s),m=Eu(t,s),y=Ht(s.type,"model")?s.type.model:void 0,g=`
    ${n.toLocaleLowerCase()}${p} {
      ${l}${f} ${m}
    }
  `,E=Su(s,r),v=di(c);try{const S=a?e.graphql(a,{...d,query:g,variables:E},h):e.graphql({...d,query:g,variables:E,...v},h),I=ht(S,u),{data:T,extensions:O}=await I;if(T){const[b]=Object.keys(T),x=Array.isArray(T[b]),U=x?T[b].filter(P=>P):T[b],M=y?it(e,y,x?U:[U],t,d.authMode,d.authToken,!!a):U;return{data:!x&&Array.isArray(M)?M.shift():M,extensions:O}}else return{data:null,extensions:O}}catch(S){const{data:I,errors:T}=S;if(I&&Object.keys(I).length!==0&&T){const[O]=Object.keys(I),b=Array.isArray(I[O]),x=b?I[O].filter(U=>U):I[O];if(x){const U=y?it(e,y,b?x:[x],t,d.authMode,d.authToken,!!a):x;return{data:!b&&Array.isArray(U)?U.shift():U,errors:T}}else return Bs(S)}else return Bs(S)}})}function bg(e,t,n,s,i,r,o){const a="subscription",{name:c}=n,u=En(e,s,r),l=Sn(e,s,r?.headers),d=yu(n),h=gu(n),p=Eu(t,n),f=Ht(n.type,"model")?n.type.model:void 0,m=`
    ${a.toLocaleLowerCase()}${d} {
      ${c}${h} ${p}
    }
  `,y=Su(n,i),g=di(o);return e.graphql({...u,query:m,variables:y,...g},l).pipe(Ys(v=>{const[S]=Object.keys(v.data),I=v.data[S],[T]=f?it(e,f,[I],t,u.authMode,u.authToken):[I];return T}))}const Ag={queries:"query",mutations:"mutation",subscriptions:"subscription"};function Or(e,t,n,s){if(!t)return{};const i=t.modelIntrospection;if(!i)return{};const r=i[n];if(!r)return{};const o={},a=s(e).amplify===null;for(const c of Object.values(r))o[c.name]=hi(e,i,Ag[n],c,a,s);return o}function Ng(e,t,n){return Or(e,t,"mutations",n)}function Cg(e,t,n){return Or(e,t,"queries",n)}function Pg(e,t,n){return Or(e,t,"subscriptions",n)}function ns(e,t,n,s,i,r=!1,o){return r?(u,l,d)=>Ca(e,t,n,l,d,s,i,u,o):(u,l)=>Ca(e,t,n,u,l,s,i,void 0,o)}function Ca(e,t,n,s,i,r,o,a,c){return dt(async u=>{const{name:l}=n,d=ui(t,n,r,i),h=li(n,r,s,t),p=En(e,o,i),f=Sn(e,o,i?.headers),m=di(c);try{const y=a?e.graphql(a,{...p,query:d,variables:h},f):e.graphql({...p,query:d,variables:h,...m},f),g=ht(y,u),{data:E,extensions:v}=await g;if(E){const[S]=Object.keys(E),I=st(t,l,E[S]);if(I===null)return{data:null,extensions:v};if(i?.selectionSet)return{data:I,extensions:v};{const[T]=it(e,l,[I],t,p.authMode,p.authToken,!!a);return{data:T,extensions:v}}}else return{data:null,extensions:v}}catch(y){const{data:g,errors:E}=y;if(g&&Object.keys(g).length!==0&&E){const[v]=Object.keys(g),S=st(t,l,g[v]);if(S){if(i?.selectionSet)return{data:S,errors:E};{const[I]=it(e,l,[S],t,p.authMode,p.authToken,!!a);return{data:I,errors:E}}}else return Bs(y)}else return Bs(y)}})}function xr(e,t,n,s,i=!1,r){return i?(c,u)=>Pa(e,t,n,s,u,c,r):c=>Pa(e,t,n,s,c,void 0,r)}function Pa(e,t,n,s,i,r,o){return dt(async a=>{const{name:c}=n,u=ui(t,n,"LIST",i),l=li(n,"LIST",i,t),d=En(e,s,i),h=Sn(e,s,i?.headers),p=di(o);try{const f=r?e.graphql(r,{...d,query:u,variables:l},h):e.graphql({...d,query:u,variables:l,...p},h),m=ht(f,a),{data:y,extensions:g}=await m;if(y!==void 0){const[E]=Object.keys(y);if(y[E].items){const v=y[E].items.map(S=>st(t,c,S));return i?.selectionSet?{data:v,nextToken:y[E].nextToken,extensions:g}:{data:it(e,c,v,t,d.authMode,d.authToken,!!r),nextToken:y[E].nextToken,extensions:g}}return{data:y[E],nextToken:y[E].nextToken,extensions:g}}}catch(f){const{data:m,errors:y}=f;if(m!=null&&Object.keys(m).length!==0&&y){const[g]=Object.keys(m);if(m[g]?.items){const E=m[g].items.map(v=>st(t,c,v));return E?i?.selectionSet?{data:E,nextToken:m[g]?.nextToken,errors:y}:{data:it(e,c,E,t,d.authMode,d.authToken,!!r),nextToken:m[g]?.nextToken,errors:y}:{data:m[g],nextToken:m[g]?.nextToken,errors:y}}else return Hi(f)}else return Hi(f)}})}const Og=e=>e.map(t=>t.image?wu(t):t.document?xg(t):t.toolUse?Rg(t):t.toolResult?kg(t):Iu(t)),wu=({image:e})=>({image:{...e,source:{...e.source,bytes:Za(e.source.bytes)}}}),xg=({document:e})=>({document:{...e,source:{...e.source,bytes:Za(e.source.bytes)}}}),_g=({json:e})=>({json:JSON.parse(e)}),Rg=({toolUse:e})=>({toolUse:{...e,input:JSON.parse(e.input)}}),kg=({toolResult:e})=>({toolResult:{toolUseId:e.toolUseId,content:e.content.map(t=>t.image?wu(t):t.json?_g(t):Iu(t))}}),Iu=e=>Object.fromEntries(Object.entries(e).filter(([t,n])=>n!==null)),vu=({content:e,createdAt:t,id:n,conversationId:s,role:i})=>({content:Og(e??[]),conversationId:s,createdAt:t,id:n,role:i}),Mg=(e,t,n,s,i)=>async r=>{const o=xr(e,t,s,i,!1,ut(De.ListMessages)),{data:a,nextToken:c,errors:u}=await o({...r,filter:{conversationId:{eq:n}}});return{data:a.map(l=>vu(l)),nextToken:c,errors:u}},Dg=({id:e,conversationId:t,associatedUserMessageId:n,contentBlockIndex:s,contentBlockDoneAtIndex:i,contentBlockDeltaIndex:r,contentBlockText:o,contentBlockToolUse:a,stopReason:c,errors:u})=>u?{error:{id:e,conversationId:t,associatedUserMessageId:n,errors:u}}:{next:Ug({id:e,conversationId:t,associatedUserMessageId:n,contentBlockIndex:s,contentBlockDoneAtIndex:i,contentBlockDeltaIndex:r,text:o,toolUse:Fg(a),stopReason:c})},Fg=e=>{if(e)return{...e,input:JSON.parse(e.input)}},Ug=e=>Object.fromEntries(Object.entries(e).filter(([t,n])=>n!==null)),Lg=(e,t,n,s,i)=>r=>{const{conversations:o}=t;if(!o)return{};const a=o[s].message.subscribe;return hi(e,t,"subscription",a,!1,i,ut(De.OnStreamEvent))({conversationId:n}).subscribe(u=>{const{next:l,error:d}=Dg(u);d&&r.error(d),l&&r.next(l)})},$g=e=>JSON.stringify(e),Kg=e=>e.map(t=>t.image?Tu(t):t.document?Bg(t):t.toolResult?Vg(t):t),jg=({tools:e})=>({tools:Object.entries(e).map(([t,n])=>({toolSpec:{name:t,description:n.description,inputSchema:{json:JSON.stringify(n.inputSchema.json)}}}))}),Tu=({image:e})=>({image:{...e,source:{...e.source,bytes:ec(e.source.bytes)}}}),Bg=({document:e})=>({document:{...e,source:{...e.source,bytes:ec(e.source.bytes)}}}),qg=({json:e})=>({json:JSON.stringify(e)}),Vg=({toolResult:e})=>({toolResult:{...e,content:e.content.map(t=>t.image?Tu(t):t.json?qg(t):t)}}),Wg=(e,t,n,s,i)=>async r=>{const{conversations:o}=t;if(!o)return{};const a=typeof r=="string"?{content:[{text:r}]}:r,{content:c,aiContext:u,toolConfiguration:l}=a,d=o[s].message.send,h=hi(e,t,"mutation",d,!1,i,ut(De.SendMessage)),{data:p,errors:f}=await h({conversationId:n,content:Kg(c),...u&&{aiContext:$g(u)},...l&&{toolConfiguration:jg(l)}});return{data:p&&vu(p),errors:f}},ss=(e,t,n,s,i,r,o,a,c,u)=>{if(!n)throw new Error(`An error occurred converting a ${r} conversation: Missing ID`);return{id:n,createdAt:s,updatedAt:i,metadata:c,name:u,onStreamEvent:Lg(e,t,n,r,a),sendMessage:Wg(e,t,n,r,a),listMessages:Mg(e,t,n,o,a)}},zg=(e,t,n,s,i,r)=>async o=>{const{name:a,metadata:c}=o??{},u=JSON.stringify(c),l=ns(e,t,s,"CREATE",r,!1,ut(De.CreateConversation)),{data:d,errors:h}=await l({name:a,metadata:u});return{data:ss(e,t,d?.id,d?.createdAt,d?.updatedAt,n,i,r,d?.metadata,d?.name),errors:h}},Hg=(e,t,n,s,i,r)=>async({id:o})=>{const a=ns(e,t,s,"GET",r,!1,ut(De.GetConversation)),{data:c,errors:u}=await a({id:o});return{data:c&&ss(e,t,c.id,c.createdAt,c.updatedAt,n,i,r,c?.metadata,c?.name),errors:u}},Gg=(e,t,n,s,i,r)=>async o=>{const a=xr(e,t,s,r,!1,ut(De.ListConversations)),{data:c,nextToken:u,errors:l}=await a(o);return{data:c.map(d=>ss(e,t,d.id,d.createdAt,d.updatedAt,n,i,r,d?.metadata,d?.name)),nextToken:u,errors:l}},Qg=(e,t,n,s,i,r)=>async({id:o})=>{const a=ns(e,t,s,"DELETE",r,!1,ut(De.DeleteConversation)),{data:c,errors:u}=await a({id:o});return{data:c&&ss(e,t,c?.id,c?.createdAt,c?.updatedAt,n,i,r,c?.metadata,c?.name),errors:u}},Yg=(e,t,n,s,i,r)=>async({id:o,metadata:a,name:c})=>{const u=JSON.stringify(a),l=ns(e,t,s,"UPDATE",r,!1,ut(De.UpdateConversation)),{data:d,errors:h}=await l({id:o,metadata:u,name:c});return{data:d&&ss(e,t,d?.id,d?.createdAt,d?.updatedAt,n,i,r,d?.metadata,d?.name),errors:h}};function Jg(e,t,n){const s=t?.modelIntrospection;if(!s?.conversations)return{};const i={};for(const{name:r,conversation:o,message:a,models:c,nonModels:u,enums:l}of Object.values(s.conversations)){const d=c[o.modelName],h=c[a.modelName];if(!d||!h)return{};const p={...s,models:{...s.models,...c},nonModels:{...s.nonModels,...u},enums:{...s.enums,...l}};i[r]={update:Yg(e,p,r,d,h,n),create:zg(e,p,r,d,h,n),get:Hg(e,p,r,d,h,n),delete:Qg(e,p,r,d,h,n),list:Gg(e,p,r,d,h,n)}}return i}function Xg(e,t,n){const s=t?.modelIntrospection;if(!s?.generations)return{};const i={};for(const r of Object.values(s.generations))i[r.name]=hi(e,s,"query",r,!1,n,ut(De.Generation));return i}const Zg=e=>{const t=e.modelIntrospection;if(!t)return{};const n={};for(const[s,i]of Object.entries(t.enums))n[i.name]={values:()=>i.values};return n};function eE(e,t,n,s,i,r=!1){return r?(c,u,l)=>Oa(e,t,n,s,i,{...u,...l},c):(c,u)=>Oa(e,t,n,s,i,{...c,...u})}function tE(e,t,n,s,i){const{data:r,extensions:o}=n,[a]=Object.keys(r);if(r[a].items){const c=r[a].items.map(u=>st(e,t,u));return{data:s?c:i(c),nextToken:r[a].nextToken,extensions:o}}return{data:r[a],nextToken:r[a].nextToken,extensions:o}}function Oa(e,t,n,s,i,r,o){return dt(async a=>{const{name:c}=n,u=ui(t,n,"INDEX_QUERY",r,s),l=li(n,"INDEX_QUERY",r,t,s),d=En(e,i,r),h=p=>it(e,c,p,t,d.authMode,d.authToken,!!o);try{const p=Sn(e,i,r?.headers),m=[{...d,query:u,variables:l},p];o!==void 0&&m.unshift(o);const y=e.graphql(...m),E=await ht(y,a);if(E.data!==void 0)return tE(t,c,E,r?.selectionSet,h)}catch(p){const{data:f,errors:m}=p;if(f!=null&&Object.keys(f).length!==0&&m){const[y]=Object.keys(f);if(f[y]?.items){const g=f[y]?.items.map(E=>st(t,c,E));if(g)return{data:r?.selectionSet?g:h(g),nextToken:f[y]?.nextToken}}return{data:f[y],nextToken:f[y]?.nextToken}}else return Hi(p)}})}function nE(e,t,n,s,i){const{name:r}=n;return a=>{const c=ui(t,n,s,a),u=li(n,s,a,t),l=En(e,i,a),d=Sn(e,i,a?.headers);return e.graphql({...l,query:c,variables:u},d).pipe(Ys(p=>{const[f]=Object.keys(p.data),m=p.data[f],y=st(t,r,m);if(y===null)return null;if(a?.selectionSet)return y;{const[g]=it(e,r,[y],t,l.authMode,l.authToken);return g}}))}}function sE(e){const{primaryKeyFieldName:t,sortKeyFieldNames:n}=e.primaryKeyInfo;return[t,...n]}function iE(e,t,n){const s=Object.fromEntries(n.map(i=>[i,e[i]]));for(let i=0;i<t.length;i++)if(Object.keys(s).every(r=>s[r]===t[i][r]))return i;return-1}function rE(e,t){const{name:n}=t;return i=>new me(r=>{const o=[],a=[];let c=(...f)=>a.push(...f);const u=e[n].onCreate(i).subscribe({next(f){c({item:f,type:"create"})},error(f){r.error({type:"onCreate",error:f})}}),l=e[n].onUpdate(i).subscribe({next(f){c({item:f,type:"update"})},error(f){r.error({type:"onUpdate",error:f})}}),d=e[n].onDelete(i).subscribe({next(f){c({item:f,type:"delete"})},error(f){r.error({type:"onDelete",error:f})}});function h(f){for(const m of f){const y=iE(m.item,o,p);switch(m.type){case"create":y<0&&o.push(m.item);break;case"update":y>=0&&(o[y]=m.item);break;case"delete":y>=0&&o.splice(y,1);break;default:console.error("Unrecognized message in observeQuery.",m)}}r.next({items:o,isSynced:!0})}const p=sE(t);return(async()=>{let f=!0,m=null;for(;!r.closed&&(f||m);){f=!1;const{data:y,errors:g,nextToken:E}=await e[n].list({...i,nextToken:m});m=E,o.push(...y);const v=a.length===0&&m==null;if(r.next({items:o,isSynced:v}),Array.isArray(g))for(const S of g)r.error(S)}a.length>0&&h(a),c=(...y)=>(h(y),o.length)})(),()=>{u.unsubscribe(),l.unsubscribe(),d.unsubscribe()}})}const oE=e=>e.type==="key"&&e.properties?.name&&e.properties?.queryField&&e.properties?.fields.length>0,aE=e=>e.attributes?.filter(oE).map(n=>{const s=n.properties.queryField,[i,...r]=n.properties.fields;return{queryField:s,pk:i,sk:r}})||[],cE=(e,t)=>{const n=e.models[t].attributes?.find(a=>a.type==="model"),s={queries:["list","get","observeQuery"],mutations:["create","update","delete"],subscriptions:["onCreate","onUpdate","onDelete"]},i=[];if(!n)return Wi;if(n.properties)for(const[a,c]of Object.entries(n.properties))a in s&&(c===null?i.push(...s[a]):c instanceof Object&&i.push(...Object.keys(c)));i.includes("list")&&i.push("observeQuery");const r=i.map(a=>a.toUpperCase());return Object.fromEntries(Object.entries(Wi).filter(([a])=>!r.includes(a)))};function uE(e,t,n){const s={},i=t.modelIntrospection;if(!i)return{};const r=["ONCREATE","ONUPDATE","ONDELETE"];for(const o of Object.values(i.models)){const{name:a}=o;s[a]={};const c=cE(i,a);Object.entries(c).forEach(([l,{operationPrefix:d}])=>{const h=l;h==="LIST"?s[a][d]=xr(e,i,o,n):r.includes(h)?s[a][d]=nE(e,i,o,h,n):h==="OBSERVEQUERY"?s[a][d]=rE(s,o):s[a][d]=ns(e,i,o,h,n)});const u=aE(o);for(const l of u)s[a][l.queryField]=eE(e,i,o,l,n)}return s}function bu(e,t,n){return pg(e),e.models=uE(e,t,n),e.enums=Zg(t),e.queries=Cg(e,t,n),e.mutations=Ng(e,t,n),e.subscriptions=Pg(e,t,n),e.conversations=Jg(e,t,n),e.generations=Xg(e,t,n),e}function lE(e){return Pr in e}class dE extends pu{getModuleName(){return"GraphQLAPI"}graphql(t,n,s){const i={category:St.API,action:Ms.GraphQl};if(lE(n)){const{[Pr]:r,...o}=n;return super.graphql(t,o,s,{...i,...r})}return super.graphql(t,n,s,{...i})}isCancelError(t){return super.isCancelError(t)}cancel(t,n){return super.cancel(t,n)}}const _r=new dE;function hE(e,t){const n=Cr(this),s=n.endpoint,i=n.authMode,r=n.apiKey;if(e.authMode=e.authMode||i,e.apiKey=e.apiKey??r,e.authToken=e.authToken||n.authToken,s&&e.authMode==="apiKey"&&!e.apiKey)throw new Error("graphql() requires an explicit `apiKey` for a custom `endpoint` when `authMode = 'apiKey'`.");const o=t||n.headers;return _r.graphql(n.amplify,{...e,endpoint:s},o)}function pE(e,t){return _r.cancel(e,t)}function fE(e){return _r.isCancelError(e)}function Au(e){return e!==void 0}function mE(e){return e.event==="configure"}function yE(e){const t={[lu]:e.amplify,[Os]:e.authMode,[du]:e.authToken,[Vi]:"apiKey"in e?e.apiKey:void 0,[xs]:"endpoint"in e?e.endpoint:void 0,[hu]:e.headers,graphql:hE,cancel:pE,isCancelError:fE,models:Nn,enums:Nn,queries:Nn,mutations:Nn,subscriptions:Nn},n=e.amplify.getConfig().API?.GraphQL;if(t[xs]){if(!t[Os])throw new Error("generateClient() requires an explicit `authMode` when `endpoint` is provided.");if(t[Os]==="apiKey"&&!t[Vi])throw new Error("generateClient() requires an explicit `apiKey` when `endpoint` is provided and `authMode = 'apiKey'`.")}return t[xs]||(Au(n)?bu(t,n,Cr):gE(t)),t}const gE=e=>{ye.listen("core",t=>{if(!mE(t.payload))return;const n=t.payload.data.API?.GraphQL;Au(n)&&bu(e,n,Cr)})},Nn=new Proxy({},{get(){throw new Error("Client could not be generated. This is likely due to `Amplify.configure()` not being called prior to `generateClient()` or because the configuration passed to `Amplify.configure()` is missing GraphQL provider configuration.")}});function aw(e){return yE({amplify:W})}function Nu(e){return e&&e.pluralName!==void 0}function Gi(e){return Nu(e)&&e.attributes!==void 0}function Rr(e){return e?.targetName||e?.targetNames}function xa(e,t){return e?.fields[t]?.association?.connectionType}function pi(e){return e.type==="key"&&e.properties&&e.properties.fields&&e.properties.fields.length>0}function fi(e){return pi(e)&&e.properties.name===void 0}function EE(e){return pi(e)&&e.properties.name!==void 0&&e.properties.fields.length>2}var Te;(function(e){e.CUSTOM="custom",e.OWNER="owner",e.GROUPS="groups",e.PRIVATE="private",e.PUBLIC="public"})(Te||(Te={}));var ce;(function(e){e.FUNCTION="function",e.USER_POOLS="userPools",e.OIDC="oidc",e.IAM="iam",e.API_KEY="apiKey"})(ce||(ce={}));var Ft;(function(e){e[e.ID=0]="ID",e[e.String=1]="String",e[e.Int=2]="Int",e[e.Float=3]="Float",e[e.Boolean=4]="Boolean",e[e.AWSDate=5]="AWSDate",e[e.AWSTime=6]="AWSTime",e[e.AWSDateTime=7]="AWSDateTime",e[e.AWSTimestamp=8]="AWSTimestamp",e[e.AWSEmail=9]="AWSEmail",e[e.AWSJSON=10]="AWSJSON",e[e.AWSURL=11]="AWSURL",e[e.AWSPhone=12]="AWSPhone",e[e.AWSIPAddress=13]="AWSIPAddress"})(Ft||(Ft={}));(function(e){function t(s){switch(s){case"Boolean":return"boolean";case"ID":case"String":case"AWSDate":case"AWSTime":case"AWSDateTime":case"AWSEmail":case"AWSURL":case"AWSPhone":case"AWSIPAddress":return"string";case"Int":case"Float":case"AWSTimestamp":return"number";case"AWSJSON":return"object";default:throw new Error("Invalid scalar type")}}e.getJSType=t;function n(s){switch(s){case"AWSDate":return UE;case"AWSTime":return LE;case"AWSDateTime":return $E;case"AWSTimestamp":return KE;case"AWSEmail":return jE;case"AWSJSON":return BE;case"AWSURL":return qE;case"AWSPhone":return VE;case"AWSIPAddress":return WE;default:return}}e.getValidationFunction=n})(Ft||(Ft={}));function Cu(e){return e&&Ft[e]!==void 0}function Pu(e){return!!(e&&e["model"])}function qs(e){return!!(e&&e["nonModel"])}function SE(e){return!!(e&&e["enum"])}function ps(e,t){const n=te(t);return typeof e=="object"&&e&&n.every(s=>e[s]!==void 0)}var q;(function(e){e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(q||(q={}));function on(e){return e&&e.field!==void 0}function Gn(e){return e&&e.type!==void 0}var rt;(function(e){e[e.FIRST=0]="FIRST",e[e.LAST=1]="LAST"})(rt||(rt={}));var Qi;(function(e){e.ASCENDING="ASCENDING",e.DESCENDING="DESCENDING"})(Qi||(Qi={}));var Ln;(function(e){e.DEFAULT="DEFAULT",e.MULTI_AUTH="MULTI_AUTH"})(Ln||(Ln={}));var Yi;(function(e){e.CREATE="CREATE",e.READ="READ",e.UPDATE="UPDATE",e.DELETE="DELETE"})(Yi||(Yi={}));var mt;(function(e){e.sync="sync",e.mutate="mutate",e.subscribe="subscribe"})(mt||(mt={}));const _a=Symbol("DISCARD");var Vs;(function(e){e.LIMIT="LIMIT",e.TIMER="TIMER"})(Vs||(Vs={}));class wE{constructor(){this.__isPredicateInternalsKeySentinel=!0}}class _e{static createPredicateBuilder(t){const{name:n}=t,s=new Set(Object.keys(t.fields)),i=new Proxy({},{get(r,o,a){const c=o;if(!s.has(c))throw new Error(`Invalid field for model. field: ${String(c)}, model: ${n}`);return l=>(_e.sortPredicateGroupsMap.get(a)?.push({field:c,sortDirection:l}),a)}});return _e.sortPredicateGroupsMap.set(i,[]),i}static isValidPredicate(t){return _e.sortPredicateGroupsMap.has(t)}static getPredicates(t,n=!0){if(n&&!_e.isValidPredicate(t))throw new Error("The predicate is not valid");const s=_e.sortPredicateGroupsMap.get(t);if(s)return s;throw new Error("Predicate group not found")}static createFromExisting(t,n){if(!(!n||!t))return n(_e.createPredicateBuilder(t))}}_e.sortPredicateGroupsMap=new WeakMap;const IE=new WeakSet;function Ai(e){return IE.has(e)}const vE=new Set(["and","or","not"]),TE=e=>{const t=[...Object.keys(e)];return t.length===1&&vE.has(t[0])},bE=e=>!Array.isArray(e)&&Object.keys(e).length===0,Ou=new Set(["eq","ne","gt","lt","ge","le","contains","notContains","beginsWith","between"]),AE=e=>{const t=[...Object.keys(e)];return!Array.isArray(e)&&t.length===1&&Ou.has(t[0])},xu=e=>Array.isArray(e)?e.every(t=>xu(t)):Object.keys(e).length<=1;class ${static isValidPredicate(t){return $.predicateGroupsMap.has(t)}static getPredicates(t,n=!0){if(n&&!$.isValidPredicate(t))throw new Error("The predicate is not valid");return $.predicateGroupsMap.get(t)}static createForPk(t,n){const s=te(t),i=Du(n,s);return this.createFromAST(t,{and:s.map((o,a)=>{const c=i[a];return{[o]:{eq:c}}})})}static createFromFlatEqualities(t,n){const s={and:Object.entries(n).map(([i,r])=>({[i]:{eq:r}}))};return this.createFromAST(t,s)}static transformGraphQLFilterNodeToPredicateAST(t){if(!xu(t))throw new Error("Invalid GraphQL Condition or subtree: "+JSON.stringify(t));if(bE(t))return{type:"and",predicates:[]};if(TE(t)){const n=Object.keys(t)[0],s=this.transformGraphQLFilterNodeToPredicateAST(t[n]);return{type:n,predicates:Array.isArray(s)?s:[s]}}else if(AE(t)){const n=Object.keys(t)[0];return{operator:n,operand:t[n]}}else{if(Array.isArray(t))return t.map(n=>this.transformGraphQLFilterNodeToPredicateAST(n));{const n=Object.keys(t)[0];return{field:n,...this.transformGraphQLFilterNodeToPredicateAST(t[n])}}}}static createFromAST(t,n){const s={};return $.predicateGroupsMap.set(s,this.transformGraphQLFilterNodeToPredicateAST(n)),s}}$.predicateGroupsMap=new WeakMap;const is="id",pt="#",_u="-",$n={idEmptyString:"An index field cannot contain an empty string value",queryByPkWithCompositeKeyPresent:"Models with composite primary keys cannot be queried by a single key value. Use object literal syntax for composite keys instead: https://docs.amplify.aws/lib/datastore/advanced-workflows/q/platform/js/#querying-records-with-custom-primary-keys",deleteByPkWithCompositeKeyPresent:"Models with composite primary keys cannot be deleted by a single key value, unless using a predicate. Use object literal syntax for composite keys instead: https://docs.amplify.aws/lib/datastore/advanced-workflows/q/platform/js/#querying-records-with-custom-primary-keys",observeWithObjectLiteral:"Object literal syntax cannot be used with observe. Use a predicate instead: https://docs.amplify.aws/lib/datastore/data-access/q/platform/js/#predicates"};var an;(function(e){e.DATASTORE="datastore",e.USER="user",e.SYNC="sync",e.STORAGE="storage"})(an||(an={}));const{DATASTORE:kr}=an,{USER:wn}=an,{SYNC:Jt}=an,{STORAGE:Ru}=an,we=e=>typeof e>"u"||e===void 0||e===null,Ut=(e,t,n)=>{let s,i=!1;if(n.length===0)return!0;switch(t){case"not":s="every",i=!0;break;case"and":s="every";break;case"or":s="some";break;default:throw new Error(`Invalid ${t}`)}const r=n[s](o=>{if(on(o)){const{field:a,operator:c,operand:u}=o,l=e[a];return NE(l,c,u)}if(Gn(o)){const{type:a,predicates:c}=o;return Ut(e,a,c)}throw new Error("Not a predicate or group")});return i?!r:r},NE=(e,t,n)=>{switch(t){case"ne":return e!==n;case"eq":return e===n;case"le":return e<=n;case"lt":return e<n;case"ge":return e>=n;case"gt":return e>n;case"between":{const[s,i]=n;return e>=s&&e<=i}case"beginsWith":return!we(e)&&e.startsWith(n);case"contains":return!we(e)&&e.indexOf(n)>-1;case"notContains":return we(e)||e.indexOf(n)===-1;default:return!1}},kt=e=>e&&typeof e.copyOf=="function",CE=new WeakSet;function PE(e){CE.add(e)}const Ni=new WeakMap,Mr=(e,t,n,s,i)=>{const r=i(n.name,e),o=[],a=r.copyOf(t,()=>{});o.unshift({modelName:e,item:a,instance:a}),Ni.has(n)||Ni.set(n,Array.from(n.modelTopologicalOrdering.keys()));const c=Ni.get(n);return o.sort((u,l)=>c.indexOf(u.modelName)-c.indexOf(l.modelName)),o};let fs;const OE=()=>new Promise(e=>{const t=Mt();let n;const s=()=>{fs=!1,e(!0)},i=async()=>{n&&n.result&&typeof n.result.close=="function"&&await n.result.close(),await indexedDB.deleteDatabase(t),fs=!0,e(!1)};if(fs===!0)return i();if(fs===!1){s();return}if(indexedDB===null){s();return}n=indexedDB.open(t),n.onerror=s,n.onsuccess=i});let jt;const xE=async()=>{try{const e=Mt(),t="indexedDBFeatureProbeStore",n="idx";if(indexedDB===null)return!1;if(jt!==void 0)return jt;const s=await new Promise(a=>{const c=indexedDB.open(e);c.onerror=()=>{a(!1)},c.onsuccess=()=>{const u=c.result;a(u)},c.onupgradeneeded=u=>{const l=u?.target?.result;l.onerror=()=>{a(!1)},l.createObjectStore(t,{autoIncrement:!0}).createIndex(n,["id"])}});if(!s)throw new Error("Could not open probe DB");const i=s.transaction(t,"readwrite");i.objectStore(t).add({id:1}),i.commit();const o=await new Promise(a=>{const d=s.transaction(t,"readonly").objectStore(t).index(n).get([1]);d.onerror=()=>{a(!1)},d.onsuccess=h=>{a(h?.target?.result)}});s&&typeof s.close=="function"&&await s.close(),await indexedDB.deleteDatabase(e),o===void 0?jt=!0:jt=!1}catch{jt=!1}return jt},Ji={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();t.length===1&&(t=`0${t}`),Ji[t]=e}const _E=e=>{if(e.length%2!==0)throw new Error("Hex encoded strings must have an even number length");const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2){const s=e.slice(n,n+2).toLowerCase();if(s in Ji)t[n/2]=Ji[s];else throw new Error(`Cannot decode unrecognized sequence ${s} as hexadecimal`)}return t},RE=e=>{const t=new ei().random(e).toString();return _E(t)},kE=()=>RE(1)[0]/255;function ku(e){const t=tl(kE);return()=>t(e)}function Ra(){return typeof performance<"u"&&performance&&typeof performance.now=="function"?performance.now()|0:Date.now()}function Mu(e){return function(n,s){for(const i of e){const{field:r,sortDirection:o}=i,a=o===Qi.ASCENDING?1:-1;if(n[r]<s[r])return-1*a;if(n[r]>s[r])return 1*a}return 0}}function ME(e,t,n=!1){const s=Object.keys(e);for(const i of s){const r=e[i],o=t[i];if(!Ws(r,o,n))return!1}return!0}function Ws(e,t,n=!1){let s=e,i=t;const r=(u,l)=>u==null&&l==null;if(s instanceof Object&&!(i instanceof Object)||!(s instanceof Object)&&i instanceof Object)return!1;if(!(s instanceof Object))return n&&r(s,i)?!0:s===i;if(Array.isArray(s)&&!Array.isArray(i)||Array.isArray(i)&&!Array.isArray(s))return!1;s instanceof Set&&i instanceof Set&&(s=[...s],i=[...i]),s instanceof Map&&i instanceof Map&&(s=Object.fromEntries(s),i=Object.fromEntries(i));const o=Object.keys(s),a=Object.keys(i);if(o.length!==a.length&&(!n||Array.isArray(s)))return!1;const c=o.length>=a.length?o:a;for(const u of c){const l=s[u],d=i[u];if(!Ws(l,d,n))return!1}return!0}function Dr(e,t){if(t&&e.length>1){if(t.sort){const o=_e.getPredicates(t.sort);if(o.length){const a=Mu(o);e.sort(a)}}const{page:n=0,limit:s=0}=t,i=Math.max(0,n*s)||0,r=s>0?i+s:e.length;return e.slice(i,r)}return e}async function DE(e,t){for(const n of e)if(await t(n))return!0;return!1}async function FE(e,t){for(const n of e)if(!await t(n))return!1;return!0}const UE=e=>!!/^\d{4}-\d{2}-\d{2}(Z|[+-]\d{2}:\d{2}($|:\d{2}))?$/.exec(e),LE=e=>!!/^\d{2}:\d{2}(:\d{2}(.\d+)?)?(Z|[+-]\d{2}:\d{2}($|:\d{2}))?$/.exec(e),$E=e=>!!/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}(:\d{2}(.\d+)?)?(Z|[+-]\d{2}:\d{2}($|:\d{2}))?$/.exec(e),KE=e=>!!/^\d+$/.exec(String(e)),jE=e=>!!/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.exec(e),BE=e=>{try{return JSON.parse(e),!0}catch{return!1}},qE=e=>{try{return!!new ke(e)}catch{return!1}},VE=e=>!!/^\+?\d[\d\s-]+$/.exec(e),WE=e=>!!/((^((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))$)|(^((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?$))$/.exec(e);class ka{constructor(){const t=this;this.promise=new Promise((n,s)=>{t.resolve=n,t.reject=s})}}class zE{constructor(t){this.limitPromise=new ka,this.raceInFlight=!1,this.callback=()=>{},this.defaultErrorHandler=(n="DeferredCallbackResolver error")=>{throw new Error(n)},this.callback=t.callback,this.errorHandler=t.errorHandler||this.defaultErrorHandler,this.maxInterval=t.maxInterval||2e3}startTimer(){this.timerPromise=new Promise((t,n)=>{this.timer=setTimeout(()=>{t(Vs.TIMER)},this.maxInterval)})}async racePromises(){let t;try{this.raceInFlight=!0,this.startTimer(),t=await Promise.race([this.timerPromise,this.limitPromise.promise]),this.callback()}catch(n){this.errorHandler(n)}finally{return this.clear(),this.raceInFlight=!1,this.limitPromise=new ka,t}}start(){this.raceInFlight||this.racePromises()}clear(){clearTimeout(this.timer)}resolve(){this.limitPromise.resolve(Vs.LIMIT)}}function HE(e,t,n){const s=t.concat(n);let i;return Dn(e,r=>{nl(r,s)},r=>{i=r}),i}const Pt=(e,t)=>`${e}_${t}`,GE=e=>{const t=({properties:{fields:[,...o]}})=>o,n=e.filter(EE).map(t),s=o=>o.reduce((a,c)=>{const u=new Set(c);if(a.length===0)return a.push(u),a;const l=a.findIndex(d=>[...d].some(h=>u.has(h)));if(l>-1){const d=new Set([...a[l],...u]);a[l]=d}else a.push(u);return a},[]),i=s(n);return s(i)},Fr=e=>e?.attributes?.find(pi),te=e=>{const t=Fr(e);return t&&fi(t)?t.properties.fields:[is]},Du=(e,t)=>t.map(n=>e[n]),QE=(e,t)=>{const n={};return t.forEach(s=>n[s]=e[s]),n},Fu=e=>{const t=Fr(e);return!(t&&fi(t))},YE=e=>{const t=Fr(e);return t&&fi(t)?t.properties.fields[0]===is:!1},Uu=e=>{const t={},n={};return Object.keys(e.models).forEach(s=>{t[s]={indexes:[],relationTypes:[]},n[s]={};const i=e.models[s];if(Object.keys(i.fields).forEach(r=>{const o=i.fields[r];if(typeof o.type=="object"&&"model"in o.type){const{connectionType:a}=o.association;if(t[s].relationTypes.push({fieldName:o.name,modelName:o.type.model,relationType:a,targetName:o.association.targetName,targetNames:o.association.targetNames,associatedWith:o.association.associatedWith}),a==="BELONGS_TO"){const c=Lu(o.association);if(c){const u=Xi(c);t[s].indexes.find(([d])=>d===u)||t[s].indexes.push([u,c])}}}}),i.attributes){n[s].compositeKeys=GE(i.attributes);for(const r of i.attributes){if(!pi(r))continue;const{fields:o}=r.properties;if(fi(r)){n[s].primaryKey=o;continue}const a=Xi(o);t[s].indexes.find(([u])=>u===a)||t[s].indexes.push([a,o])}}n[s].primaryKey||(n[s].primaryKey=[is]),t[s].indexes.push(["byPk",n[s].primaryKey,{unique:!0}])}),[t,n]},Lu=e=>{const t=e?.targetName,n=e?.targetNames;return Array.isArray(n)?n:typeof t=="string"?[t]:void 0},Xi=e=>e.reduce((t,n,s)=>s===0?n:`${t}${_u}${n}`,""),zs=(e,t)=>e.length!==t.length?!1:e.every((n,s)=>n===t[s]),Rs=(e,t)=>{const n=e?.keys?.[t]?.primaryKey;return n||[is]},JE=e=>{const n=e.attributes?.find(r=>r.type==="model")?.properties?.timestamps;return{...{createdAt:"createdAt",updatedAt:"updatedAt"},...n||{}}};class XE{constructor(){this.Cache=Pc,this._graphqlApi=new pu}getModuleName(){return"InternalAPI"}getGraphqlOperationType(t){return this._graphqlApi.getGraphqlOperationType(t)}graphql(t,n,s){const i={category:St.API,action:Ms.GraphQl,...s};return this._graphqlApi.graphql(W,t,n,i)}}const mi=new XE,Ma=()=>[];function Da(e){return e.allow==="private"&&!e.provider?ce.USER_POOLS:e.allow==="public"&&!e.provider?ce.API_KEY:e.provider}function ZE(e){const t=[Te.CUSTOM,Te.OWNER,Te.GROUPS,Te.PRIVATE,Te.PUBLIC],n=[ce.FUNCTION,ce.USER_POOLS,ce.OIDC,ce.IAM,ce.API_KEY];return[...e].sort((s,i)=>s.allow===i.allow?n.indexOf(Da(s))-n.indexOf(Da(i)):t.indexOf(s.allow)-t.indexOf(i.allow))}function eS({rules:e,currentUser:t}){const n=new Set;return e.forEach(s=>{switch(s.allow){case Te.CUSTOM:(!s.provider||s.provider===ce.FUNCTION)&&n.add("lambda");break;case Te.GROUPS:case Te.OWNER:{t&&(s.provider===ce.USER_POOLS?n.add("userPool"):s.provider===ce.OIDC&&n.add("oidc"));break}case Te.PRIVATE:{t&&(!s.provider||s.provider===ce.USER_POOLS?n.add("userPool"):s.provider===ce.IAM&&n.add("iam"));break}case Te.PUBLIC:{s.provider===ce.IAM?n.add("iam"):(!s.provider||s.provider===ce.API_KEY)&&n.add("apiKey");break}}}),Array.from(n)}const tS=()=>async({schema:e,modelName:t})=>{let n;try{const i=await Zt();i.tokens.accessToken&&(n=i)}catch{}const{attributes:s}=e.namespaces.user.models[t];if(s){const i=s.find(r=>r.type==="auth");if(i?.properties?.rules){const r=ZE(i.properties.rules);return eS({currentUser:n,rules:r})}}return[]},nS=new j("DataStore"),sS={LIST:"query",CREATE:"mutation",UPDATE:"mutation",DELETE:"mutation",GET:"query"};var K;(function(e){e.CREATE="Create",e.UPDATE="Update",e.DELETE="Delete",e.GET="Get"})(K||(K={}));const iS={_version:void 0,_lastChangedAt:void 0,_deleted:void 0},rS=Object.keys(iS);function oS(){return rS}function Ur(e,t){const n=$u(t),s=lS(e,t),i=aS(t,n);let r=Object.values(n).map(({name:a})=>a).concat(i).concat(s);return Nu(t)&&(r=r.concat(oS()).concat(uS(t,e))),r.join(`
`)}function aS(e,t){const n=cS(e);return!t.owner&&n.includes("owner")?["owner"]:[]}function cS(e){const t=[];return Gi(e)&&e.attributes.forEach(n=>{if(n.properties&&n.properties.rules){const s=n.properties.rules.find(i=>i.allow==="owner");s&&s.ownerField&&t.push(s.ownerField)}}),t}function $u(e){const{fields:t}=e;return Object.values(t).filter(s=>!!(Cu(s.type)||SE(s.type))).reduce((s,i)=>(s[i.name]=i,s),{})}function uS(e,t){const n=[];return Object.values(e.fields).filter(({association:s})=>s&&Object.keys(s).length).forEach(({name:s,association:i})=>{const{connectionType:r}=i||{};switch(r){case"HAS_ONE":case"HAS_MANY":break;case"BELONGS_TO":if(Rr(i))if(i.targetNames&&i.targetNames.length>0){const[o]=Uu(t),a=e.fields[s].type.model,c=o[a].indexes.find(([d])=>d==="byPk"),l=(c&&c[1])?.join(" ");n.push(`${s} { ${l} _deleted }`)}else n.push(`${s} { id _deleted }`);break;default:throw new Error(`Invalid connection type ${r}`)}}),n}function lS(e,t){const n=[];return Object.values(t.fields).forEach(({name:s,type:i})=>{if(qs(i)){const r=e.nonModels[i.nonModel],o=Object.values($u(r)).map(({name:c})=>c),a=[];Object.values(r.fields).forEach(c=>{const{type:u,name:l}=c;if(qs(u)){const d=e.nonModels[u.nonModel];a.push(`${l} { ${Ur(e,d)} }`)}}),n.push(`${s} { ${o.join(" ")} ${a.join(" ")} }`)}}),n}function Ku(e){const t=[].concat(e.attributes||[]).find(i=>i&&i.type==="auth"),{properties:{rules:n=[]}={}}=t||{},s=[];return n.forEach(i=>{const{identityClaim:r="cognito:username",ownerField:o="owner",operations:a=["create","update","delete","read"],provider:c="userPools",groupClaim:u="cognito:groups",allow:l="iam",groups:d=[],groupsField:h=""}=i,p=a.includes("read"),f=l==="owner";if(!p&&!f)return;const m={identityClaim:r,ownerField:o,provider:c,groupClaim:u,authStrategy:l,groups:d,groupsField:h,areSubscriptionsPublic:!1};if(f){const y=[].concat(e.attributes||[]).find(E=>E&&E.type==="model"),{properties:{subscriptions:{level:g="on"}={}}={}}=y||{};m.areSubscriptionsPublic=!a.includes("read")||g==="public"}if(f){s.push(m);return}s.unshift(m)}),s}function dS(e,t,n,s,i,r=!1){const o=Ur(e,t),{name:a}=t,c=`on${n}${a}`,u=[],l=[];r&&(u.push(`$filter: ModelSubscription${a}FilterInput`),l.push("filter: $filter")),s&&(u.push(`$${i}: String!`),l.push(`${i}: $${i}`));const d=u.length?`(${u.join(",")})`:"",h=l.length?`(${l.join(",")})`:"";return[n,c,`subscription operation${d}{
			${c}${h}{
				${o}
			}
		}`]}function Mn(e,t,n){let s=Ur(e,t);const{name:i,pluralName:r}=t;let o,a,c,u;switch(n){case"LIST":o=`sync${r}`,a=`($limit: Int, $nextToken: String, $lastSync: AWSTimestamp, $filter: Model${i}FilterInput)`,c="(limit: $limit, nextToken: $nextToken, lastSync: $lastSync, filter: $filter)",s=`items {
							${s}
						}
						nextToken
						startedAt`;break;case"CREATE":o=`create${i}`,a=`($input: Create${i}Input!)`,c="(input: $input)",u=K.CREATE;break;case"UPDATE":o=`update${i}`,a=`($input: Update${i}Input!, $condition: Model${i}ConditionInput)`,c="(input: $input, condition: $condition)",u=K.UPDATE;break;case"DELETE":o=`delete${i}`,a=`($input: Delete${i}Input!, $condition: Model${i}ConditionInput)`,c="(input: $input, condition: $condition)",u=K.DELETE;break;case"GET":o=`get${i}`,a="($id: ID!)",c="(id: $id)",u=K.GET;break;default:throw new Error(`Invalid graphQlOpType ${n}`)}return[[u,o,`${sS[n]} operation${a}{
		${o}${c}{
			${s}
		}
	}`]]}function ju(e,t,n,s,i,r,o,a,c){let u;switch(n){case q.INSERT:u=K.CREATE;break;case q.UPDATE:u=K.UPDATE;break;case q.DELETE:u=K.DELETE;break;default:throw new Error(`Invalid opType ${n}`)}const l=(f,m)=>f&&m!==null&&typeof m=="object"&&t.fields[f]&&t.fields[f].type==="AWSJSON"?JSON.stringify(m):m,d=We(t,i),h=q.INSERT&&c?{id:c}:{};return a(o,{...h,data:JSON.stringify(i,l),modelId:d,model:s.name,operation:u,condition:JSON.stringify(r)})}function hS(e,t){const n={};if(!e||!Array.isArray(e.predicates))return n;const s=te(t);return rs(e,s)}function rs(e,t=[],n=!0){const s={};if(!e||!Array.isArray(e.predicates))return s;const{type:i,predicates:r}=e,o=i==="and"||i==="or";s[i]=o?[]:{};const a=[];if(r.forEach(c=>{if(on(c)){const{field:l,operator:d,operand:h}=c;if(t.includes(l))return;const p={[l]:{[d]:h}};a.push(p);return}const u=rs(c,t,!1);Object.keys(u).length>0&&a.push(u)}),a.length===1){const[c]=a;if(o&&!n||o&&n&&("and"in c||"or"in c))return delete s[i],Object.assign(s,c),s}if(a.forEach(c=>{o?s[i].push(c):s[i]=c}),o){if(s[i].length===0)return{}}else if(Object.keys(s[i]).length===0)return{};return s}function pS(e){const t=new Set;if(!e||!Array.isArray(e.predicates))return t;const{predicates:n}=e,s=[...n];for(;s.length>0;){const i=s.pop();on(i)?t.add(i.field):Gn(i)&&s.push(...i.predicates)}return t}function fS(e){const t=Ku(e),n=new Set;for(const s of t)s.groupsField&&!s.groups.length?n.add(s.groupsField):s.ownerField&&n.add(s.ownerField);return n}function mS(e){if(!e||!Array.isArray(e.predicates))return 0;let t=0;const n=[e];for(;n.length>0;){const s=n.pop();if(Gn(s)){const{predicates:i,type:r}=s;r==="or"&&i.length>1&&(t+=i.length),n.push(...i)}}return t||1}function yS(e){if(!e||!Array.isArray(e.predicates))return null;const n=[rs(e)],s=i=>{const r={};for(const o of i){const[a]=Object.keys(o);if(r[a])return a;r[a]=!0}return null};for(;n.length>0;){const i=n.pop(),[r]=Object.keys(i),o=i[r];if(!Array.isArray(o))return null;const a=o.filter(u=>!Array.isArray(Object.values(u)[0])),c=o.filter(u=>Array.isArray(Object.values(u)[0]));if(r==="and"){const u=s(a);if(u)return u}n.push(...c)}return null}var fe;(function(e){e[e.UnknownField=0]="UnknownField",e[e.MaxAttributes=1]="MaxAttributes",e[e.MaxCombinations=2]="MaxCombinations",e[e.RepeatedFieldname=3]="RepeatedFieldname",e[e.NotGroup=4]="NotGroup",e[e.FieldNotInType=5]="FieldNotInType"})(fe||(fe={}));function gS(e,t,n){const s=pS(n),i=[...s].join(", "),r=fS(t),o=[...r].join(", "),a=mS(n),c=yS(n);switch(e){case fe.UnknownField:return"Your API was generated with an older version of the CLI that doesn't support backend subscription filtering.To enable backend subscription filtering, upgrade your Amplify CLI to the latest version and push your app by running `amplify upgrade` followed by `amplify push`";case fe.MaxAttributes:{let u=`Your selective sync expression for ${t.name} contains ${s.size} different model fields: ${i}.

`;return r.size>0&&(u+=`Note: the number of fields you can use with selective sync is affected by @auth rules configured on the model.

Dynamic auth modes, such as owner auth and dynamic group auth each utilize 1 field.
You currently have ${r.size} dynamic auth mode(s) configured on this model: ${o}.`),u}case fe.MaxCombinations:{let u=`Your selective sync expression for ${t.name} contains ${a} field combinations (total number of predicates in an OR expression).

`;return r.size>0&&(u+=`Note: the number of fields you can use with selective sync is affected by @auth rules configured on the model.

Dynamic auth modes, such as owner auth and dynamic group auth factor in to the number of combinations you're using.
You currently have ${r.size} dynamic auth mode(s) configured on this model: ${o}.`),u}case fe.RepeatedFieldname:return`Your selective sync expression for ${t.name} contains multiple entries for ${c} in the same AND group.`;case fe.NotGroup:return`Your selective sync expression for ${t.name} uses a \`not\` group. If you'd like to filter subscriptions in the backend, rewrite your expression using \`ne\` or \`notContains\` operators.`;case fe.FieldNotInType:return""}}function ES(e,t){let n=e[t.groupClaim]||[];if(typeof n=="string"){let s;try{s=JSON.parse(n)}catch{s=n}n=[].concat(s)}return n}async function Lr({authModeStrategy:e,defaultAuthMode:t,modelName:n,schema:s}){const i=Object.values(Yi),r={CREATE:[],READ:[],UPDATE:[],DELETE:[]};try{await Promise.all(i.map(async o=>{const a=await e({schema:s,modelName:n,operation:o});typeof a=="string"?r[o]=[a]:Array.isArray(a)&&a.length?r[o]=a:r[o]=[t]}))}catch(o){nS.debug(`Error getting auth modes for model: ${n}`,o)}return r}function Fa(e){const t=[401,403];let n;return e&&e.errors?n=e.errors.find(s=>t.includes(Qn(s))):e&&e.message&&(n=e),n?n.message??`Request failed with status code ${Qn(n)}`:null}function Qn(e){return e?.$metadata?.httpStatusCode?Number(e?.$metadata?.httpStatusCode):e?.originalError?Qn(e?.originalError):null}function Ua(e){const t=Object.values(It);return e&&e.message&&t.find(s=>e.message.includes(s))||null}async function Hs(e,t={}){if(e==="lambda"){const{authProviders:{functionAuthProvider:n}={functionAuthProvider:null}}=t;if(n&&typeof n=="function")try{const{token:s}=await n();return s}catch(s){throw new Error(`Error retrieving token from \`functionAuthProvider\`: ${s}`)}else throw new Error("You must provide a `functionAuthProvider` function to `DataStore.configure` when using lambda")}}function We(e,t){return te(e).map(i=>t[i]).join(_u)}class In{constructor(t,n){if(!xa(t.schema,n))throw new Error(`${t.schema.name}.${n} is not a relationship.`);this.localModel=t,this._field=n}static from(t,n){return xa(t.schema,n)?new this(t,n):null}static allFrom(t){const n=[];for(const s of Object.keys(t.schema.fields)){const i=In.from(t,s);i&&n.push(i)}return n}get localDefinition(){return this.localModel.schema}get field(){return this._field}get localConstructor(){return this.localModel.builder}get type(){return this.localAssocation.connectionType}get localAssocation(){return this.localDefinition.fields[this.field].association}get localJoinFields(){return this.localAssocation.targetName?[this.localAssocation.targetName]:this.localAssocation.targetNames?this.localAssocation.targetNames:this.localPKFields}get localPKFields(){return this.localModel.pkField}get remoteDefinition(){return this.remoteModelType.modelConstructor?.schema}get remoteModelType(){return this.localDefinition.fields[this.field].type}get remoteModelConstructor(){return this.remoteModelType.modelConstructor.builder}get remotePKFields(){return this.remoteModelType.modelConstructor?.pkField||["id"]}get localAssociatedWith(){if(this.localAssocation.connectionType==="HAS_MANY"||this.localAssocation.connectionType==="HAS_ONE")return Array.isArray(this.localAssocation.associatedWith)?this.localAssocation.associatedWith:[this.localAssocation.associatedWith]}get explicitRemoteAssociation(){if(this.localAssociatedWith)return this.localAssociatedWith.length===1?this.remoteDefinition.fields[this.localAssociatedWith[0]]?.association:void 0}get remoteJoinFields(){return this.explicitRemoteAssociation?.targetName?[this.explicitRemoteAssociation.targetName]:this.explicitRemoteAssociation?.targetNames?this.explicitRemoteAssociation?.targetNames:this.localAssociatedWith?this.localAssociatedWith:this.remotePKFields}get isComplete(){return this.localJoinFields.length>0&&this.remoteJoinFields.length>0}createLocalFKObject(t){const n={};for(let s=0;s<this.localJoinFields.length;s++)n[this.localJoinFields[s]]=t[this.remoteJoinFields[s]];return n}createRemoteQueryObject(t){const n={};for(let s=0;s<this.remoteJoinFields.length;s++){const i=t[this.localJoinFields[s]];if(i==null)return null;n[this.remoteJoinFields[s]]=t[this.localJoinFields[s]]}return n}}const Ci=new j("DataStore"),La="amplify-datastore";class Bu{constructor(){this.dbName=La}async setUp(t,n,s,i,r){if(await this.preSetUpChecks(),!this.initPromise)this.initPromise=new Promise((o,a)=>{this.resolve=o,this.reject=a});else{await this.initPromise;return}r&&(this.dbName=`${La}-${r}`),this.schema=t,this.namespaceResolver=n,this.modelInstanceCreator=s,this.getModelConstructorByModelName=i;try{this.db||(this.db=await this.initDb(),this.resolve())}catch(o){this.reject(o)}}getStorenameForModel(t){const n=this.namespaceResolver(t),{name:s}=t;return Pt(n,s)}getIndexKeyValuesFromModel(t){const n=Object.getPrototypeOf(t).constructor,s=this.namespaceResolver(n),i=Rs(this.schema.namespaces[s],n.name);return Du(t,i)}saveMetadata(t){const n=Object.getPrototypeOf(t).constructor,s=this.getStorenameForModel(n),i=this.namespaceResolver(n),r=Mr(n.name,t,this.schema.namespaces[i],this.modelInstanceCreator,this.getModelConstructorByModelName),o=new Set,a=Object.values(r).map(({modelName:u,item:l,instance:d})=>{const h=Pt(i,u);o.add(h);const p=Rs(this.schema.namespaces[i],u);return{storeName:h,item:l,instance:d,keys:p}}),c=this.getIndexKeyValuesFromModel(t);return{storeName:s,set:o,connectionStoreNames:a,modelKeyValues:c}}validateSaveCondition(t,n){if(!(t&&n))return;const s=$.getPredicates(t),{predicates:i,type:r}=s;if(!Ut(n,r,i)){const a="Conditional update failed";throw Ci.error(a,{model:n,condition:i}),new Error(a)}}async load(t,n,s){const o=this.schema.namespaces[t].relationships[n].relationTypes.map(({modelName:c})=>Pt(t,c)),a=this.getModelConstructorByModelName(t,n);return o.length===0?s.map(c=>this.modelInstanceCreator(a,c)):s.map(c=>this.modelInstanceCreator(a,c))}keyValueFromPredicate(t,n){const{predicates:s}=t;if(s.length!==n.length)return;const i=[];for(const r of n){const o=s.find(a=>on(a)&&a.field===r&&a.operator==="eq"&&a.operand!==null&&a.operand!==void 0);o&&i.push(o.operand)}return i.length===n.length?i:void 0}queryMetadata(t,n,s){const i=this.getStorenameForModel(t),r=this.namespaceResolver(t),o=n&&$.getPredicates(n),a=Rs(this.schema.namespaces[r],t.name),c=o&&this.keyValueFromPredicate(o,a),u=s&&s.sort,l=s&&s.limit;return{storeName:i,namespaceName:r,queryByKey:c,predicates:o,hasSort:u,hasPagination:l}}async delete(t,n){await this.preOpCheck();const s=[];if(kt(t)){const i=t,r=this.namespaceResolver(i),o=await this.query(i,n);if(n!==void 0){await this.deleteTraverse(o,i,r,s),await this.deleteItem(s);const a=s.reduce((c,{items:u})=>c.concat(u),[]);return[o,a]}else{await this.deleteTraverse(o,i,r,s),await this.deleteItem(s);const a=s.reduce((c,{items:u})=>c.concat(u),[]);return[o,a]}}else{const i=t,r=Object.getPrototypeOf(i).constructor,o=this.namespaceResolver(r),a=this.getStorenameForModel(r);if(n){const u=this.getIndexKeyValuesFromModel(i),l=await this._get(a,u);if(l===void 0)return Ci.warn("Model instance not found in storage",{model:i}),[[i],[]];const d=$.getPredicates(n),{predicates:h,type:p}=d;if(!Ut(l,p,h)){const m="Conditional update failed";throw Ci.error(m,{model:l,condition:h}),new Error(m)}await this.deleteTraverse([i],r,o,s)}else await this.deleteTraverse([i],r,o,s);await this.deleteItem(s);const c=s.reduce((u,{items:l})=>u.concat(l),[]);return[[i],c]}}async deleteTraverse(t,n,s,i){const r=["HAS_ONE","HAS_MANY"];for await(const o of t){const a=this.schema.namespaces[s].models[n.name],c={builder:n,schema:a,pkField:te(a)},u=In.allFrom(c).filter(l=>r.includes(l.type));for await(const l of u){const d=l.createRemoteQueryObject(o);if(d!==null){const h=await this.query(l.remoteModelConstructor,$.createFromFlatEqualities(l.remoteDefinition,d));await this.deleteTraverse(h,l.remoteModelConstructor,s,i)}}}i.push({storeName:Pt(s,n.name),items:t})}}const ms=new j("DataStore"),SS=7,wS=3;class IS extends Bu{constructor(){super(...arguments),this.safariCompatabilityMode=!1,this.canonicalKeyPath=t=>this.safariCompatabilityMode?t.length>1?t:t[0]:t}async preSetUpChecks(){await this.checkPrivate(),await this.setSafariCompatabilityMode()}async preOpCheck(){await this.checkPrivate()}async initDb(){return sl(this.dbName,wS,{upgrade:async(t,n,s,i)=>{if(n===0){Object.keys(this.schema.namespaces).forEach(r=>{const o=this.schema.namespaces[r];Object.keys(o.models).forEach(a=>{const c=Pt(r,a);this.createObjectStoreForModel(t,r,c,a)})});return}if((n===1||n===2)&&s===3)try{for(const r of i.objectStoreNames){const o=i.objectStore(r),a=`tmp_${r}`;o.name=a;const{namespaceName:c,modelName:u}=this.getNamespaceAndModelFromStorename(r);if(!(u in this.schema.namespaces[c].models)){t.deleteObjectStore(a);continue}const d=this.createObjectStoreForModel(t,c,r,u);let h=await o.openCursor(),p=0;for(;h&&h.value;)await d.put(h.value),h=await h.continue(),p++;t.deleteObjectStore(a),ms.debug(`${p} ${r} records migrated`)}Object.keys(this.schema.namespaces).forEach(r=>{const o=this.schema.namespaces[r],a=new Set(i.objectStoreNames);Object.keys(o.models).map(c=>[c,Pt(r,c)]).filter(([,c])=>!a.has(c)).forEach(([c,u])=>{this.createObjectStoreForModel(t,r,u,c)})})}catch(r){throw ms.error("Error migrating IndexedDB data",r),i.abort(),r}}})}async _get(t,n){let s;if(typeof t=="string"){const r=t;s=this.db.transaction(r,"readonly").store.index("byPk")}else s=t.index("byPk");return await s.get(this.canonicalKeyPath(n))}async clear(){await this.checkPrivate(),this.db?.close(),await il(this.dbName),this.db=void 0,this.initPromise=void 0}async save(t,n){await this.checkPrivate();const{storeName:s,set:i,connectionStoreNames:r,modelKeyValues:o}=this.saveMetadata(t),a=this.db.transaction([s,...Array.from(i.values())],"readwrite"),c=a.objectStore(s),u=await this._get(c,o);this.validateSaveCondition(n,u);const l=[];for await(const d of r){const{storeName:h,item:p,instance:f,keys:m}=d,y=a.objectStore(h),g=m.map(S=>p[S]),v=await this._get(y,g)?q.UPDATE:q.INSERT;if(zs(g,o)||v===q.INSERT){const S=await y.index("byPk").getKey(this.canonicalKeyPath(g));await y.put(p,S),l.push([f,v])}}return await a.done,l}async query(t,n,s){await this.checkPrivate();const{storeName:i,namespaceName:r,queryByKey:o,predicates:a,hasSort:c,hasPagination:u}=this.queryMetadata(t,n,s),l=await(async()=>{if(o){const d=await this.getByKey(i,o);return d?[d]:[]}if(a){const d=await this.filterOnPredicate(i,a);return this.inMemoryPagination(d,s)}if(c){const d=await this.getAll(i);return this.inMemoryPagination(d,s)}return u?this.enginePagination(i,s):this.getAll(i)})();return this.load(r,t.name,l)}async queryOne(t,n=rt.FIRST){await this.checkPrivate();const s=this.getStorenameForModel(t),i=await this.db.transaction([s],"readonly").objectStore(s).openCursor(void 0,n===rt.FIRST?"next":"prev"),r=i?i.value:void 0;return r&&this.modelInstanceCreator(t,r)}async batchSave(t,n){if(await this.checkPrivate(),n.length===0)return[];const s=t.name,i=this.namespaceResolver(t),r=this.getStorenameForModel(t),o=[],a=this.db.transaction(r,"readwrite"),{store:c}=a;for(const u of n){const l=this.modelInstanceCreator(t,u),d=Mr(s,l,this.schema.namespaces[i],this.modelInstanceCreator,this.getModelConstructorByModelName),h=this.getIndexKeyValuesFromModel(l),{_deleted:p}=u,m=await c.index("byPk").getKey(this.canonicalKeyPath(h));if(p)o.push([u,q.DELETE]),m&&await c.delete(m);else{const{instance:y}=d.find(({instance:g})=>{const E=this.getIndexKeyValuesFromModel(g);return zs(E,h)});o.push([y,m?q.UPDATE:q.INSERT]),await c.put(y,m)}}return await a.done,o}async deleteItem(t){const n=t.map(({storeName:i})=>i),s=this.db.transaction([...n],"readwrite");for await(const i of t){const{storeName:r,items:o}=i,a=s.objectStore(r);for await(const c of o)if(c){let u;if(typeof c=="object"){const l=this.getIndexKeyValuesFromModel(c);u=await a.index("byPk").getKey(this.canonicalKeyPath(l))}else{const l=c.toString();u=await a.index("byPk").getKey(l)}u!==void 0&&await a.delete(u)}}}async checkPrivate(){return await OE()?(ms.error("IndexedDB not supported in this browser's private mode"),Promise.reject("IndexedDB not supported in this browser's private mode")):Promise.resolve()}async setSafariCompatabilityMode(){this.safariCompatabilityMode=await xE(),this.safariCompatabilityMode===!0&&ms.debug("IndexedDB Adapter is running in Safari Compatability Mode")}getNamespaceAndModelFromStorename(t){const[n,...s]=t.split("_");return{namespaceName:n,modelName:s.join("_")}}createObjectStoreForModel(t,n,s,i){const r=t.createObjectStore(s,{autoIncrement:!0}),{indexes:o}=this.schema.namespaces[n].relationships[i];return o.forEach(([a,c,u])=>{r.createIndex(a,c,u)}),r}async getByKey(t,n){return await this._get(t,n)}async getAll(t){return this.db.getAll(t)}matchingIndexQueries(t,n,s){const i=[],r=new Map;for(const a of n)r.set(String(a.field),a);const o=s.objectStore(t);for(const a of o.indexNames){const c=o.index(a),u=Array.isArray(c.keyPath)?c.keyPath:[c.keyPath],l=[];for(const d of u){const h=r.get(d);if(h&&h.operand!==null&&h.operand!==void 0)l.push(h.operand);else break}l.length===u.length&&i.push(()=>this.db.transaction(t).objectStore(t).index(a).getAll(this.canonicalKeyPath(l)))}return i}async baseQueryIndex(t,n,s){let{predicates:i,type:r}=n;for(;i.length===1&&Gn(i[0])&&i[0].type!=="not";)({type:r}=i[0]),i=i[0].predicates;const o=i.filter(u=>on(u)&&u.operator==="eq"),a=s||this.db.transaction(t);let c={};if(r==="or"){const u=await Promise.all(i.filter(h=>Gn(h)&&h.type==="and").map(h=>this.baseQueryIndex(t,h,a))).then(h=>h.filter(p=>p.indexedQueries.length===1).map(p=>p.indexedQueries)),l=i.filter(h=>on(h)).map(h=>this.matchingIndexQueries(t,[h],a)),d=[...u,...l].map(h=>h[0]).filter(h=>h);i.length>d.length?c={groupType:null,indexedQueries:[]}:c={groupType:"or",indexedQueries:d}}else r==="and"?c={groupType:r,indexedQueries:this.matchingIndexQueries(t,o,a)}:c={groupType:null,indexedQueries:[]};return s||await a.done,c}async filterOnPredicate(t,n){const{predicates:s,type:i}=n,{groupType:r,indexedQueries:o}=await this.baseQueryIndex(t,n);let a;if(r==="and"&&o.length>0)a=await o[0]();else if(r==="or"&&o.length>0&&o.length<=SS){const u=new Map;for(const l of o){const d=await l();for(const h of d){const p=JSON.stringify(h);u.set(p,h)}}a=Array.from(u.values())}else a=await this.getAll(t);return s?a.filter(u=>Ut(u,i,s)):a}inMemoryPagination(t,n){return Dr(t,n)}async enginePagination(t,n){let s;if(n){const{page:i=0,limit:r=0}=n,o=Math.max(0,i*r)||0;let a=await this.db.transaction(t).objectStore(t).openCursor();a&&o>0&&await a.advance(o);const c=[],u=typeof r=="number"&&r>0;for(;a&&a.value&&(c.push(a.value),!(u&&c.length===r));)a=await a.continue();s=c}else s=await this.db.getAll(t);return s}}var vS=new IS;class TS{constructor(){this.db=new Map,this.getAllKeys=async()=>Array.from(this.db.keys()),this.multiGet=async t=>t.reduce((n,s)=>(n.push([s,this.db.get(s)]),n),[]),this.multiRemove=async(t,n)=>{t.forEach(s=>this.db.delete(s)),typeof n=="function"&&n()},this.multiSet=async(t,n)=>{t.forEach(([s,i])=>{this.setItem(s,i)}),typeof n=="function"&&n()},this.setItem=async(t,n)=>this.db.set(t,n),this.removeItem=async t=>this.db.delete(t),this.getItem=async t=>this.db.get(t)}}function bS(){return new TS}const Pi="@AmplifyDatastore",AS="Collection",$a="Data",Oi=new Map;class NS{constructor(){this._collectionInMemoryIndex=new Map,this.storage=bS()}getCollectionIndex(t){return this._collectionInMemoryIndex.has(t)||this._collectionInMemoryIndex.set(t,new Map),this._collectionInMemoryIndex.get(t)}getMonotonicFactory(t){return Oi.has(t)||Oi.set(t,ku()),Oi.get(t)}async init(){this._collectionInMemoryIndex.clear();const t=await this.storage.getAllKeys(),n=[];for(const s of t){const[i,r,o,a,c]=s.split("::");if(i===Pi)if(o===$a){let u;if(c===void 0){const l=a,d=this.getMonotonicFactory(r)(),h=this.getLegacyKeyForItem(r,l),p=this.getKeyForItem(r,l,d),f=await this.storage.getItem(h);await this.storage.setItem(p,f),await this.storage.removeItem(h),u=d}else u=a;this.getCollectionIndex(r).set(c,u)}else o===AS&&n.push(s)}n.length>0&&await this.storage.multiRemove(n)}async save(t,n,s,i){const r=Xi(s),o=this.getCollectionIndex(n)?.get(r)||this.getMonotonicFactory(n)(),a=this.getKeyForItem(n,i,o);this.getCollectionIndex(n)?.set(i,o),await this.storage.setItem(a,JSON.stringify(t))}async batchSave(t,n,s){if(n.length===0)return[];const i=[],r=this.getCollectionIndex(t),o=new Set,a=new Set,c=[],u={};for(const h of n){const p=s.map(g=>h[g]),{_deleted:f}=h,m=r.get(p.join(pt))||this.getMonotonicFactory(t)(),y=this.getKeyForItem(t,p.join(pt),m);c.push(y),u[y]={ulid:m,model:h},f?o.add(y):a.add(y)}const d=(await this.storage.multiGet(c)).filter(([,h])=>!!h).reduce((h,[p])=>h.add(p),new Set);await new Promise((h,p)=>{if(o.size===0){h();return}const f=Array.from(o);f.forEach(m=>{const y=s.map(g=>u[m].model[g]).join(pt);r.delete(y)}),this.storage.multiRemove(f,m=>{m&&m.length>0?p(m):h()})}),await new Promise((h,p)=>{if(a.size===0){h();return}const f=Array.from(a).map(m=>[m,JSON.stringify(u[m].model)]);a.forEach(m=>{const{model:y,ulid:g}=u[m],E=s.map(v=>y[v]).join(pt);r.set(E,g)}),this.storage.multiSet(f,m=>{m&&m.length>0?p(m):h()})});for(const h of c)o.has(h)&&d.has(h)?i.push([u[h].model,q.DELETE]):a.has(h)&&i.push([u[h].model,d.has(h)?q.UPDATE:q.INSERT]);return i}async get(t,n){const s=this.getCollectionIndex(n).get(t),i=this.getKeyForItem(n,t,s),r=await this.storage.getItem(i);return r&&JSON.parse(r)}async getOne(t,n){const s=this.getCollectionIndex(n),[i,r]=t===rt.FIRST?(()=>{let u,l;for([u,l]of s)break;return[u,l]})():(()=>{let u,l;for([u,l]of s);return[u,l]})(),o=this.getKeyForItem(n,i,r),a=o&&await this.storage.getItem(o);return a&&JSON.parse(a)||void 0}async getAll(t,n){const s=this.getCollectionIndex(t),{page:i=0,limit:r=0}=n||{},o=Math.max(0,i*r)||0,a=r>0?o+r:void 0,c=[];let u=0;for(const[h,p]of s)if(u++,!(u<=o)&&(c.push(this.getKeyForItem(t,h,p)),u===a))break;return(await this.storage.multiGet(c)).filter(([,h])=>h).map(([,h])=>JSON.parse(h))}async delete(t,n){const s=this.getCollectionIndex(n).get(t),i=this.getKeyForItem(n,t,s);this.getCollectionIndex(n).delete(t),await this.storage.removeItem(i)}async clear(){const n=(await this.storage.getAllKeys()).filter(s=>s.startsWith(Pi));await this.storage.multiRemove(n),this._collectionInMemoryIndex.clear()}getKeyForItem(t,n,s){return`${this.getKeyPrefixForStoreItems(t)}::${s}::${n}`}getLegacyKeyForItem(t,n){return`${this.getKeyPrefixForStoreItems(t)}::${n}`}getKeyPrefixForStoreItems(t){return`${Pi}::${t}::${$a}`}}class CS extends Bu{async preSetUpChecks(){}async preOpCheck(){}async initDb(){const t=new NS;return await t.init(),t}async clear(){await this.db.clear(),this.db=void 0,this.initPromise=void 0}async batchSave(t,n){if(n.length===0)return[];const s=t.name,i=this.namespaceResolver(t),r=Pt(i,s),o=Rs(this.schema.namespaces[i],s),a=[];for(const c of n){const u=this.modelInstanceCreator(t,c),l=Mr(s,u,this.schema.namespaces[i],this.modelInstanceCreator,this.getModelConstructorByModelName),d=this.getIndexKeyValuesPath(u),{instance:h}=l.find(({instance:p})=>{const f=this.getIndexKeyValuesPath(p);return zs([f],[d])});a.push(h)}return this.db.batchSave(r,a,o)}async _get(t,n){const s=n.join(pt);return await this.db.get(s,t)}async save(t,n){const{storeName:s,connectionStoreNames:i,modelKeyValues:r}=this.saveMetadata(t),o=await this._get(s,r);this.validateSaveCondition(n,o);const a=[];for await(const c of i){const{storeName:u,item:l,instance:d,keys:h}=c,p=h.map(y=>l[y]),m=await this._get(u,p)?q.UPDATE:q.INSERT;(zs(p,r)||m===q.INSERT)&&(await this.db.save(l,u,h,p.join(pt)),a.push([d,m]))}return a}async query(t,n,s){const{storeName:i,namespaceName:r,queryByKey:o,predicates:a,hasSort:c,hasPagination:u}=this.queryMetadata(t,n,s),l=await(async()=>{if(o){const d=o.join(pt),h=await this.getByKey(i,d);return h?[h]:[]}if(a){const d=await this.filterOnPredicate(i,a);return this.inMemoryPagination(d,s)}if(c||u){const d=await this.getAll(i);return this.inMemoryPagination(d,s)}return this.getAll(i)})();return this.load(r,t.name,l)}async getByKey(t,n){return await this.db.get(n,t)}async getAll(t){return this.db.getAll(t)}async filterOnPredicate(t,n){const{predicates:s,type:i}=n,r=await this.getAll(t);return s?r.filter(a=>Ut(a,i,s)):r}inMemoryPagination(t,n){return Dr(t,n)}async queryOne(t,n=rt.FIRST){const s=this.getStorenameForModel(t),i=await this.db.getOne(n,s);return i&&this.modelInstanceCreator(t,i)}async deleteItem(t){for await(const n of t){const{storeName:s,items:i}=n;for await(const r of i)if(r&&typeof r=="object"){const o=this.getIndexKeyValuesPath(r);await this.db.delete(o,s)}}}getIndexKeyValuesPath(t){return this.getIndexKeyValuesFromModel(t).join(pt)}}var PS=new CS;const OS=()=>ar&&window.indexedDB||hc()&&self.indexedDB?vS:PS,xS=new j("DataStore");class Ka{constructor(t,n,s,i,r,o){this.schema=t,this.namespaceResolver=n,this.getModelConstructorByModelName=s,this.modelInstanceCreator=i,this.adapter=r,this.sessionId=o,this.adapter=this.adapter||OS(),this.pushStream=new rl}static getNamespace(){return{name:Ru,relationships:{},enums:{},models:{},nonModels:{}}}async init(){if(this.initialized!==void 0){await this.initialized;return}xS.debug("Starting Storage");let t,n;this.initialized=new Promise((s,i)=>{t=s,n=i}),this.adapter.setUp(this.schema,this.namespaceResolver,this.modelInstanceCreator,this.getModelConstructorByModelName,this.sessionId).then(t,n),await this.initialized}async save(t,n,s,i){if(await this.init(),!this.adapter)throw new Error("Storage adapter is missing");const r=await this.adapter.save(t,n);return r.forEach(o=>{const[a,c]=o,u=!!s;let l;if((c===q.UPDATE||c===q.INSERT)&&!u&&(l=this.getChangedFieldsInput(t,a,i),l===null))return r;const d=l||a,h=Object.getPrototypeOf(a).constructor;this.pushStream.next({model:h,opType:c,element:d,mutator:s,condition:n&&$.getPredicates(n,!1)||null,savedElement:a})}),r}async delete(t,n,s){if(await this.init(),!this.adapter)throw new Error("Storage adapter is missing");let i,r;[i,r]=await this.adapter.delete(t,n);const o=kt(t)?t:Object.getPrototypeOf(t||{}).constructor,a=this.namespaceResolver(o),c=this.schema.namespaces[a].models[o.name],u=new Set(i.map(l=>We(c,l)));return!kt(t)&&!Array.isArray(r)&&(r=[r]),r.forEach(l=>{const d=Object.getPrototypeOf(l).constructor;let h;if(!kt(t)){const p=We(c,l);h=u.has(p)?$.getPredicates(n,!1):void 0}this.pushStream.next({model:d,opType:q.DELETE,element:l,mutator:s,condition:h||null})}),[i,r]}async query(t,n,s){if(await this.init(),!this.adapter)throw new Error("Storage adapter is missing");return this.adapter.query(t,n,s)}async queryOne(t,n=rt.FIRST){if(await this.init(),!this.adapter)throw new Error("Storage adapter is missing");return this.adapter.queryOne(t,n)}observe(t,n,s){const i=!t,{predicates:r,type:o}=n&&$.getPredicates(n,!1)||{};let a=this.pushStream.pipe(jn(({mutator:c})=>!s||c!==s)).pipe(Ys(({mutator:c,...u})=>u));return i||(a=a.pipe(jn(({model:c,element:u})=>t!==c?!1:r&&o?Ut(u,o,r):!0))),a}async clear(t=!0){if(this.initialized=void 0,!this.adapter)throw new Error("Storage adapter is missing");await this.adapter.clear(),t&&this.pushStream.complete()}async batchSave(t,n,s){if(await this.init(),!this.adapter)throw new Error("Storage adapter is missing");const i=await this.adapter.batchSave(t,n);return i.forEach(([r,o])=>{this.pushStream.next({model:t,opType:o,element:r,mutator:s,condition:null})}),i}getChangedFieldsInput(t,n,s){if(!(s&&s.length))return null;const[r,o]=s,a={},c=r.map(E=>E.path&&E.path[0]),u=Object.getPrototypeOf(t).constructor,l=this.namespaceResolver(u),{fields:d}=this.schema.namespaces[l].models[u.name],{primaryKey:h,compositeKeys:p=[]}=this.schema.namespaces[l].keys?.[u.name]||{};if(c.forEach(E=>{const v=Rr(d[E]?.association);if(Array.isArray(v)){for(const S of v)if(!Ws(o[S],n[S])){a[S]=n[S]===void 0?null:n[S];for(const I of p)if(I.has(S))for(const T of I)a[T]=n[T]}}else{const S=v||E;if(!Ws(o[S],n[S])){a[S]=n[S]===void 0?null:n[S];for(const I of p)if(I.has(S))for(const T of I)a[T]=n[T]}}}),Object.keys(a).length===0)return null;if(h&&h.length)for(const E of h)a[E]=n[E];const{id:f,_version:m,_lastChangedAt:y,_deleted:g}=n;return{...a,id:f,_version:m,_lastChangedAt:y,_deleted:g}}}class Zi{constructor(t,n,s,i,r,o){this.mutex=new Ah,this.storage=new Ka(t,n,s,i,r,o)}runExclusive(t){return this.mutex.runExclusive(t.bind(this,this.storage))}async save(t,n,s,i){return this.runExclusive(r=>r.save(t,n,s,i))}async delete(t,n,s){return this.runExclusive(i=>{if(kt(t)){const r=t;return i.delete(r,n,s)}else{const r=t;return i.delete(r,n,s)}})}async query(t,n,s){return this.runExclusive(i=>i.query(t,n,s))}async queryOne(t,n=rt.FIRST){return this.runExclusive(s=>s.queryOne(t,n))}static getNamespace(){return Ka.getNamespace()}observe(t,n,s){return this.storage.observe(t,n,s)}async clear(){await this.runExclusive(t=>t.clear())}batchSave(t,n){return this.storage.batchSave(t,n)}async init(){return this.storage.init()}}const _S=new _t().networkMonitor(),RS=5e3;class kS{constructor(){this.connectionStatus={online:!1}}status(){if(this.observer)throw new Error("Subscriber already exists");return new me(t=>(this.observer=t,this.subscription=_S.subscribe(({online:n})=>{this.connectionStatus.online=n;const s={...this.connectionStatus};t.next(s)}),()=>{clearTimeout(this.timeout),this.unsubscribe()}))}unsubscribe(){this.subscription&&(clearTimeout(this.timeout),this.subscription.unsubscribe())}async stop(){this.unsubscribe()}socketDisconnected(){this.observer&&typeof this.observer.next=="function"&&(this.observer.next({online:!1}),this.timeout=setTimeout(()=>{const t={...this.connectionStatus};this.observer.next(t)},RS))}}class MS{constructor(t,n){this.outbox=t,this.ownSymbol=n}async merge(t,n,s){let i;const r=await this.outbox.getForModel(t,n,s),o=n._deleted;return r.length===0&&(o?(i=q.DELETE,await t.delete(n,void 0,this.ownSymbol)):[[,i]]=await t.save(n,void 0,this.ownSymbol)),i}async mergePage(t,n,s,i){const r=new Map;for(const a of s){const c=We(i,a);r.set(c,a)}const o=[...r.values()];return t.batchSave(n,o,this.ownSymbol)}}class DS{constructor(t,n,s,i){this.schema=t,this._MutationEvent=n,this.modelInstanceCreator=s,this.ownSymbol=i}async enqueue(t,n){await t.runExclusive(async s=>{const i=this.schema.namespaces[Jt].models.MutationEvent,r=$.createFromAST(i,{and:[{modelId:{eq:n.modelId}},{id:{ne:this.inProgressMutationEventId}}]}),[o]=await s.query(this._MutationEvent,r);if(o===void 0){await s.save(n,void 0,this.ownSymbol);return}const{operation:a}=n;if(o.operation===K.CREATE)if(a===K.DELETE)await s.delete(this._MutationEvent,r);else{const c=this.mergeUserFields(o,n);await s.save(this._MutationEvent.copyOf(o,u=>{u.data=c.data}),void 0,this.ownSymbol)}else{const{condition:c}=n,u=JSON.parse(c);let l;Object.keys(u).length===0&&(l=this.mergeUserFields(o,n),await s.delete(this._MutationEvent,r)),l=l||n,await s.save(l,void 0,this.ownSymbol)}})}async dequeue(t,n,s){const i=await this.peek(t);return n&&await this.syncOutboxVersionsOnDequeue(t,n,i,s),i&&await t.delete(i),this.inProgressMutationEventId=void 0,i}async peek(t){const n=await t.queryOne(this._MutationEvent,rt.FIRST);return this.inProgressMutationEventId=n?n.id:void 0,n}async getForModel(t,n,s){const i=this.schema.namespaces[Jt].models.MutationEvent,r=We(s,n);return await t.query(this._MutationEvent,$.createFromAST(i,{and:{modelId:{eq:r}}}))}async getModelIds(t){const n=await t.query(this._MutationEvent),s=new Set;return n.forEach(({modelId:i})=>s.add(i)),s}async syncOutboxVersionsOnDequeue(t,n,s,i){if(s?.operation!==i)return;const{_version:r,_lastChangedAt:o,_deleted:a,...c}=n,u=this.removeTimestampFields(s.model,c),l=JSON.parse(s.data);if(!l)return;const{_version:d,_lastChangedAt:h,_deleted:p,...f}=l,m=this.removeTimestampFields(s.model,f);if(!ME(m,u,!0))return;const y=this.schema.namespaces[Jt].models.MutationEvent,g=this.schema.namespaces.user.models[s.model],E=We(g,n),v=$.createFromAST(y,{and:[{modelId:{eq:E}},{id:{ne:this.inProgressMutationEventId}}]}),S=await t.query(this._MutationEvent,v);if(!S.length)return;const I=S.map(T=>{const b={...JSON.parse(T.data),_version:r,_lastChangedAt:o};return this._MutationEvent.copyOf(T,x=>{x.data=JSON.stringify(b)})});await t.delete(this._MutationEvent,v),await Promise.all(I.map(async T=>t.save(T,void 0,this.ownSymbol)))}mergeUserFields(t,n){const{_version:s,_lastChangedAt:i,_deleted:r,...o}=JSON.parse(t.data),{_version:a,_lastChangedAt:c,_deleted:u,...l}=JSON.parse(n.data),d=JSON.stringify({_version:s,_lastChangedAt:i,_deleted:r,...o,...l});return this.modelInstanceCreator(this._MutationEvent,{...n,data:d})}removeTimestampFields(t,n){const s="createdAt",i="updatedAt";let r=s,o=i;const c=this.schema.namespaces[wn].models[t].attributes?.find(u=>u.type==="model")?.properties?.timestamps;return c&&(r=c[s],o=c[i]),delete n[r],delete n[o],n}}const $r=e=>/^Connection failed: Connection Timeout/.test(e.message),Kr=e=>Qn(e)>=500,FS={BadModel:()=>!1,BadRecord:e=>{const{message:t}=e;return/^Cannot return \w+ for [\w-_]+ type/.test(t)||/^Variable '.+' has coerced Null value for NonNull type/.test(t)},ConfigError:()=>!1,Transient:e=>$r(e)||Kr(e),Unauthorized:e=>e.message==="Unauthorized"||Qn(e)===401},US={BadModel:()=>!1,BadRecord:()=>!1,ConfigError:()=>!1,Transient:e=>{const t=ja(e);return $r(t)||Kr(t)},Unauthorized:e=>{const t=ja(e);return/Connection failed.+Unauthorized/.test(t.message)}},LS={BadModel:()=>!1,BadRecord:e=>/^Cannot return \w+ for [\w-_]+ type/.test(e.message),ConfigError:()=>!1,Transient:e=>$r(e)||Kr(e),Unauthorized:e=>e.errorType==="Unauthorized"};function ja(e){const{errors:[t]}=e;return t}function Ba(e){return jr(FS,e)}function $S(e){return jr(US,e)}function xi(e){return jr(LS,e)}function jr(e,t){const n=[...Object.keys(e)];for(const s of n){const i=e[s];if(i?.(t))return s}return"Unknown"}const KS=10,He=new j("DataStore");class jS{constructor(t,n,s,i,r,o,a={},c,u,l,d){this.schema=t,this.storage=n,this.userClasses=s,this.outbox=i,this.modelInstanceCreator=r,this._MutationEvent=o,this.amplifyConfig=a,this.authModeStrategy=c,this.errorHandler=u,this.conflictHandler=l,this.amplifyContext=d,this.typeQuery=new WeakMap,this.processing=!1,this.runningProcesses=new tt,this.amplifyContext.InternalAPI=this.amplifyContext.InternalAPI||mi,this.generateQueries()}generateQueries(){Object.values(this.schema.namespaces).forEach(t=>{Object.values(t.models).filter(({syncable:n})=>n).forEach(n=>{const[s]=Mn(t,n,"CREATE"),[i]=Mn(t,n,"UPDATE"),[r]=Mn(t,n,"DELETE");this.typeQuery.set(n,[s,i,r])})})}isReady(){return this.observer!==void 0}start(){return this.runningProcesses=new tt,new me(n=>{this.observer=n;try{this.resume()}catch(s){throw He.error("mutations processor start error",s),s}return this.runningProcesses.addCleaner(async()=>{this.removeObserver(),this.pause()})})}async stop(){this.removeObserver(),await this.runningProcesses.close(),await this.runningProcesses.open()}removeObserver(){this.observer?.complete?.(),this.observer=void 0}async resume(){this.runningProcesses.isOpen&&await this.runningProcesses.add(async t=>{if(this.processing||!this.isReady()||!this.runningProcesses.isOpen)return;this.processing=!0;let n;const s=wn;for(;this.processing&&this.runningProcesses.isOpen&&(n=await this.outbox.peek(this.storage))!==void 0;){const{model:i,operation:r,data:o,condition:a}=n,c=this.userClasses[i];let u,l,d;try{const m=(await Lr({authModeStrategy:this.authModeStrategy,defaultAuthMode:this.amplifyConfig.aws_appsync_authenticationType,modelName:i,schema:this.schema}))[r.toUpperCase()];let y=0;const g=async()=>{try{He.debug(`Attempting mutation with authMode: ${m[y]}`);const E=await this.jitteredRetry(s,i,r,o,a,c,this._MutationEvent,n,m[y],t);return He.debug(`Mutation sent successfully with authMode: ${m[y]}`),E}catch(E){if(y++,y>=m.length){He.debug(`Mutation failed with authMode: ${m[y-1]}`);try{await this.errorHandler({recoverySuggestion:"Ensure app code is up to date, auth directives exist and are correct on each model, and that server-side data has not been invalidated by a schema change. If the problem persists, search for or create an issue: https://github.com/aws-amplify/amplify-js/issues",localModel:null,message:E.message,model:c.name,operation:l,errorType:Ba(E),process:mt.sync,remoteModel:null,cause:E})}catch(v){He.error("Mutation error handler failed with:",v)}throw E}return He.debug(`Mutation failed with authMode: ${m[y-1]}. Retrying with authMode: ${m[y]}`),g()}};[u,l,d]=await g()}catch(f){if(f.message==="Offline"||f.message==="RetryMutation")continue}if(u===void 0){He.debug("done retrying"),await this.storage.runExclusive(async f=>{await this.outbox.dequeue(f)});continue}const h=u.data[l];let p=!1;await this.storage.runExclusive(async f=>{await this.outbox.dequeue(f,h,r),p=await this.outbox.peek(f)!==void 0}),this.observer?.next?.({operation:r,modelDefinition:d,model:h,hasMore:p})}this.pause()},"mutation resume loop")}async jitteredRetry(t,n,s,i,r,o,a,c,u,l){return rc(async(d,h,p,f,m,y,g)=>{const[E,v,S,I,T]=this.createQueryVariables(t,d,h,p,f),O=await Hs(u,this.amplifyConfig),b={query:E,variables:v,authMode:u,authToken:O};let x=0;const U=this.opTypeFromTransformerOperation(h),M={category:St.DataStore,action:Bn.GraphQl};do try{return[await this.amplifyContext.InternalAPI.graphql(b,void 0,M),I,T]}catch(P){if(P.errors&&P.errors.length>0){const[A]=P.errors,{originalError:{code:F=null}={}}=A;if(A.errorType==="Unauthorized")throw new Ct("Unauthorized");if(A.message==="Network Error"||F==="ERR_NETWORK")throw this.processing?new Error("Network Error"):new Ct("Offline");if(A.errorType==="ConflictUnhandled"){x++;let k;if(x>KS)k=_a;else try{k=await this.conflictHandler({modelConstructor:m,localModel:this.modelInstanceCreator(m,v.input),remoteModel:this.modelInstanceCreator(m,A.data),operation:U,attempts:x})}catch(he){He.warn("conflict trycatch",he);continue}if(k===_a){const[[,he,$t]]=Mn(this.schema.namespaces[t],T,"GET"),Kt=await Hs(u,this.amplifyConfig);return[await this.amplifyContext.InternalAPI.graphql({query:$t,variables:{id:v.input.id},authMode:u,authToken:Kt},void 0,M),he,T]}const V=this.schema.namespaces[t],Z=ju(V.relationships,T,U,m,k,S,y,this.modelInstanceCreator,g.id);throw await this.storage.save(Z),new Ct("RetryMutation")}else try{this.errorHandler({recoverySuggestion:"Ensure app code is up to date, auth directives exist and are correct on each model, and that server-side data has not been invalidated by a schema change. If the problem persists, search for or create an issue: https://github.com/aws-amplify/amplify-js/issues",localModel:v.input,message:A.message,operation:h,errorType:Ba(A),errorInfo:A.errorInfo,process:mt.mutate,cause:A,remoteModel:A.data?this.modelInstanceCreator(m,A.data):null})}catch(k){He.warn("Mutation error handler failed with:",k)}finally{return A.data?[{data:{[I]:A.data}},I,T]:[]}}else throw new Ct(P)}while(b)},[n,s,i,r,o,a,c],qS,l)}createQueryVariables(t,n,s,i,r){const o=this.schema.namespaces[t].models[n],{primaryKey:a}=this.schema.namespaces[t].keys[n],u=o.attributes?.find(S=>S.type==="auth")?.properties?.rules.map(S=>S.ownerField).filter(S=>S)||["owner"],l=this.typeQuery.get(o),[,d,h]=l.find(([S])=>S===s),{_version:p,...f}=JSON.parse(i),m={};if(a&&a.length)for(const S of a)m[S]=f[S];else m[is]=f.id;let y;if(s===K.DELETE)y=m;else{y={};const S=Object.values(o.fields);for(const{name:I,type:T,association:O,isReadOnly:b}of S)if(!b&&!(u.includes(I)&&f[I]===null)){if(Pu(T)){if(Rr(O)&&O.connectionType==="BELONGS_TO"){const x=Lu(O);if(x)for(const U of x)y[U]=f[U]}continue}s===K.UPDATE&&!Object.prototype.hasOwnProperty.call(f,I)||(y[I]=f[I])}}const g={...y,_version:p},E=JSON.parse(r),v={input:g,...s===K.CREATE?{}:{condition:Object.keys(E).length>0?E:null}};return[h,v,E,d,o]}opTypeFromTransformerOperation(t){switch(t){case K.CREATE:return q.INSERT;case K.DELETE:return q.DELETE;case K.UPDATE:return q.UPDATE;case K.GET:break;default:throw new Error(`Invalid operation ${t}`)}}pause(){this.processing=!1}}const qu=5*60*1e3,BS=cr(qu),qS=(e,t,n)=>{const s=BS(e);return s===!1&&(n||{}).message==="Network Error"?qu:s},bt=new j("DataStore");var Gs;(function(e){e.CONNECTED="CONNECTED"})(Gs||(Gs={}));var Gt;(function(e){e[e.none=0]="none",e[e.unauth=1]="unauth",e[e.auth=2]="auth"})(Gt||(Gt={}));class VS{constructor(t,n,s={},i,r,o={InternalAPI:mi}){this.schema=t,this.syncPredicates=n,this.amplifyConfig=s,this.authModeStrategy=i,this.errorHandler=r,this.amplifyContext=o,this.typeQuery=new WeakMap,this.buffer=[],this.runningProcesses=new tt}buildSubscription(t,n,s,i,r,o,a=!1){const{aws_appsync_authenticationType:c}=this.amplifyConfig,{isOwner:u,ownerField:l,ownerValue:d}=this.getAuthorizationInfo(n,i,c,r,o)||{},[h,p,f]=dS(t,n,s,u,l,a);return{authMode:o,opType:h,opName:p,query:f,isOwner:u,ownerField:l,ownerValue:d}}getAuthorizationInfo(t,n,s,i,r){const o=Ku(t);if(r==="iam"&&o.find(h=>h.authStrategy==="private"&&h.provider==="iam")&&n===Gt.unauth)return null;const c=o.filter(h=>h.authStrategy==="groups"&&["userPools","oidc"].includes(h.provider));if((r==="oidc"||r==="userPool")&&c.find(h=>{if(i)return[...ES(i,h)].find(f=>h.groups.find(m=>m===f))}))return{authMode:r,isOwner:!1};let l;return l||((r==="oidc"||r==="userPool"?o.filter(h=>h.authStrategy==="owner"&&(h.provider==="oidc"||h.provider==="userPools")):[]).forEach(h=>{const p=i?.[h.identityClaim],m=t.fields[h.ownerField]?.isArray!==!0&&!h.areSubscriptionsPublic;p&&(l={authMode:r,isOwner:m,ownerField:h.ownerField,ownerValue:String(p)})}),l)?l:{authMode:r||s,isOwner:!1}}hubQueryCompletionListener(t,n){const{payload:{event:s}}=n;s===ae.SUBSCRIPTION_ACK&&t()}start(){this.runningProcesses=this.runningProcesses||new tt;const t=new me(s=>{const i=[];let r={},o,a=Gt.none;return this.runningProcesses.add(async()=>{try{a=(await Zt()).tokens?.accessToken?Gt.auth:Gt.unauth}catch{}try{o=(await Zt()).tokens?.idToken?.payload}catch{}Object.values(this.schema.namespaces).forEach(c=>{Object.values(c.models).filter(({syncable:u})=>u).forEach(u=>this.runningProcesses.isOpen&&this.runningProcesses.add(async()=>{const d=(await Lr({authModeStrategy:this.authModeStrategy,defaultAuthMode:this.amplifyConfig.aws_appsync_authenticationType,modelName:u.name,schema:this.schema})).READ;r={...r,[u.name]:{[K.CREATE]:[],[K.UPDATE]:[],[K.DELETE]:[]}};const h=[K.CREATE,K.UPDATE,K.DELETE],p={[K.CREATE]:0,[K.UPDATE]:0,[K.DELETE]:0},f=$.getPredicates(this.syncPredicates.get(u),!1),m=f!==void 0,y=async(g,E=m)=>{const{opType:v,opName:S,query:I,isOwner:T,ownerField:O,ownerValue:b,authMode:x}=this.buildSubscription(c,u,g,a,o,d[p[g]],E),U=await Hs(x,this.amplifyConfig),M={},P={category:St.DataStore,action:Bn.Subscribe};if(E&&f&&(M.filter=rs(f)),T){if(!b){s.error("Owner field required, sign in is needed in order to perform this operation");return}M[O]=b}bt.debug(`Attempting ${g} subscription with authMode: ${d[p[g]]}`);const A=this.amplifyContext.InternalAPI.graphql({query:I,variables:M,authMode:x,authToken:U},void 0,P);let F;r[u.name][v].push(A.subscribe({next:k=>{const{data:V,errors:Z}=k;if(Array.isArray(Z)&&Z.length>0){const Kt=Z.map(({message:vn})=>vn);bt.warn(`Skipping incoming subscription. Messages: ${Kt.join(`
`)}`),this.drainBuffer();return}const he=$.getPredicates(this.syncPredicates.get(u),!1),{[S]:$t}=V;this.passesPredicateValidation($t,he)&&this.pushToBuffer(v,u,$t),this.drainBuffer()},error:async k=>{const{errors:[{message:V=""}={}]}=k;if(E&&this.catchRTFError(V,u,f)){r[u.name][v].forEach(he=>he.unsubscribe()),r[u.name][v]=[],y(g,!1);return}if(V.includes(ae.REALTIME_SUBSCRIPTION_INIT_ERROR)||V.includes(ae.CONNECTION_FAILED))if(r[u.name][v].forEach(he=>he.unsubscribe()),r[u.name][v]=[],p[g]++,p[g]>=d.length)bt.debug(`${g} subscription failed with authMode: ${d[p[g]-1]}`);else{bt.debug(`${g} subscription failed with authMode: ${d[p[g]-1]}. Retrying with authMode: ${d[p[g]]}`),y(g);return}bt.warn("subscriptionError",V);try{await this.errorHandler({recoverySuggestion:"Ensure app code is up to date, auth directives exist and are correct on each model, and that server-side data has not been invalidated by a schema change. If the problem persists, search for or create an issue: https://github.com/aws-amplify/amplify-js/issues",localModel:null,message:V,model:u.name,operation:g,errorType:$S(k),process:mt.subscribe,remoteModel:null,cause:k})}catch(he){bt.error("Subscription error handler failed with:",he)}typeof F=="function"&&F(),!(V.includes('"errorType":"Unauthorized"')||V.includes('"errorType":"OperationDisabled"'))&&s.error(V)}})),i.push((async()=>{let k,V;await new Promise(Z=>{F=Z,k=this.hubQueryCompletionListener.bind(this,Z),V=ye.listen("api",k)}),V()})())};h.forEach(g=>y(g))}))}),this.runningProcesses.isOpen&&this.runningProcesses.add(()=>Promise.all(i).then(()=>{s.next(Gs.CONNECTED)}))},"subscription processor new subscriber"),this.runningProcesses.addCleaner(async()=>{Object.keys(r).forEach(c=>{r[c][K.CREATE].forEach(u=>{u.unsubscribe()}),r[c][K.UPDATE].forEach(u=>{u.unsubscribe()}),r[c][K.DELETE].forEach(u=>{u.unsubscribe()})})})}),n=new me(s=>(this.dataObserver=s,this.drainBuffer(),this.runningProcesses.addCleaner(async()=>{this.dataObserver=null})));return[t,n]}async stop(){await this.runningProcesses.close(),await this.runningProcesses.open()}passesPredicateValidation(t,n){if(!n)return!0;const{predicates:s,type:i}=n;return Ut(t,i,s)}pushToBuffer(t,n,s){this.buffer.push([t,n,s])}drainBuffer(){this.dataObserver&&(this.buffer.forEach(t=>{this.dataObserver.next(t)}),this.buffer=[])}catchRTFError(t,n,s){const i=`Backend subscriptions filtering error.
Subscriptions filtering will be applied clientside.
`,r={"UnknownArgument: Unknown field argument filter":fe.UnknownField,"Filters exceed maximum attributes limit":fe.MaxAttributes,"Filters combination exceed maximum limit":fe.MaxCombinations,"filter uses same fieldName multiple time":fe.RepeatedFieldname,"The variables input contains a field name 'not'":fe.NotGroup,"The variables input contains a field that is not defined for input object type":fe.FieldNotInType},[o,a]=Object.entries(r).find(([c])=>t.includes(c))||[];if(a!==void 0){const c=gS(a,n,s);return bt.warn(`${i}
${t}
${c}`),!0}return!1}}const WS={items:[],nextToken:null,startedAt:null},xe=new j("DataStore");class zS{constructor(t,n,s={},i,r,o){this.schema=t,this.syncPredicates=n,this.amplifyConfig=s,this.authModeStrategy=i,this.errorHandler=r,this.amplifyContext=o,this.typeQuery=new WeakMap,this.runningProcesses=new tt,o.InternalAPI=o.InternalAPI||mi,this.generateQueries()}generateQueries(){Object.values(this.schema.namespaces).forEach(t=>{Object.values(t.models).filter(({syncable:n})=>n).forEach(n=>{const[[,...s]]=Mn(t,n,"LIST");this.typeQuery.set(n,s)})})}graphqlFilterFromPredicate(t){if(!this.syncPredicates)return null;const n=$.getPredicates(this.syncPredicates.get(t),!1);return n?rs(n):null}async retrievePage(t,n,s,i=null,r,o){const[a,c]=this.typeQuery.get(t),u={limit:i,nextToken:s,lastSync:n,filter:r},d=(await Lr({authModeStrategy:this.authModeStrategy,defaultAuthMode:this.amplifyConfig.aws_appsync_authenticationType,modelName:t.name,schema:this.schema})).READ;let h=0;const p=async()=>{if(!this.runningProcesses.isOpen)throw new Error("sync.retreievePage termination was requested. Exiting.");try{xe.debug(`Attempting sync with authMode: ${d[h]}`);const v=await this.jitteredRetry({query:c,variables:u,opName:a,modelDefinition:t,authMode:d[h],onTerminate:o});return xe.debug(`Sync successful with authMode: ${d[h]}`),v}catch(v){if(h++,h>=d.length){const S=d[h-1];if(xe.debug(`Sync failed with authMode: ${S}`,v),Ua(v)||Fa(v))return xe.warn(`User is unauthorized to query ${a} with auth mode ${S}. No data could be returned.`),{data:{[a]:WS}};throw v}return xe.debug(`Sync failed with authMode: ${d[h-1]}. Retrying with authMode: ${d[h]}`),p()}},{data:f}=await p(),{[a]:m}=f,{items:y,nextToken:g,startedAt:E}=m;return{nextToken:g,startedAt:E,items:y}}async jitteredRetry({query:t,variables:n,opName:s,modelDefinition:i,authMode:r,onTerminate:o}){return Mc(async(a,c)=>{try{const u=await Hs(r,this.amplifyConfig),l={category:St.DataStore,action:Bn.GraphQl};return await this.amplifyContext.InternalAPI.graphql({query:a,variables:c,authMode:r,authToken:u},void 0,l)}catch(u){const l=Ua(u)||Fa(u);if(l)throw xe.error("Sync processor retry error:",u),new Ct(l);const d=!!u?.data?.[s]?.items,h=u?.errors&&u.errors.some(m=>m.errorType==="Unauthorized"),p=u?.errors&&u.errors.filter(m=>m.errorType!=="Unauthorized"),f=u;if(d&&(f.data[s].items=f.data[s].items.filter(m=>m!==null)),d&&p?.length&&(await Promise.all(p.map(async m=>{try{await this.errorHandler({recoverySuggestion:"Ensure app code is up to date, auth directives exist and are correct on each model, and that server-side data has not been invalidated by a schema change. If the problem persists, search for or create an issue: https://github.com/aws-amplify/amplify-js/issues",localModel:null,message:m.message,model:i.name,operation:s,errorType:xi(m),process:mt.sync,remoteModel:null,cause:m})}catch(y){xe.error("Sync error handler failed with:",y)}})),ye.dispatch("datastore",{event:"nonApplicableDataReceived",data:{errors:p,modelName:i.name}})),h)throw this.errorHandler({recoverySuggestion:"Ensure app code is up to date, auth directives exist and are correct on each model, and that server-side data has not been invalidated by a schema change. If the problem persists, search for or create an issue: https://github.com/aws-amplify/amplify-js/issues",localModel:null,message:u.message,model:i.name,operation:s,errorType:xi(u.errors[0]),process:mt.sync,remoteModel:null,cause:u}),new Ct(u);if(f.data?.[s]?.items?.length)return f;throw u}},[t,n],void 0,o)}start(t){const{maxRecordsToSync:n,syncPageSize:s}=this.amplifyConfig,i=new Map;return new me(o=>{const a=Object.values(this.schema.namespaces).reduce((u,l)=>{for(const d of Array.from(l.modelTopologicalOrdering.keys())){const h=t.get(l.models[d]);u.set(l.models[d],h)}return u},new Map),c=Array.from(a.entries()).filter(([{syncable:u}])=>u).map(([u,[l,d]])=>this.runningProcesses.isOpen&&this.runningProcesses.add(async h=>{let p=!1,f=null,m=null,y=null,g=0;const E=this.graphqlFilterFromPredicate(u),S=this.schema.namespaces[l].modelTopologicalOrdering.get(u.name).map(T=>i.get(`${l}_${T}`)),I=new Promise(async T=>{await Promise.all(S);do{if(!this.runningProcesses.isOpen){xe.debug(`Sync processor has been stopped, terminating sync for ${u.name}`),T();return}const O=Math.min(n-g,s);try{({items:y,nextToken:f,startedAt:m}=await this.retrievePage(u,d,f,O,E,h))}catch(b){try{await this.errorHandler({recoverySuggestion:"Ensure app code is up to date, auth directives exist and are correct on each model, and that server-side data has not been invalidated by a schema change. If the problem persists, search for or create an issue: https://github.com/aws-amplify/amplify-js/issues",localModel:null,message:b.message,model:u.name,operation:null,errorType:xi(b),process:mt.sync,remoteModel:null,cause:b})}catch(x){xe.error("Sync error handler failed with:",x)}p=!0,y=[]}g+=y.length,p=f===null||g>=n,o.next({namespace:l,modelDefinition:u,items:y,done:p,startedAt:m,isFullSync:!d})}while(!p);T()});i.set(`${l}_${u.name}`,I),await I},`adding model ${u.name}`));Promise.all(c).then(()=>{o.complete()})})}async stop(){xe.debug("stopping sync processor"),await this.runningProcesses.close(),await this.runningProcesses.open(),xe.debug("sync processor stopped")}}const Cn=new j("DataStore"),Pn=Symbol("sync");var ee;(function(e){e.SYNC_ENGINE_STORAGE_SUBSCRIBED="storageSubscribed",e.SYNC_ENGINE_SUBSCRIPTIONS_ESTABLISHED="subscriptionsEstablished",e.SYNC_ENGINE_SYNC_QUERIES_STARTED="syncQueriesStarted",e.SYNC_ENGINE_SYNC_QUERIES_READY="syncQueriesReady",e.SYNC_ENGINE_MODEL_SYNCED="modelSynced",e.SYNC_ENGINE_OUTBOX_MUTATION_ENQUEUED="outboxMutationEnqueued",e.SYNC_ENGINE_OUTBOX_MUTATION_PROCESSED="outboxMutationProcessed",e.SYNC_ENGINE_OUTBOX_STATUS="outboxStatus",e.SYNC_ENGINE_NETWORK_STATUS="networkStatus",e.SYNC_ENGINE_READY="ready"})(ee||(ee={}));class Vu{getModelSyncedStatus(t){return this.modelSyncedStatus.get(t)}constructor(t,n,s,i,r,o,a,c,u,l={},d,h,p){this.schema=t,this.namespaceResolver=n,this.modelClasses=s,this.userModelClasses=i,this.storage=r,this.modelInstanceCreator=o,this.syncPredicates=u,this.amplifyConfig=l,this.authModeStrategy=d,this.amplifyContext=h,this.connectivityMonitor=p,this.online=!1,this.modelSyncedStatus=new WeakMap,this.connectionDisrupted=!1,this.runningProcesses=new tt,this.waitForSleepState=new Promise(m=>{this.syncQueriesObservableStartSleeping=m});const f=this.modelClasses.MutationEvent;this.outbox=new DS(this.schema,f,o,Pn),this.modelMerger=new MS(this.outbox,Pn),this.syncQueriesProcessor=new zS(this.schema,this.syncPredicates,this.amplifyConfig,this.authModeStrategy,c,this.amplifyContext),this.subscriptionsProcessor=new VS(this.schema,this.syncPredicates,this.amplifyConfig,this.authModeStrategy,c,this.amplifyContext),this.mutationsProcessor=new jS(this.schema,this.storage,this.userModelClasses,this.outbox,this.modelInstanceCreator,f,this.amplifyConfig,this.authModeStrategy,c,a,this.amplifyContext),this.datastoreConnectivity=this.connectivityMonitor||new kS}start(t){return new me(n=>{Cn.log("starting sync engine...");let s=[];this.runningProcesses.add(async()=>{try{await this.setupModels(t)}catch(o){n.error(o);return}const i=new Promise((o,a)=>{const c=o,u=a;this.datastoreConnectivity.status().subscribe(async({online:l})=>this.runningProcesses.isOpen&&this.runningProcesses.add(async d=>{if(l&&!this.online){this.online=l,n.next({type:ee.SYNC_ENGINE_NETWORK_STATUS,data:{active:this.online}}),this.stopDisruptionListener=this.startDisruptionListener();const[h,p]=this.subscriptionsProcessor.start();try{await new Promise((f,m)=>{d.then(m);const y=h.subscribe({next:g=>{g===Gs.CONNECTED&&f()},error:g=>{m(g),this.disconnectionHandler()(g)}});s.push(y)})}catch(f){n.error(f),u();return}Cn.log("Realtime ready"),n.next({type:ee.SYNC_ENGINE_SUBSCRIPTIONS_ESTABLISHED});try{await new Promise((f,m)=>{const y=this.syncQueriesObservable().subscribe({next:g=>{const{type:E}=g;E===ee.SYNC_ENGINE_SYNC_QUERIES_READY&&f(),n.next(g)},complete:()=>{f()},error:g=>{m(g)}});y&&s.push(y)})}catch(f){n.error(f),u();return}s.push(this.mutationsProcessor.start().subscribe(({modelDefinition:f,model:m,hasMore:y})=>this.runningProcesses.add(async()=>{const g=this.userModelClasses[f.name],E=this.modelInstanceCreator(g,m);await this.storage.runExclusive(v=>this.modelMerger.merge(v,E,f)),n.next({type:ee.SYNC_ENGINE_OUTBOX_MUTATION_PROCESSED,data:{model:g,element:E}}),n.next({type:ee.SYNC_ENGINE_OUTBOX_STATUS,data:{isEmpty:!y}})},"mutation processor event"))),s.push(p.subscribe(([f,m,y])=>this.runningProcesses.add(async()=>{const g=this.userModelClasses[m.name],E=this.modelInstanceCreator(g,y);await this.storage.runExclusive(v=>this.modelMerger.merge(v,E,m))},"subscription dataSubsObservable event")))}else l||(this.online=l,n.next({type:ee.SYNC_ENGINE_NETWORK_STATUS,data:{active:this.online}}),s.forEach(h=>{h.unsubscribe()}),s=[]);c()},"datastore connectivity event"))});this.storage.observe(null,null,Pn).pipe(jn(({model:o})=>this.getModelDefinition(o).syncable===!0)).subscribe({next:async({opType:o,model:a,element:c,condition:u})=>this.runningProcesses.add(async()=>{const l=this.schema.namespaces[this.namespaceResolver(a)],d=this.modelClasses.MutationEvent,h=this.getModelDefinition(a),p=hS(u,h),f=ju(l.relationships,this.getModelDefinition(a),o,a,c,p,d,this.modelInstanceCreator);await this.outbox.enqueue(this.storage,f),n.next({type:ee.SYNC_ENGINE_OUTBOX_MUTATION_ENQUEUED,data:{model:a,element:c}}),n.next({type:ee.SYNC_ENGINE_OUTBOX_STATUS,data:{isEmpty:!1}}),await i,this.online&&this.mutationsProcessor.resume()},"storage event")}),n.next({type:ee.SYNC_ENGINE_STORAGE_SUBSCRIBED});const r=await this.outbox.peek(this.storage)===void 0;n.next({type:ee.SYNC_ENGINE_OUTBOX_STATUS,data:{isEmpty:r}}),await i,n.next({type:ee.SYNC_ENGINE_READY})},"sync start")})}async getModelsMetadataWithNextFullSync(t){return new Map((await this.runningProcesses.add(()=>this.getModelsMetadata(),"sync/index getModelsMetadataWithNextFullSync")).map(({namespace:s,model:i,lastSync:r,lastFullSync:o,fullSyncInterval:a})=>{const c=o+a,u=!o||c<t?0:r;return[this.schema.namespaces[s].models[i],[s,u]]}))}syncQueriesObservable(){return this.online?new me(t=>{let n;this.runningProcesses.isOpen&&this.runningProcesses.add(async s=>{let i=!1;for(;!t.closed&&!i;){const r=new WeakMap,o=await this.getModelsMetadataWithNextFullSync(Date.now()),a=new Set(o.keys());let c,u,l,d,h;await new Promise((f,m)=>{this.runningProcesses.isOpen||f(),s.then(()=>{f()}),n=this.syncQueriesProcessor.start(o).subscribe({next:async({namespace:y,modelDefinition:g,items:E,done:v,startedAt:S,isFullSync:I})=>{const T=this.userModelClasses[g.name];if(r.has(T)||(r.set(T,{new:0,updated:0,deleted:0}),l=Ra(),h=h===void 0?S:Math.max(h,S)),await this.storage.runExclusive(async O=>{const b=await this.outbox.getModelIds(O),x=[],U=E.filter(A=>{const F=We(g,A);return b.has(F)?(x.push(A),!1):!0}),M=[];for(const A of x){const F=await this.modelMerger.merge(O,A,g);F!==void 0&&M.push([A,F])}M.push(...await this.modelMerger.mergePage(O,T,U,g));const P=r.get(T);M.forEach(([,A])=>{switch(A){case q.INSERT:P.new++;break;case q.UPDATE:P.updated++;break;case q.DELETE:P.deleted++;break;default:throw new Error(`Invalid opType ${A}`)}})}),v){const{name:O}=g;let b=await this.getModelMetadata(y,O);const{lastFullSync:x,fullSyncInterval:U}=b;u=U,c=c===void 0?x:Math.max(c,I?S:x),b=this.modelClasses.ModelMetadata.copyOf(b,P=>{P.lastSync=S,P.lastFullSync=I?S:b.lastFullSync}),await this.storage.save(b,void 0,Pn);const M=r.get(T);this.modelSyncedStatus.set(T,!0),t.next({type:ee.SYNC_ENGINE_MODEL_SYNCED,data:{model:T,isFullSync:I,isDeltaSync:!I,counts:M}}),a.delete(g),a.size===0&&(d=Ra()-l,f(),t.next({type:ee.SYNC_ENGINE_SYNC_QUERIES_READY}),n.unsubscribe())}},error:y=>{t.error(y)}}),t.next({type:ee.SYNC_ENGINE_SYNC_QUERIES_STARTED,data:{models:Array.from(a).map(({name:y})=>y)}})});let p;c?p=c+u-(h+d):p=u-d,Cn.debug(`Next fullSync in ${p/1e3} seconds. (${new Date(Date.now()+p)})`),await this.runningProcesses.add(async f=>{let m;const y=new Promise(g=>{m=g,setTimeout(m,p)});return f.then(()=>{i=!0,this.syncQueriesObservableStartSleeping(),m()}),this.unsleepSyncQueriesObservable=m,this.syncQueriesObservableStartSleeping(),y},"syncQueriesObservable sleep"),this.unsleepSyncQueriesObservable=null,this.waitForSleepState=new Promise(f=>{this.syncQueriesObservableStartSleeping=f})}},"syncQueriesObservable main")}):ol({})}disconnectionHandler(){return t=>{(ae.CONNECTION_CLOSED===t||ae.TIMEOUT_DISCONNECT===t)&&this.datastoreConnectivity.socketDisconnected()}}unsubscribeConnectivity(){this.datastoreConnectivity.unsubscribe()}async stop(){Cn.debug("stopping sync engine"),this.unsubscribeConnectivity(),this.stopDisruptionListener&&this.stopDisruptionListener(),await this.mutationsProcessor.stop(),await this.subscriptionsProcessor.stop(),await this.datastoreConnectivity.stop(),await this.syncQueriesProcessor.stop(),await this.runningProcesses.close(),await this.runningProcesses.open(),Cn.debug("sync engine stopped and ready to restart")}async setupModels(t){const{fullSyncInterval:n}=t,s=this.modelClasses.ModelMetadata,i=[];let r;Object.values(this.schema.namespaces).forEach(c=>{Object.values(c.models).filter(({syncable:u})=>u).forEach(u=>{if(i.push([c.name,u]),c.name===wn){const l=this.userModelClasses[u.name];this.modelSyncedStatus.set(l,!1)}})});const o=i.map(async([c,u])=>{const l=await this.getModelMetadata(c,u.name),d=$.getPredicates(this.syncPredicates.get(u),!1),h=d?JSON.stringify(d):null;if(l===void 0)[[r]]=await this.storage.save(this.modelInstanceCreator(s,{model:u.name,namespace:c,lastSync:null,fullSyncInterval:n,lastFullSync:null,lastSyncPredicate:h}),void 0,Pn);else{const f=(l.lastSyncPredicate?l.lastSyncPredicate:null)!==h;[[r]]=await this.storage.save(s.copyOf(l,m=>{m.fullSyncInterval=n,f&&(m.lastSync=null,m.lastFullSync=null,m.lastSyncPredicate=h)}))}return r}),a={};for(const c of await Promise.all(o)){const{model:u}=c;a[u]=c}return a}async getModelsMetadata(){const t=this.modelClasses.ModelMetadata;return await this.storage.query(t)}async getModelMetadata(t,n){const s=this.modelClasses.ModelMetadata,i=$.createFromAST(this.schema.namespaces[Jt].models[s.name],{and:[{namespace:{eq:t}},{model:{eq:n}}]}),[r]=await this.storage.query(s,i,{page:0,limit:1});return r}getModelDefinition(t){const n=this.namespaceResolver(t);return this.schema.namespaces[n].models[t.name]}static getNamespace(){return{name:Jt,relationships:{},enums:{OperationType:{name:"OperationType",values:["CREATE","UPDATE","DELETE"]}},nonModels:{},models:{MutationEvent:{name:"MutationEvent",pluralName:"MutationEvents",syncable:!1,fields:{id:{name:"id",type:"ID",isRequired:!0,isArray:!1},model:{name:"model",type:"String",isRequired:!0,isArray:!1},data:{name:"data",type:"String",isRequired:!0,isArray:!1},modelId:{name:"modelId",type:"String",isRequired:!0,isArray:!1},operation:{name:"operation",type:{enum:"Operationtype"},isArray:!1,isRequired:!0},condition:{name:"condition",type:"String",isArray:!1,isRequired:!0}}},ModelMetadata:{name:"ModelMetadata",pluralName:"ModelsMetadata",syncable:!1,fields:{id:{name:"id",type:"ID",isRequired:!0,isArray:!1},namespace:{name:"namespace",type:"String",isRequired:!0,isArray:!1},model:{name:"model",type:"String",isRequired:!0,isArray:!1},lastSync:{name:"lastSync",type:"Int",isRequired:!1,isArray:!1},lastFullSync:{name:"lastFullSync",type:"Int",isRequired:!1,isArray:!1},fullSyncInterval:{name:"fullSyncInterval",type:"Int",isRequired:!0,isArray:!1},lastSyncPredicate:{name:"lastSyncPredicate",type:"String",isRequired:!1,isArray:!1}}}}}}startDisruptionListener(){return ye.listen("api",t=>{if(t.source==="PubSub"&&t.payload.event===cu)switch(t.payload.data.connectionState){case X.ConnectionDisrupted:this.connectionDisrupted=!0;break;case X.Connected:this.connectionDisrupted&&this.scheduleSync(),this.connectionDisrupted=!1;break}})}scheduleSync(){return this.runningProcesses.isOpen&&this.runningProcesses.add(()=>this.waitForSleepState.then(()=>{this.unsleepSyncQueriesObservable()}))}}const HS=[...Ou],er=new Map,ys=(e,t)=>{const n=t||new wE;return er.set(n,e),n},Ke=e=>{if(!er.has(e))throw new Error("Invalid predicate. Terminate your predicate with a valid condition (e.g., `p => p.field.eq('value')`) or pass `Predicates.ALL`.");return er.get(e)},tr={and:"or",or:"and",not:"and",eq:"ne",ne:"eq",gt:"le",ge:"lt",lt:"ge",le:"gt",contains:"notContains",notContains:"contains"};class Ve{constructor(t,n,s){this.field=t,this.operator=n,this.operands=s,this.validate()}copy(){return[new Ve(this.field,this.operator,[...this.operands]),void 0]}toAST(){return{[this.field]:{[this.operator]:this.operator==="between"?[this.operands[0],this.operands[1]]:this.operands[0]}}}negated(t){return this.operator==="between"?new be(t,void 0,void 0,"or",[new Ve(this.field,"lt",[this.operands[0]]),new Ve(this.field,"gt",[this.operands[1]])]):this.operator==="beginsWith"?new be(t,void 0,void 0,"not",[new Ve(this.field,"beginsWith",[this.operands[0]])]):new Ve(this.field,tr[this.operator],this.operands)}async fetch(){return Promise.reject("No implementation needed [yet].")}async matches(t){const n=t[this.field],i={eq:()=>n===this.operands[0],ne:()=>n!==this.operands[0],gt:()=>n>this.operands[0],ge:()=>n>=this.operands[0],lt:()=>n<this.operands[0],le:()=>n<=this.operands[0],contains:()=>n?.indexOf(this.operands[0])>-1,notContains:()=>n?n.indexOf(this.operands[0])===-1:!0,beginsWith:()=>n?.startsWith(this.operands[0]),between:()=>n>=this.operands[0]&&n<=this.operands[1]}[this.operator];if(i)return i();throw new Error(`Invalid operator given: ${this.operator}`)}validate(){const t=i=>{const r=i===1?"argument is":"arguments are";return()=>{if(this.operands.length!==i)return`Exactly ${i} ${r} required.`}},s={eq:t(1),ne:t(1),gt:t(1),ge:t(1),lt:t(1),le:t(1),contains:t(1),notContains:t(1),beginsWith:t(1),between:()=>t(2)()||(this.operands[0]>this.operands[1]?"The first argument must be less than or equal to the second argument.":null)}[this.operator];if(s){const i=s();if(typeof i=="string")throw new Error(`Incorrect usage of \`${this.operator}()\`: ${i}`)}else throw new Error(`Non-existent operator: \`${this.operator}()\``)}}const GS=(()=>{let e=1;return()=>`group_${e++}`})();class be{constructor(t,n,s,i,r,o=!1){this.model=t,this.field=n,this.relationshipType=s,this.operator=i,this.operands=r,this.isOptimized=o,this.groupId=GS()}copy(t){const n=new be(this.model,this.field,this.relationshipType,this.operator,[]);let s=t===this?n:void 0;return this.operands.forEach(i=>{const[r,o]=i.copy(t);n.operands.push(r),s=s||o}),[n,s]}withFieldConditionsOnly(t){const n=t!==(this.operator==="not");return new be(this.model,void 0,void 0,t?tr[this.operator]:this.operator,this.operands.filter(s=>s instanceof Ve).map(s=>n?s.negated(this.model):s))}optimized(t=!0){const n=this.operands.map(s=>s instanceof be?s.optimized(this.operator==="not"):s);if(!t&&["and","or"].includes(this.operator)&&!this.field&&n.length===1){const s=n[0];if(s instanceof Ve){if(s.operator!=="between")return s}else return s}return new be(this.model,this.field,this.relationshipType,this.operator,n,!0)}async fetch(t,n=[],s=!1){if(!this.isOptimized)return this.optimized().fetch(t);const i=[],r=s?tr[this.operator]:this.operator,o=s!==(this.operator==="not"),a=this.operands.filter(d=>d instanceof be),c=this.operands.filter(d=>d instanceof Ve);for(const d of a){const h=await d.fetch(t,[...n,this.groupId],o);if(h.length===0){if(r==="and")return[];i.push([]);continue}if(d.field){const p=In.from(this.model,d.field);if(p){const f=[];for(const y of h){const g=[];for(let E=0;E<p.localJoinFields.length;E++)g.push({[p.localJoinFields[E]]:{eq:y[p.remoteJoinFields[E]]}});f.push({and:g})}const m=$.createFromAST(this.model.schema,{or:f});i.push(await t.query(this.model.builder,m))}else throw new Error("Missing field metadata.")}else i.push(h)}if(c.length>0){const d=this.withFieldConditionsOnly(o).toStoragePredicate();i.push(await t.query(this.model.builder,d))}else c.length===0&&i.length===0&&i.push(await t.query(this.model.builder));const u=d=>JSON.stringify(this.model.pkField.map(h=>d[h]));let l;if(r==="and"){if(i.length===0)return[];for(const d of i)if(l===void 0)l=new Map(d.map(h=>[u(h),h]));else{const h=new Map(d.map(p=>[u(p),p]));for(const p of l.keys())h.has(p)||l.delete(p)}}else if(r==="or"||r==="not"){l=new Map;for(const d of i)for(const h of d)l.set(u(h),h)}return Array.from(l?.values()||[])}async matches(t,n=!1){const s=this.field&&!n?await t[this.field]:t;if(!s)return!1;if(this.relationshipType==="HAS_MANY"&&typeof s[Symbol.asyncIterator]=="function"){for await(const i of s)if(await this.matches(i,!0))return!0;return!1}if(this.operator==="or")return DE(this.operands,i=>i.matches(s));if(this.operator==="and")return FE(this.operands,i=>i.matches(s));if(this.operator==="not"){if(this.operands.length!==1)throw new Error("Invalid arguments! `not()` accepts exactly one predicate expression.");return!await this.operands[0].matches(s)}else throw new Error("Invalid group operator!")}toAST(){if(this.field)throw new Error("Nested type conditions are not supported!");return{[this.operator]:this.operands.map(t=>t.toAST())}}toStoragePredicate(){return $.createFromAST(this.model.schema,this.toAST())}toJSON(){return{...this,model:this.model.schema.name}}}function Ot(e,t=!0,n,s,i){const r=new be(e,n,void 0,"and",[]),o=s&&i?s:r,a=s&&i?i:r,c={};ys(o,c);const u=()=>{const[l,d]=o.copy(a),h=Ot(e,t,void 0,l,d);return{query:l,newTail:d,newLink:h}};["and","or"].forEach(l=>{c[l]=d=>{const{query:h,newTail:p}=u(),f=d(Ot(e,t));if(!Array.isArray(f))throw new Error(`Invalid predicate. \`${l}\` groups must return an array of child conditions.`);return p?.operands.push(new be(e,n,void 0,l,f.map(m=>Ke(m)))),ys(h)}}),c.not=l=>{const{query:d,newTail:h}=u();return h?.operands.push(new be(e,n,void 0,"not",[Ke(l(Ot(e,t)))])),ys(d)};for(const l in e.schema.allFields)Object.defineProperty(c,l,{enumerable:!0,get:()=>{const d=e.schema.allFields[l];if(d.association)if(t)if(d.association.connectionType==="BELONGS_TO"||d.association.connectionType==="HAS_ONE"||d.association.connectionType==="HAS_MANY"){const h=d.type.modelConstructor;if(!h)throw new Error("Related model metadata is missing. This is a bug! Please report it.");const[p,f]=o.copy(a),m=new be(h,l,d.association.connectionType,"and",[]);return f.operands.push(m),Ot(h,t,void 0,p,m)}else throw new Error("Related model definition doesn't have a typedef. This is a bug! Please report it.");else throw new Error("Predication on releated models is not supported in this context.");else return HS.reduce((h,p)=>({...h,[p]:(...f)=>{const{query:m,newTail:y}=u(),g=f.map(E=>E===void 0?null:E);return y?.operands.push(new Ve(l,p,g)),ys(m)}}),{})}});return c}function gs(e){return Ot(e,!1)}const QS=()=>typeof process<"u"&&process.versions!=null&&process.versions.node!=null;al(!0);cl();const L=new j("DataStore"),YS=ku(Date.now()),qa="schemaVersion";let ie;const yi=new WeakMap,Wt=new WeakMap,pe=e=>{const t=yi.get(e);return t?ie.namespaces[t].models[e.name]:void 0},je=e=>kt(e)&&yi.has(e),Es=e=>{const t=yi.get(e);if(!t)throw new Error(`Namespace Resolver for '${e.name}' not found! This is probably a bug in '@amplify-js/datastore'.`);return t},_i=e=>{if(!e)throw new Error("Missing modelConstructor");const t=pe(e);if(!t)throw new Error("Missing modelSchema");const n=te(t);if(!n)throw new Error("Could not determine PK");return Ot({builder:e,schema:t,pkField:n})};let Br,Qt,qr,Wu;const Bt=new WeakMap;var Re;(function(e){e.Detached="Detached",e.DataStore="DataStore",e.API="API"})(Re||(Re={}));const nr=new WeakMap;function xt(e,t){return Array.isArray(e)?e.map(n=>xt(n,t)):e&&nr.set(e,t),e}const Va=e=>nr.has(e)?nr.get(e):Re.Detached,cw=e=>{if(ie!==void 0)return console.warn("The schema has already been initialized"),Qt;L.log("validating schema",{schema:e}),JS(e.codegenVersion);const t={name:wn,...e};L.log("DataStore","Init models"),Qt=Ss(t),L.log("DataStore","Models initialized");const n=nw(),s=Zi.getNamespace(),i=Vu.getNamespace();return qr=Ss(n),Wu=Ss(s),Br=Ss(i),ie={namespaces:{[n.name]:n,[t.name]:t,[s.name]:s,[i.name]:i},version:e.version,codegenVersion:e.codegenVersion},Object.keys(ie.namespaces).forEach(r=>{const[o,a]=Uu(ie.namespaces[r]);ie.namespaces[r].relationships=o,ie.namespaces[r].keys=a;const c=new Map;Object.values(ie.namespaces[r].models).forEach(d=>{const h=[];Object.values(d.fields).filter(m=>m.association&&m.association.connectionType==="BELONGS_TO"&&m.type.model!==d.name).forEach(m=>h.push(m.type.model)),c.set(d.name,h),Object.values(d.fields).forEach(m=>{const y=Qt[m.type.model];kt(y)&&Object.defineProperty(m.type,"modelConstructor",{get:()=>{const g=pe(y);if(!g)throw new Error(`Could not find model definition for ${y.name}`);return{builder:y,schema:g,pkField:te(g)}}})});const{indexes:p}=ie.namespaces[r].relationships[d.name],f=new Set;for(const m of p)for(const y of m[1])f.add(y);d.allFields={...Object.fromEntries([...f.values()].map(m=>[m,{name:m,type:"ID",isArray:!1}])),...d.fields}});const u=new Map;let l=1e3;for(;l>0&&c.size!==0;){if(l--,l===0)throw new Error("Models are not topologically sortable. Please verify your schema.");for(const d of Array.from(c.keys())){const h=c.get(d);h?.every(p=>u.has(p))&&u.set(d,h)}Array.from(u.keys()).forEach(d=>c.delete(d))}ie.namespaces[r].modelTopologicalOrdering=u}),Qt},Wa=()=>{if(ie===void 0){const e="Schema is not initialized. DataStore will not function as expected. This could happen if you have multiple versions of DataStore installed. Please see https://docs.amplify.aws/lib/troubleshooting/upgrading/q/platform/js/#check-for-duplicate-versions";throw L.error(e),new Error(e)}},JS=e=>{let s=!1;try{const i=e.split("."),[r,o]=i;s=Number(r)===3&&Number(o)>=2}catch(i){console.log(`Error parsing codegen version: ${e}
${i}`)}if(!s){const i=`Models were generated with an unsupported version of codegen. Codegen artifacts are from ${e||"an unknown version"}, whereas ^3.2.0 is required. Update to the latest CLI and run 'amplify codegen models'.`;throw L.error(i),new Error(i)}},Ss=e=>{const t={};return Object.entries(e.models).forEach(([n,s])=>{const i=XS(s);t[n]=i,yi.set(i,e.name)}),Object.entries(e.nonModels||{}).forEach(([n,s])=>{const i=ew(s);t[n]=i}),t},zu=new WeakSet;function Xt(e,t){return zu.add(t),new e(t)}const Qs=e=>(t,n)=>{const s=e.fields[t];if(s!==void 0){const{type:i,isRequired:r,isArrayNullable:o,name:a,isArray:c}=s,l=!!(Gi(e)?JE(e):{})[a];if((!c&&r||c&&!o)&&!l&&n==null)throw new Error(`Field ${a} is required`);if(Gi(e)&&!Fu(e)&&te(e).includes(t)&&n==="")throw L.error($n.idEmptyString,{k:t,value:n}),new Error($n.idEmptyString);if(Cu(i)){const d=Ft.getJSType(i),h=Ft.getValidationFunction(i);if(i==="AWSJSON"){if(typeof n===d)return;if(typeof n=="string")try{JSON.parse(n);return}catch{throw new Error(`Field ${a} is an invalid JSON object. ${n}`)}}if(c){let p=d;if(r||(p=`${d} | null | undefined`),!Array.isArray(n)&&!o)throw new Error(`Field ${a} should be of type [${p}], ${typeof n} received. ${n}`);if(!we(n)&&n.some(f=>we(f)?r:typeof f!==d)){const f=n.map(m=>m===null?"null":typeof m).join(",");throw new Error(`All elements in the ${a} array should be of type ${p}, [${f}] received. ${n}`)}if(h&&!we(n)&&!n.map(m=>we(m)?!!(we(m)&&!r):h(m)).every(m=>m))throw new Error(`All elements in the ${a} array should be of type ${i}, validation failed for one or more elements. ${n}`)}else if(!(!r&&n===void 0)){if(typeof n!==d&&n!==null)throw new Error(`Field ${a} should be of type ${d}, ${typeof n} received. ${n}`);if(!we(n)&&h&&!h(n))throw new Error(`Field ${a} should be of type ${i}, validation failed. ${n}`)}}else if(qs(i)&&!we(n)){const d=ie.namespaces.user.nonModels[i.nonModel],h=Qs(d);if(c){let p=i.nonModel;if(r||(p=`${i.nonModel} | null | undefined`),!Array.isArray(n))throw new Error(`Field ${a} should be of type [${p}], ${typeof n} received. ${n}`);n.forEach(f=>{if(we(f)&&r||typeof f!="object"&&typeof f<"u")throw new Error(`All elements in the ${a} array should be of type ${i.nonModel}, [${typeof f}] received. ${f}`);we(f)||Object.keys(d.fields).forEach(m=>{h(m,f[m])})})}else{if(typeof n!="object")throw new Error(`Field ${a} should be of type ${i.nonModel}, ${typeof n} recieved. ${n}`);Object.keys(d.fields).forEach(p=>{h(p,n[p])})}}}},Hu=(e,t,n)=>{const{isArray:s,type:i}=e.fields[t]||{};if(typeof n=="string"&&(s||i==="AWSJSON"||qs(i)||Pu(i)))try{return JSON.parse(n)}catch{}return typeof n=="number"&&i==="Boolean"?!!n:n},sr=new WeakMap,Gu=(e,t,n)=>{const s=Qs(t);Object.entries(e).forEach(([i,r])=>{const o=Hu(t,i,r);s(i,o),n[i]=o})},za=(e,t)=>{for(const n of Object.keys(e.fields))t[n]===void 0&&(t[n]=null)},XS=e=>{const t=class{constructor(i){let r=[];const o=Dn(this,c=>{Gu(i,e,c);const u=zu.has(i),l=u?i:{},{id:d}=l;if(Fu(e)){const y=d!=null?d:e.syncable?Mt():YS();c.id=y}else YE(e)&&(c.id=c.id||Mt());u||ZS(c,e);const{_version:h,_lastChangedAt:p,_deleted:f}=l;e.syncable&&(c._version=h,c._lastChangedAt=p,c._deleted=f)},c=>r=c),a=Dn(o,c=>{za(e,c)});return sr.set(a,r),a}static copyOf(i,r){const o=Object.getPrototypeOf(i||{}).constructor;if(!je(o)){const l="The source object is not a valid model";throw L.error(l,{source:i}),new Error(l)}let a=[];const c=Dn(i,l=>{r(l),te(e).forEach(p=>{l[p]!==i[p]&&L.warn(`copyOf() does not update PK fields. The '${p}' update is being ignored.`,{source:i}),l[p]=i[p]});const h=Qs(e);Object.entries(l).forEach(([p,f])=>{const m=Hu(e,p,f);h(p,m)}),za(e,l)},l=>a=l),u=Wt.has(i);if(a.length||u)if(u){const[l,d]=Wt.get(i),h=HE(d,l,a);Wt.set(c,[h,d]),Ga(h,e)}else Wt.set(c,[a,i]),Ga(a,e);else Wt.set(c,[[],i]);return xt(c,Re.DataStore)}static fromJSON(i){if(Array.isArray(i))return i.map(a=>this.fromJSON(a));const r=Xt(t,i),o=Qs(e);return Object.entries(r).forEach(([a,c])=>{o(a,c)}),xt(r,Re.DataStore)}};t[tc]=!0,Object.defineProperty(t,"name",{value:e.name});const n=In.allFrom({builder:t,schema:e,pkField:te(e)});for(const s of n){const{field:i}=s;Object.defineProperty(t.prototype,e.fields[i].name,{set(r){if(typeof r=="object"||typeof r>"u"){if(r&&Object.prototype.hasOwnProperty.call(r,"_version")){const o=Object.getPrototypeOf(r||{}).constructor;if(!je(o)){const a=`Value passed to ${e.name}.${i} is not a valid instance of a model`;throw L.error(a,{model:r}),new Error(a)}if(o.name.toLowerCase()!==s.remoteModelConstructor.name.toLowerCase()){const a=`Value passed to ${e.name}.${i} is not an instance of ${s.remoteModelConstructor.name}`;throw L.error(a,{model:r}),new Error(a)}}if(s.isComplete){for(let a=0;a<s.localJoinFields.length;a++)this[s.localJoinFields[a]]=r?.[s.remoteJoinFields[a]];const o=Bt.has(this)?Bt.get(this):Bt.set(this,{}).get(this);o[i]=r||void 0}}},get(){const r=Bt.has(this)?Bt.get(this):Bt.set(this,{}).get(this);if(!Object.prototype.hasOwnProperty.call(r,i))if(Va(this)===Re.DataStore){const o=Vr.query(s.remoteModelConstructor,a=>a.and(c=>s.remoteJoinFields.map((u,l)=>c[u].eq(this[s.localJoinFields[l]]))));s.type==="HAS_MANY"?r[i]=new Ha(o):r[i]=o.then(a=>{if(a.length>1){const c=new Error(`
									Data integrity error.
									Too many records found for a HAS_ONE/BELONGS_TO field '${e.name}.${i}'
								`);throw console.error(c),c}else return a[0]})}else{if(Va(this)===Re.API)throw new Error("Lazy loading from API is not yet supported!");return s.type==="HAS_MANY"?new Ha([]):Promise.resolve(void 0)}return r[i]}})}return t};class Ha{constructor(t){this.values=t}[Symbol.asyncIterator](){let t,n=0;return{next:async()=>{if(t||(t=await this.values),n<t.length){const s={value:t[n],done:!1};return n++,s}return{value:null,done:!0}}}}async toArray({max:t=Number.MAX_SAFE_INTEGER}={}){const n=[];let s=0;for await(const i of this)if(s<t)n.push(i),s++;else break;return n}}const ZS=(e,t)=>{const n=Object.keys(e),{fields:s}=t;n.forEach(i=>{if(s[i]&&s[i].isReadOnly)throw new Error(`${i} is read-only.`)})},Ga=(e,t)=>{const n=e.map(i=>[i.path[0],i.value]),{fields:s}=t;n.forEach(([i,r])=>{if(!(!r||!s[i])&&s[i].isReadOnly)throw new Error(`${i} is read-only.`)})},ew=e=>{const t=class{constructor(s){return Dn(this,r=>{Gu(s,e,r)})}};return t[tc]=!0,Object.defineProperty(t,"name",{value:e.name}),PE(t),t};function Qa(e){return typeof e=="string"}function Ya(e){const{localModel:t,modelConstructor:n,remoteModel:s}=e,{_version:i}=s;return Xt(n,{...t,_version:i})}function Ja(e){L.warn(e)}function Xa(e,t){let n;switch(e){case kr:n=qr[t];break;case wn:n=Qt[t];break;case Jt:n=Br[t];break;case Ru:n=Wu[t];break;default:throw new Error(`Invalid namespace: ${e}`)}if(je(n))return n;{const s=`Model name is not valid for namespace. modelName: ${t}, namespace: ${e}`;throw L.error(s),new Error(s)}}async function tw(e,t){const n=qr.Setting,s=ie.namespaces[kr].models.Setting;await e.runExclusive(async i=>{const[r]=await i.query(n,$.createFromAST(s,{and:{key:{eq:qa}}}),{page:0,limit:1});r!==void 0&&r.value!==void 0?JSON.parse(r.value)!==t&&await i.clear(!1):await i.save(Xt(n,{key:qa,value:JSON.stringify(t)}))})}let At;function nw(){return{name:kr,relationships:{},enums:{},nonModels:{},models:{Setting:{name:"Setting",pluralName:"Settings",syncable:!1,fields:{id:{name:"id",type:"ID",isRequired:!0,isArray:!1},key:{name:"key",type:"String",isRequired:!0,isArray:!1},value:{name:"value",type:"String",isRequired:!0,isArray:!1}}}}}}var Je;(function(e){e.NotRunning="Not Running",e.Starting="Starting",e.Running="Running",e.Stopping="Stopping",e.Clearing="Clearing"})(Je||(Je={}));class sw{constructor(){this.InternalAPI=mi,this.Cache=Pc,this.amplifyConfig={},this.syncPredicates=new WeakMap,this.amplifyContext={InternalAPI:this.InternalAPI},this.runningProcesses=new tt,this.state=Je.NotRunning,this.start=async()=>this.runningProcesses.add(async()=>{if(this.state=Je.Starting,this.initialized===void 0)L.debug("Starting DataStore"),this.initialized=new Promise((n,s)=>{this.initResolve=n,this.initReject=s});else{await this.initialized;return}this.storage=new Zi(ie,Es,Xa,Xt,this.storageAdapter,this.sessionId),await this.storage.init(),Wa(),await tw(this.storage,ie.version);const{aws_appsync_graphqlEndpoint:t}=this.amplifyConfig;if(t){L.debug("GraphQL endpoint available",t),this.syncPredicates=await this.processSyncExpressions(),this.sync=new Vu(ie,Es,Br,Qt,this.storage,Xt,this.conflictHandler,this.errorHandler,this.syncPredicates,this.amplifyConfig,this.authModeStrategy,this.amplifyContext,this.connectivityMonitor);const n=this.fullSyncInterval*1e3*60;At=this.sync.start({fullSyncInterval:n}).subscribe({next:({type:s,data:i})=>{const r=QS()?ee.SYNC_ENGINE_SYNC_QUERIES_READY:ee.SYNC_ENGINE_STORAGE_SUBSCRIBED;s===r&&this.initResolve(),ye.dispatch("datastore",{event:s,data:i})},error:s=>{L.warn("Sync error",s),this.initReject()}})}else L.warn("Data won't be synchronized. No GraphQL endpoint configured. Did you forget `Amplify.configure(awsconfig)`?",{config:this.amplifyConfig}),this.initResolve();await this.initialized,this.state=Je.Running},"datastore start").catch(this.handleAddProcError("DataStore.start()")),this.query=async(t,n,s)=>this.runningProcesses.add(async()=>{await this.start();let i;if(!this.storage)throw new Error("No storage to query");if(!je(t)){const u="Constructor is not for a valid model";throw L.error(u,{modelConstructor:t}),new Error(u)}typeof n=="string"&&s!==void 0&&L.warn("Pagination is ignored when querying by id");const r=pe(t);if(!r)throw new Error("Invalid model definition provided!");const o=this.processPagination(r,s),a=te(r);if(Qa(n)){if(a.length>1){const l=$n.queryByPkWithCompositeKeyPresent;throw L.error(l,{keyFields:a}),new Error(l)}const u=$.createFromFlatEqualities(r,{[a[0]]:n});i=await this.storage.query(t,u,o)}else if(ps(n,r)){const u=$.createForPk(r,n);i=await this.storage.query(t,u,o)}else if(!n||Ai(n))i=await this.storage?.query(t,void 0,o);else{const u=Ot({builder:t,schema:r,pkField:te(r)});i=await Ke(n(u)).fetch(this.storage),i=Dr(i,o)}const c=Qa(n)||ps(n,r);return xt(c?i[0]:i,Re.DataStore)},"datastore query").catch(this.handleAddProcError("DataStore.query()")),this.save=async(t,n)=>this.runningProcesses.add(async()=>{if(await this.start(),!this.storage)throw new Error("No storage to save to");const s=Wt.get(t),i=sr.has(t)?[sr.get(t),{}]:void 0,r=s||i,o=t?t.constructor:void 0;if(!je(o)){const d="Object is not an instance of a valid model";throw L.error(d,{model:t}),new Error(d)}const a=pe(o);if(!a)throw new Error("Model Definition could not be found for model");const c={builder:o,schema:a,pkField:te(a)};await this.storage.runExclusive(async d=>{const h=In.allFrom(c).filter(p=>p.type==="BELONGS_TO");for(const p of h){const f=p.createRemoteQueryObject(t);if(f!==null&&(await d.query(p.remoteModelConstructor,$.createFromFlatEqualities(p.remoteDefinition,f))).length===0)throw new Error([`Data integrity error. You tried to save a ${a.name} (${JSON.stringify(t)})`,`but the instance assigned to the "${p.field}" property`,"does not exist in the local database. If you're trying to create the related",`"${p.remoteDefinition?.name}", you must save it independently first.`].join(" "))}});const u=n?Ke(n(gs(c))).toStoragePredicate():void 0,[l]=await this.storage.runExclusive(async d=>(await d.save(t,u,void 0,r),d.query(o,$.createForPk(a,t))));return xt(l,Re.DataStore)},"datastore save").catch(this.handleAddProcError("DataStore.save()")),this.setConflictHandler=t=>{const{DataStore:n}=t,s=()=>this.conflictHandler===Ya;return n&&n.conflictHandler?n.conflictHandler:s()&&t.conflictHandler?t.conflictHandler:this.conflictHandler||Ya},this.setErrorHandler=t=>{const{DataStore:n}=t,s=()=>this.errorHandler===Ja;return n&&n.errorHandler?n.errorHandler:s()&&t.errorHandler?t.errorHandler:this.errorHandler||Ja},this.delete=async(t,n)=>this.runningProcesses.add(async()=>{if(await this.start(),!this.storage)throw new Error("No storage to delete from");let s;if(!t){const i="Model or Model Constructor required";throw L.error(i,{modelOrConstructor:t}),new Error(i)}if(je(t)){const i=t;if(!n){const a="Id to delete or criteria required. Do you want to delete all? Pass Predicates.ALL";throw L.error(a,{identifierOrCriteria:n}),new Error(a)}const r=pe(i);if(!r)throw new Error("Could not find model definition for modelConstructor.");if(typeof n=="string"){const a=te(r);if(a.length>1){const c=$n.deleteByPkWithCompositeKeyPresent;throw L.error(c,{keyFields:a}),new Error(c)}s=$.createFromFlatEqualities(r,{[a[0]]:n})}else if(ps(n,r)?s=$.createForPk(r,n):s=Ke(n(gs({builder:i,schema:r,pkField:te(r)}))).toStoragePredicate(),!s||!$.isValidPredicate(s)){const a="Criteria required. Do you want to delete all? Pass Predicates.ALL";throw L.error(a,{condition:s}),new Error(a)}const[o]=await this.storage.delete(i,s);return xt(o,Re.DataStore)}else{const i=t,r=Object.getPrototypeOf(i||{}).constructor;if(!je(r)){const u="Object is not an instance of a valid model";throw L.error(u,{model:i}),new Error(u)}const o=pe(r);if(!o)throw new Error("Could not find model definition for modelConstructor.");const a=$.createForPk(o,i);if(n){if(typeof n!="function"){const u="Invalid criteria";throw L.error(u,{identifierOrCriteria:n}),new Error(u)}s=Ke(n(gs({builder:r,schema:o,pkField:te(o)}))).toStoragePredicate()}else s=a;const[[c]]=await this.storage.delete(i,s);return xt(c,Re.DataStore)}},"datastore delete").catch(this.handleAddProcError("DataStore.delete()")),this.observe=(t,n)=>{let s;const i=t&&je(t)?t:void 0;if(t&&i===void 0){const r=t,o=r&&Object.getPrototypeOf(r).constructor;if(je(o))return n&&L.warn("idOrCriteria is ignored when using a model instance",{model:r,identifierOrCriteria:n}),this.observe(o,r.id);{const a="The model is not an instance of a PersistentModelConstructor";throw L.error(a,{model:r}),new Error(a)}}if(n&&i&&ps(n,pe(i))){const r=$n.observeWithObjectLiteral;throw L.error(r,{objectLiteral:n}),new Error(r)}if(n!==void 0&&i===void 0){const r="Cannot provide criteria without a modelConstructor";throw L.error(r,n),new Error(r)}if(i&&!je(i)){const r="Constructor is not for a valid model";throw L.error(r,{modelConstructor:i}),new Error(r)}return i&&typeof n=="string"?s=Ke((o=>o.id.eq(n))(_i(i))):i&&typeof n=="function"&&(s=Ke(n(_i(i)))),new me(r=>{let o;return this.runningProcesses.add(async()=>{await this.start(),o=this.storage.observe(i).pipe(jn(({model:a})=>Es(a)===wn)).subscribe({next:a=>this.runningProcesses.isOpen&&this.runningProcesses.add(async()=>{let c=a;if(a.opType!=="DELETE"){const u=pe(a.model),l=te(u),d=QE(a.element,l),h=await this.query(a.model,d);c={...c,element:h}}(!s||await s.matches(c.element))&&r.next(c)},"datastore observe message handler"),error:a=>{r.error(a)},complete:()=>{r.complete()}})},"datastore observe observable initialization").catch(this.handleAddProcError("DataStore.observe()")).catch(a=>{r.error(a)}),this.runningProcesses.addCleaner(async()=>{o&&o.unsubscribe()},"DataStore.observe() cleanup")})},this.observeQuery=(t,n,s)=>new me(i=>{const r=new Map,o=new Map;let a=[],c,u;const l=()=>{const S=m();y(S)},d=new zE({callback:l,errorHandler:i.error,maxInterval:2e3}),{sort:h}=s||{},p=h?{sort:h}:void 0;if(!pe(t))throw new Error("Could not find model definition.");t&&typeof n=="function"?u=Ke(n(_i(t))):Ai(n)&&(u=void 0),this.runningProcesses.add(async()=>{try{(await this.query(t,n,p)).forEach(S=>{const I=pe(t),T=We(I,S);r.set(T,S)}),c=this.observe(t).subscribe(({element:S,model:I,opType:T})=>this.runningProcesses.isOpen&&this.runningProcesses.add(async()=>{const O=pe(I),b=We(O,S);if(u&&!await u.matches(S))if(T==="UPDATE"&&(r.has(b)||o.has(b)))a.push(b);else return;T==="DELETE"?a.push(b):o.set(b,S);const x=this.sync?.getModelSyncedStatus(I)??!1;(o.size-a.length>=this.syncPageSize||x)&&d.resolve(),d.start()},"handle observeQuery observed event")),l()}catch(S){i.error(S)}},"datastore observequery startup").catch(this.handleAddProcError("DataStore.observeQuery()")).catch(S=>{i.error(S)});const m=()=>{const S=this.sync?.getModelSyncedStatus(t)??!1,I=[...Array.from(r.values()),...Array.from(o.values())];r.clear(),I.forEach(O=>{const b=pe(t),x=We(b,O);r.set(x,O)}),a.forEach(O=>r.delete(O));const T=Array.from(r.values());return s?.sort&&g(T),{items:T,isSynced:S}},y=S=>{i.next(S),o.clear(),a=[]},g=S=>{const I=pe(t),T=this.processPagination(I,s),O=_e.getPredicates(T.sort);if(O.length){const b=Mu(O);S.sort(b)}},E=({payload:S})=>{const{event:I,data:T}=S;I===ee.SYNC_ENGINE_MODEL_SYNCED&&T?.model?.name===t.name&&(l(),v())},v=ye.listen("datastore",E);return this.runningProcesses.addCleaner(async()=>{c&&c.unsubscribe()},"datastore observequery cleaner")}),this.configure=(t={})=>{this.amplifyContext.InternalAPI=this.InternalAPI;const{DataStore:n,authModeStrategyType:s,maxRecordsToSync:i,syncPageSize:r,fullSyncInterval:o,syncExpressions:a,authProviders:c,storageAdapter:u,...l}=t,d=W.getConfig().API?.GraphQL,h={aws_appsync_graphqlEndpoint:d?.endpoint,aws_appsync_authenticationType:d?.defaultAuthMode,aws_appsync_region:d?.region,aws_appsync_apiKey:d?.apiKey};switch(this.amplifyConfig={...this.amplifyConfig,...l,...d&&h},this.conflictHandler=this.setConflictHandler(t),this.errorHandler=this.setErrorHandler(t),n&&n.authModeStrategyType||s||Ln.DEFAULT){case Ln.MULTI_AUTH:this.authModeStrategy=tS(this.amplifyContext);break;case Ln.DEFAULT:this.authModeStrategy=Ma;break;default:this.authModeStrategy=Ma;break}this.amplifyConfig.authProviders=n&&n.authProviders||c,this.syncExpressions=n&&n.syncExpressions||a||this.syncExpressions,this.maxRecordsToSync=n&&n.maxRecordsToSync||i||this.maxRecordsToSync||1e4,this.amplifyConfig.maxRecordsToSync=this.maxRecordsToSync,this.syncPageSize=n&&n.syncPageSize||r||this.syncPageSize||1e3,this.amplifyConfig.syncPageSize=this.syncPageSize,this.fullSyncInterval=n&&n.fullSyncInterval||o||this.fullSyncInterval||24*60,this.storageAdapter=n&&n.storageAdapter||u||this.storageAdapter||void 0,this.sessionId=this.retrieveSessionId()}}getModuleName(){return"DataStore"}handleAddProcError(t){return s=>{throw s.message.startsWith("BackgroundManagerNotOpenError")?new Error([`DataStoreStateError: Tried to execute \`${t}\` while DataStore was "${this.state}".`,'This can only be done while DataStore is "Started" or "Stopped". To remedy:',"Ensure all calls to `stop()` and `clear()` have completed first.","If this is not possible, retry the operation until it succeeds."].join(`
`)):s}}async clear(){Wa(),this.state=Je.Clearing,await this.runningProcesses.close(),this.storage===void 0&&(this.storage=new Zi(ie,Es,Xa,Xt,this.storageAdapter,this.sessionId),await this.storage.init()),At&&!At.closed&&At.unsubscribe(),this.sync&&await this.sync.stop(),await this.storage.clear(),this.initialized=void 0,this.storage=void 0,this.sync=void 0,this.syncPredicates=new WeakMap,await this.runningProcesses.open(),this.state=Je.NotRunning}async stop(){this.state=Je.Stopping,await this.runningProcesses.close(),At&&!At.closed&&At.unsubscribe(),this.sync&&await this.sync.stop(),this.initialized=void 0,this.sync=void 0,await this.runningProcesses.open(),this.state=Je.NotRunning}processPagination(t,n){let s;const{limit:i,page:r,sort:o}=n||{};if(!(i===void 0&&r===void 0&&o===void 0)){if(r!==void 0&&i===void 0)throw new Error("Limit is required when requesting a page");if(r!==void 0){if(typeof r!="number")throw new Error("Page should be a number");if(r<0)throw new Error("Page can't be negative")}if(i!==void 0){if(typeof i!="number")throw new Error("Limit should be a number");if(i<0)throw new Error("Limit can't be negative")}return o&&(s=_e.createFromExisting(t,o)),{limit:i,page:r,sort:s}}}async processSyncExpressions(){if(!this.syncExpressions||!this.syncExpressions.length)return new WeakMap;const t=await Promise.all(this.syncExpressions.map(async n=>{const{modelConstructor:s,conditionProducer:i}=await n,r=pe(s),o=await this.unwrapPromise(i);if(Ai(o))return[r,null];const a=Ke(o(gs({builder:s,schema:r,pkField:te(r)}))).toStoragePredicate();return[r,a]}));return this.weakMapFromEntries(t)}async unwrapPromise(t){try{return await t()||t}catch(n){if(n instanceof TypeError)return t;throw n}}weakMapFromEntries(t){return t.reduce((n,[s,i])=>{if(n.has(s)){const{name:r}=s;return L.warn(`You can only utilize one Sync Expression per model.
          Subsequent sync expressions for the ${r} model will be ignored.`),n}return i&&n.set(s,i),n},new WeakMap)}retrieveSessionId(){try{const t=sessionStorage.getItem("datastoreSessionId");if(t){const{aws_appsync_graphqlEndpoint:n}=this.amplifyConfig,s=n.split("/")[2],[i]=s.split(".");return`${t}-${i}`}}catch{}}}const Vr=new sw;Vr.configure({});ye.listen("core",e=>{e.payload.event==="configure"&&Vr.configure({})});export{rw as A,ym as D,ye as H,yr as a,am as b,Lf as c,Hf as d,ow as e,aw as g,cw as i,Wf as r,qf as s};
