import{a as te,u as se,f as re,r as t,j as e}from"./react-vendor-C_ls207L.js";import{b as q,c as le}from"./index-zctVBz0Z.js";import{u as oe}from"./usePlanningData-B1SNKOR8.js";import{S as W}from"./StandardLayout-CHsFjCWf.js";import{T as v}from"./TextInput-BQHZCKtc.js";import{F as ne}from"./FormBox-Dl2qNixC.js";import{P as ie}from"./PrimaryButton-BzVl43HT.js";import{S as ce}from"./ShareMoreModal-DnXwJGI9.js";import{g as me}from"./amplify-core-Blotw2Bg.js";import"./vendor-DeJPPs1q.js";import"./sanity-BS235U2J.js";import"./stripe-CN_WJsnY.js";import"./PageWrapper-CRYaw3_L.js";import"./Footer-B_S_3MWt.js";/* empty css                  */const ue=[{value:"family",label:"Family Member"},{value:"friend",label:"Friend"},{value:"coworker",label:"Colleague/Co-worker"},{value:"caregiver",label:"Caregiver"},{value:"other",label:"Other"}],Fe=()=>{const u=te(),j=se(),_=re(),{isLoading:Y,user:l}=q?q():{isLoading:!1,user:null},{formData:o,currentPlanId:G}=oe(),U=me(),[c,d]=t.useState(""),[n,h]=t.useState(""),[I,f]=t.useState(""),[H,p]=t.useState(""),[y,b]=t.useState(null),[V,w]=t.useState(!1),[i,C]=t.useState(!1),[N,de]=t.useState(null),[z,E]=t.useState(!1),[D,J]=t.useState({name:""}),[P,g]=t.useState({fullName:!1,email:!1}),x=a=>{g(m=>({...m,[a]:!0}))},K=a=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a),F=_.inviteId||null;t.useEffect(()=>{C(!!F),d(""),h(""),f(""),p("")},[F]);const S=async a=>{var m,A,M,O,k,B,L,T,$;if(a&&a.preventDefault(),!c.trim()&&!n.trim()){b("Please enter a name and email address."),g({fullName:!0,email:!0});return}if(!n.trim()||!K(n)){b("Please enter a valid email address."),g(s=>({...s,email:!0}));return}w(!0),b(null);try{if(!(l!=null&&l.userId))throw new Error("User not authenticated");let s=G;if(!s)throw new Error("No farewell plan found. Please create your farewell plan first.");let r=((m=l.attributes)==null?void 0:m.name)||((A=l.attributes)==null?void 0:A.given_name)||((M=o==null?void 0:o.basicInformation)==null?void 0:M.firstName)||((k=(O=l.attributes)==null?void 0:O.email)==null?void 0:k.split("@")[0])||"Plan Owner";(B=o==null?void 0:o.basicInformation)!=null&&B.lastName?r=`${o.basicInformation.firstName||r} ${o.basicInformation.lastName}`:(L=l.attributes)!=null&&L.family_name&&(r=`${l.attributes.given_name||r} ${l.attributes.family_name}`);const R={name:c.trim()||null,email:n.trim(),planOwnerId:l.userId,planOwnerName:r,farewellPlanCollaboratorsId:s,invitedAt:new Date().toISOString(),status:"pending",role:I||"viewer"};console.log("Creating collaborator with input:",R);const ae=(await U.graphql({query:le,variables:{input:R}})).data.createCollaborator;console.log("Collaborator created successfully:",ae),J({name:c||n}),E(!0),w(!1),d(""),h(""),f(""),p(""),g({fullName:!1,email:!1})}catch(s){console.error("Error creating collaborator:",s);let r="Unable to share your wishes. Please try again.";(T=s.message)!=null&&T.includes("not authenticated")?r="Please sign in to share your wishes.":($=s.message)!=null&&$.includes("No farewell plan")?r="Please complete your farewell plan before sharing.":s.errors&&s.errors.length>0&&(r=s.errors[0].message||r),b(r),w(!1)}},Q=()=>{E(!1),d(""),h(""),f(""),p("")},X=()=>{j.key!=="default"&&j.pathname!=="/"?u(-1):u(i?"/":"/confirm-wishes")},Z=()=>{u("/donation")},ee=()=>"Add people who can access your farewell wishes.";return Y?e.jsx(W,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"h1b",children:"Loading"})," ",e.jsx("span",{className:"h1",children:"Information"})]}),subtitle:e.jsx("span",{className:"h1sub",children:"Please wait"}),children:e.jsx("div",{className:"form-box-container",children:e.jsx("div",{className:"form-box",style:{textAlign:"center",padding:"20px"},children:"Loading your information..."})})}):e.jsx(W,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"h1b",children:"Share"})," ",e.jsx("span",{className:"h1",children:"Your Wishes"})]}),subtitle:e.jsx("span",{className:"h1sub",children:ee()}),onGoBack:X,onSaveContinue:S,continueButtonText:i?"Accept Invitation":"Share Wishes",showSkipButton:!1,hideFooter:!0,showFooter:!1,mobileResponsive:!0,children:e.jsx("div",{className:"add-collaborators-container",children:e.jsxs(ne,{className:"collaborator-form-box",children:[e.jsx("button",{className:"form-exit-button",onClick:Z,"aria-label":"Exit to donation screen",children:e.jsx("img",{src:"/Picture/exit-x.svg",alt:"Exit"})}),e.jsxs("form",{className:"collaborator-form",onSubmit:S,children:[e.jsx("div",{className:"form-field",children:e.jsx(v,{label:"Full Name",id:"collaboratorFullName",value:c,onChange:a=>{d(a.target.value),x("fullName")},onBlur:()=>x("fullName"),placeholder:"First & Last Name",required:!!c.trim()||!!n.trim()})}),e.jsx("div",{className:"form-field",children:e.jsx(v,{label:"Email Address",id:"collaboratorEmail",type:"email",value:n,onChange:a=>{h(a.target.value),x("email")},onBlur:()=>x("email"),placeholder:i?"Your Email Address":"Enter their email address",required:!!c.trim()||!!n.trim(),disabled:i&&(N==null?void 0:N.invitedEmail)})}),e.jsx("div",{className:"form-field",children:e.jsx(v,{type:"dropdown",label:`Relationship ${i?"to the Plan Owner":"to You"} (Optional)`,options:ue,value:I,onChange:a=>f(a.target.value),placeholder:"Choose from dropdown"})}),e.jsx("div",{className:"form-field",children:e.jsx(v,{label:`Personal Message ${i?"to the Plan Owner":"to Them"} (Optional)`,id:"personalMessage",multiline:!0,value:H,onChange:a=>p(a.target.value),placeholder:i?"Add a note for the plan owner...":"Write a short note to let them know why you're sharing...",textareaClassName:"tributes-textarea farewell-scrollbar",style:{minHeight:"7rem"}})}),y&&(P.fullName||P.email)&&e.jsx("div",{className:"error-helper",children:y}),e.jsx("div",{className:"button-container-centered",children:e.jsx(ie,{onClick:S,disabled:V,className:"centered-button",children:i?"Accept Invitation":"Share Wishes"})})]}),z&&e.jsx(ce,{collaboratorName:D.name,onClose:()=>u("/donation"),onShareMore:Q})]})})})};export{Fe as default};
