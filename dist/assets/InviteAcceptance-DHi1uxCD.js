import{f as y,a as S,r as t,j as e}from"./react-vendor-C_ls207L.js";import{u as C,g as L}from"./index-zctVBz0Z.js";import{u as P}from"./useCollaborators-DjJ28Jpg.js";import{S as l}from"./StandardLayout-CHsFjCWf.js";import{F as c}from"./FormBox-Dl2qNixC.js";import{P as p}from"./PrimaryButton-BzVl43HT.js";import E from"./Login-B86rE5XQ.js";import{g as O}from"./amplify-core-Blotw2Bg.js";import"./vendor-DeJPPs1q.js";import"./sanity-BS235U2J.js";import"./stripe-CN_WJsnY.js";import"./PageWrapper-CRYaw3_L.js";import"./Footer-B_S_3MWt.js";import"./TextInput-BQHZCKtc.js";/* empty css                  *//* empty css                        */const Q=()=>{const{inviteId:r}=y(),{isAuthenticated:n,isLoading:h}=C(),{updateCollaborator:u}=P(),o=S(),[a,g]=t.useState(null),[f,x]=t.useState(!0),[d,i]=t.useState(""),[b,w]=t.useState(!1),j=O();t.useEffect(()=>{r&&N()},[r]),t.useEffect(()=>{n&&a&&a.status==="pending"&&v()},[n,a]);const N=async()=>{try{const m=(await j.graphql({query:L,variables:{id:r}})).data.getCollaborator;m?(g(m),n||localStorage.setItem("pendingInviteId",r)):i("Invalid or expired invitation.")}catch(s){console.error("Error fetching invite:",s),i("Unable to load invitation details.")}finally{x(!1)}},v=async()=>{try{await u(r,{status:"accepted",respondedAt:new Date().toISOString()}),localStorage.removeItem("pendingInviteId"),o("/collaborator/welcome",{state:{planOwnerName:a.planOwnerName,farewellPlanId:a.farewellPlanCollaboratorsId}})}catch(s){console.error("Error accepting invite:",s),i("Failed to accept invitation. Please try again.")}},I=()=>{w(!0)};return h||f?e.jsx(l,{title:e.jsx("span",{className:"h1",children:"Loading..."}),subtitle:e.jsx("span",{className:"h1sub",children:"Please wait while we process your invitation."}),children:e.jsx("div",{className:"onboarding-form-content",children:e.jsx(c,{className:"onboarding-formbox",children:e.jsx("p",{children:"Loading invitation details..."})})})}):d?e.jsx(l,{title:e.jsx("span",{className:"h1",children:"Invitation Error"}),subtitle:e.jsx("span",{className:"h1sub",children:"There was a problem with your invitation."}),children:e.jsx("div",{className:"onboarding-form-content",children:e.jsxs(c,{className:"onboarding-formbox",children:[e.jsx("p",{className:"error-message",children:d}),e.jsx(p,{onClick:()=>o("/"),children:"Return to Homepage"})]})})}):b?e.jsx(E,{}):n&&(a==null?void 0:a.status)==="accepted"?(o("/collaborator/welcome",{state:{planOwnerName:a.planOwnerName,farewellPlanId:a.farewellPlanCollaboratorsId}}),null):e.jsx(l,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"h1",children:"You're invited to view "}),e.jsxs("span",{className:"h1b",children:[(a==null?void 0:a.planOwnerName)||"someone","'s"]}),e.jsx("span",{className:"h1",children:" farewell plan"})]}),subtitle:e.jsxs("span",{className:"h1sub",children:[a==null?void 0:a.planOwnerName," has shared their farewell wishes with you."]}),children:e.jsx("div",{className:"onboarding-form-content",children:e.jsxs(c,{className:"onboarding-formbox",children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"2rem"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:a==null?void 0:a.planOwnerName})," has invited you to view and collaborate on their farewell plan."]}),e.jsx("p",{children:"To continue, please sign in to your account or create a new one."})]}),!n&&e.jsx("div",{className:"onboarding-button-container",children:e.jsx(p,{onClick:I,children:"Sign In to Continue"})})]})})})};export{Q as default};
