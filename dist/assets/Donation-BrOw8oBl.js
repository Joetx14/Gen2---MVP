import{G as he,R as o,y as ye,z as ge,r as C,H as ve}from"./index-C2ptP9zk.js";import{S as be}from"./StandardLayout-AckhbhSc.js";import{F as Ee}from"./FormBox-B7cn36Ju.js";import"./TextInput-C3p8qorw.js";import{u as Ce}from"./usePlanningData-EtnObrgk.js";import"./PageWrapper-BzhDbW5c.js";import"./Footer-CZyU5Jsg.js";var K={exports:{}},V,ee;function Se(){if(ee)return V;ee=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return V=r,V}var Z,te;function ke(){if(te)return Z;te=1;var r=Se();function e(){}function t(){}return t.resetWarningCache=e,Z=function(){function n(m,g,i,c,d,v){if(v!==r){var l=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}n.isRequired=n;function s(){return n}var a={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:s,element:n,elementType:n,instanceOf:s,node:n,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:t,resetWarningCache:e};return a.PropTypes=a,a},Z}var re;function xe(){return re||(re=1,K.exports=ke()()),K.exports}var Pe=xe();const p=he(Pe);function ne(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function oe(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ne(Object(t),!0).forEach(function(n){ce(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ne(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function Y(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Y=function(e){return typeof e}:Y=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Y(r)}function ce(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Ne(r,e){if(r==null)return{};var t={},n=Object.keys(r),s,a;for(a=0;a<n.length;a++)s=n[a],!(e.indexOf(s)>=0)&&(t[s]=r[s]);return t}function we(r,e){if(r==null)return{};var t=Ne(r,e),n,s;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);for(s=0;s<a.length;s++)n=a[s],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}function le(r,e){return Oe(r)||Ae(r,e)||Re(r,e)||Te()}function Oe(r){if(Array.isArray(r))return r}function Ae(r,e){var t=r&&(typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"]);if(t!=null){var n=[],s=!0,a=!1,m,g;try{for(t=t.call(r);!(s=(m=t.next()).done)&&(n.push(m.value),!(e&&n.length===e));s=!0);}catch(i){a=!0,g=i}finally{try{!s&&t.return!=null&&t.return()}finally{if(a)throw g}}return n}}function Re(r,e){if(r){if(typeof r=="string")return ae(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ae(r,e)}}function ae(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function Te(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var x=function(e,t,n){var s=!!n,a=o.useRef(n);o.useEffect(function(){a.current=n},[n]),o.useEffect(function(){if(!s||!e)return function(){};var m=function(){a.current&&a.current.apply(a,arguments)};return e.on(t,m),function(){e.off(t,m)}},[s,t,e,a])},G=function(e){var t=o.useRef(e);return o.useEffect(function(){t.current=e},[e]),t.current},F=function(e){return e!==null&&Y(e)==="object"},je=function(e){return F(e)&&typeof e.then=="function"},_e=function(e){return F(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},se="[object Object]",Fe=function r(e,t){if(!F(e)||!F(t))return e===t;var n=Array.isArray(e),s=Array.isArray(t);if(n!==s)return!1;var a=Object.prototype.toString.call(e)===se,m=Object.prototype.toString.call(t)===se;if(a!==m)return!1;if(!a&&!n)return e===t;var g=Object.keys(e),i=Object.keys(t);if(g.length!==i.length)return!1;for(var c={},d=0;d<g.length;d+=1)c[g[d]]=!0;for(var v=0;v<i.length;v+=1)c[i[v]]=!0;var l=Object.keys(c);if(l.length!==g.length)return!1;var O=e,S=t,P=function($){return r(O[$],S[$])};return l.every(P)},ue=function(e,t,n){return F(e)?Object.keys(e).reduce(function(s,a){var m=!F(t)||!Fe(e[a],t[a]);return n.includes(a)?(m&&console.warn("Unsupported prop change: options.".concat(a," is not a mutable property.")),s):m?oe(oe({},s||{}),{},ce({},a,e[a])):s},null):null},pe="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",ie=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pe;if(e===null||_e(e))return e;throw new Error(t)},$e=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pe;if(je(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(s){return ie(s,t)})};var n=ie(e,t);return n===null?{tag:"empty"}:{tag:"sync",stripe:n}},Ie=function(e){!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:"react-stripe-js",version:"3.7.0"}),e.registerAppInfo({name:"react-stripe-js",version:"3.7.0",url:"https://stripe.com/docs/stripe-js/react"}))},z=o.createContext(null);z.displayName="ElementsContext";var me=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},fe=function(e){var t=e.stripe,n=e.options,s=e.children,a=o.useMemo(function(){return $e(t)},[t]),m=o.useState(function(){return{stripe:a.tag==="sync"?a.stripe:null,elements:a.tag==="sync"?a.stripe.elements(n):null}}),g=le(m,2),i=g[0],c=g[1];o.useEffect(function(){var l=!0,O=function(P){c(function(N){return N.stripe?N:{stripe:P,elements:P.elements(n)}})};return a.tag==="async"&&!i.stripe?a.stripePromise.then(function(S){S&&l&&O(S)}):a.tag==="sync"&&!i.stripe&&O(a.stripe),function(){l=!1}},[a,i,n]);var d=G(t);o.useEffect(function(){d!==null&&d!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[d,t]);var v=G(n);return o.useEffect(function(){if(i.elements){var l=ue(n,v,["clientSecret","fonts"]);l&&i.elements.update(l)}},[n,v,i.elements]),o.useEffect(function(){Ie(i.stripe)},[i.stripe]),o.createElement(z.Provider,{value:i},s)};fe.propTypes={stripe:p.any,options:p.object};var Le=function(e){var t=o.useContext(z);return me(t,e)},We=function(){var e=Le("calls useElements()"),t=e.elements;return t};p.func.isRequired;var de=o.createContext(null);de.displayName="CheckoutSdkContext";var De=function(e,t){if(!e)throw new Error("Could not find CheckoutProvider context; You need to wrap the part of your app that ".concat(t," in an <CheckoutProvider> provider."));return e},qe=o.createContext(null);qe.displayName="CheckoutContext";p.any,p.shape({fetchClientSecret:p.func.isRequired,elementsOptions:p.object}).isRequired;var X=function(e){var t=o.useContext(de),n=o.useContext(z);if(t&&n)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CheckoutProvider> and <Elements> providers."));return t?De(t,e):me(n,e)},Be=["mode"],Ue=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},h=function(e,t){var n="".concat(Ue(e),"Element"),s=function(i){var c=i.id,d=i.className,v=i.options,l=v===void 0?{}:v,O=i.onBlur,S=i.onFocus,P=i.onReady,N=i.onChange,$=i.onEscape,I=i.onClick,R=i.onLoadError,L=i.onLoaderStart,W=i.onNetworksChange,D=i.onConfirm,T=i.onCancel,B=i.onShippingAddressChange,U=i.onShippingRateChange,q=X("mounts <".concat(n,">")),j="elements"in q?q.elements:null,A="checkoutSdk"in q?q.checkoutSdk:null,H=o.useState(null),M=le(H,2),E=M[0],J=M[1],w=o.useRef(null),f=o.useRef(null);x(E,"blur",O),x(E,"focus",S),x(E,"escape",$),x(E,"click",I),x(E,"loaderror",R),x(E,"loaderstart",L),x(E,"networkschange",W),x(E,"confirm",D),x(E,"cancel",T),x(E,"shippingaddresschange",B),x(E,"shippingratechange",U),x(E,"change",N);var k;P&&(e==="expressCheckout"?k=P:k=function(){P(E)}),x(E,"ready",k),o.useLayoutEffect(function(){if(w.current===null&&f.current!==null&&(j||A)){var u=null;if(A)switch(e){case"payment":u=A.createPaymentElement(l);break;case"address":if("mode"in l){var _=l.mode,Q=we(l,Be);if(_==="shipping")u=A.createShippingAddressElement(Q);else if(_==="billing")u=A.createBillingAddressElement(Q);else throw new Error("Invalid options.mode. mode must be 'billing' or 'shipping'.")}else throw new Error("You must supply options.mode. mode must be 'billing' or 'shipping'.");break;case"expressCheckout":u=A.createExpressCheckoutElement(l);break;case"currencySelector":u=A.createCurrencySelectorElement();break;default:throw new Error("Invalid Element type ".concat(n,". You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />."))}else j&&(u=j.create(e,l));w.current=u,J(u),u&&u.mount(f.current)}},[j,A,l]);var b=G(l);return o.useEffect(function(){if(w.current){var u=ue(l,b,["paymentRequest"]);u&&"update"in w.current&&w.current.update(u)}},[l,b]),o.useLayoutEffect(function(){return function(){if(w.current&&typeof w.current.destroy=="function")try{w.current.destroy(),w.current=null}catch{}}},[]),o.createElement("div",{id:c,className:d,ref:f})},a=function(i){X("mounts <".concat(n,">"));var c=i.id,d=i.className;return o.createElement("div",{id:c,className:d})},m=t?a:s;return m.propTypes={id:p.string,className:p.string,onChange:p.func,onBlur:p.func,onFocus:p.func,onReady:p.func,onEscape:p.func,onClick:p.func,onLoadError:p.func,onLoaderStart:p.func,onNetworksChange:p.func,onConfirm:p.func,onCancel:p.func,onShippingAddressChange:p.func,onShippingRateChange:p.func,options:p.object},m.displayName=n,m.__elementType=e,m},y=typeof window>"u",Me=o.createContext(null);Me.displayName="EmbeddedCheckoutProviderContext";var Ye=function(){var e=X("calls useStripe()"),t=e.stripe;return t};h("auBankAccount",y);h("card",y);h("cardNumber",y);h("cardExpiry",y);h("cardCvc",y);h("fpxBank",y);h("iban",y);h("idealBank",y);h("p24Bank",y);h("epsBank",y);var ze=h("payment",y);h("expressCheckout",y);h("currencySelector",y);h("paymentRequestButton",y);h("linkAuthentication",y);h("address",y);h("shippingAddress",y);h("paymentMethodMessaging",y);h("affirmMessage",y);h("afterpayClearpayMessage",y);const He=ve("pk_test_51RXq0S4ULmLYjN7nF1rMkXtrZ5Ll67OYqjEiJoG5khgSlVYdZy0LuJDqyHySjJgAaggB2gKhEgKkZgpKsCiCnbFn00tPOnrlhl"),Je=({donationAmount:r,firstName:e,lastName:t,setPaymentError:n,setIsSubmitting:s,navigate:a,clientSecret:m,isRecurring:g})=>{const i=Ye(),c=We(),[d,v]=C.useState(!1);C.useEffect(()=>{console.log("DonationFormContent mounted"),console.log("Stripe initialized:",!!i),console.log("Elements initialized:",!!c)},[i,c]);const l=async O=>{if(O.preventDefault(),v(!0),s(!0),!i||!c){n("Stripe is not loaded yet. Please try again in a moment."),v(!1),s(!1);return}n(null);try{const S=await i.confirmPayment({elements:c,confirmParams:{return_url:`${window.location.origin}/dashboard?payment_success=true`,payment_method_data:{billing_details:{name:`${e} ${t}`.trim(),email:e?`${e.toLowerCase()}@example.com`:void 0}}},redirect:"if_required"});S.error?(console.error("[Stripe error]",S.error),n(S.error.message||"An unexpected error occurred during payment."),v(!1),s(!1)):a("/dashboard?payment_success=true")}catch(S){console.error("Payment confirmation error:",S),n("An unexpected error occurred. Please try again."),v(!1),s(!1)}};return o.createElement("form",{onSubmit:l,className:"payment-form"},o.createElement("div",{style:{marginBottom:"20px"}},o.createElement(ze,{options:{layout:"tabs"}})),o.createElement("button",{type:"submit",className:"pay-button",disabled:!i||!c||d,style:{width:"100%",padding:"12px",backgroundColor:"#c05f68",color:"white",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"600",cursor:"pointer"}},d?o.createElement("span",null,"Processing..."):o.createElement("span",null,"Pay $",r.toFixed(2))))},tt=()=>{const r=ye(),e=ge(),{routeToLastStep:t}=Ce(),n=e.state?.returnToPlanning,s=e.state?.lastStep,[a,m]=C.useState(!0),g=[3,9],i=[10,25],[c,d]=C.useState(g[0]),[v,l]=C.useState(""),[O,S]=C.useState(""),[P,N]=C.useState(null),[$,I]=C.useState(!1),[R,L]=C.useState(!1),[W,D]=C.useState(""),[T,B]=C.useState(""),[U,q]=C.useState(null);C.useEffect(()=>{(async()=>{if(c<=0){B(""),N("Donation amount must be greater than zero.");return}N(null);try{console.log("Fetching client secret for amount:",c);const k=Math.round(c*100),b=await fetch("https://us-central1-farewell-app.cloudfunctions.net/createPaymentIntent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:k,isRecurring:a})});if(!b.ok){const _=await b.json().catch(()=>null);throw new Error(_&&_.error?_.error:`HTTP error! Status: ${b.status}`)}const u=await b.json();console.log("Client secret received:",u.clientSecret?"✓":"✗"),B(u.clientSecret)}catch(k){console.error("Error fetching client secret:",k),N(`Failed to initialize payment: ${k.message}`)}})()},[c,a]),C.useEffect(()=>{R&&parseFloat(W)>0?d(parseFloat(W)):(d(a?g[0]:i[0]),L(!1)),D("")},[a]);const j=f=>{m(f)},A=f=>{d(f),L(!1)},H=()=>{L(!0),R||D(c.toString())},M=f=>{const b=f.target.value.replace(/[^\d.]/g,"").split(".");if(b.length>2)return;b[1]&&b[1].length>2&&(b[1]=b[1].substring(0,2));const u=b.join(".");D(u),d(parseFloat(u)||0)},E=()=>{r(n&&s?s:"/confirm-wishes")},J=C.useMemo(()=>T?{clientSecret:T,appearance:{theme:"stripe",variables:{colorPrimary:"#c05f68",colorBackground:"#ffffff",colorText:"#30313d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',borderRadius:"4px"}},loader:"auto"}:null,[T]),w=async()=>{try{I(!0);const f=Math.round(c*100),k=await fetch("https://us-central1-farewell-app.cloudfunctions.net/createCheckoutSession",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:f,isRecurring:a,successUrl:`${window.location.origin}/dashboard?success=true`,cancelUrl:`${window.location.origin}/donation?canceled=true`})});if(!k.ok){const u=await k.json().catch(()=>null);throw new Error(u?.error||`HTTP error ${k.status}`)}const{url:b}=await k.json();console.log("Redirecting to checkout:",b),window.location.href=b}catch(f){console.error("Error redirecting to checkout:",f),N(`Failed to redirect to checkout: ${f.message}`),I(!1)}};return o.createElement(be,{title:o.createElement(o.Fragment,null,o.createElement("span",{className:"h1b"},"Support")," ",o.createElement("span",{className:"h1"},"Our Cause")),subtitle:o.createElement("span",{className:"h1sub"},"And secure access to Farewell for life!"),hideFooter:!0,showFooter:!1},o.createElement("div",{className:"donation-container"},o.createElement(Ee,{className:"donation-form-box"},o.createElement("button",{type:"button",className:"exit-button",onClick:E,"aria-label":"Close donation form"},o.createElement("img",{src:"/Picture/exit-x.svg",alt:"Close"})),o.createElement("div",{className:"impact-message"},"Your contribution helps families navigate end-of-life planning with dignity and care."),o.createElement("div",{className:"contribution-tabs",role:"tablist"},o.createElement("button",{type:"button",className:`tab ${a?"active":""}`,onClick:()=>j(!0),role:"tab","aria-selected":a,"aria-controls":"monthly-donation-panel",id:"monthly-tab"},o.createElement("span",{className:"tab-label"},"Monthly"),o.createElement("span",{className:"tab-benefit"},"Help us grow")),o.createElement("button",{type:"button",className:`tab ${a?"":"active"}`,onClick:()=>j(!1),role:"tab","aria-selected":!a,"aria-controls":"one-time-donation-panel",id:"one-time-tab"},o.createElement("span",{className:"tab-label"},"One-time"),o.createElement("span",{className:"tab-benefit"},"Quick support"))),o.createElement("div",{className:"amount-selection",role:"tabpanel",id:a?"monthly-donation-panel":"one-time-donation-panel","aria-labelledby":a?"monthly-tab":"one-time-tab"},o.createElement("label",{className:"form-label",id:"select-amount-label"},"Select an amount"),o.createElement("div",{className:"amount-options",role:"radiogroup","aria-labelledby":"select-amount-label"},(a?g:i).map(f=>o.createElement("button",{key:f,type:"button",className:`amount-option ${c===f&&!R?"selected":""}`,onClick:()=>A(f),role:"radio","aria-checked":c===f&&!R},"$",f)),o.createElement("button",{type:"button",className:`amount-option ${R?"selected":""}`,onClick:H,role:"radio","aria-checked":R},"Custom")),R&&o.createElement("div",{className:"custom-amount"},o.createElement("div",{className:"input-with-prefix"},o.createElement("span",{className:"currency-prefix","aria-hidden":"true"},"$"),o.createElement("input",{className:"custom-amount-input",type:"text",value:W,onChange:M,placeholder:"0.00","aria-label":"Custom donation amount",inputMode:"decimal",autoFocus:!0}))),o.createElement("div",{className:"amount-summary","aria-live":"polite"},o.createElement("span",{className:"amount-label"},a?"Monthly donation:":"One-time donation:"),o.createElement("span",{className:"amount-value"},"$",c.toFixed(2)))),T&&c>0?o.createElement(fe,{stripe:He,options:J},o.createElement(Je,{donationAmount:c,firstName:v,lastName:O,setPaymentError:N,setIsSubmitting:I,navigate:r,clientSecret:T,isRecurring:a})):o.createElement("div",{className:"loading-payment-section"},P?o.createElement("p",{className:"error-message"},P):o.createElement("p",null,"Loading payment options...")),U&&o.createElement("div",{className:"error-message full-width"},U),o.createElement("div",{className:"privacy-note"},o.createElement("p",{className:"donation-privacy-text"},"Your payment information is secure. By proceeding, you agree to our ",o.createElement("a",{href:"/terms",target:"_blank",rel:"noopener noreferrer"},"Terms of Service")," and ",o.createElement("a",{href:"/privacy",target:"_blank",rel:"noopener noreferrer"},"Privacy Policy"),".")),o.createElement("p",{className:"unlock-message"},"By completing this support, you'll immediately unlock access to all future features of Farewell at no additional cost."),!1,o.createElement("button",{type:"button",onClick:w,className:"pay-button",style:{width:"100%",padding:"12px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"600",cursor:"pointer",marginTop:"10px"}},"Try Stripe Checkout Instead"))))};export{tt as default};
