import{y as L,F,r as o,A,R as e}from"./index-BDULtanx.js";import{u as D}from"./usePlanningData-CeIF-zwT.js";import{P as W}from"./PrimaryButton-CcQCH6qR.js";import{F as B}from"./FormBox-CQ-4ucf6.js";import{S as P}from"./StandardLayout-BI2Ss88D.js";import{S as g}from"./ShareMoreModal-ouASwZtI.js";import"./PageWrapper-CJ_6LTVp.js";import"./Footer-CveEMXpG.js";const $=()=>{const u=L(),{user:w,isAuthenticated:d}=F(),{currentPlanId:s}=D(),[n,E]=o.useState([]),[C,c]=o.useState(!0),[p,v]=o.useState(null),[y,b]=o.useState(!1),[f,N]=o.useState(null),i=o.useRef(null),h=A();o.useEffect(()=>{(async()=>{if(d&&s)try{c(!0),console.log("Fetching collaborators for plan:",s);const m=(await h.models.Collaborator.list({filter:{farewellPlanCollaboratorsId:{eq:s}}})).items||[];console.log("Raw collaborator data:",m);const r=m.map(l=>({id:l.id,name:l.name||l.email.split("@")[0],email:l.email,relationship:l.role||"Collaborator",status:l.status,invitedAt:l.invitedAt}));console.log("Transformed collaborators:",r),E(r),c(!1)}catch(t){console.error("Error fetching collaborators:",t),c(!1)}else console.log("Not fetching collaborators - authenticated:",d,"planId:",s),c(!1)})()},[d,w,s,h]),o.useEffect(()=>{function a(t){i.current&&!i.current.contains(t.target)&&N(null)}return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[i]);const S=async a=>{try{console.log("Removing collaborator:",a);const t=n.find(r=>r.id===a),m=await h.graphql({query:deleteCollaborator,variables:{input:{id:a}}});console.log("Collaborator deleted successfully:",m.data.deleteCollaborator),E(n.filter(r=>r.id!==a)),v(t)}catch(t){console.error("Error removing collaborator:",t)}},R=a=>{N(f===a?null:a)},k=()=>{v(null)},x=()=>{u("/add-collaborator")},M=()=>{b(!1),u("/add-collaborator")};return e.createElement(P,{title:e.createElement(e.Fragment,null,e.createElement("span",{className:"h1b"},"Shared "),e.createElement("span",{className:"h1"},"Wishes")),subtitle:e.createElement("span",{className:"h1sub"},"Update who can view your Farewell Wishes â€” add trusted people or remove access as needed."),hideFooter:!0,showFooter:!1},e.createElement("div",{className:"collaborator-dashboard-container"},e.createElement(B,{className:"collaborator-form-box"},e.createElement("div",{className:"current-collaborators-section"},e.createElement("h2",{className:"section-title"},"Current Collaborators"),C?e.createElement("div",{className:"loading-indicator"},"Loading collaborators..."):n.length===0?e.createElement("div",{className:"no-collaborators-message"},e.createElement("p",null,"You haven't shared your wishes with anyone yet.")):e.createElement("div",{className:"collaborator-cards"},e.createElement("div",{className:"collaborator-card header"},e.createElement("div",{className:"collaborator-name"},"Name"),e.createElement("div",{className:"collaborator-email"},"Email"),e.createElement("div",{className:"collaborator-relationship"},"Relationship"),e.createElement("div",{className:"collaborator-actions"},"Remove")),n.map(a=>e.createElement("div",{key:a.id,className:"collaborator-card"},e.createElement("div",{className:"collaborator-name"},a.name),e.createElement("div",{className:"collaborator-email"},a.email),e.createElement("div",{className:"collaborator-relationship"},a.relationship||"Not specified"),e.createElement("div",{className:"mobile-details"},e.createElement("div",{className:"details-dropdown",ref:i},e.createElement("button",{className:"more-button",onClick:()=>R(a.id),"aria-label":"Show more details"},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#34547A",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},e.createElement("circle",{cx:"12",cy:"12",r:"1"}),e.createElement("circle",{cx:"12",cy:"5",r:"1"}),e.createElement("circle",{cx:"12",cy:"19",r:"1"}))),f===a.id&&e.createElement("div",{className:"details-dropdown-content show"},e.createElement("div",{className:"detail-item"},e.createElement("span",{className:"detail-label"},"Email:"),e.createElement("span",null,a.email)),e.createElement("div",{className:"detail-item"},e.createElement("span",{className:"detail-label"},"Relationship:"),e.createElement("span",null,a.relationship||"Not specified"))))),e.createElement("div",{className:"collaborator-actions"},e.createElement("button",{className:"remove-button",onClick:()=>S(a.id),"aria-label":`Remove ${a.name}`},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#B93636",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},e.createElement("path",{d:"M3 6h18"}),e.createElement("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}))))))),e.createElement("div",{className:"share-button-container"},e.createElement(W,{onClick:x,className:"share-wishes-btn"},"Share Wishes"))))),p&&e.createElement(g,{modalType:"removeSuccess",collaboratorName:p.name,onClose:k}),y&&e.createElement(g,{modalType:"shareMore",isReturningUser:!0,onClose:()=>b(!1),onShareMore:M}))};export{$ as default};
