import{y as V,z as j,u as J,F as A,A as K,r as l,R as e}from"./index-CfyrB-Jf.js";import{u as Q}from"./usePlanningData-Dk-VhFrX.js";import{S as M}from"./StandardLayout-COLC9qI8.js";import{T as E}from"./TextInput-CYEPzTM5.js";import{F as X}from"./FormBox-B6bUczmp.js";import{P as Z}from"./PrimaryButton-BvMykqgP.js";import{S as ee}from"./ShareMoreModal-DUSEEUPV.js";import"./PageWrapper-CEQC3pGQ.js";import"./Footer-BDbKV7Ex.js";import"./TextInput-ChRIhU7X.js";const ae=[{value:"family",label:"Family Member"},{value:"friend",label:"Friend"},{value:"coworker",label:"Colleague/Co-worker"},{value:"caregiver",label:"Caregiver"},{value:"other",label:"Other"}],he=()=>{const m=V(),N=j(),O=J(),{isLoading:k,user:o}=A?A():{isLoading:!1,user:null},{formData:c,currentPlanId:B}=Q(),L=K(),[i,u]=l.useState(""),[s,d]=l.useState(""),[S,f]=l.useState(""),[T,h]=l.useState(""),[I,p]=l.useState(null),[R,v]=l.useState(!1),[n,y]=l.useState(!1),[$,te]=l.useState(null),[D,C]=l.useState(!1),[q,W]=l.useState({name:""}),[x,b]=l.useState({fullName:!1,email:!1}),g=a=>{b(t=>({...t,[a]:!0}))},_=a=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a),P=O.inviteId||null;l.useEffect(()=>{y(!!P),u(""),d(""),f(""),h("")},[P]);const w=async a=>{if(a&&a.preventDefault(),!i.trim()&&!s.trim()){p("Please enter a name and email address."),b({fullName:!0,email:!0});return}if(!s.trim()||!_(s)){p("Please enter a valid email address."),b(t=>({...t,email:!0}));return}v(!0),p(null);try{if(!o?.userId)throw new Error("User not authenticated");let t=B;if(!t)throw new Error("No farewell plan found. Please create your farewell plan first.");let r=o.attributes?.name||o.attributes?.given_name||c?.basicInformation?.firstName||o.attributes?.email?.split("@")[0]||"Plan Owner";c?.basicInformation?.lastName?r=`${c.basicInformation.firstName||r} ${c.basicInformation.lastName}`:o.attributes?.family_name&&(r=`${o.attributes.given_name||r} ${o.attributes.family_name}`);const F={name:i.trim()||null,email:s.trim(),planOwnerId:o.userId,planOwnerName:r,farewellPlanCollaboratorsId:t,invitedAt:new Date().toISOString(),status:"pending",role:S||"viewer"};console.log("Creating collaborator with input:",F);const H=(await L.graphql({query:createCollaborator,variables:{input:F}})).data.createCollaborator;console.log("Collaborator created successfully:",H),W({name:i||s}),C(!0),v(!1),u(""),d(""),f(""),h(""),b({fullName:!1,email:!1})}catch(t){console.error("Error creating collaborator:",t);let r="Unable to share your wishes. Please try again.";t.message?.includes("not authenticated")?r="Please sign in to share your wishes.":t.message?.includes("No farewell plan")?r="Please complete your farewell plan before sharing.":t.errors&&t.errors.length>0&&(r=t.errors[0].message||r),p(r),v(!1)}},Y=()=>{C(!1),u(""),d(""),f(""),h("")},G=()=>{N.key!=="default"&&N.pathname!=="/"?m(-1):m(n?"/":"/confirm-wishes")},U=()=>{m("/donation")},z=()=>"Add people who can access your farewell wishes.";return k?e.createElement(M,{title:e.createElement(e.Fragment,null,e.createElement("span",{className:"h1b"},"Loading")," ",e.createElement("span",{className:"h1"},"Information")),subtitle:e.createElement("span",{className:"h1sub"},"Please wait")},e.createElement("div",{className:"form-box-container"},e.createElement("div",{className:"form-box",style:{textAlign:"center",padding:"20px"}},"Loading your information..."))):e.createElement(M,{title:e.createElement(e.Fragment,null,e.createElement("span",{className:"h1b"},"Share")," ",e.createElement("span",{className:"h1"},"Your Wishes")),subtitle:e.createElement("span",{className:"h1sub"},z()),onGoBack:G,onSaveContinue:w,continueButtonText:n?"Accept Invitation":"Share Wishes",showSkipButton:!1,hideFooter:!0,showFooter:!1,mobileResponsive:!0},e.createElement("div",{className:"add-collaborators-container"},e.createElement(X,{className:"collaborator-form-box"},e.createElement("button",{className:"form-exit-button",onClick:U,"aria-label":"Exit to donation screen"},e.createElement("img",{src:"/Picture/exit-x.svg",alt:"Exit"})),e.createElement("form",{className:"collaborator-form",onSubmit:w},e.createElement("div",{className:"form-field"},e.createElement(E,{label:"Full Name",id:"collaboratorFullName",value:i,onChange:a=>{u(a.target.value),g("fullName")},onBlur:()=>g("fullName"),placeholder:"First & Last Name",required:!!i.trim()||!!s.trim()})),e.createElement("div",{className:"form-field"},e.createElement(E,{label:"Email Address",id:"collaboratorEmail",type:"email",value:s,onChange:a=>{d(a.target.value),g("email")},onBlur:()=>g("email"),placeholder:n?"Your Email Address":"Enter their email address",required:!!i.trim()||!!s.trim(),disabled:n&&$?.invitedEmail})),e.createElement("div",{className:"form-field"},e.createElement(E,{type:"dropdown",label:`Relationship ${n?"to the Plan Owner":"to You"} (Optional)`,options:ae,value:S,onChange:a=>f(a.target.value),placeholder:"Choose from dropdown"})),e.createElement("div",{className:"form-field"},e.createElement(E,{label:`Personal Message ${n?"to the Plan Owner":"to Them"} (Optional)`,id:"personalMessage",multiline:!0,value:T,onChange:a=>h(a.target.value),placeholder:n?"Add a note for the plan owner...":"Write a short note to let them know why you're sharing...",textareaClassName:"tributes-textarea farewell-scrollbar",style:{minHeight:"7rem"}})),I&&(x.fullName||x.email)&&e.createElement("div",{className:"error-helper"},I),e.createElement("div",{className:"button-container-centered"},e.createElement(Z,{onClick:w,disabled:R,className:"centered-button"},n?"Accept Invitation":"Share Wishes"))),D&&e.createElement(ee,{collaboratorName:q.name,onClose:()=>m("/donation"),onShareMore:Y}))))};export{he as default};
