import{a as M,r as o,j as e}from"./react-vendor-C_ls207L.js";import{b as L,l as F,d as D}from"./index-zctVBz0Z.js";import{u as W}from"./usePlanningData-B1SNKOR8.js";import{P as q}from"./PrimaryButton-BzVl43HT.js";import{F as A}from"./FormBox-Dl2qNixC.js";import{S as B}from"./StandardLayout-CHsFjCWf.js";import{S as g}from"./ShareMoreModal-DnXwJGI9.js";import{g as P}from"./amplify-core-Blotw2Bg.js";import"./vendor-DeJPPs1q.js";import"./sanity-BS235U2J.js";import"./stripe-CN_WJsnY.js";import"./PageWrapper-CRYaw3_L.js";import"./Footer-B_S_3MWt.js";const X=()=>{const u=M(),{user:N,isAuthenticated:h}=L(),{currentPlanId:t}=W(),[i,x]=o.useState([]),[w,n]=o.useState(!0),[p,v]=o.useState(null),[C,j]=o.useState(!1),[b,f]=o.useState(null),c=o.useRef(null),m=P();o.useEffect(()=>{(async()=>{if(h&&t)try{n(!0),console.log("Fetching collaborators for plan:",t);const d=(await m.graphql({query:F,variables:{filter:{farewellPlanCollaboratorsId:{eq:t}}}})).data.listCollaborators.items||[];console.log("Raw collaborator data:",d);const l=d.map(r=>({id:r.id,name:r.name||r.email.split("@")[0],email:r.email,relationship:r.role||"Collaborator",status:r.status,invitedAt:r.invitedAt}));console.log("Transformed collaborators:",l),x(l),n(!1)}catch(a){console.error("Error fetching collaborators:",a),n(!1)}else console.log("Not fetching collaborators - authenticated:",h,"planId:",t),n(!1)})()},[h,N,t,m]),o.useEffect(()=>{function s(a){c.current&&!c.current.contains(a.target)&&f(null)}return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[c]);const S=async s=>{try{console.log("Removing collaborator:",s);const a=i.find(l=>l.id===s),d=await m.graphql({query:D,variables:{input:{id:s}}});console.log("Collaborator deleted successfully:",d.data.deleteCollaborator),x(i.filter(l=>l.id!==s)),v(a)}catch(a){console.error("Error removing collaborator:",a)}},y=s=>{f(b===s?null:s)},R=()=>{v(null)},k=()=>{u("/add-collaborator")},E=()=>{j(!1),u("/add-collaborator")};return e.jsxs(B,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"h1b",children:"Shared "}),e.jsx("span",{className:"h1",children:"Wishes"})]}),subtitle:e.jsx("span",{className:"h1sub",children:"Update who can view your Farewell Wishes â€” add trusted people or remove access as needed."}),hideFooter:!0,showFooter:!1,children:[e.jsx("div",{className:"collaborator-dashboard-container",children:e.jsx(A,{className:"collaborator-form-box",children:e.jsxs("div",{className:"current-collaborators-section",children:[e.jsx("h2",{className:"section-title",children:"Current Collaborators"}),w?e.jsx("div",{className:"loading-indicator",children:"Loading collaborators..."}):i.length===0?e.jsx("div",{className:"no-collaborators-message",children:e.jsx("p",{children:"You haven't shared your wishes with anyone yet."})}):e.jsxs("div",{className:"collaborator-cards",children:[e.jsxs("div",{className:"collaborator-card header",children:[e.jsx("div",{className:"collaborator-name",children:"Name"}),e.jsx("div",{className:"collaborator-email",children:"Email"}),e.jsx("div",{className:"collaborator-relationship",children:"Relationship"}),e.jsx("div",{className:"collaborator-actions",children:"Remove"})]}),i.map(s=>e.jsxs("div",{className:"collaborator-card",children:[e.jsx("div",{className:"collaborator-name",children:s.name}),e.jsx("div",{className:"collaborator-email",children:s.email}),e.jsx("div",{className:"collaborator-relationship",children:s.relationship||"Not specified"}),e.jsx("div",{className:"mobile-details",children:e.jsxs("div",{className:"details-dropdown",ref:c,children:[e.jsx("button",{className:"more-button",onClick:()=>y(s.id),"aria-label":"Show more details",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#34547A",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"1"}),e.jsx("circle",{cx:"12",cy:"5",r:"1"}),e.jsx("circle",{cx:"12",cy:"19",r:"1"})]})}),b===s.id&&e.jsxs("div",{className:"details-dropdown-content show",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Email:"}),e.jsx("span",{children:s.email})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Relationship:"}),e.jsx("span",{children:s.relationship||"Not specified"})]})]})]})}),e.jsx("div",{className:"collaborator-actions",children:e.jsx("button",{className:"remove-button",onClick:()=>S(s.id),"aria-label":`Remove ${s.name}`,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#B93636",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 6h18"}),e.jsx("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})]})})})]},s.id))]}),e.jsx("div",{className:"share-button-container",children:e.jsx(q,{onClick:k,className:"share-wishes-btn",children:"Share Wishes"})})]})})}),p&&e.jsx(g,{modalType:"removeSuccess",collaboratorName:p.name,onClose:R}),C&&e.jsx(g,{modalType:"shareMore",isReturningUser:!0,onClose:()=>j(!1),onShareMore:E})]})};export{X as default};
