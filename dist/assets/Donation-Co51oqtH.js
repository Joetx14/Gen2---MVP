import{a as H,u as I,r as s,j as e,E as J,h as Y,i as q,k as K}from"./react-vendor-C_ls207L.js";import{l as U}from"./stripe-CN_WJsnY.js";import{S as Z}from"./StandardLayout-CHsFjCWf.js";import{F as W}from"./FormBox-Dl2qNixC.js";/* empty css                  */import{u as X}from"./usePlanningData-B1SNKOR8.js";import"./vendor-DeJPPs1q.js";import"./sanity-BS235U2J.js";import"./PageWrapper-CRYaw3_L.js";import"./Footer-B_S_3MWt.js";import"./index-zctVBz0Z.js";import"./amplify-core-Blotw2Bg.js";const G=U("pk_test_51RXq0S4ULmLYjN7nF1rMkXtrZ5Ll67OYqjEiJoG5khgSlVYdZy0LuJDqyHySjJgAaggB2gKhEgKkZgpKsCiCnbFn00tPOnrlhl"),Q=({donationAmount:g,firstName:m,lastName:k,setPaymentError:p,setIsSubmitting:c,navigate:o,clientSecret:F,isRecurring:y})=>{const l=Y(),t=q(),[u,h]=s.useState(!1);s.useEffect(()=>{console.log("DonationFormContent mounted"),console.log("Stripe initialized:",!!l),console.log("Elements initialized:",!!t)},[l,t]);const P=async j=>{if(j.preventDefault(),h(!0),c(!0),!l||!t){p("Stripe is not loaded yet. Please try again in a moment."),h(!1),c(!1);return}p(null);try{const f=await l.confirmPayment({elements:t,confirmParams:{return_url:`${window.location.origin}/dashboard?payment_success=true`,payment_method_data:{billing_details:{name:`${m} ${k}`.trim(),email:m?`${m.toLowerCase()}@example.com`:void 0}}},redirect:"if_required"});f.error?(console.error("[Stripe error]",f.error),p(f.error.message||"An unexpected error occurred during payment."),h(!1),c(!1)):o("/dashboard?payment_success=true")}catch(f){console.error("Payment confirmation error:",f),p("An unexpected error occurred. Please try again."),h(!1),c(!1)}};return e.jsxs("form",{onSubmit:P,className:"payment-form",children:[e.jsx("div",{style:{marginBottom:"20px"},children:e.jsx(K,{options:{layout:"tabs"}})}),e.jsx("button",{type:"submit",className:"pay-button",disabled:!l||!t||u,style:{width:"100%",padding:"12px",backgroundColor:"#c05f68",color:"white",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"600",cursor:"pointer"},children:u?e.jsx("span",{children:"Processing..."}):e.jsxs("span",{children:["Pay $",g.toFixed(2)]})})]})},pe=()=>{var R,_;const g=H(),m=I(),{routeToLastStep:k}=X(),p=(R=m.state)==null?void 0:R.returnToPlanning,c=(_=m.state)==null?void 0:_.lastStep,[o,F]=s.useState(!0),y=[3,9],l=[10,25],[t,u]=s.useState(y[0]),[h,P]=s.useState(""),[j,f]=s.useState(""),[E,x]=s.useState(null),[V,S]=s.useState(!1),[d,N]=s.useState(!1),[C,v]=s.useState(""),[b,A]=s.useState(""),[$,ee]=s.useState(null);s.useEffect(()=>{(async()=>{if(t<=0){A(""),x("Donation amount must be greater than zero.");return}x(null);try{console.log("Fetching client secret for amount:",t);const r=Math.round(t*100),a=await fetch("https://us-central1-farewell-app.cloudfunctions.net/createPaymentIntent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:r,isRecurring:o})});if(!a.ok){const w=await a.json().catch(()=>null);throw new Error(w&&w.error?w.error:`HTTP error! Status: ${a.status}`)}const i=await a.json();console.log("Client secret received:",i.clientSecret?"✓":"✗"),A(i.clientSecret)}catch(r){console.error("Error fetching client secret:",r),x(`Failed to initialize payment: ${r.message}`)}})()},[t,o]),s.useEffect(()=>{d&&parseFloat(C)>0?u(parseFloat(C)):(u(o?y[0]:l[0]),N(!1)),v("")},[o]);const T=n=>{F(n)},L=n=>{u(n),N(!1)},O=()=>{N(!0),d||v(t.toString())},D=n=>{const a=n.target.value.replace(/[^\d.]/g,"").split(".");if(a.length>2)return;a[1]&&a[1].length>2&&(a[1]=a[1].substring(0,2));const i=a.join(".");v(i),u(parseFloat(i)||0)},z=()=>{g(p&&c?c:"/confirm-wishes")},M=s.useMemo(()=>b?{clientSecret:b,appearance:{theme:"stripe",variables:{colorPrimary:"#c05f68",colorBackground:"#ffffff",colorText:"#30313d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',borderRadius:"4px"}},loader:"auto"}:null,[b]),B=async()=>{try{S(!0);const n=Math.round(t*100),r=await fetch("https://us-central1-farewell-app.cloudfunctions.net/createCheckoutSession",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:n,isRecurring:o,successUrl:`${window.location.origin}/dashboard?success=true`,cancelUrl:`${window.location.origin}/donation?canceled=true`})});if(!r.ok){const i=await r.json().catch(()=>null);throw new Error((i==null?void 0:i.error)||`HTTP error ${r.status}`)}const{url:a}=await r.json();console.log("Redirecting to checkout:",a),window.location.href=a}catch(n){console.error("Error redirecting to checkout:",n),x(`Failed to redirect to checkout: ${n.message}`),S(!1)}};return e.jsx(Z,{title:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"h1b",children:"Support"})," ",e.jsx("span",{className:"h1",children:"Our Cause"})]}),subtitle:e.jsx("span",{className:"h1sub",children:"And secure access to Farewell for life!"}),hideFooter:!0,showFooter:!1,children:e.jsx("div",{className:"donation-container",children:e.jsxs(W,{className:"donation-form-box",children:[e.jsx("button",{type:"button",className:"exit-button",onClick:z,"aria-label":"Close donation form",children:e.jsx("img",{src:"/Picture/exit-x.svg",alt:"Close"})}),e.jsx("div",{className:"impact-message",children:"Your contribution helps families navigate end-of-life planning with dignity and care."}),e.jsxs("div",{className:"contribution-tabs",role:"tablist",children:[e.jsxs("button",{type:"button",className:`tab ${o?"active":""}`,onClick:()=>T(!0),role:"tab","aria-selected":o,"aria-controls":"monthly-donation-panel",id:"monthly-tab",children:[e.jsx("span",{className:"tab-label",children:"Monthly"}),e.jsx("span",{className:"tab-benefit",children:"Help us grow"})]}),e.jsxs("button",{type:"button",className:`tab ${o?"":"active"}`,onClick:()=>T(!1),role:"tab","aria-selected":!o,"aria-controls":"one-time-donation-panel",id:"one-time-tab",children:[e.jsx("span",{className:"tab-label",children:"One-time"}),e.jsx("span",{className:"tab-benefit",children:"Quick support"})]})]}),e.jsxs("div",{className:"amount-selection",role:"tabpanel",id:o?"monthly-donation-panel":"one-time-donation-panel","aria-labelledby":o?"monthly-tab":"one-time-tab",children:[e.jsx("label",{className:"form-label",id:"select-amount-label",children:"Select an amount"}),e.jsxs("div",{className:"amount-options",role:"radiogroup","aria-labelledby":"select-amount-label",children:[(o?y:l).map(n=>e.jsxs("button",{type:"button",className:`amount-option ${t===n&&!d?"selected":""}`,onClick:()=>L(n),role:"radio","aria-checked":t===n&&!d,children:["$",n]},n)),e.jsx("button",{type:"button",className:`amount-option ${d?"selected":""}`,onClick:O,role:"radio","aria-checked":d,children:"Custom"})]}),d&&e.jsx("div",{className:"custom-amount",children:e.jsxs("div",{className:"input-with-prefix",children:[e.jsx("span",{className:"currency-prefix","aria-hidden":"true",children:"$"}),e.jsx("input",{className:"custom-amount-input",type:"text",value:C,onChange:D,placeholder:"0.00","aria-label":"Custom donation amount",inputMode:"decimal",autoFocus:!0})]})}),e.jsxs("div",{className:"amount-summary","aria-live":"polite",children:[e.jsx("span",{className:"amount-label",children:o?"Monthly donation:":"One-time donation:"}),e.jsxs("span",{className:"amount-value",children:["$",t.toFixed(2)]})]})]}),b&&t>0?e.jsx(J,{stripe:G,options:M,children:e.jsx(Q,{donationAmount:t,firstName:h,lastName:j,setPaymentError:x,setIsSubmitting:S,navigate:g,clientSecret:b,isRecurring:o})}):e.jsx("div",{className:"loading-payment-section",children:E?e.jsx("p",{className:"error-message",children:E}):e.jsx("p",{children:"Loading payment options..."})}),$&&e.jsx("div",{className:"error-message full-width",children:$}),e.jsx("div",{className:"privacy-note",children:e.jsxs("p",{className:"donation-privacy-text",children:["Your payment information is secure. By proceeding, you agree to our ",e.jsx("a",{href:"/terms",target:"_blank",rel:"noopener noreferrer",children:"Terms of Service"})," and ",e.jsx("a",{href:"/privacy",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"}),"."]})}),e.jsx("p",{className:"unlock-message",children:"By completing this support, you'll immediately unlock access to all future features of Farewell at no additional cost."}),!1,e.jsx("button",{type:"button",onClick:B,className:"pay-button",style:{width:"100%",padding:"12px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"600",cursor:"pointer",marginTop:"10px"},children:"Try Stripe Checkout Instead"})]})})})};export{pe as default};
