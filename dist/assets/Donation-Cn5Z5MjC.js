import{H as ye,R as o,y as ve,z as ge,r as E,w as be}from"./index-CF6624GP.js";import{S as Ee}from"./StandardLayout-BbnnO7S-.js";import{F as Ce}from"./FormBox-CJsMRRhu.js";import"./TextInput-C1wQsApC.js";import{u as Se}from"./usePlanningData-DIMTIp08.js";import"./PageWrapper-BpgNwjTZ.js";import"./Footer-Dbu-YUaM.js";var G={exports:{}},Q,te;function ke(){if(te)return Q;te=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Q=r,Q}var X,re;function xe(){if(re)return X;re=1;var r=ke();function e(){}function t(){}return t.resetWarningCache=e,X=function(){function n(f,v,i,l,d,g){if(g!==r){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}n.isRequired=n;function s(){return n}var a={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:s,element:n,elementType:n,instanceOf:s,node:n,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:t,resetWarningCache:e};return a.PropTypes=a,a},X}var ne;function Pe(){return ne||(ne=1,G.exports=xe()()),G.exports}var we=Pe();const m=ye(we);function oe(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function ae(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?oe(Object(t),!0).forEach(function(n){le(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):oe(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function H(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?H=function(e){return typeof e}:H=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(r)}function le(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Oe(r,e){if(r==null)return{};var t={},n=Object.keys(r),s,a;for(a=0;a<n.length;a++)s=n[a],!(e.indexOf(s)>=0)&&(t[s]=r[s]);return t}function Ne(r,e){if(r==null)return{};var t=Oe(r,e),n,s;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);for(s=0;s<a.length;s++)n=a[s],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}function ue(r,e){return Te(r)||Re(r,e)||Ae(r,e)||je()}function Te(r){if(Array.isArray(r))return r}function Re(r,e){var t=r&&(typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"]);if(t!=null){var n=[],s=!0,a=!1,f,v;try{for(t=t.call(r);!(s=(f=t.next()).done)&&(n.push(f.value),!(e&&n.length===e));s=!0);}catch(i){a=!0,v=i}finally{try{!s&&t.return!=null&&t.return()}finally{if(a)throw v}}return n}}function Ae(r,e){if(r){if(typeof r=="string")return se(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return se(r,e)}}function se(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function je(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var k=function(e,t,n){var s=!!n,a=o.useRef(n);o.useEffect(function(){a.current=n},[n]),o.useEffect(function(){if(!s||!e)return function(){};var f=function(){a.current&&a.current.apply(a,arguments)};return e.on(t,f),function(){e.off(t,f)}},[s,t,e,a])},Z=function(e){var t=o.useRef(e);return o.useEffect(function(){t.current=e},[e]),t.current},_=function(e){return e!==null&&H(e)==="object"},_e=function(e){return _(e)&&typeof e.then=="function"},Fe=function(e){return _(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},ie="[object Object]",Ie=function r(e,t){if(!_(e)||!_(t))return e===t;var n=Array.isArray(e),s=Array.isArray(t);if(n!==s)return!1;var a=Object.prototype.toString.call(e)===ie,f=Object.prototype.toString.call(t)===ie;if(a!==f)return!1;if(!a&&!n)return e===t;var v=Object.keys(e),i=Object.keys(t);if(v.length!==i.length)return!1;for(var l={},d=0;d<v.length;d+=1)l[v[d]]=!0;for(var g=0;g<i.length;g+=1)l[i[g]]=!0;var u=Object.keys(l);if(u.length!==v.length)return!1;var O=e,S=t,x=function(F){return r(O[F],S[F])};return u.every(x)},pe=function(e,t,n){return _(e)?Object.keys(e).reduce(function(s,a){var f=!_(t)||!Ie(e[a],t[a]);return n.includes(a)?(f&&console.warn("Unsupported prop change: options.".concat(a," is not a mutable property.")),s):f?ae(ae({},s||{}),{},le({},a,e[a])):s},null):null},me="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",ce=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:me;if(e===null||Fe(e))return e;throw new Error(t)},$e=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:me;if(_e(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(s){return ce(s,t)})};var n=ce(e,t);return n===null?{tag:"empty"}:{tag:"sync",stripe:n}},We=function(e){!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:"react-stripe-js",version:"3.7.0"}),e.registerAppInfo({name:"react-stripe-js",version:"3.7.0",url:"https://stripe.com/docs/stripe-js/react"}))},J=o.createContext(null);J.displayName="ElementsContext";var fe=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},de=function(e){var t=e.stripe,n=e.options,s=e.children,a=o.useMemo(function(){return $e(t)},[t]),f=o.useState(function(){return{stripe:a.tag==="sync"?a.stripe:null,elements:a.tag==="sync"?a.stripe.elements(n):null}}),v=ue(f,2),i=v[0],l=v[1];o.useEffect(function(){var u=!0,O=function(x){l(function(P){return P.stripe?P:{stripe:x,elements:x.elements(n)}})};return a.tag==="async"&&!i.stripe?a.stripePromise.then(function(S){S&&u&&O(S)}):a.tag==="sync"&&!i.stripe&&O(a.stripe),function(){u=!1}},[a,i,n]);var d=Z(t);o.useEffect(function(){d!==null&&d!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[d,t]);var g=Z(n);return o.useEffect(function(){if(i.elements){var u=pe(n,g,["clientSecret","fonts"]);u&&i.elements.update(u)}},[n,g,i.elements]),o.useEffect(function(){We(i.stripe)},[i.stripe]),o.createElement(J.Provider,{value:i},s)};de.propTypes={stripe:m.any,options:m.object};var Le=function(e){var t=o.useContext(J);return fe(t,e)},De=function(){var e=Le("calls useElements()"),t=e.elements;return t};m.func.isRequired;var he=o.createContext(null);he.displayName="CheckoutSdkContext";var Be=function(e,t){if(!e)throw new Error("Could not find CheckoutProvider context; You need to wrap the part of your app that ".concat(t," in an <CheckoutProvider> provider."));return e},Me=o.createContext(null);Me.displayName="CheckoutContext";m.any,m.shape({fetchClientSecret:m.func.isRequired,elementsOptions:m.object}).isRequired;var ee=function(e){var t=o.useContext(he),n=o.useContext(J);if(t&&n)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CheckoutProvider> and <Elements> providers."));return t?Be(t,e):fe(n,e)},Ue=["mode"],qe=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},h=function(e,t){var n="".concat(qe(e),"Element"),s=function(i){var l=i.id,d=i.className,g=i.options,u=g===void 0?{}:g,O=i.onBlur,S=i.onFocus,x=i.onReady,P=i.onChange,F=i.onEscape,I=i.onClick,R=i.onLoadError,$=i.onLoaderStart,W=i.onNetworksChange,L=i.onConfirm,A=i.onCancel,U=i.onShippingAddressChange,q=i.onShippingRateChange,D=ee("mounts <".concat(n,">")),j="elements"in D?D.elements:null,N="checkoutSdk"in D?D.checkoutSdk:null,Y=o.useState(null),z=ue(Y,2),C=z[0],K=z[1],w=o.useRef(null),B=o.useRef(null);k(C,"blur",O),k(C,"focus",S),k(C,"escape",F),k(C,"click",I),k(C,"loaderror",R),k(C,"loaderstart",$),k(C,"networkschange",W),k(C,"confirm",L),k(C,"cancel",A),k(C,"shippingaddresschange",U),k(C,"shippingratechange",q),k(C,"change",P);var M;x&&(e==="expressCheckout"?M=x:M=function(){x(C)}),k(C,"ready",M),o.useLayoutEffect(function(){if(w.current===null&&B.current!==null&&(j||N)){var c=null;if(N)switch(e){case"payment":c=N.createPaymentElement(u);break;case"address":if("mode"in u){var b=u.mode,T=Ne(u,Ue);if(b==="shipping")c=N.createShippingAddressElement(T);else if(b==="billing")c=N.createBillingAddressElement(T);else throw new Error("Invalid options.mode. mode must be 'billing' or 'shipping'.")}else throw new Error("You must supply options.mode. mode must be 'billing' or 'shipping'.");break;case"expressCheckout":c=N.createExpressCheckoutElement(u);break;case"currencySelector":c=N.createCurrencySelectorElement();break;default:throw new Error("Invalid Element type ".concat(n,". You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />."))}else j&&(c=j.create(e,u));w.current=c,K(c),c&&c.mount(B.current)}},[j,N,u]);var p=Z(u);return o.useEffect(function(){if(w.current){var c=pe(u,p,["paymentRequest"]);c&&"update"in w.current&&w.current.update(c)}},[u,p]),o.useLayoutEffect(function(){return function(){if(w.current&&typeof w.current.destroy=="function")try{w.current.destroy(),w.current=null}catch{}}},[]),o.createElement("div",{id:l,className:d,ref:B})},a=function(i){ee("mounts <".concat(n,">"));var l=i.id,d=i.className;return o.createElement("div",{id:l,className:d})},f=t?a:s;return f.propTypes={id:m.string,className:m.string,onChange:m.func,onBlur:m.func,onFocus:m.func,onReady:m.func,onEscape:m.func,onClick:m.func,onLoadError:m.func,onLoaderStart:m.func,onNetworksChange:m.func,onConfirm:m.func,onCancel:m.func,onShippingAddressChange:m.func,onShippingRateChange:m.func,options:m.object},f.displayName=n,f.__elementType=e,f},y=typeof window>"u",Ye=o.createContext(null);Ye.displayName="EmbeddedCheckoutProviderContext";var ze=function(){var e=ee("calls useStripe()"),t=e.stripe;return t};h("auBankAccount",y);h("card",y);h("cardNumber",y);h("cardExpiry",y);h("cardCvc",y);h("fpxBank",y);h("iban",y);h("idealBank",y);h("p24Bank",y);h("epsBank",y);var He=h("payment",y);h("expressCheckout",y);h("currencySelector",y);h("paymentRequestButton",y);h("linkAuthentication",y);h("address",y);h("shippingAddress",y);h("paymentMethodMessaging",y);h("affirmMessage",y);h("afterpayClearpayMessage",y);const Je=({donationAmount:r,firstName:e,lastName:t,setPaymentError:n,setIsSubmitting:s,navigate:a,clientSecret:f,isRecurring:v})=>{const i=ze(),l=De(),[d,g]=E.useState(!1);E.useEffect(()=>{console.log("DonationFormContent mounted"),console.log("Stripe initialized:",!!i),console.log("Elements initialized:",!!l)},[i,l]);const u=async O=>{if(O.preventDefault(),g(!0),s(!0),!i||!l){n("Stripe is not loaded yet. Please try again in a moment."),g(!1),s(!1);return}n(null);try{const S=await i.confirmPayment({elements:l,confirmParams:{return_url:`${window.location.origin}/dashboard?payment_success=true`,payment_method_data:{billing_details:{name:`${e} ${t}`.trim(),email:e?`${e.toLowerCase()}@example.com`:void 0}}},redirect:"if_required"});S.error?(console.error("[Stripe error]",S.error),n(S.error.message||"An unexpected error occurred during payment."),g(!1),s(!1)):a("/dashboard?payment_success=true")}catch(S){console.error("Payment confirmation error:",S),n("An unexpected error occurred. Please try again."),g(!1),s(!1)}};return o.createElement("form",{onSubmit:u,className:"payment-form"},o.createElement("div",{style:{marginBottom:"20px"}},o.createElement(He,{options:{layout:"tabs"}})),o.createElement("button",{type:"submit",className:"pay-button",disabled:!i||!l||d,style:{width:"100%",padding:"12px",backgroundColor:"#c05f68",color:"white",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"600",cursor:"pointer"}},d?o.createElement("span",null,"Processing..."):o.createElement("span",null,"Pay $",r.toFixed(2))))},tt=()=>{const r=ve(),e=ge(),{routeToLastStep:t}=Se(),n=e.state?.returnToPlanning,s=e.state?.lastStep,[a,f]=E.useState(!0),v=[3,9],i=[10,25],[l,d]=E.useState(v[0]),[g,u]=E.useState(""),[O,S]=E.useState(""),[x,P]=E.useState(null),[F,I]=E.useState(!1),[R,$]=E.useState(!1),[W,L]=E.useState(""),[A,U]=E.useState(""),[q,D]=E.useState(null),[j,N]=E.useState(null);E.useEffect(()=>{let p=!0;return be(async()=>{const{loadStripe:c}=await import("./index-BArKxyv9.js");return{loadStripe:c}},[]).then(({loadStripe:c})=>{p&&N(c("pk_test_51RXnXYG0OYrUVFvzGJONOsFdtY0ib6iFfSkvdpOEV9YTk1TQ4FjGvf2xp5G4a6wHZlMpfuKP8SrCi5kQ8R9uSKyB00ZTz09Pol"))}),()=>{p=!1}},[]),E.useEffect(()=>{(async()=>{if(l<=0){U(""),P("Donation amount must be greater than zero.");return}P(null);try{console.log("Fetching client secret for amount:",l);const c=Math.round(l*100),b=await fetch("https://us-central1-farewell-app.cloudfunctions.net/createPaymentIntent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:c,isRecurring:a})});if(!b.ok){const V=await b.json().catch(()=>null);throw new Error(V&&V.error?V.error:`HTTP error! Status: ${b.status}`)}const T=await b.json();console.log("Client secret received:",T.clientSecret?"✓":"✗"),U(T.clientSecret)}catch(c){console.error("Error fetching client secret:",c),P(`Failed to initialize payment: ${c.message}`)}})()},[l,a]),E.useEffect(()=>{R&&parseFloat(W)>0?d(parseFloat(W)):(d(a?v[0]:i[0]),$(!1)),L("")},[a]);const Y=p=>{f(p)},z=p=>{d(p),$(!1)},C=()=>{$(!0),R||L(l.toString())},K=p=>{const b=p.target.value.replace(/[^\d.]/g,"").split(".");if(b.length>2)return;b[1]&&b[1].length>2&&(b[1]=b[1].substring(0,2));const T=b.join(".");L(T),d(parseFloat(T)||0)},w=()=>{r(n&&s?s:"/confirm-wishes")},B=E.useMemo(()=>A?{clientSecret:A,appearance:{theme:"stripe",variables:{colorPrimary:"#c05f68",colorBackground:"#ffffff",colorText:"#30313d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',borderRadius:"4px"}},loader:"auto"}:null,[A]),M=async()=>{try{I(!0);const p=Math.round(l*100),c=await fetch("https://us-central1-farewell-app.cloudfunctions.net/createCheckoutSession",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:p,isRecurring:a,successUrl:`${window.location.origin}/dashboard?success=true`,cancelUrl:`${window.location.origin}/donation?canceled=true`})});if(!c.ok){const T=await c.json().catch(()=>null);throw new Error(T?.error||`HTTP error ${c.status}`)}const{url:b}=await c.json();console.log("Redirecting to checkout:",b),window.location.href=b}catch(p){console.error("Error redirecting to checkout:",p),P(`Failed to redirect to checkout: ${p.message}`),I(!1)}};return o.createElement(Ee,{title:o.createElement(o.Fragment,null,o.createElement("span",{className:"h1b"},"Support")," ",o.createElement("span",{className:"h1"},"Our Cause")),subtitle:o.createElement("span",{className:"h1sub"},"And secure access to Farewell for life!"),hideFooter:!0,showFooter:!1},o.createElement("div",{className:"donation-container"},o.createElement(Ce,{className:"donation-form-box"},o.createElement("button",{type:"button",className:"exit-button",onClick:w,"aria-label":"Close donation form"},o.createElement("img",{src:"/Picture/exit-x.svg",alt:"Close"})),o.createElement("div",{className:"impact-message"},"Your contribution helps families navigate end-of-life planning with dignity and care."),o.createElement("div",{className:"contribution-tabs",role:"tablist"},o.createElement("button",{type:"button",className:`tab ${a?"active":""}`,onClick:()=>Y(!0),role:"tab","aria-selected":a,"aria-controls":"monthly-donation-panel",id:"monthly-tab"},o.createElement("span",{className:"tab-label"},"Monthly"),o.createElement("span",{className:"tab-benefit"},"Help us grow")),o.createElement("button",{type:"button",className:`tab ${a?"":"active"}`,onClick:()=>Y(!1),role:"tab","aria-selected":!a,"aria-controls":"one-time-donation-panel",id:"one-time-tab"},o.createElement("span",{className:"tab-label"},"One-time"),o.createElement("span",{className:"tab-benefit"},"Quick support"))),o.createElement("div",{className:"amount-selection",role:"tabpanel",id:a?"monthly-donation-panel":"one-time-donation-panel","aria-labelledby":a?"monthly-tab":"one-time-tab"},o.createElement("label",{className:"form-label",id:"select-amount-label"},"Select an amount"),o.createElement("div",{className:"amount-options",role:"radiogroup","aria-labelledby":"select-amount-label"},(a?v:i).map(p=>o.createElement("button",{key:p,type:"button",className:`amount-option ${l===p&&!R?"selected":""}`,onClick:()=>z(p),role:"radio","aria-checked":l===p&&!R},"$",p)),o.createElement("button",{type:"button",className:`amount-option ${R?"selected":""}`,onClick:C,role:"radio","aria-checked":R},"Custom")),R&&o.createElement("div",{className:"custom-amount"},o.createElement("div",{className:"input-with-prefix"},o.createElement("span",{className:"currency-prefix","aria-hidden":"true"},"$"),o.createElement("input",{className:"custom-amount-input",type:"text",value:W,onChange:K,placeholder:"0.00","aria-label":"Custom donation amount",inputMode:"decimal",autoFocus:!0}))),o.createElement("div",{className:"amount-summary","aria-live":"polite"},o.createElement("span",{className:"amount-label"},a?"Monthly donation:":"One-time donation:"),o.createElement("span",{className:"amount-value"},"$",l.toFixed(2)))),A&&l>0?o.createElement(de,{stripe:j,options:B},o.createElement(Je,{donationAmount:l,firstName:g,lastName:O,setPaymentError:P,setIsSubmitting:I,navigate:r,clientSecret:A,isRecurring:a})):o.createElement("div",{className:"loading-payment-section"},x?o.createElement("p",{className:"error-message"},x):o.createElement("p",null,"Loading payment options...")),q&&o.createElement("div",{className:"error-message full-width"},q),o.createElement("div",{className:"privacy-note"},o.createElement("p",{className:"donation-privacy-text"},"Your payment information is secure. By proceeding, you agree to our ",o.createElement("a",{href:"/terms",target:"_blank",rel:"noopener noreferrer"},"Terms of Service")," and ",o.createElement("a",{href:"/privacy",target:"_blank",rel:"noopener noreferrer"},"Privacy Policy"),".")),o.createElement("p",{className:"unlock-message"},"By completing this support, you'll immediately unlock access to all future features of Farewell at no additional cost."),!1,o.createElement("button",{type:"button",onClick:M,className:"pay-button",style:{width:"100%",padding:"12px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"600",cursor:"pointer",marginTop:"10px"}},"Try Stripe Checkout Instead"))))};export{tt as default};
